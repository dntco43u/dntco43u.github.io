[{"body":"","categories":["dev"],"description":"개발 색인","excerpt":"개발 색인","ref":"/dev/","tags":"","title":"개발"},{"body":"","categories":["infra"],"description":"개발환경 색인","excerpt":"개발환경 색인","ref":"/infra/","tags":"","title":"개발환경"},{"body":"","categories":["references"],"description":"참고 색인","excerpt":"참고 색인","ref":"/ref/","tags":"","title":"참고"},{"body":"","categories":["etc"],"description":"기타 색인","excerpt":"기타 색인","ref":"/etc/","tags":"","title":"기타"},{"body":"","categories":["apps"],"description":"앱 색인","excerpt":"앱 색인","ref":"/apps/","tags":"","title":"앱"},{"body":"작성 중 ","categories":["apps"],"description":"ansible 구성","excerpt":"ansible 구성","ref":"/apps/ansible/","tags":["ansible"],"title":"ansible"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/ansible/","tags":"","title":"ansible"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/apps/","tags":"","title":"apps"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/","tags":"","title":"categories"},{"body":"작성 중 ","categories":["apps"],"description":"kubernetes 구성","excerpt":"kubernetes 구성","ref":"/apps/kubernetes/","tags":["kubernetes"],"title":"kubernetes"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/kubernetes/","tags":"","title":"kubernetes"},{"body":"작성 중 ","categories":["apps"],"description":"rabbitmq 구성","excerpt":"rabbitmq 구성","ref":"/apps/rabbitmq/","tags":["rabbitmq"],"title":"rabbitmq"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/rabbitmq/","tags":"","title":"rabbitmq"},{"body":"작성 중 ","categories":["apps"],"description":"redis 구성","excerpt":"redis 구성","ref":"/apps/redis/","tags":["redis"],"title":"redis"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/redis/","tags":"","title":"redis"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/","tags":"","title":"tags"},{"body":"","categories":"","description":"잡동사니정리 색인","excerpt":"잡동사니정리 색인","ref":"/","tags":"","title":"잡동사니정리"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/ftp/","tags":"","title":"ftp"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/infra/","tags":"","title":"infra"},{"body":"\nLicense 상업적 이용 제한 없음\nwinmerge: GNU GPL v2 1 D2Coding: OFL 2 References https://github.com/WinMerge/winmerge https://github.com/WinMerge/winmerge?tab=GPL-2.0-1-ov-file ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"winmerge 구성","excerpt":"winmerge 구성","ref":"/infra/winmerge/","tags":["winmerge"],"title":"winmerge"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/winmerge/","tags":"","title":"winmerge"},{"body":"\nLicense 상업적 이용 제한 없음\nwinscp: GNU GPL v3 1 D2Coding: OFL 2 References https://winscp.net/eng/index.php https://winscp.net/eng/index.php ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"winscp 구성","excerpt":"winscp 구성","ref":"/infra/winscp/","tags":["winscp","ftp"],"title":"winscp"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/winscp/","tags":"","title":"winscp"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/autohotkey/","tags":"","title":"autohotkey"},{"body":"작성 중 GitHub repository 바로 가기\ncontainer 구성 Dockerfile vi /opt/azvj6fml/Dockerfile FROM ibm-semeru-runtimes:open-17-jre #RUN adduser --no-create-home -u 1000 dev RUN mkdir -p /usr/share/java \u0026\u0026 \\ chown -R dev /usr/share/java USER 1000 COPY --chown=1000:1000 build/libs/*.jar /usr/share/java/app.jar WORKDIR /usr/share/java EXPOSE 61314/tcp ENTRYPOINT [\"java\", \"-Dspring.profiles.active=prod\", \"-Xms2G\", \"-Xmx2G\", \"-jar\", \"/usr/share/java/app.jar\"] docker-compose.yml vi /opt/azvj6fml/docker-compose.yml services: azvj6fml: image: e7hnr8ov/azvj6fml:open-17-jre container_name: azvj6fml networks: - dev ports: - 61314/tcp user: 1000:1000 environment: - TZ=Asia/Seoul volumes: - /opt/azvj6fml/log:/usr/share/java/log:rw restart: unless-stopped networks: dev: external: true host 구성 post_build.sh 1 vi /opt/bdkqpr0x/config/post_build.sh #!/bin/bash # 자동 build 후 처리 source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp jenkins_bot_key=\"$3\" tel_chat_id=\"$4\" { echo \"$1 #$2\" show_file_stat \"/opt/$1/build/libs/$1-0.0.1-SNAPSHOT.jar\" cd \"/opt/$1\" || exit 1 docker build -t \"e7hnr8ov/$1:open-17-jre\" \"/opt/$1\" if [ -f \"docker-compose.yml\" ]; then docker compose rm -f -s docker compose up -d docker exec -i \"$1\" date +\"%Z %F %T\" fi } \u003e \"$log_file\" read -ra args \u003c \u003c(docker images -q -f dangling=true) docker rmi \"${args[@]}\" rm -rf \"/opt/$1/build\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$jenkins_bot_key\" \"$tel_chat_id\" \"$msg_file\" rm \"$msg_file\" logrotate sudo vi /etc/logrotate.d/azvj6fml /opt/azvj6fml/log/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 dev dev sharedscripts postrotate docker restart azvj6fml \u003e/dev/null 2\u003e\u00261 || true endscript } ## 데모 페이지 Troubleshooting =\u003e ERROR [2/5] RUN adduser –no-create-home -u 1000 dev\nibm-semeru-runtimes:open-17-jre 이미지 업데이트로 Dockerfile build 시 계정 생성 구성 삭제\nvi /opt/bdkqpr0x/Dockerfile #RUN adduser --no-create-home -u 1000 dev https://hu.gvp6nx1a.duckdns.org/infra/jenkins/#post_buildsh ↩︎\n","categories":["dev"],"description":"springboot + vue.js 화면 샘플","excerpt":"springboot + vue.js 화면 샘플","ref":"/dev/azvj6fml/","tags":["oracle","sptingboot","rest-api","vue.js","docker"],"title":"azvj6fml"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/ci-cd/","tags":"","title":"ci-cd"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/dev/","tags":"","title":"dev"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/docker/","tags":"","title":"docker"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/docsy/","tags":"","title":"docsy"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/esportshelper/","tags":"","title":"esportshelper"},{"body":"Deprecated lolesports.com 로그인 페이지 변경에 대응하지 못함 지원 종료. 2024-02 이후 업데이트 없음 1\ngraph LR subgraph gvp6nx1a A[https://lolesports.com/] \u003c-- https --\u003e B B[esportshelper] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/esportshelper/docker-compose.yml services: esportshelper: image: e7hnr8ov/esportshelper:alpine container_name: esportshelper networks: - dev ports: - 3000/tcp user: 0:0 environment: - TZ=Asia/Seoul - PUID=1000 - PGID=1000 volumes: - /opt/esportshelper/config:/config:rw - /opt/esportshelper/config.yaml:/esportshelper/config.yaml:rw - /opt/esportshelper/data:/esportshelper/dropsHistory:rw shm_size: 2gb restart: unless-stopped networks: dev: external: true sudo docker cp esportshelper:/esportshelper/config.yaml /opt/esportshelper/ \u0026\u0026 \\ sudo chown dev:dev -R /opt/esportshelper config.yaml vi /opt/esportshelper/config.yaml ### 필수 입력 사항 username: \"f*******\" # 필수, 계정 번호 password: \"o***********************\" # 필수, 비밀번호 ### 선택사항 delay: 600 # 각 검사의 시간 간격(초)(기본값은 600초)(각 감지 시간은 설정한 지연의 0.8-1.5배 사이에서 무작위로 변동됩니다) headless: False # True로 설정하면 프로그램이 백그라운드에서 실행되고, 그렇지 않으면 브라우저 창이 열립니다(기본값은 False). language: \"en_US\" # 이제 \"zh_CN\", \"zh_TW\", \"en_US\" 언어를 지원합니다. 중국어 간체, 중국어 번체 및 영어. nickName: \"\" # 닉네임, 비어 있으면 기본값은 사용자 이름입니다(개인 정보 보호 강화). onlyWatchMatches: [\"lcs\",\"lla\",\"lpl\",\"lck\",\"ljl-japan\",\"lco\",\"lec\",\"cblol-brazil\",\"pcs\",\"tft_esports\",\"worlds\" ,\"wqs\"] # 감시 전용 경쟁 영역 이름, 소문자. disWatchMatches: [\"prime\",\"lfl\",\"liga\",\"hitpoint\",\"series\",\"nlc\",\"nationals\",\"academy\",\"qualifiers\",\"legends\",\"challengers\",\"league\" ] # 대회지역 이름을 보고 싶지 않다면 여기에 추가하면 됩니다. (참고로 소문자입니다.) maxRunHours: -1 # 음수 값은 항상 실행됨을 의미하고 양수 값은 실행 시간을 의미하며 기본값은 -1입니다. maxStream: 4 # 기본값은 동시에 시청할 수 있는 최대 게임 수인 4이며, 그 수를 초과하면 시청하지 않습니다. mode: \"safe\" # 모드 선택, safe는 안전 모드, Normal은 일반 모드, 기본값은 safe를 참조하세요. exportDrops: True # 기본값은 False입니다. 경력 드롭 세부 정보 파일을 내보내야 하는지 여부는 스크립트가 열릴 때만 생성됩니다. briefLogLength: 10 #간단한 로그 정보 개수 기본값은 10입니다. proxy: \"\" # 프록시 주소, 선택사항, 일반 사용자는 자신이 무엇을 하고 있는지 알지 못하는 한 입력할 필요가 없습니다. 예: \"양말://127.0.0.1:20173\" connectorDropsUrl: \"https://discord.com/api/webhooks/1******************/t***************-*****************-*********************************\" # (DingTalk, Discord, Job Warning, Enterprise WeChat, Feishu 지원) 구체적인 구성 방법은 여기에 있습니다 https://github.com/Yudaotor/EsportsHelper/wiki/%E6%80% 8E%E4 %B9%88%E9%85%8D%E7%BD%AE%E6%8E%89%E8%90%BD%E6%8F%90%E9%86%92%3F platForm: \"linux\" #플랫폼을 사용하세요. 기본값은 Windows입니다. Linux를 사용해야 하는 경우 여기에서 구성하세요. closeStream: False # 스트림 저장 모드, 기본값은 False, 라이브 방송실의 비디오 스트림을 닫습니다(위험이 존재하며 Riot에서 감지할 수 있음). desktopNotify: False # 시스템 오른쪽 하단에 팝업 메시지가 표시됩니다. 기본값은 False입니다. sleepPeriod: [\"0-0\"] # 수면 기간, (기본값은 비어 있음) 형식은 \"시작 시간 - 종료 시간\"입니다. 수면 기간 동안에는 보기 웹페이지가 닫히고 이후에는 잠이 다시 열렸습니다. 간격은 왼쪽이 닫혀 있고 오른쪽이 열려 있습니다. ignoreBroadCast: True # 생방송 방에 미리 입장하려면 False로 설정하고, 항상 방송되는 특정 경쟁 지역(예: TFT)에서 생방송을 지원합니다. userDataDir: \"\" # xxxxx가 자신의 컴퓨터 이름으로 변경되는 예는 https를 참조하세요. //github.com/Yudaotor/EsportsHelper/wiki/%E6%80%8E%E4%B9%88%E4%BD%BF%E7%94%A8%E6%9C%AC%E5%9C%B0%E6 %B5%8F %E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98-%E5%85%8D%E8%B4%A6%E5%AF%86%E7% 99%BB% E5%BD%95 chromePath: \"\" # Google Chrome 사용자 정의 경로 countDrops: True # 드롭 수를 확인할지 여부 notifyType: \"all\" # 푸시 정보 유형을 필터링합니다. \"all\"은 모든 정보를 푸시하고, \"error\"는 오류 정보만 푸시하고, \"drops\"는 드롭 정보만 푸시합니다. autoSleep: True # (권장) 자동으로 잠자기 여부, 기본값은 True debug: False # 디버그 모드를 활성화할지 여부. 활성화된 후 예외가 발생하면 스크린샷이 사진 폴더로 이동됩니다. 기본값은 False입니다. arm64: True # Linux ARM64에서 Chromium 사용을 지원하려면 platformForm: \"linux\"를 구성하고 \"/home/USERNAME/.local/share/unDetected_chromedriver/chromedriver\" 경로에 chromedriver가 있어야 합니다. 자세한 내용은 다음을 참조하세요. https:/ /github.com/Yudaotor/EsportsHelper/wiki/The-Way-Using-Chromium-on-ARM64 isDockerized: True # Docker에서 실행할 때만 True로 구성되며 기본값은 False입니다. webhook 구성 디스코드 webhook\nexport WEBHOOK_URL=\"https://discord.com/api/webhooks/1******************/t***************-*****************-*********************************\" curl \\ -H \"Content-Type: application/json\" \\ -d \"{\\\"username\\\": \\\"test\\\", \\\"content\\\": \\\"Test Sender\\n$(hostname)\\\"}\" \\ $WEBHOOK_URL proxy 구성 authelia 구성\nvi /opt/nginx/config/sites-available/esportshelper.conf ... location /authelia { if ($allowed_country = no) { return 403; } include /etc/nginx/snippets/authelia-api.conf; } location / { if ($allowed_country = no) { return 403; } proxy_pass http://esportshelper:3000; include /etc/nginx/snippets/authelia-auth.conf; add_header 'Cross-Origin-Embedder-Policy' 'require-corp'; add_header 'Cross-Origin-Opener-Policy' 'same-origin'; add_header 'Cross-Origin-Resource-Policy' 'same-site'; proxy_buffering off; proxy_request_buffering off; } ... Troubleshooting docker restart 불가\ndocker exec -it esportshelper rm -rf /tmp/.X1-lock \u0026\u0026 docker restart esportshelper ERROR: failed to solve: ghcr.io/linuxserver/baseimage-kasmvnc:alpine318: failed to resolve source metadata for ghcr.io/linuxserver/baseimage-kasmvnc:alpine318: no match for platform in manifest: not found\n기존 Dockerfile로 build 불가. baseimiage 변경 필요\nhttps://github.com/Yudaotor/EsportsHelper ↩︎\n","categories":["apps"],"description":"legague of legends esports drops 봇 구성","excerpt":"legague of legends esports drops 봇 구성","ref":"/apps/esportshelper/","tags":["esportshelper","docker"],"title":"esportshelper (deprecated)"},{"body":"\ngraph LR A1[websites] -- rss --\u003e B[freshrss] B -- google-api --\u003e C[rss-client] container 구성 docker-compose.yml vi /opt/freshrss/docker-compose.yml services: freshrss: image: linuxserver/freshrss:latest container_name: freshrss networks: - dev ports: - 80/tcp user: 0:0 environment: - PUID=911 - PGID=911 - TZ=Asia/Seoul volumes: - /opt/freshrss/data:/config:rw - /opt/freshrss/config/logrotate_nginx.conf:/etc/logrotate.d/nginx:ro - /opt/freshrss/config/logrotate_php-fpm.conf:/etc/logrotate.d/php-fpm:ro restart: unless-stopped networks: dev: external: true 구성 proxy url 구성\nvi /opt/freshrss/data/www/freshrss/data/config.php \u003c?php return array ( ... 'base_url' =\u003e 'https://fr.m7jrgve9.duckdns.org', ... logrotate logrotate는 root(0:0) 권한이 필요하고 app은 abc(911:911)가 실행한다\nlogrotate 재구성을 위해 host에 mount\ndocker exec -it freshrss id 911 \u0026\u0026 \\ sudo docker cp freshrss:/etc/logrotate.d/nginx /opt/freshrss/logrotate/logrotate_nginx.conf \u0026\u0026 \\ sudo docker cp freshrss:/etc/logrotate.d/php-fpm /opt/freshrss/logrotate/logrotate_php-fpm.conf uid=911(abc) gid=911(abc) groups=911(abc),1000(users) sudo vi /opt/freshrss/config/logrotate_nginx.conf /config/log/nginx/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate s6-svc -r /run/service/svc-nginx endscript su abc abc nocompress } sudo vi /opt/freshrss/config/logrotate_php-fpm.conf /config/log/php/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate s6-svc -r /run/service/svc-php-fpm endscript su abc abc nocompress } docker exec -it freshrss logrotate -v /etc/logrotate.d/nginx \u0026\u0026 \\ docker exec -it freshrss logrotate -v /etc/logrotate.d/php-fpm windows 구성 fluent-reader Troubleshooting error: Ignoring nginx because the file owner is wrong (should be root or user with uid 0).\nerror: Ignoring php-fpm because the file owner is wrong (should be root or user with uid 0).\nsudo chown 0:0 /opt/freshrss/config/logrotate_nginx.conf \u0026\u0026 \\ sudo chown 0:0 /opt/freshrss/config/logrotate_php-fpm.conf 기타 권한 오류\nsudo chown 911:911 -R /home/opc/docker/freshrss/config ","categories":["apps"],"description":"freshrss 구성","excerpt":"freshrss 구성","ref":"/apps/freshrss/","tags":["freshrss","docker"],"title":"freshrss"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/freshrss/","tags":"","title":"freshrss"},{"body":"\ngraph LR A[api] \u003c-- https --\u003e B subgraph gvp6nx1a B[g4f] \u003c-- proxy --\u003e C[authelia] C \u003c-- proxy --\u003e C1[nginx] end C1 \u003c-- https --\u003e D[client] B \u003c---\u003e E1[ai_tel_bot.py] E1 \u003c---\u003e F[telegram-bot] container 구성 docker-compose.yml (arm) vi /opt/g4f/docker-compose.yml services: g4f: image: hlohaus789/g4f:latest-armv7 container_name: g4f networks: - dev ports: - 8080/tcp - 1337:1337/tcp - 7900/tcp user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/g4f/har_and_cookies:/app/har_and_cookies:rw - /opt/g4f/generated_images:/app/generated_images:rw shm_size: 2gb restart: unless-stopped networks: dev: external: true proxy 구성 authelia 구성\nvi /opt/nginx/config/sites-available/g4f.conf ... location /authelia { if ($allowed_country = no) { return 403; } include /etc/nginx/snippets/authelia-api.conf; } location / { if ($allowed_country = no) { return 403; } proxy_pass http://g4f:8080; include /etc/nginx/snippets/authelia-auth.conf; add_header 'Cross-Origin-Embedder-Policy' 'require-corp'; add_header 'Cross-Origin-Opener-Policy' 'same-origin'; add_header 'Cross-Origin-Resource-Policy' 'same-site'; } ... Troubleshooting Could not open lock file /var/lib/dpkg/lock-frontend - open (13: Permission denied)\n특성상 이런저런 모듈 설치가 잦다. 실행 권한 1000:1000에서 0:0으로 변경\nReferences https://g4f.dev/docs/config.html ","categories":["apps"],"description":"gpt4free 구성","excerpt":"gpt4free 구성","ref":"/apps/g4f/","tags":["g4f","docker"],"title":"g4f"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/g4f/","tags":"","title":"g4f"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/giscus/","tags":"","title":"giscus"},{"body":"\ngraph LR subgraph gvp6nx1a A \u003c-- proxy --\u003e C1[nginx] B1[ssh-key] -- ssh-keygen --\u003e A[gitea] B2[gpg-key] -- gpg --\u003e A end C[client] \u003c-- ssh --\u003e A C1 \u003c-- https --\u003e C container 구성 docker-compose.yml vi /opt/gitea/docker-compose.yml services: gitea: image: gitea/gitea:latest container_name: gitea networks: - dev ports: - 61257:22/tcp - 3000/tcp user: 0:0 environment: - USER_UID=1000 - USER_GID=1000 volumes: - /opt/gitea/data:/data:rw - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro restart: unless-stopped networks: dev: external: true key gitea 전용의 ssh와 gpg키를 github 구성과 동일하게 생성\nssh 구성 바로 가기\ngpg 구성 바로 가기\neval \"$(ssh-agent -s)\" \u0026\u0026 \\ ssh-add ~/.ssh/git@gvp6nx1a.pem \u0026\u0026 \\ ssh -vT ssh://git@localhost:6**** \u0026\u0026 \\ ssh -p 6**** -i \"/home/dev/.ssh/git@gvp6nx1a.pem\" git@localhost Hi there, dev! You've successfully authenticated with the key named gitea-eddsa-key-20240625, but Gitea does not provide shell access. app.ini vi /opt/gitea/data/gitea/conf/app.ini [server] APP_DATA_PATH = /data/gitea DOMAIN = localhost SSH_DOMAIN = gvp6nx1a.duckdns.org HTTP_PORT = 3000 ROOT_URL = https://gi.gvp6nx1a.duckdns.org DISABLE_SSH = false SSH_PORT = 6**** SSH_LISTEN_PORT = 6**** LFS_START_SERVER = true LFS_JWT_SECRET = S****************************************** OFFLINE_MODE = false ... [security] ... REVERSE_PROXY_LIMIT = 1 REVERSE_PROXY_TRUSTED_PROXIES = * ... Options Remarks SSH_LISTEN_PORT Port for the built-in SSH server SSH_PORT SSH port displayed in clone URL (endpoint 주소) REVERSE_PROXY_LIMIT proxy에서 real ip 노출 여부 References https://docs.gitea.com/administration/config-cheat-sheet ","categories":["apps"],"description":"gitea 구성","excerpt":"gitea 구성","ref":"/apps/gitea/","tags":["gitea","docker"],"title":"gitea"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/gitea/","tags":"","title":"gitea"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/github/","tags":"","title":"github"},{"body":"\ngraph LR subgraph gvp6nx1a A[guacamole] \u003c-- proxy --\u003e C1[nginx] B2[ssh-servers] \u003c-- tcp --\u003e A end C1 \u003c-- https --\u003e C[client] container 구성 docker-compose.yml vi /opt/guacamole/docker-compose.yml services: guacamole: image: flcontainers/guacamole:latest container_name: guacamole networks: - dev ports: - 8080/tcp user: 0:0 environment: - TZ=Asia/Seoul - EXTENSIONS=auth-totp volumes: - /opt/guacamole/config:/config:rw - /etc/localtime:/etc/localtime:ro restart: unless-stopped networks: dev: external: true proxy 구성 vi /opt/nginx/config/sites-available/guacamole.conf ... location / { if ($allowed_country = no) { return 403; } include /etc/nginx/conf.d/include/proxy.conf; proxy_pass http://guacamole:8080; proxy_buffering off; proxy_request_buffering off; } ... Troubleshooting 초기 계정\nguacadmin/guacadmin\n","categories":["apps"],"description":"guacamole 구성","excerpt":"guacamole 구성","ref":"/apps/guacamole/","tags":["guacamole","docker"],"title":"guacamole"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/guacamole/","tags":"","title":"guacamole"},{"body":"\ngraph LR subgraph gvp6nx1a B[dev-server] \u003c-- proxy --\u003e C[nginx] end C1[prod-server] \u003c-- https --\u003e D[client] C2[github-action] --- C3[contents/\u003cbr/\u003esecurity-properties] C \u003c-- https --\u003e D B -- git --\u003e C2 B -- ssh --\u003e C3 C3 -- ssh --\u003e C1 container 구성 docker-compose.yml 배포 폴더 /opt/hugo/data/public/ 개발 서버이며 여기서 편집 후 운영 적용 서버 시작 시 배포 폴더 초기화 실시간 새로고침 baseURL 옵션은 운영 서버 URL 적용 (sitemap.xml 생성에 관여) environment 옵션 production만 googleanalytics 적용 vi /opt/hugo/docker-compose.yml services: hugo: image: hugomods/hugo:exts container_name: hugo networks: - dev ports: - 1313/tcp user: 1000:1000 volumes: - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro - /opt/hugo/data:/src:rw command: hugo server --cleanDestinationDir --poll 700ms --disableFastRender --noHTTPCache --environment production --minify --baseURL https://dntco43u.github.io --appendPort=false restart: unless-stopped networks: dev: external: true docsy 테마 1 템플릿은 exts 모듈이 적용된 docsy-example 테마 폴더 구조 변경. 기존 구조가 2-depth(/content/blog/)인데 1-depth(/content/)로 바꾸고 blog로만 사용 /content/search.md는 삭제. 1-depth 구조에서 노출을 막으려면 이것저것 수정해야 하므로 이미지 중앙 정렬 스타일 추가 2 sudo rm -rf /opt/hugo/data \u0026\u0026 \\ docker run --rm -it \\ -p1313/tcp \\ -v /opt/hugo/data:/src:rw \\ hugomods/hugo:exts \\ /bin/sh hugo mod graph \u0026\u0026 \\ cd / \u0026\u0026 git clone --depth 1 https://github.com/google/docsy-example.git src \u0026\u0026 \\ cd /src \u0026\u0026 npm install \u0026\u0026 \\ hugo --minify \u0026\u0026 \\ exit sudo chown dev:dev -R /opt/hugo/data/ \u0026\u0026 \\ sed -i 's/enableGitInfo: true/enableGitInfo: false/' /opt/hugo/data/hugo.yaml \u0026\u0026 \\ grep \"enableGitInfo\" /opt/hugo/data/hugo.yaml \u0026\u0026 \\ rm /opt/hugo/data/LICENSE \u0026\u0026 \\ rm /opt/hugo/data/*.md \u0026\u0026 \\ rm /opt/hugo/data/{Dockerfile,docker-compose.yaml} \u0026\u0026 \\ find /opt/hugo/data/ -name \".git*\" -exec rm -rf {} \\; vi /opt/hugo/data/hugo.yaml ... module: hugoVersion: extended: true min: 0.146.0 imports: - path: github.com/google/docsy disable: false ... vi /opt/hugo/data/assets/scss/_styles_project.scss ... img[src$='#center'] { display: block; margin: 1.0rem auto; max-width: 100%; height: auto; } giscus 댓글 3 테마 템플릿의 구성이 구 버전이라면 새 버전에 맞게 폴더 구조 변경 /layouts/partials/ -\u003e /layouts/_partials/ 4 댓글을 비활성화하고 싶다면 markdown 파라미터에 no_comment: true 추가 mv /opt/hugo/data/layouts/partials /opt/hugo/data/layouts/_partials \u0026\u0026 \\ vi /opt/hugo/data/layouts/_partials/disqus-comment.html {{ if not .Params.no_comment }} \u003cstyle type=\"text/css\"\u003e .giscus, .giscus-frame { width: 90%; } .container-fluid { height: auto; } \u003c/style\u003e \u003cdiv class=\"page-blank\"\u003e \u003cdiv class=\"giscus\"\u003e\u003c/div\u003e \u003cscript src=\"https://giscus.app/client.js\" data-repo=\"{{site.Params.comments.giscus.repo}}\" data-repo-id=\"{{site.Params.comments.giscus.repo_id}}\" data-category=\"{{site.Params.comments.giscus.category}}\" data-category-id=\"{{site.Params.comments.giscus.category_id}}\" data-mapping=\"{{site.Params.comments.giscus.mapping}}\" data-strict=\"{{site.Params.comments.giscus.reactions_enabled}}\" data-reactions-enabled=\"{{site.Params.comments.giscus.reactions_enabled}}\" data-emit-metadata=\"0\" data-input-position=\"{{site.Params.comments.giscus.data_input_position}}\" data-theme=\"{{site.Params.comments.giscus.theme}}\" data-lang=\"{{site.Params.comments.giscus.data_lang}}\" crossorigin=\"anonymous\" async\u003e \u003c/script\u003e \u003cnoscript\u003ePlease enable JavaScript to view the \u003ca href=\"https://giscus.app/\"\u003ecomments powered by Giscus.\u003c/a\u003e\u003c/noscript\u003e \u003c/div\u003e {{ end }} vi /opt/hugo/data/hugo.yaml ... params: comments: provider: giscus giscus: repo: dntco43u/dntco43u.github.io repo_id: R*********** category: General category_id: D******************* mapping: pathname reactions_enabled: 0 data_input_position: bottom # theme: light theme: catppuccin_frappe data_lang: en services: disqus: shortname: giscus 기타 vi /opt/hugo/data/hugo.yaml ... imaging: quality: 100 ... outputs: section: [HTML, RSS] ... services: googleAnalytics: ID: G-G********* #https://dntco43u.github.io ... # 제목 파스칼 케이스 변환 금지 titleCaseStyle: none # prod-server 캐시 caches: images: dir: :cacheDir/images ... favicon /opt/hugo/data/static/favicons/favicon.ico host 구성 deploy_hugo.sh 5 vi /home/dev/.local/bin/deploy_hugo.sh #!/bin/bash # hugo clean -\u003e build -\u003e publsh source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh container_name=hugo hugo_env=$(docker exec -it $container_name hugo version) hugo_version=$(echo \"$hugo_env\" | grep -o \"hugo v[0-9.]*\" | grep -o \"[0-9.]*\") if echo \"$hugo_env\" | grep -q \"+extended\"; then hugo_extended=true else hugo_extended=false fi rm -rf /opt/$container_name/data/public/* cd /opt/$container_name \u0026\u0026 docker compose rm -f -s \u0026\u0026 docker compose up -d \u0026\u0026 docker exec -it $container_name date +\"%Z\" sudo tail -fn0 /var/lib/docker/containers/\"$(docker inspect --format=\"{{.Id}}\" $container_name)/local-logs/container.log\" | \\ # 정적 파일 생성까지 대기 while read -r line; do echo \"$line\" if [[ \"$line\" == *\"Web Server is available\"* ]]; then break fi done # prod-server에서 참조하도록 dev-server 기준의 .env를 생성 echo \"HUGO_VERSION=$hugo_version\" \u003e /opt/$container_name/data/.env echo \"HUGO_EXTENDED=$hugo_extended\" \u003e\u003e /opt/$container_name/data/.env cat /opt/$container_name/data/.env # github pages는 속도를 위해 history 항상 삭제 cd /opt/$container_name/data/public || exit #git rm -r --cached . rm -rf .git \u0026\u0026 git init git remote add origin git@github.com:dntco43u/dntco43u.github.io.git git add . \u0026\u0026 git commit -m \"update #$HOSTNAME\" \u0026\u0026 git push -u -f origin main github 구성 deploy-hugo.yml Repository secrets Remarks secrets.GVP6NX1A_KEY 개발 서버 ssh 키 secrets.GVP6NX1A_ADDR 개발 서버 ssh 주소 secrets.GVP6NX1A_PORT 개발 서버 ssh 포트 vi /opt/hugo/data/public/.github/workflows/deploy-hugo.yml name: deploy-hugo on: push: branches: - main pull_request: jobs: build: runs-on: ubuntu-latest concurrency: group: ${{ github.workflow }}-${{ github.ref }} steps: - name: Debug host run: dig +short txt ch whoami.cloudflare @1.1.1.1 | sed 's/\"//g' - name: Set SSH key uses: shimataro/ssh-key-action@v2 with: key: ${{ secrets.GVP6NX1A_KEY }} name: id_ed25519 known_hosts: 'placeholder' - name: Adding known hosts run: ssh-keyscan -H -t ed25519 -p ${{ secrets.GVP6NX1A_PORT }} ${{ secrets.GVP6NX1A_ADDR }} \u003e\u003e ~/.ssh/known_hosts - name: Debug SSH run: | ssh -Q key ls -alh ~/.ssh ssh -T -p ${{ secrets.GVP6NX1A_PORT }} dev@${{ secrets.GVP6NX1A_ADDR }} -i ~/.ssh/id_ed25519 - name: Get artifacts from dev-server run: | rsync \\ -avz \\ --delete \\ --exclude=\".git/\" \\ -e \"ssh -p ${{ secrets.GVP6NX1A_PORT }} -i ~/.ssh/id_ed25519\" \\ dev@${{ secrets.GVP6NX1A_ADDR }}:/opt/hugo/data/ \\ ./ - name: Debug rsync run: | rsync -V sudo apt-get update -y \u0026\u0026 sudo apt-get install -y tree \u0026\u0026 sudo tree -L 2 -f - name: Set .env run: | . ./.env echo \"HUGO_VERSION=${HUGO_VERSION}\" \u003e\u003e $GITHUB_ENV echo \"HUGO_EXTENDED=${HUGO_EXTENDED}\" \u003e\u003e $GITHUB_ENV - name: Setup hugo uses: peaceiris/actions-hugo@v3 with: hugo-version: '${{ env.HUGO_VERSION }}' extended: '${{ env.HUGO_EXTENDED }}' - name: Install Node.js dependencies run: | hugo mod graph [[ -f package-lock.json || -f npm-shrinkwrap.json ]] \u0026\u0026 npm ci || true - name: Restore cache id: cache-restore uses: actions/cache/restore@v4 with: path: ${{ runner.temp }}/hugo_cache key: hugo-${{ github.run_id }} restore-keys: hugo- - name: Build hugo env: TZ: 'Asia/Seoul' run: | hugo \\ --gc \\ --minify \\ --environment production \\ --baseURL \"https://dntco43u.github.io\" \\ --cacheDir \"${{ runner.temp }}/hugo_cache\" - name: Save cache id: cache-save uses: actions/cache/save@v4 with: path: ${{ runner.temp }}/hugo_cache key: ${{ steps.cache-restore.outputs.cache-primary-key }} - name: Upload pages uses: actions/upload-pages-artifact@v3 with: path: ./public deploy: needs: build runs-on: ubuntu-latest permissions: pages: write id-token: write environment: name: github-pages url: ${{ steps.deployment.outputs.page_url }} steps: - name: Deploy pages id: deployment uses: actions/deploy-pages@v4 SEO Google Analytics Google Search Console 네이버 서치 어드바이저 다음 검색 등록 Troubleshooting posts.md 파일명에 /와 _의 대체로 -사용 6\n네이버 서치 어드바이저 SEO \u003cmeta name=\"description\"\u003e 설명 누락\n색인을 포함한 모든 페이지에 description 파라미터 추가\ngoogle search console: Duplicate without user-selected canonical\n운영이 아닌 개발 서버가 색인되고 있어 원본 주소를 명시적으로 선언. 레이아웃에 canonical 메타 추가 7 (hugo.yaml 구성은 추후 삭제 예정임 8)\nvi /opt/hugo/data/layouts/_partials/taxonomy_terms_article_wrapper.html {{ if .Params.canonical_url }} \u003clink rel=\"canonical\" href=\"{{ .Params.canonical_url }}\"\u003e {{ else }} \u003clink rel=\"canonical\" href=\"{{ .Permalink }}\"\u003e {{ end }} ERROR Failed to read Git log: fatal: not a git repository (or any parent up to mount point /)\ngit repo 수정 또는 enableGitInfo: false (hugo.yaml)\n17:02:08 gvp6nx1a sshd[2432098]: Connection closed by 1... port 60416 [preauth]\nssh-keyscan 지문 추가 시 fail2ban에서 공격으로 집계. 지문을 secret으로 빼거나 fail2ban maxretry 9 구성 변경 필요\nsudo fail2ban-client set sshd unbanip 1**.***.***.*** References https://github.com/google/docsy https://github.com/google/docsy-example https://github.com/gwatts/mostlydocs https://blog.concannon.tech/tech-talk/hugo-canonical-url/ https://gohugo.io/templates/new-templatesystem-overview/#changes-to-the-layouts-folder https://developers.google.com/search/docs/crawling-indexing/consolidate-duplicate-urls?hl=ko https://gohugo.io/host-and-deploy/host-on-github-pages/ https://forums.opensuse.org/t/rsync-ed25519/175136 https://www.reddit.com/r/rust/comments/wy3j50/psa_if_youre_using_ghpages_to_host_your/ https://linux.die.net/man/1/rsync https://github.com/actions/checkout https://github.com/peaceiris/actions-hugo https://github.com/marketplace/actions/install-ssh-key https://blog.popey.com/2023/09/publishing-hugo-site-via-github-actions/ https://belief-driven-design.com/deploying-hugo-with-github-actions-a78c2117aae/ https://medium.com/@pooyan_razian/automatically-delete-old-github-actions-runs-5e1f7286fd81 https://www.docsy.dev/ ↩︎\nhttps://www.docsy.dev/docs/content/lookandfeel ↩︎\nhttps://giscus.app ↩︎\nhttps://gohugo.io/templates/new-templatesystem-overview/ ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/deploy_hugo.sh ↩︎\nhttps://www.stanventures.com/blog/underscore-in-url/ ↩︎\nhttps://github.com/google/docsy/blob/main/layouts/_td-content.html ↩︎\nhttps://gohugo.io/content-management/urls/#canonical-urls ↩︎\nhttps://dntco43u.github.io/apps/fail2ban/#jaillocal ↩︎\n","categories":["apps"],"description":"hugo:exts + docsy + giscus 구성","excerpt":"hugo:exts + docsy + giscus 구성","ref":"/apps/hugo/","tags":["hugo","docsy","giscus","docker","github","ci-cd"],"title":"hugo"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/hugo/","tags":"","title":"hugo"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/infara/","tags":"","title":"infara"},{"body":"\nGitHub repository 바로 가기\nautohotkey Shortcuts Shortcuts Remarks Functions Ctrl+Shift+P Pause - Ctrl+Shift+R Reload - Ctrl+Shift+X Exit - Ctrl+Shift++ getPixelColor getPixelColor Ctrl+Shift+Z 수통에 급수/음수 doTacDrinkWaterAuto Ctrl+Shift+1 스탯 EXP 증가 doMapStatExp Ctrl+Shift+2 스탯 WIS/EXP 증가 doTacStatWisExp Ctrl+Shift+3 스탯 MRK 증가 doTacStatDexMrk Ctrl+Shift+4 스탯 MEC 증가 doTacStatDexMec Ctrl+Shift+5 스탯 HLT 증가 doTacStatStrHlt Ctrl+Shift+6 스탯 AGI 증가 doTacBatStatAgi Ctrl+Shift+7 스탯 STR/HLT 증가 doTacBatStatStrHlt Ctrl+Shift+8 Gun Barrel Extender 분리 doTacRemoveExtender Ctrl+Shift+9 스탯 LDR 증가 doTacStatLdr Ctrl+Shift+0 스탯 DEX/MEC 전처리 doTacStatPreDexMec Ctrl+Shift+- 스탯 DEX/MEC 증가 doTacStatDexMec Ctrl+Shift+\\ 군장 버리기 doMapDropBackpack Ctrl+Shift+- 군장 버리기 doMapDropBackpack2 Ctrl+Shift+[ 스탯 WIS/EXP 증가 doTacBatStatWisExp Ctrl+Shift+] 스탯 WIS/EXP 증가 doTacBatStatWisExp2 Ctrl+Shift+. 전투 종료 후처리 doTacBatPostProc Common.ahk 1 #include \u003cGdip_All\u003e #include \u003cUwpOcr\u003e #SingleInstance force #NoEnv #MaxHotkeysPerInterval 99000000 #HotkeyInterval 99000000 #KeyHistory 0 #InstallKeybdHook #InstallMouseHook #UseHook ListLines Off Process, Priority, , A SetTitleMatchMode, 2 SetTitleMatchMode, Fast SetBatchLines, -1 SetKeyDelay, -1, -1, Play SetMouseDelay, -1 SetDefaultMouseSpeed, 0 SetWinDelay, -1 SetControlDelay, -1 SendMode Input CoordMode, Mouse, Client CoordMode, Pixel, Client CoordMode, ToolTip, Screen FileEncoding, UTF-8 ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- global TRACE := 1 ;log level global DEBUG := 2 ;log level global INFO := 3 ;log level global WARN := 4 ;log level global ERROR := 5 ;log level global SEVERE := 6 ;log level global LOG_FILE := A_ScriptDir \"\\\" SubStr(A_ScriptName, 1, -4) \".log\" ;log file global LOG_LEVEL := 5 ;current log level global NW := 1 ;direction code global NE := 2 ;direction code global SW := 3 ;direction code global SE := 4 ;direction code global MAN_WOMAN := 1 ;leadership mantype global BIG_MAN := 2 ;leadership mantype global COMBAT_PACK := 1 ;backpack type global BACKPACK := 2 ;backpack type global DUR_56_COORD_Y := 723 ;item 56% durability global DUR_51_COORD_Y := 724 ;item 51% durability global DUR_46_COORD_Y := 725 ;item 46% durability ;------------------------------------------------------------------------------- ; screen functions ;------------------------------------------------------------------------------- getTextUwpOcrFile(imageFile) { startTime := A_TickCount outText := ocrFile(imageFile, \"en\") endTime := A_TickCount - startTime message := \"UwpOcr.ocr() \" Round(endTime) \"ms \" outText writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } getTextUwpOcrScreen(startX, startY, width, height) { startTime := A_TickCount hBitmap := HBitmapFromScreen(startX, startY, width, height) pIRandomAccessStream := HBitmapToRandomAccessStream(hBitmap) DllCall(\"DeleteObject\", \"Ptr\", hBitmap) outText := ocrStream(pIRandomAccessStream, \"en\") endTime := A_TickCount - startTime message := \"UwpOcr.ocr() \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } setFileTesseract(imageFile, textFile) { textFileWithoutExt := SubStr(textFile, 1, -4) startTime := A_TickCount RunWait, %TESSERACT_FILE% \"%imageFile%\" \"%textFileWithoutExt%\" --tessdata-dir \"%A_ProgramFiles%\\Tesseract-OCR\\tessdata\" -l eng --psm 4--oem 3 \"%TESSERACT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Tesseract \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } setFileCapture2Text(imageFile, textFile) { startTime := A_TickCount RunWait, %CAPTURE2TEXT_FILE% --image \"%imageFile%\" --output-file \"%textFile%\" --line-breaks --scale-factor 3.5 --tess-config-file \"%CAPTURE2TEXT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Capture2Text \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } getClipboardCapture2Text(startX, startY, width, height) { endX := startX + width endY := startY + height startTime := A_TickCount RunWait, %CAPTURE2TEXT_FILE% --clipboard --screen-rect \"%startX% %startY% %endX% %endY%\" --line-breaks --scale-factor 3.5 --tess-config-file \"%CAPTURE2TEXT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Capture2Text \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) message := \"getClipboardCapture2Text() \" clipboard \" (\" StrLen(clipboard) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return clipboard } getPixelColor(pixelX, pixelY) { if (pixelX = \"\") || (pixelY = \"\") { MouseGetPos, pixelX, pixelY } PixelGetColor, color, pixelX, pixelY, RGB message := \"PixelGetColor() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" pixelX \", \" pixelY \", \"\"\" color \"\"\"\" clipboard := pixelX \", \" pixelY \", \"\"\" color \"\"\"\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return color } isColorFromPixel(startX, startY, color, variation) { endX := startX endY := startY PixelSearch, foundX, foundY, startX, startY, endX, endY, color, variation, Fast RGB result := ErrorLevel = 0 ? true : false message := \"PixelSearch() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(WARN, message) if result return true else return false } ;------------------------------------------------------------------------------- ; file functions ;------------------------------------------------------------------------------- getTextFile(textFile) { FileRead, outText, %textFile% message := \"FileRead() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) message := \"getTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } setTextFile(outText, textFile) { FileAppend, %outText%, %textFile% message := \"FileAppend() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) message := \"setTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } ;------------------------------------------------------------------------------- ; common functions ;------------------------------------------------------------------------------- runAsAdmin() { message := \"A_IsAdmin \" (A_IsAdmin = 1 ? \"SUCCEED\" : \"FAILED \") writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) if A_IsAdmin return Run *RunAs \"%A_ScriptFullPath%\" ExitApp } writeLogFile(level, functionName, lineNumber, message) { if (LOG_LEVEL \u003e level) return ;write log file levelName := \"\" switch (level) { case TRACE: levelName := \"TRACE\" case DEBUG: levelName := \"DEBUG\" case INFO: levelName := \"INFO \" case WARN: levelName := \"WARN \" case ERROR: levelName := \"ERROR\" default: } FileAppend, % A_YYYY \"-\" A_MM \"-\" A_DD \" \" A_Hour \":\" A_Min \":\" A_Sec \".\" A_MSec \" \" levelName \" \" A_ScriptName \".\" functionName \"() Line \" lineNumber \" \" message \"`n\", %LOG_FILE% } removeLogFile(thresholdSize) { FileGetSize, fileSize, %LOG_FILE%, K message := \"FileGetSize() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" fileSize \"KB \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) if (fileSize \u003c thresholdSize) return FileDelete, %LOG_FILE% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } showToolTip(level, message) { if (LOG_LEVEL \u003e level) return ToolTip, %message%, 5, 5 SetTimer, removeTooltipTimer, -7000 } removeTooltipTimer: { ToolTip return } initHotkey(description) { if GetKeyState(\"Ctrl\") { Send, {Ctrl Up} Sleep, 10 } if GetKeyState(\"Alt\") { Send, {Alt Up} Sleep, 10 } if GetKeyState(\"Shift\") { Send, {Shift Up} Sleep, 10 } if GetKeyState(\"LButton\") { Send, {LButton Up} Sleep, 10 } if GetKeyState(\"RButton\") { Send, {RButton Up} Sleep, 10 } KeyWait, Ctrl KeyWait, Alt KeyWait, Shift Sleep, 10 showToolTip(INFO, A_ScriptName \".\" description) } ;playBeep(1, 7902, 80) ;SUCCEED ;playBeep(1, 2489, 80) ;FAILED playBeep(times, freq, dur) { loop, % times { SoundBeep, freq, dur Sleep, 100 } } ;------------------------------------------------------------------------------- ; library functions ;------------------------------------------------------------------------------- getMouseCursorRect(ByRef startX, ByRef startY, ByRef width, ByRef height) { ;Mask Screen Gui, Color, FFFFFF Gui +LastFound WinSet, Transparent, 50 Gui, -Caption Gui, +AlwaysOnTop Gui, Show, x0 y0 h%A_ScreenHeight% w%A_ScreenWidth%, \"AutoHotkeySnapshotApp\" ;Drag Mouse CoordMode, Mouse, Screen WinGet, hw_frame_m, ID, \"AutoHotkeySnapshotApp\" hdc_frame_m := DllCall( \"GetDC\", \"uint\", hw_frame_m) KeyWait, LButton, D MouseGetPos, scanStartX, scanStartY Loop { Sleep, 10 KeyIsDown := GetKeyState(\"LButton\") if (KeyIsDown = 1) { MouseGetPos, scanX, scanY DllCall( \"gdi32.dll\\Rectangle\", \"uint\", hdc_frame_m, \"int\", 0, \"int\", 0, \"int\", A_ScreenWidth, \"int\", A_ScreenWidth) DllCall( \"gdi32.dll\\Rectangle\", \"uint\", hdc_frame_m, \"int\", scanStartX, \"int\", scanStartY, \"int\", scanX, \"int\", scanY) } else { break } } ;KeyWait, LButton, U MouseGetPos, scanEndX, scanEndY Gui Destroy if (scanStartX \u003c scanEndX) { startX := scanStartX width := scanEndX - scanStartX } else { startX := scanEndX width := scanStartX - scanEndX } if (scanStartY \u003c scanEndY) { startY := scanStartY height := scanEndY - scanStartY } else { startY := scanEndY height := scanStartY - scanEndY } CoordMode, Mouse, Client message := \"getMouseCursorRect() \" startX \", \" startY \", \" width \", \" height writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } setCaptureImageFile(startX, startY, width, height, fileName) { startTime := A_TickCount pToken := Gdip_StartUp() pArg := startX . \"|\" . startY . \"|\" . width . \"|\" . height pBitmap := Gdip_BitmapFromScreen(pArg) Gdip_SaveBitmapToFile(pBitmap, fileName) Gdip_DisposeImage(pBitmap) Gdip_Shutdown(pToken) endTime := A_TickCount - startTime message := \"Gdip_SaveBitmapToFile() \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) message := \"setCaptureImageFile() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" startX \", \" startY \", \" width \", \" height \", \" fileName writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } ja2_helper.ahk 2 #include \u003cCommon\u003e ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- ;------------------------------------------------------------------------------- ; hotkeys ;------------------------------------------------------------------------------- ^+p:: ;ctrl+shift+p { initHotkey(\"Pause\") Pause return } ^+r:: ;ctrl+shift+r { Reload return } ^+x:: ;ctrl+shift+x { ExitApp } ^+`:: ;ctrl+shift+` { initHotkey(\"getPixelColor\") getPixelColor(\"\", \"\") return } ^+a:: ;ctrl+shift+a { ;if !WinActive(\"ahk_exe ja2.exe\") ; return ;initHotkey(\"test\") test() return } ^+z:: ;ctrl+shift+z { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacDrinkWaterAuto\") doTacDrinkWaterAuto() return } ^+1:: ;ctrl+shift+1 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doMapStatExp\") ;doMapStatExp(1) doMapStatExp(99) ;doMapStatExp(9999) ;aggressive return } ^+2:: ;ctrl+shift+2 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatWisExp\") doTacStatWisExp(0) return } ^+3:: ;ctrl+shift+3 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatDexMrk\") ;doTacStatDexMrk(\"\", DUR_46_COORD_Y, true) ;doTacStatDexMrk(NW, DUR_46_COORD_Y, true) ;doTacStatDexMrk(NE, DUR_46_COORD_Y, true) ;doTacStatDexMrk(SW, DUR_46_COORD_Y, false) ;estoni i6 doTacStatDexMrk(SE, DUR_46_COORD_Y, false) ;drassen d13, cambria g9, meduna o4, meduna n3 ;doTacStatDexMrk(\"\", DUR_46_COORD_Y, false) return } ^+4:: ;ctrl+shift+4 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatDexMec\") ;doTacStatDexMec(NE, DUR_51_COORD_Y, 0, false, false) ;single mode doTacStatDexMec(NE, DUR_51_COORD_Y, 0, false, true) ;auto momde ;doTacStatDexMec(NE, DUR_46_COORD_Y, 5, false, true) ;auto momde return } ^+5:: ;ctrl+shift+5 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatStrHlt\") ;doTacStatStrHlt(40, false) ;heavy weight waterdrum ;doTacStatStrHlt(33, false) ;heavy weight waterdrum doTacStatStrHlt(10, false) ;low weight sandbag return } ^+6:: ;ctrl+shift+6 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatAgi\") doTacBatStatAgi(NE, 4) ;NE: Cambria, Alma, Chitzena ;doTacBatStatAgi(NW, 4) ;NW: Drassen return } ^+7:: ;ctrl+shift+7 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacBatStatStrHlt\") doTacBatStatStrHlt(1, 50) ;heavy weight waterdrum ;doTacBatStatStrHlt(2, 50) ;heavy weight waterdrum ;doTacBatStatStrHlt(3, 50) ;low weight sandbag return } ^+8:: ;ctrl+shift+8 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacRemoveExtender\") doTacRemoveExtender(NE, DUR_46_COORD_Y, false, false) return } ^+9:: ;ctrl+shift+9 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatLdr\") doTacStatLdr(NW, MAN_WOMAN, false) ;doTacStatLdr(NW, BIG_MAN, false) return } ^+0:: ;ctrl+shift+0 { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatPreDexMec\") doTacStatPreDexMec(NE) return } ^+-:: ;ctrl+shift+- { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacStatDexMec\") doTacStatDexMec(NE, DUR_46_COORD_Y, 400, false, false) ;single momde return } ^+\\:: ;ctrl+shift+\\ { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doMapDropBackpack\") ;doMapDropBackpack(COMBAT_PACK, 1) doMapDropBackpack(BACKPACK, 20) return } ^+':: ;ctrl+shift+' { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doMapDropBackpack2\") doMapDropBackpack2(1) return } ^+[:: ;ctrl+shift+[ { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacBatStatWisExp\") doTacBatStatWisExp(0) ;doTacBatStatWisExp(9999) return } ^+]:: ;ctrl+shift+] { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacBatStatWisExp2\") doTacBatStatWisExp2(0) ;doTacBatStatWisExp2(9999) return } ^+.:: ;ctrl+shift+. { if !WinActive(\"ahk_exe ja2.exe\") return initHotkey(\"doTacBatPostProc\") doTacBatPostProc() return } ;------------------------------------------------------------------------------- ; init ;------------------------------------------------------------------------------- init() ;init init() { runAsAdmin() removeLogFile(8192) } ;------------------------------------------------------------------------------- ; test ;------------------------------------------------------------------------------- test() { writeLogFile(WARN, A_ThisFunc, A_LineNumber, \"start_of_test\") ;getPixelColor(446, 161) ;testGaugeBarCoord(67 + (0 * 6), 19, 43) ;map health coord: 67, 19 ~ 73, 61, color: 0xCE0000, bg: 0x080000 ;testGaugeBarCoord(67 + (1 * 6), 19, 43) ;map energy coord: 73, 19 ~ 73, 61, color: 0x2930F7, bg: 0x000000 ;testGaugeBarCoord(67 + (2 * 6), 19, 43) ;map morale coord: 79, 19 ~ 79, 61 color: 0x08B608, bg: 0x080000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isDamagedHLTCoord(67, 19, 43, \"0xF7F310\")) ;map damaged color: 0xF7F310 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(159, 24 + (3 * 10), \"0xD6CB9C\")) ;map exp stat color: 0xD6CB9C, now up: 0x00CF00 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(159, 24 + (3 * 10), \"0x00CF00\")) ;map exp stat color: 0xD6CB9C, now up: 0x00CF00 ;doMapLoadGame() ;doMapSaveGame() ;doMapPreStatExp() ;getPixelColor(453, 400) ;getPixelColor(463, 367) ;getPixelColor(6, 691) ;getPixelColor(6, 6) ;isColorFromPixel(252, 338, \"0x523808\", 0) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isDamagedHLTCoord(67, 19, 43, \"0xF7F310\")) ;clickMouse(43, 206, \"Right\", 1) ;doMapStatExp(20) ;testGaugeBarCoord(70 + (0 * 6), 653, 43) ;tac health coord: 70, 653 ~ 70, 695, squad1 color: 0xCE0000, bg: 0x000000 ;testGaugeBarCoord(70 + (1 * 6), 653, 43) ;tac energy coord: 76, 653 ~ 70, 695, squad1 color: 0x2930F7, bg: 0x000000 ;testGaugeBarCoord(70 + (2 * 6), 653, 43) ;tac morale coord: 82, 653 ~ 70, 695, squad1 color: 0x08B608, bg: 0x080000 ;testGaugeBarCoord(71 + (0 * 6), 573, 43) ;tac health coord: 71, 573 ~ 70, 615, inv color: 0xCE0000, bg: 0x000000 573 always starts with black, and 98 and 100 are indistinguishable. ;testGaugeBarCoord(71 + (1 * 6), 573, 43) ;tac energy coord: 77, 573 ~ 70, 615, inv color: 0x2930F7, bg: 0x000000 ;testGaugeBarCoord(71 + (2 * 6), 573, 43) ;tac morale coord: 83, 573 ~ 70, 615, inv color: 0x08B608, bg: 0x080000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isDamagedHLTCoord(70, 653, 43, \"0xF7F310\")) ;tac squad1 damaged color: 0xF7F310 ;writeLogFile(INFO, A_ThisFunc, A_LineNum ber, isDamagedHLTCoord(71, 573, 43, \"0xF7F310\")) ;tac inv damaged color: 0xF7F310 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(71, 615, \"0x000000\", 0)) ;tac inv dead color: 0x000000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(77, 593, \"0x000000\", 0)) ;tac inv energy 50 color: 0x000000 ;doTacLoadGame() ;doTacSaveGame() ;doTacDrinkWater(50, 362, 720) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(116, 577 + (4 * 10), \"0xD6CB9C\")) ;tac wis stat color: 0xD6CB9C, now up: 0x00CF00 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(163, 577 + (3 * 10), \"0xD6CB9C\")) ;tac exp stat color: 0xD6CB9C, now up: 0x00CF00 ;testUseItemCursor() ;doTacStatWisExp(20) ;testGaugeBarCoord(119, 716, 20) ;tac inv primary item durability coord: 67, 19 ~ 73, 61, color: 0xCEAE84, bg: 0x000000 ;testGrabCursor() ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 725, \"0x393829\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 735, \"0xCEAE84\", 0)) ;doMapDropItem(false) ;doMapDropItem(true) ;doTacStatDexMrk(\"\", false) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 735, \"0xCEAE84\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 725, \"0x393829\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 724, \"0x000000\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(119, 725, \"0x000000\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(197, 581, \"0x312018\", 0)) ;tac inv is gun attachemnt color: 0x312018 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(159, 734, \"0xFF0000\", 0)) ;tac inv is gun burst or auto mode color: 0xFF0000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(172, 724, \"0xFF0000\", 0)) ;tac inv is gun jammed color: 0xFF0000 ;testIsMessage(120, 30, 16, 16, \"0xFFFFFF\") ;merc speech ;doTacStatDexMec(NE) ;testGaugeBarCoord(71 + (0 * 6), 573, 43) ;tac health coord: 70, 653 ~ 70, 695, inv color: 0xCE0000, bg: 0x000000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(71 + (0 * 6), 573, \"0x000000\", 0)) ;regenPer := 99 ;100 is over pixel so 99 max ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, 573 + Floor(43 * regenPer / 100)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, testIsMessage(5, 555, 32, 12, \"0xFFD739\")) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(4, 556, \"0x00CF00\", 0)) ;tac is message color: 0x00CF00 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(6, 691, \"0x735118\", 0)) ;is tac not inv color: 0x735118 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(6, 691, \"0x291010\", 0)) ;is tac not inv no selected color: 0x291010 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(6, 691, \"0x000000\", 0)) ;is tac inv color: 0x000000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(6, 691, \"0x000800\", 0)) ;is map color: 0x000800 ;doTacStatStrHlt(true) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(6, 6, \"0x73A600\", 0)) ;tac is battle player's turn color: 0x73A600 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(112, 24 + (0 * 10), \"0xD6CB9C\")) ;map agi stat color: 0xD6CB9C, now up: 0x00CF00 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(3, 557, \"0xFFD739\", 0)) ;not enough ap color: 0xFFD739 ;testGaugeBarCoord(70 + (1 * 6), 653, 43) ;tac energy coord: 76, 653 ~ 70, 695, squad1 color: 0x2930F7, bg: 0x000000 ;MouseGetPos, coordX, coordY ;isPlayerCenter(coordX - 36, coordY - 90, 60, 60, \"0xCE0000\") ;doTacBatStatAgi(NE, 4) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(112, 24 + (2 * 10), \"0x00CF00\")) ;map str stat color: 0xD6CB9C, now up: 0x00CF00 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(112, 24 + (2 * 10), \"0xD6CB9C\")) ;map str stat color: 0xD6CB9C, now up: 0x00CF00 ;testGaugeBarCoord(67 + (0 * 6), 19, 43) ;map health coord: 67, 19 ~ 73, 61, color: 0xCE0000, bg: 0x080000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(67 + (0 * 6), 19, \"0xCE0000\", 0)) ;map health max stat color: 0xCE0000 ;testGaugeBarCoord(70 + (1 * 6), 653, 43) ;tac energy coord: 76, 653 ~ 70, 695, squad1 color: 0x2930F7, bg: 0x000000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, getTacMaxEnergyCoordY()) ;map energy max stat color: 0xCE0000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(159, 81, \"0x00CF00\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(159, 81, \"0xD6CB9C\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(510 - 6, 310 - 50, \"0xCE0000\", 0)) ;tac character stance s health coord x - 6, y - 50 color: 0xCE0000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(510 - 6, 310 - 40, \"0xCE0000\", 0)) ;tac character stance c health coord x - 6, y - 50 color: 0xCE0000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(510 - 6, 310 - 25, \"0xCE0000\", 0)) ;tac character stance x health coord x - 6, y - 50 color: 0xCE0000 ;doTacBatStatStrHlt(4, 50) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(177, 719, \"0x007900\", 0)) ;tac inv is gun attachemnt color: 0x007900 ;getPixelColor(119, 725) ;getPixelColor(177, 719) ;doTacRemoveExtender(NE) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isStatMaxCoord(116, 577 + (3 * 10), \"0xD6CB9C\")) ;tac ldr stat color: 0xD6CB9C, now up: 0x00CF00 ;testIsMessage(0, 0, 1024, 768m, \"0xFFD739\") ;yellow message ;testIsMessage(3, 556, 16, 11, \"0x00CF00\") ;squad last line ;testIsMessage(3, 541, 16, 16, \"0xFFD739\") ;yellow message last two lines ;testIsMessage(3, 541, 16, 16, \"0x00CF00\") ;squad last two lines ;testIsMessage(3, 541, 16, 16, \"0xBDBEBD\") ;helicopter last two lines ;doTacStatLdr(NE, \"MAN\", false) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(11, 14, \"0x731008\", 0)) ;map entering enemy sector ;testBattleMoveCursor() ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isDamagedHLTCoord(70, 653, 43, \"0xF7F310\")) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(70, 695, \"0x000000\", 0)) ;doTacBatStatWisExp(0) ;regenPer := 1 ;maxY := getTacMaxEnergyCoordY() ;regenY := maxY ;parsedEnergySize := maxY - 653 ;totalEnergySize := 43 - parsedEnergySize ;if (regenPer \u003c 99) { ; regenY := 653 + parsedEnergySize + (totalEnergySize - 1) - Floor(totalEnergySize * regenPer / 100) ;} ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"maxY: \" maxY) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"parsedEnergySize: \" parsedEnergySize) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"totalEnergySize: \" totalEnergySize) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"regenY: \" regenY) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(70 + (1 * 6), 653, \"0x2930F7\", 0)) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(70 + (1 * 6), 657, \"0x2930F7\", 0)) ;testGaugeHBarCoord(504, 260, 12) ;tac character health coord: 504 ~ 515, 260 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(510 - 6, 310 - 50, \"0xCE0000\", 0)) ;tac character health coord x - 6, y - 50 color: 0xCE0000 ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(550 - 6, 290 - 50, \"0xCE0000\", 0)) ;tac character health coord x - 6, y - 50 color: 0xCE0000 ;getPixelColor(36, 724) ;tac squad no right hand color: 0x524131 ;doTacBatStatWisExp2(0) ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(672, 698, \"0x212C10\", 0)) ;is canteen in tims backpack ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(708, 698, \"0x212C10\", 0)) ;is canteen in 3day pack ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(362, 720, \"0x212C10\", 0)) ;is canteen in left holster ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, isColorFromPixel(520, 720, \"0x212C10\", 0)) ;is canteen in right holster ;writeLogFile(INFO, A_ThisFunc, A_LineNumber, getTacCanteenCoord(340, 575, 385, 155, \"0x212008\")) ;canteen color: 0x212008 ;doTacDrinkWaterAuto() ;doTacBatPostProc() ;doTacStatPreDexMec(NE) ;doMapDropBackpack(BACKPACK, 1) ;getPixelColor(9, 214) ;right hhand is item ;getPixelColor(9, 237) ;left hand is item ;getPixelColor(181, 284) ;vest is item ;getPixelColor(189, 381) ;combat pack is item ;getPixelColor(168, 567) ;backpack is item ;doMapDropBackpack2(1) writeLogFile(WARN, A_ThisFunc, A_LineNumber, \"end_of_test\") } testGaugeHBarCoord(startX, startY, length) { Loop, % length { getPixelColor((startX + A_Index - 1), startY) } } testGaugeBarCoord(startX, startY, length) { Loop, % length { getPixelColor(startX, (startY + A_Index - 1)) ;health coord: 73, 19 ~ 73, 61, color: 0xCE0000, bg: 0x080000 } } ;green text color: 0xFFD739, yellow text color: 0xFFD739 ;only check last line for search spped testIsMessage(startX, startY, lengthX, lengthY, color) { PixelSearch, foundX, foundY, startX, startY, startX + lengthX, startY + lengthY, color, 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"testIsMessage() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return result } testGrabCursor() { MouseMove, 510, 310 Sleep, 50 Send, {Ctrl Down} Sleep, 50 getPixelColor(510, 310) Sleep, 50 Send, {Ctrl Up} Sleep, 50 } testUseItemCursor() { MouseMove, 530, 300 - 15 Sleep, 50 Send, {u} Sleep, 100 getPixelColor(530, 300 - 15) Sleep, 50 } testBattleMoveCursor() { MouseMove, 510, 310 Sleep, 3000 Send, {Shift Down} Sleep, 50 ;Send, {Click, 510, 310 \"Left\" Down} ;Sleep, 3000 loop, 24 { writeLogFile(INFO, A_ThisFunc, A_LineNumber, getPixelColor(499 + A_Index, 310)) } ;Send, {Click, 510, 310, \"Left\" Up} ;Sleep, 50 Send, {Shift Up} Sleep, 50 ;move red cursor x - 9, y - 0 color: 0xE70000 ;move grey cursor x - 9, y - 0 color: 0xBDAAAD } ;------------------------------------------------------------------------------- ; biz functions ;------------------------------------------------------------------------------- ;canteen color: 0x212C10 isPlayerCenter(startX, startY, lengthX, lengthY, color) { PixelSearch, foundX, foundY, startX, startY, startX + lengthX, startY + lengthY, color, 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"isPlayerCenter() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return result } ;canteen color: 0x212C10 getTacCanteenCoord(startX, startY, lengthX, lengthY, color) { PixelSearch, foundX, foundY, startX, startY, startX + lengthX, startY + lengthY, color, 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"getTacCanteenCoord() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return foundX \",\" (foundY + 10) } doTacBatPostProc() { Send, {Shift Down} Sleep, 10 Send, {r} ;all sqaud reload Sleep, 10 Send, {Shift Up} Sleep, 10 loop { Send, {Ctrl Down} Sleep, 10 Send, {.} Sleep, 10 Send, {Ctrl Up} Sleep, 10 if (isColorFromPixel(455, 343, \"0xFFFFFF\", 0)) { ;sector menu exist clickMouse(455, 343, \"Left\", 50) ;fill canteen break } Sleep, 10 } loop { Send, {Ctrl Down} Sleep, 10 Send, {.} Sleep, 10 Send, {Ctrl Up} Sleep, 10 if (isColorFromPixel(455, 343, \"0xFFFFFF\", 0)) { ;sector menu exist clickMouse(455, 378, \"Left\", 50) ;clean guns merc break } Sleep, 10 } loop { Send, {Ctrl Down} Sleep, 10 Send, {.} Sleep, 10 Send, {Ctrl Up} Sleep, 10 if (isColorFromPixel(455, 343, \"0xFFFFFF\", 0)) { ;sector menu exist clickMouse(569, 378, \"Left\", 50) ;clean guns team break } Sleep, 10 } callMapScreen() } doTacDrinkWaterAuto() { doTacToTacInv() canteenCoord := StrSplit(getTacCanteenCoord(340, 575, 385, 155, \"0x212008\"), \",\") ;canteen color: 0x212008 ;canteenCoordX := 0, canteenCoordY := 0 ;if (isColorFromPixel(672, 698, \"0x212C10\", 0)) { ;is canteen in tims backpack ; canteenCoordX := 672 ; canteenCoordY := 698 ;} else if (isColorFromPixel(708, 698, \"0x212C10\", 0)) { ;is canteen in 3day pack ; canteenCoordX := 708 ; canteenCoordY := 698 ;} else if (isColorFromPixel(362, 720, \"0x212C10\", 0)) { ;is canteen in left holster ; canteenCoordX := 362 ; canteenCoordY := 720 ;} else if (isColorFromPixel(520, 720, \"0x212C10\", 0)) { ;is canteen in right holster ; canteenCoordX := 520 ; canteenCoordY := 720 ;} doTacDrinkWater(99, canteenCoord[1], canteenCoord[2]) doTacInvToTac() Send, {Pause} Sleep, 50 } ;location ; client(center) ; / ; bomb ; / ;server doTacBatStatWisExp2(skipCheckAmount) { coordX1 := 510, coordY1 := 310 ;client coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 ;bomb coordX3 := coordX1 + 40, coordY3 := coordY1 - 20 ;server successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacInvToTac() Send, {s} Sleep, 50 doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) loop { outerIndex := A_index if (Mod(A_index, 50) == 0) { callMapScreen() if (isStatMaxCoord(112, 24 + (4 * 10), \"0x00CF00\") || isStatMaxCoord(112, 24 + (4 * 10), \"0xD6CB9C\")) { ;map wis stat color: 0xD6CB9C, now up: 0x00CF00 if (isStatMaxCoord(159, 24 + (3 * 10), \"0x00CF00\") || isStatMaxCoord(159, 24 + (3 * 10), \"0xD6CB9C\")) { ;map exp stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED if (successCnt \u003e 0) { doMapSaveGame() } return } } else { callTacScreen() continue } Sleep, 50 } ;server start Send, {r} Sleep, 10 doTacBatCenter(coordX1, coordY1) MouseMove, coordX2, coordY2 Sleep, 10 loop { if (isColorFromPixel(coordX2 - 9, coordY2, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {u} Sleep, 10 Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x101010\", 0) || isColorFromPixel(coordX2, coordY2, \"0x000008\", 0)) { ;bomb cursor, hurl: 0x000008 clickMouse(coordX2, coordY2, \"Left\", 10) ;plant bomb break } Sleep, 10 } Send, {Shift Up} Sleep, 10 loop { if (isColorFromPixel(451, 399, \"0x000008\", 0)) { ;remote detonator or detonator dialog exist Send, {4} Sleep, 10 break } Sleep, 10 } MouseMove, coordX1, coordY1 Sleep, 10 loop { if (isColorFromPixel(coordX1 - 9, coordY1, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move before pos } Send, {Shift Up} Sleep, 10 ;server end ;change squad loop { Send, {Shift Down} Sleep, 10 Send, {Space} Sleep, 10 Send, {Shift Up} Sleep, 10 if (isColorFromPixel(coordX3 - 6, coordY3 - 50, \"0xCE0000\", 0)) { ;tac character health coord x - 6, y - 50 color: 0xCE0000 break } Sleep, 10 } Sleep, 100 ;client start MouseMove, coordX2, coordY2 Sleep, 10 Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x420000\", 0)) { ;red grab cursor clickMouse(coordX2, coordY2, \"Left\", 10) ;disarm bomb break } Sleep, 10 } Send, {Shift Up} Send, {Ctrl Up} Sleep, 10 loop { isDisarmed := true if (isColorFromPixel(464, 400, \"0x000008\", 0)) { ;disarm dialog exist Send, {y} Sleep, 10 break } if (isDamagedHLTCoord(70, 653, 43, \"0xF7F310\") || isColorFromPixel(70, 695, \"0x000000\", 0)) { ;tac squad1 damaged color: 0xF7F310, died color: 0x000000 successCnt := 0 isDisarmed := false break } Sleep, 10 } Sleep, 50 ;delay if (!isDisarmed) { successCnt := 0 doTacLoadGame() continue } loop { Send, {Shift Down} Sleep, 10 Send, {q} Sleep, 10 Send, {Shift Up} Sleep, 10 if (isColorFromPixel(36, 724, \"0x524131\", 0)) { ;tac squad no right hand color: 0x524131 break } Sleep, 10 } Sleep, 100 ;XXX: drop bomb if set lower than 10 sleep bomb going to missing MouseMove, coordX3, coordY3 Sleep, 10 loop { if (isColorFromPixel(coordX3 - 9, coordY3, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX3, coordY3, \"Left\", 10) ;move before pos } ;client end ;change squad loop { Send, {Shift Down} Sleep, 10 Send, {Space} Sleep, 10 Send, {Shift Up} Sleep, 10 if (isColorFromPixel(coordX1 - 6, coordY1 - 50, \"0xCE0000\", 0)) { ;tac character health coord x - 6, y - 50 color: 0xCE0000 break } Sleep, 10 } Sleep, 100 ;server start MouseMove, coordX2, coordY2 Sleep, 10 Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x420000\", 0)) { ;red grab cursor clickMouse(coordX2, coordY2, \"Left\", 10) ;get bomb break } Sleep, 10 } Send, {Shift Up} Send, {Ctrl Up} Sleep, 10 MouseMove, coordX1, coordY1 Sleep, 10 loop { if (isColorFromPixel(coordX1 - 9, coordY1, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move before pos } Send, {Shift Up} Sleep, 10 ;server end doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) successCnt += 1 if (successCnt \u003c skipCheckAmount) { doTacSaveGame() } Sleep, 10 } } doTacBatStatWisExp(skipCheckAmount) { coordX1 := 510, coordY1 := 310 coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacInvToTac() Send, {s} Sleep, 50 doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) loop { outerIndex := A_index if (Mod(A_index, 50) == 0) { callMapScreen() if (isStatMaxCoord(112, 24 + (4 * 10), \"0x00CF00\") || isStatMaxCoord(112, 24 + (4 * 10), \"0xD6CB9C\")) { ;map wis stat color: 0xD6CB9C, now up: 0x00CF00 if (isStatMaxCoord(159, 24 + (3 * 10), \"0x00CF00\") || isStatMaxCoord(159, 24 + (3 * 10), \"0xD6CB9C\")) { ;map exp stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED if (successCnt \u003e 0) { doMapSaveGame() } return } } else { callTacScreen() continue } Sleep, 50 } Send, {r} Sleep, 10 doTacBatCenter(coordX1, coordY1) MouseMove, coordX2, coordY2 Sleep, 10 loop { if (isColorFromPixel(coordX2 - 9, coordY2, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {u} Sleep, 10 Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x101010\", 0) || isColorFromPixel(coordX2, coordY2, \"0x000008\", 0)) { ;bomb cursor, hurl: 0x000008 clickMouse(coordX2, coordY2, \"Left\", 10) ;plant bomb break } Sleep, 10 } Send, {Shift Up} Sleep, 10 loop { if (isColorFromPixel(451, 399, \"0x000008\", 0)) { ;remote detonator or detonator dialog exist Send, {4} Sleep, 10 break } Sleep, 10 } MouseMove, coordX2, coordY2 Sleep, 10 Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x420000\", 0)) { ;red grab cursor clickMouse(coordX2, coordY2, \"Left\", 10) ;disarm bomb break } Sleep, 10 } Send, {Shift Up} Send, {Ctrl Up} Sleep, 10 loop { isDisarmed := true if (isColorFromPixel(464, 400, \"0x000008\", 0)) { ;disarm dialog exist Send, {y} Sleep, 10 break } if (isDamagedHLTCoord(70, 653, 43, \"0xF7F310\") || isColorFromPixel(70, 695, \"0x000000\", 0)) { ;tac squad1 damaged color: 0xF7F310, died color: 0x000000 successCnt := 0 isDisarmed := false break } Sleep, 10 } Sleep, 50 ;delay if (!isDisarmed) { successCnt := 0 doTacLoadGame() continue } MouseMove, coordX1, coordY1 Sleep, 10 loop { if (isColorFromPixel(coordX1 - 9, coordY1, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD break } Sleep, 10 } Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move before pos } Send, {Shift Up} Sleep, 10 doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) successCnt += 1 if (successCnt \u003c skipCheckAmount) { doTacSaveGame() } Sleep, 10 } } doTacStatLdr(directionType, manType, isPixelCheck) { ;After calling militia come to me, lay it down with get down, and then execute the get down macro. For dialogue windows, use unmovable stones or houses. coordX1 := 0, coordY1 := 0 coordX2 := 0, coordY2 := 0 manTypeCoordY := 0 switch (manType) { case MAN_WOMAN: manTypeCoordY := 0 case BIG_MAN: manTypeCoordY := -3 default: } switch (directionType) { case NW: ;recommended between 1 tiles coordX1 := 510 - (20 * 1), coordY1 := 310 - (10 * 1) + 11 coordX2 := coordX1 + 22, coordY2 := coordY1 + (-6) + manTypeCoordY ;militia come to me coordination case NE: coordX1 := 510 + (20 * 1), coordY1 := 310 - (10 * 1) + 2 coordX2 := coordX1 + 56, coordY2 := coordY1 + 35 + manTypeCoordY ;35 get down, 115 all:get down case SW: ;recommended between 1 tiles coordX1 := 510 - (20 * 1), coordY1 := 310 + (10 * 1) + 2 coordX2 := coordX1 + 20, coordY2 := coordY1 - 15 + manTypeCoordY ;-15 hold position default: } callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacToTacInv() Send, {s} Sleep, 50 loop { outerIndex := A_index if (Mod(A_index, 1000) == 0) { callMapScreen() callTacScreen() continue } if (isPixelCheck) { if (isStatMaxCoord(116, 577 + (3 * 10), \"0x00CF00\") || isStatMaxCoord(116, 577 + (3 * 10), \"0xD6CB9C\")) { ;tac ldr stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED if (outerIndex \u003e 1) { doTacSaveGame() } callMapScreen() return } ;tac is message color: 0x00CF00 if (testIsMessage(3, 541, 16, 1, \"0x00CF00\") || testIsMessage(3, 556, 16, 1, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } } MouseMove, coordX1, coordY1 Sleep, 1 if (A_index == 1) { loop { if (isColorFromPixel(coordX1, coordY1, \"0x180000\", 0)) { ;red talk cursor clickMouse(coordX1, coordY1, \"Left\", 50) ;talk break } Sleep, 50 } } else { clickMouseFast(coordX1, coordY1, \"Left\") ;talk } MouseMove, coordX2, coordY2 Sleep, 1 if (A_index == 1) { loop { if (isColorFromPixel(coordX2, coordY2, \"0x101010\", 0)) { ;command cursor clickMouse(coordX2, coordY2, \"Left\", 50) ;command break } Sleep, 50 } } else { clickMouseFast(coordX2, coordY2, \"Left\") ;command } Sleep, 1 } } ;XXX: having to check at every point has performance issues skipMeanwhile() { if (isColorFromPixel(480, 367, \"0xFFFFFF\", 0)) { ;tac meanwhile color: 0xFFFFFF clickMouse(551, 394, \"Left\", 10) ;skip } Sleep, 50 } doGetTacItems(itemCoordX, itemCoordY) { Send, {Ctrl Down} Sleep, 10 if (isColorFromPixel(itemCoordX, itemCoordY, \"0x940000\", 0)) { ;item exist red hand clickMouse(itemCoordX, itemCoordY, \"Left\", 10) ;get item Send, {Ctrl Up} Sleep, 10 } else { Send, {Ctrl Up} Sleep, 10 } } getTacMaxEnergyCoordY() { PixelSearch, bgFoundX, bgFoundY, 70 + (1 * 6), 653, 70 + (1 * 6) + 1, 653 + 43, \"0x000000\", 0, Fast RGB PixelSearch, energyFoundX, energyFoundY, 70 + (1 * 6), 653, 70 + (1 * 6) + 1, 653 + 43, \"0x2930F7\", 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"getTacMaxEnergyCoordY() \" (result ? \"SUCCEED bgFoundY: \" bgFoundY \", energyFoundY: \" energyFoundY : \"FAILED\") \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) if (bgFoundY != \"\") { return bgFoundY } else { return energyFoundY } } getTacInvMaxEnergyCoordY() { PixelSearch, bgFoundX, bgFoundY, 71 + (1 * 6), 573, 71 + (1 * 6) + 1, 573 + 43, \"0x000000\", 0, Fast RGB PixelSearch, energyFoundX, energyFoundY, 71 + (1 * 6), 573, 71 + (1 * 6) + 1, 573 + 43, \"0x2930F7\", 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"getTacMaxEnergyCoordY() \" (result ? \"SUCCEED bgFoundY: \" bgFoundY \", energyFoundY: \" energyFoundY : \"FAILED\") \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) if (bgFoundY != \"\") { return bgFoundY } else { return energyFoundY } } doTacBatStatStrHlt(loopCnt, regenPer) { coordX1 := 510, coordY1 := 310 coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 coordX3 := coordX1 - 20, coordY3 := coordY1 + 10 isMinerInterrupted := false callTacScreen() Send, {F1} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacInvToTac() Send, {s} Sleep, 50 Send, {Shift Down} Sleep, 50 Send, {b} Sleep, 50 Send, {Shift Up} Sleep, 50 doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) loop { outerIndex := A_index if (Mod(A_index, 100) == 0) { callMapScreen() if (isStatMaxCoord(112, 24 + (2 * 10), \"0x00CF00\") || isStatMaxCoord(112, 24 + (2 * 10), \"0xD6CB9C\")) { ;map str stat color: 0xD6CB9C, now up: 0x00CF00 if (isColorFromPixel(159, 81, \"0x00CF00\", 0) || isColorFromPixel(159, 81, \"0xD6CB9C\", 0)) { ;map health stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED doMapSaveGame() return } else { callTacScreen() Sleep, 1000 ;delay continue } } else { callTacScreen() Sleep, 1000 ;delay continue } Sleep, 50 } Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 Send, {f} Sleep, 10 Send, {Shift Up} Send, {Ctrl Up} Sleep, 50 ;delay loop, % loopCnt { Send, {r} Sleep, 10 doTacBatCenter(coordX1, coordY1) loop { MouseMove, coordX2 + (Mod(A_index, 2) == 0 ? 5 : -5), coordY2 + (Mod(A_index, 2) == 0 ? -5 : 5) ;refresh mousemove Sleep, 10 if (isColorFromPixel(coordX2 - 9, coordY2, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD isMinerInterrupted := false break } else { if (isMinerInterrupted || A_index \u003e 30) { ;miner interrupt isMinerInterrupted := true loop, 10 { doEndPlayersTurnAndRegenEnergy(regenPer, coordX1, coordY1, true) } Sleep, 1000 break } } Sleep, 10 } Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX2, coordY2, \"Left\", 10) ;move } Send, {Shift Up} Sleep, 10 Send, {r} Sleep, 10 loop { MouseMove, coordX1 + (Mod(A_index, 2) == 0 ? 5 : -5), coordY1 + (Mod(A_index, 2) == 0 ? -5 : 5) ;refresh mousemove Sleep, 10 if (isColorFromPixel(coordX1 - 9, coordY1, \"0xBDAAAD\", 0)) { ;move grey cursor x - 9, y - 0 color: 0xBDAAAD isMinerInterrupted := false break } else { if (isMinerInterrupted || A_index \u003e 30) { ;miner interrupt isMinerInterrupted := true break } } Sleep, 50 ;delay } Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move } Send, {Shift Up} Sleep, 10 } doEndPlayersTurnAndRegenEnergy(regenPer, coordX1, coordY1, true) Sleep, 50 ;delay } } doTacInvToTac() { loop { if (isColorFromPixel(6, 691, \"0x000000\", 0)) { ;is tac inv color: 0x000000 Send, {vkC0sc029} ;tilde key Sleep, 50 break } break } } doTacToTacInv() { loop { ;is tac not inv color: 0x735118, is tac not inv no selected color: 0x291010 if (isColorFromPixel(6, 691, \"0x735118\", 0) || isColorFromPixel(6, 691, \"0x291010\", 0)) { Send, {vkC0sc029} ;tilde key Sleep, 50 break } break } } waitMapScreen() { loop { if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen break } Sleep, 50 } Sleep, 100 ;delay loop, 2 { clickMouse(33, 43, \"Left\", 50) ;skip speech } } waitTacScreen() { loop { if (isColorFromPixel(6, 691, \"0x735118\", 0) || isColorFromPixel(6, 691, \"0x291010\", 0) || isColorFromPixel(6, 691, \"0x000000\", 0)) { ;is tac not inv color: 0x735118, , is tac not inv no selected color: 0x291010, is tac inv color: 0x000000 break } Sleep, 50 } Send, {Pause} ;delay Sleep, 100 Send, {Pause} Sleep, 50 } callMapScreen() { if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen return } Send, {Pause} ;delay Sleep, 1000 loop { Send, {m} ;call map screen Sleep, 50 if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen break } Sleep, 50 } loop, 2 { clickMouse(33, 43, \"Left\", 50) ;skip speech } Sleep, 100 ;delay } callTacScreen() { if (isColorFromPixel(6, 691, \"0x735118\", 0) || isColorFromPixel(6, 691, \"0x291010\", 0) || isColorFromPixel(6, 691, \"0x000000\", 0)) { ;is tac not inv color: 0x735118, , is tac not inv no selected color: 0x291010, is tac inv color: 0x000000 return } if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen if (isColorFromPixel(220, 178, \"0x393021\" , 0)) { ;is inv mode Send, {Esc} Sleep, 100 ;added delay } Sleep, 1000 loop { ;clickMouse(895, 711, \"Left\", 50) ;tactical button Send, {Esc} Sleep, 10 if (isColorFromPixel(6, 691, \"0x735118\", 0) || isColorFromPixel(6, 691, \"0x291010\", 0) || isColorFromPixel(6, 691, \"0x000000\", 0)) { ;is tac not inv color: 0x735118, , is tac not inv no selected color: 0x291010, is tac inv color: 0x000000 break } Sleep, 10 } } Send, {Pause} ;delay Sleep, 100 Send, {Pause} Sleep, 50 } doTacBatCenter(centerCoordX, centerCoordY) { successCnt := 0 loop { if (!isPlayerCenter(centerCoordX - 36, centerCoordY - 90, 60, 60, \"0xCE0000\")) { ;tac is player center successCnt := 0 Send, {/} Sleep, 10 } else { successCnt += 1 if (successCnt \u003e= 10) { Send, {/} Sleep, 10 break } } Sleep, 10 } ;tac character stance s health coord x - 6, y - 50 color: 0xCE0000 ;tac character stance c health coord x - 6, y - 40 color: 0xCE0000 ;tac character stance x health coord x - 6, y - 25 color: 0xCE0000 ;loop { ; if (isColorFromPixel(coordX1 - 6, coordY1 - 50, \"0xCE0000\", 0) ; || isColorFromPixel(coordX1 - 6, coordY1 - 40, \"0xCE0000\", 0) ; || isColorFromPixel(coordX1 - 6, coordY1 - 25, \"0xCE0000\", 0)) { ; break ; } else { ; Send, {/} ; Sleep, 10 ;delay ; } ; Sleep, 10 ;} } doEndPlayersTurn(centerCoordX, centerCoordY, isDropBackpack) { if (isDropBackpack) { if (isColorFromPixel(3, 557, \"0xFFD739\", 0)) { ;not enough ap color: 0xFFD739 doEndPlayersTurn(centerCoordX, centerCoordY, false) } Send, {Shift Down} Sleep, 10 Send, {b} ;drop backpack Sleep, 10 Send, {Shift Up} Sleep, 10 } ;one more time for ap loop, 2 { Send, {d} Sleep, 10 loop { if (isColorFromPixel(6, 6, \"0x73A600\", 0) ;player's turn color: 0x73A600 || isColorFromPixel(6, 6, \"0xADA610\", 0)) { ;interrrupt color: 0xADA610 break } Sleep, 10 } } Sleep, 10 } doEndPlayersTurnAndRegenEnergy(regenPer, centerCoordX, centerCoordY, isDropBackpack) { maxY := getTacMaxEnergyCoordY() regenY := maxY parsedEnergySize := maxY - 653 totalEnergySize := 43 - parsedEnergySize if (regenPer \u003c 100) { regenY := 653 + parsedEnergySize + (totalEnergySize - 1) - Floor(totalEnergySize * regenPer / 100) } if (isColorFromPixel(70 + (1 * 6), regenY, \"0x000000\", 0)) { ;tac energy coord: 76, 653 ~ 70, 695, squad1 color: 0x2930F7, bg: 0x000000 loop { doEndPlayersTurn(centerCoordX, centerCoordY, isDropBackpack) if (isColorFromPixel(70 + (1 * 6), maxY, \"0x2930F7\", 0)) { ;tac energy coord: 76, 653 ~ 70, 695, squad1 color: 0x2930F7, bg: 0x000000 break } Sleep, 10 } } else { doEndPlayersTurn(centerCoordX, centerCoordY, isDropBackpack) } Sleep, 10 } doTacBatStatAgi(directionType, loopCnt) { MouseGetPos, coordX1, coordY1 coordX2 := 0, coordY2 := 0 switch (directionType) { case NW: coordX2 := coordX1 - 20, coordY2 := coordY1 - 10 case NE: coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 default: } Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, coordX1, coordY1 Sleep, 50 clickMouse(coordX1, coordY1, \"Left\", 50) doTacInvToTac() Send, {s} Sleep, 50 loop { outerIndex := A_index if (Mod(A_index, 100) == 0) { callMapScreen() if (isStatMaxCoord(112, 24 + (0 * 10), \"0x00CF00\") || isStatMaxCoord(112, 24 + (0 * 10), \"0xD6CB9C\")) { ;map agi stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED if (outerIndex \u003e 1) { doMapSaveGame() } return } else { callTacScreen() continue } Sleep, 50 } doTacBatCenter(coordX1, coordY1) loop, % loopCnt { Send, {r} Sleep, 10 MouseMove, coordX2, coordY2 Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX2, coordY2, \"Left\", 10) ;move between 1 tiles } Send, {Shift Up} Sleep, 10 MouseMove, coordX1, coordY1 Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move between 1 tiles } Send, {Shift Up} Sleep, 10 ;if (isColorFromPixel(3, 557, \"0xFFD739\", 0)) { ;not enough ap color: 0xFFD739 ; break ;} ;Sleep, 10 } doEndPlayersTurnAndRegenEnergy(99, coordX1, coordY1, false) Sleep, 10 } } doTacStatStrHlt(regenPer, isOnlyHealth) { coordX1 := 510, coordY1 := 310 coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacToTacInv() canteenCoord := StrSplit(getTacCanteenCoord(340, 575, 385, 155, \"0x212008\"), \",\") ;canteen color: 0x212008 Send, {s} Sleep, 50 loop, 2 { doTacDrinkWater(99, canteenCoord[1], canteenCoord[2]) } loop { outerIndex := A_index if (Mod(A_index, 150) == 0) { callMapScreen() callTacScreen() continue } if (isOnlyHealth || isStatMaxCoord(116, 577 + (2 * 10), \"0x00CF00\") || isStatMaxCoord(116, 577 + (2 * 10), \"0xD6CB9C\")) { ;tac str stat color: 0xD6CB9C, now up: 0x00CF00 if (isColorFromPixel(71 + (0 * 6), 574, \"0xCE0000\", 0)) { ;tac health 98 over stat color: 0xCE0000 if (A_index == 1 || testIsMessage(3, 556, 16, 1, \"0xFFD739\")) { ;yellow message callMapScreen() if (isColorFromPixel(159, 81, \"0x00CF00\", 0) || isColorFromPixel(159, 81, \"0xD6CB9C\", 0)) { ;map health stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED Sleep, 100 ;delay for anti freezing if (outerIndex \u003e 1) { doMapSaveGame() } return } else { callTacScreen() continue } } } } ;tac is message color: 0x00CF00 if (testIsMessage(3, 541, 16, 1, \"0x00CF00\") || testIsMessage(3, 556, 16, 1, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } MouseMove, coordX2, coordY2 Sleep, 10 Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX2, coordY2, \"Left\", 10) ;move before pos } Send, {Shift Up} Sleep, 10 doTacDrinkWater(regenPer, canteenCoord[1], canteenCoord[2]) Sleep, 10 MouseMove, coordX1, coordY1 Sleep, 10 Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 loop, 2 { clickMouse(coordX1, coordY1, \"Left\", 10) ;move before pos } Send, {Shift Up} Sleep, 10 doTacDrinkWater(regenPer, canteenCoord[1], canteenCoord[2]) Sleep, 10 } } doTacRemoveExtender(directionType, minDurCoordY, isCheckReload, isAutoMMode) { coordX := 0, coordY := 0 switch (directionType) { case NW: coordX := 510 - (20 * 1), coordY := 310 - (10 * 1) case NE: coordX := 510 + (20 * 1), coordY := 310 - (10 * 1) case SW: coordX := 510 - (20 * 1), coordY := 310 + (10 * 1) case SE: coordX := 510 + (20 * 1), coordY := 310 + (10 * 1) default: } successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) Send, {l} Sleep, 50 MouseMove, %coordX%, %coordY% Sleep, 50 clickMouse(coordX, coordY, \"Left\", 50) ;look target tile Sleep, 50 doTacToTacInv() canteenCoord := StrSplit(getTacCanteenCoord(340, 575, 385, 155, \"0x212008\"), \",\") ;canteen color: 0x212008 extenderColor := getPixelColor(177, 719) ;tac inv is gun attachemnt color: 0x007900, 0xFFCB00(grenade launcher) Send, {x} Sleep, 50 doTacDrinkWater(50, canteenCoord[1], canteenCoord[2]) loop { outerIndex := A_index loop { if (isColorFromPixel(119, 735, \"0xCEAE84\", 0)) { ;got gun break } Sleep, 10 } if (!isAutoMMode) { ;psycho trait loop { if (isColorFromPixel(159, 734, \"0xFF0000\", 0)) { ;tac inv is gun burst or auto mode color: 0xFF0000 Send, {b} Sleep, 10 } if (!isColorFromPixel(159, 734, \"0xFF0000\", 0)) { ;tac inv is gun single mode break } Sleep, 10 } } if (!isColorFromPixel(177, 719, extenderColor, 0)) { playBeep(3, 7902, 80) ;SUCCEED callMapScreen() if (successCnt \u003e 0) { doMapSaveGame() } doMapDropItem(false) return } ;tac is 6line message color: 0x00CF00 if (testIsMessage(3, 466, 16, 90, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is call reinforcements if (isColorFromPixel(541, 408, \"0xFFFFFF\", 0)) { ;call reinforcements to xx dialog playBeep(1, 2489, 80) ;INTERRUPTED return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } doTacDrinkWater(50, canteenCoord[1], canteenCoord[2]) if (isColorFromPixel(119, 725, \"0x393829\", 0)) { ;destructed successCnt := 0 doTacLoadGame() continue } else if (isColorFromPixel(119, minDurCoordY, \"0x000000\", 0)) { ;tac inv primary item min durability playBeep(1, 2489, 80) ;INTERRUPTED if (successCnt \u003e 0) { doTacSaveGame() } callMapScreen() doMapDropItem(false) return } if (isColorFromPixel(119, (minDurCoordY - 1), \"0x000000\", 0)) { ;tac inv primary item min - 1 durability if (Mod(successCnt, 5) == 0) { if (successCnt \u003e 0) { doTacSaveGame() } } } successCnt += 1 Send, {u} Sleep, 10 MouseMove, %coordX%, %coordY% Sleep, 10 clickMouseFast(%coordX%, %coordY%, \"Left\") ;attack between 1 tiles if (Mod(successCnt, 5) == 0) { Send, {Shift Down} Sleep, 10 Send, {r} Sleep, 10 Send, {Shift Up} Sleep, 10 } if (isCheckReload \u0026\u0026 !isColorFromPixel(172, 724, \"0xFF0000\", 0)) { ;tac inv is gun jammed color: 0xFF0000 if (testIsMessage(120, 30, 16, 16, \"0xFFFFFF\")) { ;merc speech playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } } Sleep, 10 } } doTacStatDexMec(directionType, minDurCoordY, saveTerm, isCheckReload, isAutoMMode) { coordX := 0, coordY := 0 switch (directionType) { case NW: coordX := 510 - (20 * 1), coordY := 310 - (10 * 1) case NE: coordX := 510 + (20 * 1), coordY := 310 - (10 * 1) case SW: coordX := 510 - (20 * 1), coordY := 310 + (10 * 1) case SE: coordX := 510 + (20 * 1), coordY := 310 + (10 * 1) default: } successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) Send, {l} Sleep, 50 MouseMove, %coordX%, %coordY% Sleep, 50 clickMouse(coordX, coordY, \"Left\", 50) ;look target tile Sleep, 50 doTacToTacInv() canteenCoord := StrSplit(getTacCanteenCoord(340, 575, 385, 155, \"0x212008\"), \",\") ;canteen color: 0x212008 Send, {x} Sleep, 50 doTacDrinkWater(50, canteenCoord[1], canteenCoord[2]) loop { outerIndex := A_index loop { if (isColorFromPixel(119, 735, \"0xCEAE84\", 0)) { ;got gun break } Sleep, 10 } if (!isAutoMMode) { ;psycho trait loop { if (isColorFromPixel(159, 734, \"0xFF0000\", 0)) { ;tac inv is gun burst or auto mode color: 0xFF0000 Send, {b} Sleep, 10 } if (!isColorFromPixel(159, 734, \"0xFF0000\", 0)) { ;tac inv is gun single mode break } Sleep, 10 } } if (isStatMaxCoord(163, 577 + (2 * 10), \"0x00CF00\") || isStatMaxCoord(163, 577 + (2 * 10), \"0xD6CB9C\")) { ;tac mec stat color: 0xD6CB9C, now up: 0x00CF00 if (isStatMaxCoord(116, 577 + (1 * 10), \"0x00CF00\") || isStatMaxCoord(116, 577 + (1 * 10), \"0xD6CB9C\")) { ;tac dex stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED callMapScreen() if (successCnt \u003e 0) { doMapSaveGame() } doMapDropItem(false) return } } ;tac is 6line message color: 0x00CF00 if (testIsMessage(3, 466, 16, 90, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is call reinforcements if (isColorFromPixel(541, 408, \"0xFFFFFF\", 0)) { ;call reinforcements to xx dialog playBeep(1, 2489, 80) ;INTERRUPTED return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } doTacDrinkWater(50, canteenCoord[1], canteenCoord[2]) if (isColorFromPixel(119, 725, \"0x393829\", 0)) { ;destructed successCnt := 0 doTacLoadGame() continue } else if (isColorFromPixel(119, minDurCoordY, \"0x000000\", 0)) { ;tac inv primary item min durability playBeep(1, 2489, 80) ;INTERRUPTED if (successCnt \u003e 0) { doTacSaveGame() } callMapScreen() doMapDropItem(false) return } if (saveTerm \u003e 0) { if (isColorFromPixel(119, (minDurCoordY - 1), \"0x000000\", 0)) { ;tac inv primary item min - 1 durability if (Mod(successCnt, saveTerm) == 0) { if (successCnt \u003e 0) { doTacSaveGame() } } } } successCnt += 1 Send, {u} Sleep, 10 MouseMove, %coordX%, %coordY% Sleep, 10 clickMouseFast(%coordX%, %coordY%, \"Left\") ;attack between 1 tiles if (Mod(successCnt, 5) == 0) { Send, {Shift Down} Sleep, 10 Send, {r} Sleep, 10 Send, {Shift Up} Sleep, 10 } if (isCheckReload \u0026\u0026 !isColorFromPixel(172, 724, \"0xFF0000\", 0)) { ;tac inv is gun jammed color: 0xFF0000 if (testIsMessage(120, 30, 16, 16, \"0xFFFFFF\")) { ;merc speech playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } } Sleep, 10 } } doTacStatPreDexMec(directionType) { coordX := 0, coordY := 0 switch (directionType) { case NW: coordX := 510 - (20 * 1), coordY := 310 - (10 * 1) case NE: coordX := 510 + (20 * 1), coordY := 310 - (10 * 1) case SW: coordX := 510 - (20 * 1), coordY := 310 + (10 * 1) case SE: coordX := 510 + (20 * 1), coordY := 310 + (10 * 1) default: } callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) Send, {l} Sleep, 50 MouseMove, %coordX%, %coordY% Sleep, 50 clickMouse(coordX, coordY, \"Left\", 50) ;look target tile Sleep, 50 doTacToTacInv() Send, {x} Sleep, 1000 Send, {Shift Down} Sleep, 50 Send, {r} Sleep, 50 Send, {Shift Up} Sleep, 50 Send, {u} Sleep, 50 MouseMove, %coordX%, %coordY% Sleep, 50 loop { if (Mod(A_Index, 4) == 0) { callMapScreen() doMapSwapItem() playBeep(3, 7902, 80) ;SUCCEED break } clickMouseFast(%coordX%, %coordY%, \"Left\") ;attack between 1 tiles Sleep, 10 } } doMapDropBackpack(backpackType, loopCnt) { MouseGetPos, coordX1, coordY1 coordX2 := 0, coordY2 := 0 switch (backpackType) { case COMBAT_PACK: coordX2 := 215, coordY2 := 375 case BACKPACK: coordX2 := 195, coordY2 := 555 default: } loop, % loopCnt { MouseMove, coordX1, coordY1 Sleep, 50 Send, {Ctrl Down} Send, {Shift Down} Sleep, 50 clickMouse(coordX1, coordY1, \"Left\", 50) Sleep, 50 Send, {Shift Up} Send, {Ctrl Up} Sleep, 100 ;delay Send, {Shift Down} Sleep, 50 Send, {e} Sleep, 50 Send, {Shift Up} Sleep, 100 ;delay MouseMove, coordX2, coordY2 Sleep, 50 Send, {Ctrl Down} Send, {Shift Down} Sleep, 50 clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 Send, {Shift Up} Send, {Ctrl Up} Sleep, 50 } MouseMove, coordX1, coordY1 Sleep, 50 playBeep(3, 7902, 80) ;SUCCEED } doMapDropBackpack2(loopCnt) { ;goto last page loop, % loopCnt { Send, {.} Sleep, 50 } ;drop all Send, {Shift Down} Sleep, 50 Send, {e} Sleep, 50 Send, {Shift Up} Sleep, 100 ;delay isCombatPack := false isBackpack := false ;move combat pack if (isColorFromPixel(189, 381, \"0xCEAE84\", 0)) { ;map combat pack is item color: 0xCEAE84 isCombatPack := true coordX1 := 215, coordY1 := 375 MouseMove, coordX1, coordY1 Sleep, 50 clickMouse(coordX1, coordY1, \"Left\", 50) Sleep, 50 coordX3 := 965, coordY3 := 545 MouseMove, coordX3, coordY3 Sleep, 50 clickMouse(coordX3, coordY3, \"Left\", 50) Sleep, 50 } ;move backpack if (isColorFromPixel(168, 567, \"0xCEAE84\", 0)) { ;map backpack is item color: 0xCEAE84 isBackpack := true coordX2 := 195, coordY2 := 555 MouseMove, coordX2, coordY2 Sleep, 50 clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 coordX4 := coordX3, coordY4 := coordY3 + 30 MouseMove, coordX4, coordY4 Sleep, 50 clickMouse(coordX4, coordY4, \"Left\", 50) Sleep, 50 } ;move vest if (isColorFromPixel(181, 284, \"0xCEAE84\", 0)) { ;map vest is item color: 0xCEAE84 coordX5 := 205, coordY5 := 275 MouseMove, coordX5, coordY5 Sleep, 50 Send, {Ctrl Down} Send, {Shift Down} Sleep, 50 clickMouse(coordX5, coordY5, \"Left\", 50) Sleep, 50 Send, {Shift Up} Send, {Ctrl Up} Sleep, 50 } ;drop righthand backpack if (isColorFromPixel(9, 214, \"0xCEAE84\", 0)) { ;map righthand is item color: 0xCEAE84 coordX6 := 45, coordY6 := 205 MouseMove, coordX6, coordY6 Sleep, 50 clickMouse(coordX6, coordY6, \"Left\", 50) Sleep, 50 MouseMove, coordX2, coordY2 Sleep, 50 clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 Send, {Shift Down} Sleep, 50 Send, {e} Sleep, 50 Send, {Shift Up} Sleep, 100 ;delay clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 MouseMove, coordX6, coordY6 Sleep, 50 clickMouse(coordX6, coordY6, \"Left\", 50) Sleep, 50 } ;drop lefthand backpack if (isColorFromPixel(9, 237, \"0xCEAE84\", 0)) { ;map lefthand is item color: 0xCEAE84 coordX7 := coordX6, coordY7 := coordY6 + 25 MouseMove, coordX7, coordY7 Sleep, 50 clickMouse(coordX7, coordY7, \"Left\", 50) Sleep, 50 MouseMove, coordX2, coordY2 Sleep, 50 clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 Send, {Shift Down} Sleep, 50 Send, {e} Sleep, 50 Send, {Shift Up} Sleep, 100 ;delay clickMouse(coordX2, coordY2, \"Left\", 50) Sleep, 50 MouseMove, coordX7, coordY7 Sleep, 50 clickMouse(coordX7, coordY7, \"Left\", 50) Sleep, 50 } ;move combat pack if (isCombatPack) { MouseMove, coordX3, coordY3 Sleep, 50 Send, {Ctrl Down} Send, {Shift Down} Sleep, 50 clickMouse(coordX3, coordY3, \"Left\", 50) Sleep, 50 Send, {Shift Up} Send, {Ctrl Up} Sleep, 50 } ;move backpack if (isBackpack) { MouseMove, coordX4, coordY4 Sleep, 50 Send, {Ctrl Down} Send, {Shift Down} Sleep, 50 clickMouse(coordX4, coordY4, \"Left\", 50) Sleep, 50 Send, {Shift Up} Send, {Ctrl Up} Sleep, 50 } playBeep(3, 7902, 80) ;SUCCEED } doMapSwapItem() { Send, {Enter} Sleep, 50 loop { if (isColorFromPixel(220, 178, \"0x393021\" , 0)) { ;is inv mode break } Sleep, 50 } Sleep, 100 ;mode switching delay MouseMove, 37, 201 Sleep, 50 clickMouse(37, 201, \"Left\", 50) Sleep, 50 MouseMove, 108, 275 Sleep, 50 clickMouse(108, 275, \"Left\", 50) Sleep, 50 MouseMove, 37, 201 Sleep, 50 clickMouse(37, 201, \"Left\", 50) Sleep, 50 } doMapDropItem(isOtherMerc) { Send, {Enter} Sleep, 50 loop { if (isColorFromPixel(220, 178, \"0x393021\" , 0)) { ;is inv mode break } Sleep, 50 } Sleep, 100 ;mode switching delay MouseMove, 37, 201 Sleep, 50 if (isOtherMerc) { clickMouse(37, 201, \"Left\", 50) Send, {Right} ;sort by assign Sleep, 50 clickMouse(37, 229, \"Left\", 50) Send, {Ctrl Down} Sleep, 50 Send, {Shift Down} Sleep, 50 clickMouse(37, 229, \"Left\", 50) Send, {Shift Up} Sleep, 50 Send, {Ctrl Up} Sleep, 50 } else { Send, {Ctrl Down} Sleep, 50 Send, {Shift Down} Sleep, 50 clickMouse(37, 201, \"Left\", 50) Send, {Shift Up} Sleep, 50 Send, {Ctrl Up} } } doTacStatDexMrk(directionType, minDurCoordY, isOnlyMarksmanship) { coordX := 0, coordY := 0 switch (directionType) { case NW: coordX := 510 - (20 * 1), coordY := 310 - (10 * 1) case NE: coordX := 510 + (20 * 1), coordY := 310 - (10 * 1) case SW: coordX := 510 - (20 * 1), coordY := 310 + (10 * 1) case SE: coordX := 510 + (20 * 1), coordY := 310 + (10 * 1) default: MouseGetPos, coordX, coordY } successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacToTacInv() Send, {s} Sleep, 50 Send, {l} Sleep, 50 MouseMove, %coordX%, %coordY% Sleep, 50 clickMouse(coordX, coordY, \"Left\", 50) ;look target tile Sleep, 50 loop { outerIndex := A_Index if (!isColorFromPixel(119, 735, \"0xCEAE84\", 0)) { ;no knife MouseMove, 510, 310 Sleep, 10 Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(510, 310, \"0x420000\", 0)) { ;red grab cursor break } Sleep, 10 } clickMouse(510, 310, \"Left\", 10) ;get knife Sleep, 10 Send, {Shift Up} Send, {Ctrl Up} Sleep, 10 } loop { if (isColorFromPixel(119, 735, \"0xCEAE84\", 0)) { ;got knife break } Sleep, 10 } if (isStatMaxCoord(163, 577 + (1 * 10), \"0x00CF00\") || isStatMaxCoord(163, 577 + (1 * 10), \"0xD6CB9C\")) { ;tac mrk stat color: 0xD6CB9C, now up: 0x00CF00 if (isOnlyMarksmanship || isStatMaxCoord(116, 577 + (1 * 10), \"0x00CF00\") || isStatMaxCoord(116, 577 + (1 * 10), \"0xD6CB9C\")) { ;tac dex stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED callMapScreen() if (successCnt \u003e 0) { doMapSaveGame() } doMapDropItem(true) return } } ;tac is message color: 0x00CF00 if (testIsMessage(3, 541, 16, 1, \"0x00CF00\") || testIsMessage(3, 556, 16, 1, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } if (isColorFromPixel(119, 725, \"0x393829\", 0)) { ;destructed successCnt := 0 doTacLoadGame() continue } else if (isColorFromPixel(119, minDurCoordY, \"0x000000\", 0)) { ;tac inv primary item min durability playBeep(1, 2489, 80) ;INTERRUPTED if (successCnt \u003e 0) { doTacSaveGame() } callMapScreen() doMapDropItem(true) return } if (isColorFromPixel(119, (minDurCoordY - 1), \"0x000000\", 0)) { ;tac inv primary item min - 1 durability if (successCnt \u003e 0) { doTacSaveGame() } } successCnt += 1 Sleep, 10 MouseMove, %coordX%, %coordY% Sleep, 10 Send, {u} Sleep, 10 clickMouse(%coordX%, %coordY%, \"Left\", 10) ;attack target between 1 tiles Sleep, 10 if (outerIndex == 1 \u0026\u0026 isColorFromPixel(465, 401, \"0xFFFFFF\", 0)) { ;attack dialog exist Send, {y} Sleep, 10 } Sleep, 200 } } doTacDrinkWater(regenPer, canteenCoordX, canteenCoordY) { maxY := getTacInvMaxEnergyCoordY() regenY := maxY parsedEnergySize := maxY - 573 totalEnergySize := 43 - parsedEnergySize if (regenPer \u003c 99) { regenY := 573 + parsedEnergySize + (totalEnergySize - 1) - Floor(totalEnergySize * regenPer / 100) } if (isColorFromPixel(71 + (1 * 6), regenY, \"0x000000\", 0)) { ;tac energy coord: 76, 653 ~ 70, 695, inv color: 0x2930F7, bg: 0x000000 clickMouse(canteenCoordX, canteenCoordY, \"Left\", 1) ;get water loop, 5 { clickMouse(187, 658, \"Left\", 1) ;drink water } clickMouse(canteenCoordX, canteenCoordY, \"Left\", 1) ;set water loop { Send, {Ctrl Down} Sleep, 10 Send, {.} Sleep, 10 Send, {Ctrl Up} Sleep, 10 if (isColorFromPixel(455, 343, \"0xFFFFFF\", 0)) { ;sector menu exist clickMouse(455, 343, \"Left\", 50) ;fill canteen break } Sleep, 10 } loop { if (!isColorFromPixel(455, 343, \"0xFFFFFF\", 0)) { ;sector menu doesn't exist break } Sleep, 10 } } } doTacStatWisExp(skipCheckAmount) { coordX1 := 510, coordY1 := 310 coordX2 := coordX1 + 20, coordY2 := coordY1 - 10 successCnt := 0 callTacScreen() Send, {F1} Sleep, 50 Send, {/} Sleep, 50 MouseMove, 510, 310 Sleep, 50 clickMouse(510, 310, \"Left\", 50) doTacToTacInv() canteenCoord := StrSplit(getTacCanteenCoord(340, 575, 385, 155, \"0x212008\"), \",\") ;canteen color: 0x212008 Send, {s} Sleep, 50 loop { outerIndex := A_index if (Mod(A_index, 100) == 0) { callMapScreen() callTacScreen() continue } if (isStatMaxCoord(116, 577 + (4 * 10), \"0x00CF00\") || isStatMaxCoord(116, 577 + (4 * 10), \"0xD6CB9C\")) { ;tac wis stat color: 0xD6CB9C, now up: 0x00CF00 if (isStatMaxCoord(163, 577 + (3 * 10), \"0x00CF00\") || isStatMaxCoord(163, 577 + (3 * 10), \"0xD6CB9C\")) { ;tac exp stat color: 0xD6CB9C, now up: 0x00CF00 playBeep(3, 7902, 80) ;SUCCEED callMapScreen() if (successCnt \u003e 0 \u0026\u0026 successCnt \u003c skipCheckAmount) { doMapSaveGame() } return } } ;tac is message color: 0x00CF00 if (testIsMessage(3, 541, 16, 1, \"0x00CF00\") || testIsMessage(3, 556, 16, 1, \"0x00CF00\")) { playBeep(1, 2489, 80) ;INTERRUPTED callMapScreen() return } ;is battle interrupted if (isColorFromPixel(6, 6, \"0x7B615A\", 0)) { ;map screen playBeep(1, 2489, 80) ;INTERRUPTED return } doTacDrinkWater(50, canteenCoord[1], canteenCoord[2]) MouseMove, coordX2, coordY2 Sleep, 10 Send, {r} Sleep, 10 Send, {u} Sleep, 10 Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x101010\", 0) || isColorFromPixel(coordX2, coordY2, \"0x000008\", 0)) { ;bomb cursor, hurl: 0x000008 clickMouse(coordX2, coordY2, \"Left\", 10) ;plant bomb break } Sleep, 10 } Send, {Shift Up} Sleep, 10 loop { if (isColorFromPixel(451, 399, \"0x000008\", 0)) { ;remote detonator or detonator dialog exist Send, {4} Sleep, 10 break } Sleep, 10 } MouseMove, coordX2, coordY2 Sleep, 10 Send, {Ctrl Down} Send, {Shift Down} Sleep, 10 loop { if (isColorFromPixel(coordX2, coordY2, \"0x420000\", 0)) { ;red grab cursor clickMouse(coordX2, coordY2, \"Left\", 10) ;disarm bomb break } Sleep, 10 } Send, {Shift Up} Send, {Ctrl Up} Sleep, 10 loop { if (isColorFromPixel(464, 400, \"0x000008\", 0)) { ;disarm dialog exist Send, {y} Sleep, 10 break } Sleep, 10 } MouseMove, coordX1, coordY1 Sleep, 10 Send, {r} Sleep, 10 Send, {Shift Down} Sleep, 10 clickMouse(coordX1, coordY1, \"Left\", 10) ;move before pos Send, {Shift Up} Sleep, 10 if (successCnt \u003c skipCheckAmount) { Send, {Pause} Sleep, 200 ;delay time when bomb explodes Send, {Pause} Sleep, 10 if (isDamagedHLTCoord(71, 573, 43, \"0xF7F310\") || isColorFromPixel(71, 615, \"0x000000\", 0)) { ;damaged color: 0xF7F310, died color: 0x000000 successCnt := 0 doTacLoadGame() } else { successCnt += 1 doTacSaveGame() } } Sleep, 10 } } doTacLoadGame() { loop { Send, {Ctrl Down} Sleep, 50 Send, {l} Sleep, 50 Send, {Ctrl Up} Sleep, 50 if (isColorFromPixel(446, 161, \"0x291810\", 0)) { ;load game dialog title break } Sleep, 50 } Send, {Enter} Sleep, 5000 ;screen change delay loop { if (isColorFromPixel(6, 654, \"0x735118\", 0) || isColorFromPixel(9, 577, \"0x6B4918\", 0)) { ;tactical screen break } Sleep, 100 ;delay for crash } ;Send, {Pause} ;Sleep, 50 ;Send, {Pause} ;Sleep, 50 } doTacSaveGame() { Send, {/} Sleep, 50 loop { Send, {Ctrl Down} Sleep, 50 Send, {s} Sleep, 50 Send, {Ctrl Up} Sleep, 50 if (isColorFromPixel(446, 161, \"0x9C7952\", 0)) { ;save game dialog title break } Sleep, 50 } Send, {Enter} Sleep, 50 loop { if (isColorFromPixel(349, 352, \"0x211010\", 0)) { ;save game overwrite y/n break } Sleep, 50 } Send, {y} Sleep, 50 loop { if (!isColorFromPixel(446, 161, \"0x9C7952\", 0)) { ;no exist save game dialog title break } Sleep, 50 } ;Send, {Pause} ;Sleep, 50 ;Send, {Pause} ;Sleep, 50 } isDamagedHLTCoord(startX, startY, length, color) { PixelSearch, foundX, foundY, startX, startY, startX + 1, startY + length, color, 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"isDamagedHLTCoord() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \" startX \", \" startY) \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return result } isStatMaxCoord(startX, startY, color) { PixelSearch, foundX, foundY, startX, startY, startX + 1, startY + 1, color, 0, Fast RGB result := ErrorLevel = 0 ? true : false message := \"isStatMaxCoord() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \" startX \", \" startY) \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return result } doMapLoadGame() { loop { Send, {Ctrl Down} Sleep, 50 Send, {l} Sleep, 50 Send, {Ctrl Up} Sleep, 50 if (isColorFromPixel(444, 162, \"0xA5864A\", 0)) { ;load game dialog title break } Sleep, 50 } Send, {Enter} Sleep, 5000 ;screen change delay loop { if (isColorFromPixel(252, 338, \"0x523808\", 0)) { ;map screen break } Sleep, 100 ;delay } } doMapSaveGame() { loop { Send, {Ctrl Down} Sleep, 50 Send, {s} Sleep, 50 Send, {Ctrl Up} Sleep, 50 if (isColorFromPixel(444, 162, \"0xA58652\", 0)) { ;save game dialog title break } Sleep, 50 } Send, {Enter} Sleep, 50 loop { if (isColorFromPixel(349, 350, \"0x181008\", 0)) { ;save game overwrite y/n break } Sleep, 50 } Send, {y} Sleep, 50 loop { if (isColorFromPixel(252, 338, \"0x523808\", 0)) { ;map screen break } Sleep, 50 } } doMapStatExp(skipCheckAmount) { MouseMove, 285, 25 Sleep, 50 clickMouse(285, 25, \"Left\", 50) successCnt := 0 isDisarmMode := true loop { loop { if (isColorFromPixel(252, 338, \"0x523808\", 0)) { ;map screen break } Sleep, 50 } Send, {Enter} Sleep, 50 loop { if (isColorFromPixel(220, 178, \"0x393021\" , 0)) { ;is inv mode break } Sleep, 50 } Sleep, 100 ;mode switching delay clickMouse(43, 206, \"Right\", 100) ;mode switching delay loop { if (isColorFromPixel(47, 199, \"0xCEAE84\", 0)) { ;tnt gear detail durability break } Sleep, 50 } clickMouse(161, 208, \"Left\", 50) loop { if (isColorFromPixel(166, 207, \"0xDED7DE\", 0)) { ;bomb arm dialog exist break } Sleep, 50 } loop { clickMouse(177, 217, \"Left\", 50) loop { if (isColorFromPixel(463, 367, \"0x211010\", 0) || isColorFromPixel(463, 367, \"0x211008\", 0)) { ;remote detonator or detonator dialog exist isDisarmMode := false Send, {4} Sleep, 50 break } if (isColorFromPixel(463, 367, \"0xFFFFFF\", 0)) { ;detonator dialog exist isDisarmMode := true Send, {y} Sleep, 50 break } Sleep, 50 } Sleep, 100 ;delay time when bomb explodes if (isDamagedHLTCoord(67, 19, 43, \"0xF7F310\")) { ;damaged color: 0xF7F310) successCnt := 0 doMapLoadGame() break } else { successCnt += 1 } if (isStatMaxCoord(159, 24 + (3 * 10), \"0x00CF00\") || isStatMaxCoord(159, 24 + (3 * 10), \"0xD6CB9C\")) { ;map exp stat color: 0xD6CB9C, now up: 0x00CF00 if (successCnt \u003e 0 \u0026\u0026 isDisarmMode) { playBeep(3, 7902, 80) ;SUCCEED doMapSaveGame() return } } if (successCnt \u003c skipCheckAmount) { doMapSaveGame() break } Sleep, 50 } Sleep, 50 } } clickMouse(coordX, coordY, mouseButton, delay) { Send, {Click, %coordX% %coordY% %mouseButton% Down} Sleep, 50 Send, {Click, %coordX% %coordY% %mouseButton% Up} if (delay = \"\") return Sleep, %delay% } clickMouseFast(coordX, coordY, mouseButton) { Send, {Click, %coordX% %coordY% %mouseButton% Down} Sleep, 1 Send, {Click, %coordX% %coordY% %mouseButton% Up} Sleep, 1 } Dependencies Libraries Remrks Gdip_All.ahk GDI+ 라이브러리 UwpOcr.ahk UWP (Universal Windows Platform) 라이브러리 https://github.com/dntco43u/ja2_helper/blob/main/lib/Common.ahk ↩︎\nhttps://github.com/dntco43u/ja2_helper/blob/main/ja2_helper.ahk ↩︎\n","categories":["dev"],"description":"Jagged Alliance 2 v1.13 7609 매크로","excerpt":"Jagged Alliance 2 v1.13 7609 매크로","ref":"/dev/ja2-helper/","tags":["autohotkey"],"title":"ja2-helper"},{"body":"\ngraph LR subgraph gvp6nx1a B[jackett] \u003c-- proxy --\u003e C[nginx] B \u003c-- https/api --\u003e E[qbittorrent] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/jackett/docker-compose.yml services: jackett: image: lscr.io/linuxserver/jackett:latest container_name: jackett networks: - dev ports: - 9117/tcp user: 0:0 environment: - PUID=1000 - PGID=1000 - AUTO_UPDATE=true - TZ=Asia/Seoul volumes: - /opt/jackett:/config:rw - /opt/qbittorrent/watched:/downloads:rw restart: unless-stopped networks: dev: external: true host 구성 logrotate sudo vi /etc/logrotate.d/jackett /opt/jackett/Jackett/log.txt* /opt/jackett/Jackett/updater.txt* { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 dev dev sharedscripts postrotate docker restart jackett \u003e/dev/null 2\u003e\u00261 || true endscript } ","categories":["apps"],"description":"jackett 구성","excerpt":"jackett 구성","ref":"/apps/jackett/","tags":["jackett","docker"],"title":"jackett"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/jackett/","tags":"","title":"jackett"},{"body":"\ngraph LR A1[googledrive] \u003c-- mount --\u003e B[jellyfin] subgraph cloud B \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/jellyfin/docker-compose.yml services: jellyfin: image: jellyfin/jellyfin:latest container_name: jellyfin networks: - dev ports: - 8096/tcp - 8920/tcp user: 0:0 environment: - JELLYFIN_PublishedServerUrl=https://je.gvp6nx1a.duckdns.org - TZ=Asia/Seoul volumes: - /opt/jellyfin/config:/config:rw - /opt/jellyfin/cache:/cache:rw - /home/dev/videos:/mnt/gvp6nx1a:rw - /mnt/ce9dbqya-gdrive/videos:/mnt/ce9dbqya:rw devices: - /dev/dri:/dev/dri privileged: true restart: unless-stopped networks: dev: external: true Transcoding vaapi 구성 확인\ndocker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/ffmpeg -v debug -init_hw_device opencl intel quicksync(qsv) 지원 확인\ndocker exec -it jellyfin /usr/lib/jellyfin-ffmpeg/ffmpeg -codecs | grep 'qsv' Troubleshooting 헤놀 포럼 글 중에 아래 같은 글이 있는데 해당 댓글 중 BIOS에서 CPU 관련 옵션 중 VT-d 기능을 비활성화 시키면 H/W 트랜스코딩이 된다는 글을 보고 시도해 보았습니다.\n결과는 성공!! PLEX PASS 구매하고 J4105-ITX 보드 구매한 보람이 드디어 생겼습니다. 1\nASRock J4105/J5005ITX CMOS에서 VT-d 기능을 비활성화하면 Transcoding 가능\nhttps://xpenology.com/forum/topic/14222-asrock-j4105-itx-test-transcoding-etc-with-asrock-j5005-itx-will-be-the-same/?tab=comments#comment-107981 ↩︎\n","categories":["apps"],"description":"jellyfin 구성","excerpt":"jellyfin 구성","ref":"/apps/jellyfin/","tags":["jellyfin","docker"],"title":"jellyfin"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/jellyfin/","tags":"","title":"jellyfin"},{"body":"\ngraph TB B \u003c-- ssh --\u003e A9 A9[github] -- git --\u003e A1 B -- build --\u003e A1[projects] subgraph gvp6nx1a A1 ---\u003e F1[post_build.sh] B ---\u003e F2[pre_build.sh] F2 --- G1[security-properties] G1 ---\u003e A1 F1 --\u003e G2[app-reload] B[jenkins] \u003c-- proxy --\u003e C[nginx] end A9 -- https/api --\u003e C C \u003c-- https --\u003e D[client] G2 -- https/api --\u003e D1[telegram] F2 -- https/api --\u003e D1 container 구성 docker-compose.yml 이미지 크기: latest-jdk17 279.13 MB, alpine-jdk17 193.04 MB alpine-jdk17 x86 전용. arm 사용 불가 vi /opt/jenkins/docker-compose.yml services: jenkins: image: jenkins/jenkins:jdk17 container_name: jenkins networks: - dev ports: - 8080/tcp user: 1000:1000 environment: - JAVA_OPTS=-Xmx1g - TZ=Asia/Seoul volumes: - /home/dev/.local/bin/utils.sh:/var/jenkins_home/config/utils.sh:ro - /opt/jenkins/data:/var/jenkins_home:rw restart: unless-stopped networks: dev: external: true 초기 암호 docker exec -it jenkins cat /var/jenkins_home/secrets/initialAdminPassword 3******************************* github ssh docker cp /home/dev/.ssh/dntco43u@github.pub jenkins:/var/jenkins_home/.ssh/id_ed25519.pub \u0026\u0026 \\ docker cp /home/dev/.ssh/dntco43u@github.pem jenkins:/var/jenkins_home/.ssh/id_ed25519 \u0026\u0026 \\ docker exec -it jenkins ssh -T git@github.com Hi dntco43u! You've successfully authenticated, but GitHub does not provide shell access. github webooks pre_build.sh 빌드 전처리 각 프로젝트 보안 환경 구성 /opt/jenkins/data/config/$PROJECT_NAME/application-security.properties vi /opt/jenkins/data/config/pre_build.sh #!/bin/bash # 자동 build 전 처리 source /var/jenkins_home/config/utils.sh log_file=/tmp/$(basename \"$0\" | sed 's/.sh//').log msg_file=/tmp/$(basename \"$0\" | sed 's/.sh//').tmp jenkins_bot_key=\"$3\" tel_chat_id=\"$4\" { echo \"$1 #$2\" mkdir -p \"/var/jenkins_home/workspace/$1/src/main/resources\" cp -f \\ \"/var/jenkins_home/config/$1/application-security.properties\" \\ \"/var/jenkins_home/workspace/$1/src/main/resources\" show_file_stat \"/var/jenkins_home/workspace/$1/src/main/resources/application-security.properties\" } \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$jenkins_bot_key\" \"$tel_chat_id\" \"$msg_file\" rm \"$msg_file\" post_build.sh 빌드 후처리 각 프로젝트에 첨부 telegram License 상업적 이용 제한 없음\nMIT 1 Troubleshooting 열약한 기기에서 설치 도중 멈춤\n메모리 부족일 때 그렇다고 한다. 환경 변수 JAVA_OPTS=-Xmx1g 추가 (docker-compose.yml)\nsrc 수정없이 security properties만 수정하면 jar 미반영됨\nsrc 수정 후 rebuild 되는 것 확인할 것\nproxy에서 국외 ip 차단 시 webhook 차단됨\ntail -f /opt/nginx/log/jenkins_access.log; tail -f /opt/nginx/log/jenkins_error.log https://www.jenkins.io/license/ ↩︎\n","categories":["infara"],"description":"jenkins 구성","excerpt":"jenkins 구성","ref":"/infra/jenkins/","tags":["jenkins","ci-cd","docker"],"title":"jenkins"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/jenkins/","tags":"","title":"jenkins"},{"body":"\ngraph LR A1[webdrives] \u003c---\u003e B[kavita] subgraph cloud B \u003c---\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/kavita/docker-compose.yml services: kavita: image: lscr.io/linuxserver/kavita:latest container_name: kavita networks: - dev ports: - 5000/tcp user: 0:0 environment: - PUID=1000 - PGID=1000 - TZ=Asia/Seoul volumes: - /opt/kavita/config:/config:rw - /mnt/ce9dbqya-gdrive/documents:/ce9dbqya:rw - /mnt/mgujomtd-gdrive/documents:/mgujomtd:rw - /mnt/wagimgxc-gdrive/documents:/wagimgxc:rw - /mnt/tsdfsvkx-gdrive/documents:/tsdfsvkx:rw - /mnt/aqn8dtkh-gdrive/documents:/aqn8dtkh:rw - /mnt/gvp6nx1a-alist/ndgzbj1c@teambition/documents:/ndgzbj1c:rw restart: unless-stopped networks: dev: external: true 라이브러리 구조 1 폴더 구조\nkomga는 2 depth 이상의 구조로 관리 가능 kavita는 2 depth 이상이면 이런저런 문제가 있으므로 1 depth 고정 파일명 접미어\n단편의 경우 c1 1권 분량의 경우 v1 넣지 않을 경우 special로 처리됨 북 커버\n단편, 여러 볼륨 상관없이 ________.webp를 filename.cbz에 추가 Troubleshooting 폴더 구조가 3 depth 이상일 때는 2 depth가 비어 있으면 스캔 중단됨\n라이브러리 폴더 구조 1 depth로 고정\nhttps://wiki.kavitareader.com/guides/scanner/managefiles ↩︎\n","categories":["apps"],"description":"kavita 구성","excerpt":"kavita 구성","ref":"/apps/kavita/","tags":["kavita","docker"],"title":"kavita"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/kavita/","tags":"","title":"kavita"},{"body":"\ngraph LR A13[promtail] -- https --\u003e A7[loki] subgraph gvp6nx1a A33[promtail] -- http --\u003e A7[loki] A7 \u003c-- http --\u003e B1[grafana] end A7 \u003c-- https --\u003e B2[grafana] container 구성 docker-compose.yml vi /opt/loki/docker-compose.yml services: loki: image: grafana/loki:latest container_name: loki networks: - dev ports: - 3100/tcp user: 0:0 volumes: - /opt/loki/config:/etc/loki:ro - /opt/loki/data:/loki:rw command: - --config.file=/etc/loki/local-config.yaml restart: unless-stopped networks: dev: external: true local-config.yaml s3에 적재하는 구성\nvi /opt/loki/config/local-config.yaml auth_enabled: false server: http_listen_port: 3100 http_server_read_timeout: 600s http_server_write_timeout: 600s common: ring: instance_addr: 127.0.0.1 kvstore: store: inmemory replication_factor: 1 path_prefix: /loki schema_config: configs: - from: 2020-10-24 store: tsdb object_store: aws schema: v13 index: prefix: index_ period: 24h storage_config: tsdb_shipper: active_index_directory: /loki/index cache_location: /loki/index_cache cache_ttl: 24h aws: bucketnames: ahgcnzl5 region: ap-seoul-1 endpoint: https://c***********.compat.objectstorage.ap-seoul-1.oraclecloud.com access_key_id: 9*************************************** secret_access_key: p******************************************* http_config: insecure_skip_verify: true insecure: true s3forcepathstyle: true compactor: working_directory: /loki/compactor compaction_interval: 5m retention_enabled: true delete_request_store: aws limits_config: allow_structured_metadata: true local-config.yaml file에 적재하는 구성\nvi /opt/loki/config/local-config.yaml auth_enabled: false server: http_listen_port: 3100 common: ring: instance_addr: 127.0.0.1 kvstore: store: inmemory replication_factor: 1 path_prefix: /loki schema_config: configs: - from: 2020-10-24 store: tsdb object_store: filesystem schema: v13 index: prefix: index_ period: 24h storage_config: filesystem: directory: /loki/ ruler: storage: type: local local: directory: /loki/rules rule_path: /loki/scratch alertmanager_url: http://localhost ring: kvstore: store: inmemory enable_api: true limits_config: retention_period: 7d allow_structured_metadata: true reject_old_samples: true reject_old_samples_max_age: 168h max_cache_freshness_per_query: 10m split_queries_by_interval: 15m #for big logs tune per_stream_rate_limit: 512M per_stream_rate_limit_burst: 1024M cardinality_limit: 200000 ingestion_burst_size_mb: 1000 ingestion_rate_mb: 10000 max_entries_limit_per_query: 1000000 max_label_value_length: 20480 max_label_name_length: 10240 max_label_names_per_series: 300 max_query_series: 100000 max_query_parallelism: 2 querier: max_concurrent: 16384 query_scheduler: max_outstanding_requests_per_tenant: 16384 query_range: parallelise_shardable_queries: true ingester: chunk_encoding: snappy compactor: retention_enabled: true delete_request_store: filesystem working_directory: /loki/compactor compaction_interval: 5m proxy 구성 특정 ip만 허용하도록 구성\nvi /opt/nginx/config/sites-available/loki.conf ... location / { include /etc/nginx/conf.d/include/proxy.conf; proxy_pass http://loki:3100; auth_basic \"Authorization required\"; auth_basic_user_file /etc/nginx/access/loki; proxy_intercept_errors on; allow 192.168.0.0/16; allow 2**.**.**.*; #sj9n7air allow 1**.***.**.*; #ec4mrjp5 allow 1**.***.**.**; #m7jrgve9 allow 1**.***.**.**; #gvp6nx1a allow 3*.***.***.***; #agknwpt3 deny all; } ... nginx에 http basic auth 추가\nprintf \"dev:$(openssl passwd -apr1 a***************************************************************)\\n\" \u003e\u003e /opt/nginx/config/access/loki \u0026\u0026 \\ chmod 755 /opt/nginx/config/access \u0026\u0026 \\ chmod 644 /opt/nginx/config/access/loki \u0026\u0026 \\ docker exec -it nginx nginx -s reload Troubleshooting 최상의 성능을 위해 chunk_encoding 위해 snappy를 사용하십시오. 1\nchunk_encoding 구성 추가 (local-config.yaml)\nStatus: 500. Message: maximum of series (500) reached for a single query 2\nmax_query_series, max_query_parallelism 구성 추가 (local-config.yaml)\nStatus: 504. Message: Get “http://…”: net/http: timeout awaiting response headers (Client.Timeout exceeded while awaiting headers)\ngrafana 구성 변경 loki datasource 에서 timeout 300s으로 변경\nStatus: 429\n대용량 log용 구성 (local-config.yaml) limits_config 구성 추가 (local-config.yaml)\nhttps://grafana.com/blog/2023/12/28/the-concise-guide-to-loki-how-to-get-the-most-out-of-your-query-performance/ ↩︎\nhttps://github.com/grafana/loki/issues/3045 ↩︎\n","categories":["apps"],"description":"loki 구성","excerpt":"loki 구성","ref":"/apps/loki/","tags":["loki","docker"],"title":"loki"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/loki/","tags":"","title":"loki"},{"body":"\ngraph LR A1[webdrives] \u003c---\u003e B[navidrome] subgraph cloud B \u003c---\u003e C[nginx] end C \u003c-- https --\u003e D[client] .env vi /opt/navidrome/.env ND_SPOTIFY_ID=e******************************* ND_SPOTIFY_SECRET=5******************************* docker-compose.yml vi /opt/navidrome/docker-compose.yml services: navidrome: image: deluan/navidrome:latest container_name: navidrome networks: - dev ports: - 4533/tcp user: 1000:1000 environment: - ND_MUSICFOLDER=/music - ND_SCANSCHEDULE=24h - ND_LOGLEVEL=info - ND_SCANNER_EXTRACTOR=ffmpeg - ND_SPOTIFY_ID=$ND_SPOTIFY_ID - ND_SPOTIFY_SECRET=$ND_SPOTIFY_SECRET - ND_SCANNER_PURGEMISSING=always volumes: - /opt/navidrome/data:/data:rw - /mnt/uodacgt6-gdrive/music:/music/uodacgt6:ro - /mnt/pc9xqpnh-gdrive/music:/music/pc9xqpnh:ro - /mnt/dwecl0ir-gdrive/music:/music/dwecl0ir:ro - /mnt/zckmxa4g-gdrive/music:/music/zckmxa4g:ro - /mnt/wly1zcl7-onedrive/music:/music/wly1zcl7:ro - /mnt/tamg9wel-teldrive/music:/music/tamg9wel:ro - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro restart: unless-stopped networks: dev: external: true ","categories":["apps"],"description":"navidrome 구성","excerpt":"navidrome 구성","ref":"/apps/navidrome/","tags":["navidrome","docker"],"title":"navidrome"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/navidrome/","tags":"","title":"navidrome"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/oracle/","tags":"","title":"oracle"},{"body":"\ngraph TB subgraph gvp6nx1a A2[postgres] -- tcp --\u003e A4[postgres-exporter] A4 -- http --\u003e A3[prometheus] end container 구성 .env vi /opt/pgsql-exporter/.env DATA_SOURCE_NAME=postgresql://postgres:a***************************************************************@host.docker.internal:5432/postgres?sslmode=disable docker-compose.yml network bridge 구성이어도 host를 허용하도록 구성\nvi /opt/pgsql-exporter/docker-compose.yml services: pgsql-exporter: image: quay.io/prometheuscommunity/postgres-exporter:latest container_name: pgsql-exporter networks: - dev ports: - 9187/tcp extra_hosts: - \"host.docker.internal:host-gateway\" user: 1000:1000 environment: - DATA_SOURCE_NAME=$DATA_SOURCE_NAME volumes: - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro - /opt/pgsql-exporter/config/postgres_exporter.yml:/postgres_exporter.yml:rw restart: unless-stopped networks: dev: external: true ","categories":["apps"],"description":"pgsql-exporter 구성","excerpt":"pgsql-exporter 구성","ref":"/apps/pgsql-exporter/","tags":["pgsql-exporter","docker"],"title":"pgsql-exporter"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/pgsql-exporter/","tags":"","title":"pgsql-exporter"},{"body":"\ngraph LR subgraph gvp6nx1a B1[authelia] \u003c-- proxy --\u003e C[nginx] B[privatebin] \u003c-- proxy --\u003e B1 end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/privatebin/docker-compose.yml services: privatebin: image: privatebin/fs:latest container_name: privatebin networks: - dev ports: - 8080/tcp user: 65534:82 environment: - TZ=Asia/Seoul - PHP_TZ=Asia/Seoul volumes: - /opt/privatebin/config:/srv/cfg:rw - /opt/privatebin/data:/srv/data:rw - /opt/privatebin/tmp:/tmp:rw - /opt/privatebin/run:/run:rw - /opt/privatebin/nginx_tmp:/var/lib/nginx/tmp:rw read_only: true restart: unless-stopped networks: dev: external: true proxy 구성 authelia 구성\nvi /opt/nginx/config/sites-available/privatebin.conf ... location /authelia { if ($allowed_country = no) { return 403; } include /etc/nginx/snippets/authelia-api.conf; } location / { if ($allowed_country = no) { return 403; } proxy_pass http://privatebin:8080; include /etc/nginx/snippets/authelia-auth.conf; add_header 'Cross-Origin-Embedder-Policy' 'require-corp'; add_header 'Cross-Origin-Opener-Policy' 'same-origin'; add_header 'Cross-Origin-Resource-Policy' 'same-site'; } ... Troubleshooting cp: can’t create ‘/run/services/nginx/supervise/control’: File exists\nsudo rm -rf /opt/privatebin/run/* ","categories":["apps"],"description":"privatebin 구성","excerpt":"privatebin 구성","ref":"/apps/privatebin/","tags":["privatebin","docker"],"title":"privatebin"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/privatebin/","tags":"","title":"privatebin"},{"body":"\ngraph TB subgraph gvp6nx1a A2[postgresql] -- tcp --\u003e B[grafana] A3[prometheus] -- http --\u003e B A4[postgres-exporter] -- http --\u003e A3 A2 -- tcp --\u003e A4 E2[node-exporter] -- http --\u003e A3 end E3[node-exporter] -- https --\u003e A3 container 구성 docker-compose.yml vi /opt/prometheus/docker-compose.yml services: prometheus: image: prom/prometheus:latest container_name: prometheus networks: - dev ports: - 9090/tcp user: 0:0 volumes: - /opt/prometheus/config:/etc/prometheus:rw - /opt/prometheus/data:/prometheus:rw command: - --config.file=/etc/prometheus/prometheus.yml - --web.config.file=/etc/prometheus/web.yml - --storage.tsdb.path=/prometheus - --storage.tsdb.retention.time=7d restart: unless-stopped networks: dev: external: true 일반 구성 file service discovery 구성\nFilename Remarks node_owrt.json openwrt 메트릭 수집 node_rhel.json rhel 메트릭 수집 pgsql.json postgresql 메트릭 수집 vi /opt/prometheus/config/node_owrt.json [ { \"targets\": [ \"an.sj9n7air.duckdns.org:9***\" ], \"labels\": { \"alias\": \"agq3mbw2\", \"port\": \"9***\" } } ] vi /opt/prometheus/config/node_rhel.json [ { \"targets\": [ \"no.sj9n7air.duckdns.org:443\" ], \"labels\": { \"alias\": \"sj9n7air\" } }, { \"targets\": [ \"no.ec4mrjp5.duckdns.org:443\" ], \"labels\": { \"alias\": \"ec4mrjp5\" } }, { \"targets\": [ \"no.m7jrgve9.duckdns.org:443\" ], \"labels\": { \"alias\": \"m7jrgve9\" } }, { \"targets\": [ \"no.gvp6nx1a.duckdns.org:443\" ], \"labels\": { \"alias\": \"gvp6nx1a\" } } ] vi /opt/prometheus/config/pgsql.json [ { \"targets\": [ \"pgsql-exporter:9187\" ], \"labels\": { \"alias\": \"gvp6nx1a\" } } ] vi /opt/prometheus/config/prometheus.yml global: scrape_interval: 15s evaluation_interval: 15s # Alertmanager configuration alerting: alertmanagers: - static_configs: - targets: # - alertmanager:9093 # Load and evaluate rules in this file every evaluation_interval seconds. rule_files: # - first_rules.yml # - second_rules.yml # A scrape configuration containing exactly one endpoint to scrape. scrape_configs: - job_name: node-owrt file_sd_configs: - files: - node_owrt.json scheme: http #agq3mbw2 #scheme: https #sj9n7air basic_auth: username: dev password: _*************************************************************** - job_name: node-rhel file_sd_configs: - files: - node_rhel.json scheme: https basic_auth: username: dev password: H*************************************************************** - job_name: pgsql file_sd_configs: - files: - pgsql.json scheme: http web.yml http basic auth 구성\npip install bcrypt \u0026\u0026 \\ tee ~/gen-password.py \u003c\u003cEOF import getpass import bcrypt password = getpass.getpass(\"password: \") hashed_password = bcrypt.hashpw(password.encode(\"utf-8\"), bcrypt.gensalt()) print(hashed_password.decode()) EOF python3 ~/gen-password.py password: $*********************************************************** pip uninstall -y bcrypt \u0026\u0026 rm ~/gen-password.py \u0026\u0026 \\ tee /opt/prometheus /config/web.yml \u003c\u003cEOF basic_auth_users: dev: $*********************************************************** EOF host 구성 proxy 구성 특정 ip만 허용하도록 구성\nvi /opt/nginx/config/sites-available/prometheus.conf ... location / { include /etc/nginx/conf.d/include/proxy.conf; proxy_pass http://prometheus:9090; proxy_intercept_errors on; allow 192.168.0.0/16; allow 2**.**.**.*; #sj9n7air allow 1**.***.**.**; #gvp6nx1a allow 3*.***.***.***; #agknwpt3 deny all; } ... Troubleshooting timezone utc 고정 1\n변경 불가. 단 grafana에서 timezone 변경 가능\nhttps://prometheus.io/docs/alerting/latest/configuration/ ↩︎\n","categories":["apps"],"description":"prometheus 구성","excerpt":"prometheus 구성","ref":"/apps/prometheus/","tags":["prometheus","docker"],"title":"prometheus"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/prometheus/","tags":"","title":"prometheus"},{"body":"\nGitHub repository 바로 가기\nautohotkey Shortcuts Shortcuts Remarks Ctrl+Shift+P Pause Ctrl+Shift+R Reload Ctrl+Shift+X Exit Ctrl+Shift++ getPixelColor Ctrl+Shift+A 코드 캡처 (자동) Ctrl+Shift+S 코드 캡처 (수동) Ctrl+Shift+D 마우스 캡처 promocode_helper.properties 코드 배경색/좌표 구성\nCODE_JUDGE_BG_COLOR=0xFFFFFC CODE_JUDGE_X=622 CODE_JUDGE_Y=885 CODE_START_X=619 CODE_START_Y=970 CODE_WIDTH=988 CODE_HEIGHT=78 promocode_helper.ahk 1 #include \u003cGdip_All\u003e #include \u003cUwpOcr\u003e #SingleInstance force #NoEnv #MaxHotkeysPerInterval 99000000 #HotkeyInterval 99000000 #KeyHistory 0 #InstallKeybdHook #InstallMouseHook #UseHook ListLines Off Process, Priority, , A SetTitleMatchMode, 2 SetTitleMatchMode, Fast SetBatchLines, -1 SetKeyDelay, -1, -1, Play SetMouseDelay, -1 SetDefaultMouseSpeed, 0 SetWinDelay, -1 SetControlDelay, -1 SendMode Input CoordMode, Mouse, Client CoordMode, Pixel, Client CoordMode, ToolTip, Screen FileEncoding, UTF-8 ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- global LOG_LEVEL := 3 ;current log level global TRACE := 1 ;log level global DEBUG := 2 ;log level global INFO := 3 ;log level global WARN := 4 ;log level global ERROR := 5 ;log level global SEVERE := 6 ;log level global LOG_FILE := A_ScriptDir \"\\log\\\" SubStr(A_ScriptName, 1, -4) \".log\" ;log file global CAPTURE2TEXT_FILE := A_ScriptDir \"\\Capture2Text\\Capture2Text.exe\" ;capture2text exe file, faster than Capture2Text_CLI.exe global CAPTURE2TEXT_CFG_FILE := A_ScriptDir \"\\Capture2Text\\tessconfigs-main\\configs\\lol_code\" ;capture2text config file global TESSERACT_FILE := A_ProgramFiles \"\\Tesseract-OCR\\tesseract.exe\" ;tesseract exe file global TESSERACT_CFG_FILE := A_ProgramFiles \"\\Tesseract-OCR\\tessdata\\configs\\lol_code\" ;tesseract config file global PROPERTIES_FILE := A_ScriptDir \"\\\" SubStr(A_ScriptName, 1, -4) \".properties\" ;properties file global CODE_JUDGE_BG_COLOR := \"0xFFFFFC\", CODE_JUDGE_X := 622, CODE_JUDGE_Y := 885 global CODE_START_X := 0, CODE_START_Y := 0, CODE_WIDTH := 0, CODE_HEIGHT := 0 ;------------------------------------------------------------------------------- ; hotkeys ; Get code background value with ctrl+shift+` ; Get the code background value and coordinate value with ctrl+shift+d and save it in properties ; Copy code to clipboard with ctrl+shift+a, repeat automatically ; Copy to clipboard manually with ctrl+shift+s ;------------------------------------------------------------------------------- ^+p:: ;ctrl+shift+p { initHotkey(\"Pause\") Pause return } ^+r:: ;ctrl+shift+r { Reload return } ^+x:: ;ctrl+shift+x { ExitApp } ^+`:: ;ctrl+shift+` { initHotkey(\"getPixelColor\") ;getPixelColor(\"\", \"\") getProperties(getTextFile(PROPERTIES_FILE)) getPixelColor(CODE_JUDGE_X, CODE_JUDGE_Y) return } ^+z:: ;ctrl+shift+z { initHotkey(\"test\") test() return } ^+a:: ;ctrl+shift+a { initHotkey(\"setCodeAuto\") color_variation := 16 getProperties(getTextFile(PROPERTIES_FILE)) loop { ;CODE_JUDGE_X, CODE_JUDGE_Y 적용 불가 ;if (isColorFromPixel(CODE_JUDGE_X, CODE_JUDGE_Y, CODE_JUDGE_BG_COLOR, color_variation)) { if (isColorFromPixel(622, 885, \"0xC3B65D\", color_variation)) { Sleep, 50 ;code fade in delay setTextUwpOcr(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT) playBeep(1, 7902, 80) ;SUCCEED return } else { Sleep, 100 } } } ^+s:: ;ctrl+shift+s { initHotkey(\"setCodeManual\") getProperties(getTextFile(PROPERTIES_FILE)) setTextUwpOcr(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT) playBeep(1, 7902, 80) ;SUCCEED return } ^+d:: ;ctrl+shift+d { initHotkey(\"getMouseCursorRect\") getMouseCursorRect(startX, startY, width, height) codeBgColor := getPixelColor(startX, startY) outText := \"CODE_JUDGE_BG_COLOR=\" codeBgColor \"`nCODE_JUDGE_X=\" startX \"`nCODE_JUDGE_Y=\" startY \"`nCODE_START_X=\" startX \"`nCODE_START_Y=\" startY \"`nCODE_WIDTH=\" width \"`nCODE_HEIGHT=\" height deleteTextFile(PROPERTIES_FILE) setTextFile(outText, PROPERTIES_FILE) playBeep(1, 7902, 80) ;SUCCEED return } ;------------------------------------------------------------------------------- ; init ;------------------------------------------------------------------------------- init() ;init init() { runAsAdmin() removeLogFile(8192) } ;------------------------------------------------------------------------------- ; test ;------------------------------------------------------------------------------- test() { ;getPixelColor(683, 978) ;testSpeed1() ;testSpeed2() ;testIsCode() ;initLolClient() ;initLolMarket() ;playBeep(1, 7902, 80) ;SUCCEED ;playBeep(1, 2489, 80) ;FAILED ;clipboard := getTextUwpOcrScreen(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT) } testIsCode() { loop { if (isColorFromPixel(399, 907, \"0xFEFDFB\", 0)) { setLolCodeUwpOcr(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT) return } else { Sleep, 100 } } } testSpeed1() { testStartTime := A_TickCount fileSeq := A_Now imageFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".bmp\" textFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".txt\" setCaptureImageFile(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT, imageFile) lolCode := getTextUwpOcrFile(imageFile) setTextFile(lolCode, textFile) testEndTime := A_TickCount - testStartTime message := \"UwpOcr.ocr() \" Round(testEndTime) \"ms\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } testSpeed2() { testStartTime := A_TickCount fileSeq := A_Now imageFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".bmp\" textFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".txt\" lolCode := getTextUwpOcrScreen(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT) filteredLolCode := filterLolCode(lolCode) setCaptureImageFile(CODE_START_X, CODE_START_Y, CODE_WIDTH, CODE_HEIGHT, imageFile) setTextFile(lolCode, textFile) testEndTime := A_TickCount - testStartTime message := \"UwpOcr.ocr() \" Round(testEndTime) \"ms\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } ;------------------------------------------------------------------------------- ; biz functions ;------------------------------------------------------------------------------- getProperties(outText) { if errorlevel return oProperties := StrSplit(outText, \"`n\") loop, % oProperties.MaxIndex() { varName := StrSplit(oProperties[A_Index], \"=\")[1] varValue := StrSplit(oProperties[A_Index], \"=\")[2] switch (varName) { case \"CODE_JUDGE_BG_COLOR\": CODE_JUDGE_BG_COLOR := varValue case \"CODE_JUDGE_X\": CODE_JUDGE_X := varValue case \"CODE_JUDGE_Y\": CODE_JUDGE_Y := varValue case \"CODE_START_X\": CODE_START_X := varValue case \"CODE_START_Y\": CODE_START_Y := varValue case \"CODE_WIDTH\": CODE_WIDTH := varValue case \"CODE_HEIGHT\": CODE_HEIGHT := varValue default: } } } initLolClient() { if WinExist(\"ahk_exe LeagueClientUx.exe\") { WinMove, League of Legends, , 1273, 287 ;1024x576 WinActivate } else { return } Send, {Click, 401, 177, Left} ;to cursor SendRaw, init ;paste code } initLolMarket() { if WinExist(\"LoL 상점 - Chrome\") { WinMove, LoL 상점 - Chrome, , 996, 78, 1141, 851 ;zoom 300% WinActivate } else { return } Send, {Click, 127, 610, Left} ;to cursor Send, ^{a} SendRaw, init ;paste code } setLolCodeUwpOcr(startX, startY, width, height) { bizStartTime := A_TickCount fileSeq := A_Now imageFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".bmp\" textFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".txt\" resultImageFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \"_result.bmp\" setCaptureImageFile(startX, startY, width, height, imageFile) lolCode := getTextUwpOcrFile(imageFile) filteredLolCode := filterLolCode(lolCode) bizEndTime := A_TickCount - bizStartTime ;setCodeLolMarket(filteredLolCode, bizEndTime) setCodeLolClient(filteredLolCode, bizEndTime) setTextFile(lolCode, textFile) Sleep, 300 setCaptureImageFile(1278, 290, 641, 567, resultImageFile) } setTextUwpOcr(startX, startY, width, height) { bizStartTime := A_TickCount fileSeq := A_Now sourceFile := A_ScriptDir \"\\test\\source_\" fileSeq \".bmp\" imageFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".bmp\" textFile := A_ScriptDir \"\\tmp\\uwpocr_\" fileSeq \".txt\" setCaptureImageFile(startX, startY, width, height, imageFile) capturedText := getTextUwpOcrFile(imageFile) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, capturedText) bizEndTime := A_TickCount - bizStartTime capturedText := filterLolCode(capturedText) clipboard := capturedText setTextFile(capturedText, textFile) setCaptureImageFile(0, 0, A_ScreenWidth, A_ScreenHeight, sourceFile) } filterLolCode(lolCode) { ;Remove whitespace line breaks filteredLolCode := trim(lolCode, \"`n`r`t \") filteredLolCode := StrReplace(filteredLolCode, A_Space) ;Champion name + 4 digit code format ;Converts to 1 when recognized as l among 4-digit numeric codes filteredLolCodeLeft := SubStr(filteredLolCode, 1, StrLen(filteredLolCode) - 4) filteredLolCodeRight := SubStr(filteredLolCode, StrLen(filteredLolCode) - 3, 4) filteredLolCodeRight := StrReplace(filteredLolCodeRight, \"l\", \"1\") filteredLolCode := filteredLolCodeLeft filteredLolCodeRight ;StringUpper, filteredLolCode, filteredLolCode ;filteredLolCode := StrReplace(filteredLolCode, \"(R\", \"KR\") ;message := \"filterLolCode() \" filteredLolCode \" (\" StrLen(filteredLolCode) \")\" ;writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) ;showToolTip(DEBUG, message) return filteredLolCode } setCodeLolClient(code, elapsedTime) { clipboard := code if WinExist(\"ahk_exe LeagueClientUx.exe\") { WinActivate } else { return } Send, {Click, 401, 177, Left} ;to cursor Send, ^{a}^{v} ;paste code Sleep, 40 isValidCode := false ;if (25 == StrLen(code) \u0026\u0026 (InStr(code, \"WW\", true) || InStr(code, \"KR\", true))) { ;global code if (25 == StrLen(code) \u0026\u0026 InStr(code, \"KR\", true)) { isValidCode := true Send, {Click, 614, 177, Left} ;enter code playBeep(1, 7902, 80) ;SUCCEED } else { isValidCode := false playBeep(1, 2489, 80) ;FAILED } message := \"setCodeLolClient() \" (isValidCode ? \"SUCCEED\" : \"FAILED \") \" \" code \" (\" StrLen(code) \") \" Round(elapsedTime) \"ms\" writeLogFile(WARN, A_ThisFunc, A_LineNumber, message) showToolTip(WARN, message) } setCodeLolMarket(code, elapsedTime) { clipboard := code if WinExist(\"LoL 상점 - Chrome\") { WinActivate } else { return } Send, {Click, 127, 610, Left} ;to cursor Send, ^{a}^{v} ;paste code isValidCode := false ;if (25 == StrLen(code) \u0026\u0026 (InStr(code, \"WW\", true) || InStr(code, \"KR\", true))) { ;global code if (25 == StrLen(code) \u0026\u0026 InStr(code, \"KR\", true)) { isValidCode := true Send, {Enter} ;enter code playBeep(1, 7902, 80) ;SUCCEED } else { isValidCode := false playBeep(1, 2489, 80) ;FAILED } message := \"setCodeLolMarket() \" (isValidCode ? \"SUCCEED\" : \"FAILED \") \" \" code \" (\" StrLen(code) \") \" Round(elapsedTime) \"ms\" writeLogFile(WARN, A_ThisFunc, A_LineNumber, message) showToolTip(WARN, message) } ;------------------------------------------------------------------------------- ; screen functions ;------------------------------------------------------------------------------- getTextUwpOcrFile(imageFile) { startTime := A_TickCount outText := ocrFile(imageFile, \"en\") endTime := A_TickCount - startTime message := \"UwpOcr.ocr() \" Round(endTime) \"ms \" outText writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } getTextUwpOcrScreen(startX, startY, width, height) { startTime := A_TickCount hBitmap := HBitmapFromScreen(startX, startY, width, height) pIRandomAccessStream := HBitmapToRandomAccessStream(hBitmap) DllCall(\"DeleteObject\", \"Ptr\", hBitmap) outText := ocrStream(pIRandomAccessStream, \"en\") endTime := A_TickCount - startTime message := \"UwpOcr.ocr() \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } setFileTesseract(imageFile, textFile) { textFileWithoutExt := SubStr(textFile, 1, -4) startTime := A_TickCount RunWait, %TESSERACT_FILE% \"%imageFile%\" \"%textFileWithoutExt%\" --tessdata-dir \"%A_ProgramFiles%\\Tesseract-OCR\\tessdata\" -l eng --psm 4--oem 3 \"%TESSERACT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Tesseract \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } setFileCapture2Text(imageFile, textFile) { startTime := A_TickCount RunWait, %CAPTURE2TEXT_FILE% --image \"%imageFile%\" --output-file \"%textFile%\" --line-breaks --scale-factor 3.5 --tess-config-file \"%CAPTURE2TEXT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Capture2Text \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } getClipboardCapture2Text(startX, startY, width, height) { endX := startX + width endY := startY + height startTime := A_TickCount RunWait, %CAPTURE2TEXT_FILE% --clipboard --screen-rect \"%startX% %startY% %endX% %endY%\" --line-breaks --scale-factor 3.5 --tess-config-file \"%CAPTURE2TEXT_CFG_FILE%\", , Hide endTime := A_TickCount - startTime message := \"RunWait() Capture2Text \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) message := \"getClipboardCapture2Text() \" clipboard \" (\" StrLen(clipboard) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return clipboard } getPixelColor(pixelX, pixelY) { if (pixelX = \"\") || (pixelY = \"\") { MouseGetPos, pixelX, pixelY } PixelGetColor, color, pixelX, pixelY message := \"PixelGetColor() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" pixelX \", \" pixelY \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return color } isColorFromPixel(startX, startY, color, variation) { endX := startX + 1 endY :=startY + 1 PixelSearch, foundX, foundY, startX, startY, endX, endY, color, variation, Fast result := ErrorLevel = 0 ? true : false message := \"PixelSearch() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(WARN, message) if result return true else return false } ;------------------------------------------------------------------------------- ; file functions ;------------------------------------------------------------------------------- getTextFile(textFile) { FileRead, outText, %textFile% message := \"FileRead() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) message := \"getTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } setTextFile(outText, textFile) { FileAppend, %outText%, %textFile% message := \"FileAppend() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) message := \"setTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } deleteTextFile(textFile) { FileDelete, %textFile% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } ;------------------------------------------------------------------------------- ; common functions ;------------------------------------------------------------------------------- runAsAdmin() { message := \"A_IsAdmin \" (A_IsAdmin = 1 ? \"SUCCEED\" : \"FAILED \") writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) if A_IsAdmin return Run *RunAs \"%A_ScriptFullPath%\" ExitApp } writeLogFile(level, functionName, lineNumber, message) { if (LOG_LEVEL \u003e level) return ;write log file levelName := \"\" switch (level) { case TRACE: levelName := \"TRACE\" case DEBUG: levelName := \"DEBUG\" case INFO: levelName := \"INFO \" case WARN: levelName := \"WARN \" case ERROR: levelName := \"ERROR\" default: } FileAppend, % A_YYYY \"-\" A_MM \"-\" A_DD \" \" A_Hour \":\" A_Min \":\" A_Sec \".\" A_MSec \" \" levelName \" \" A_ScriptName \".\" functionName \"() Line \" lineNumber \" \" message \"`n\", %LOG_FILE% } removeLogFile(thresholdSize) { FileGetSize, fileSize, %LOG_FILE%, K message := \"FileGetSize() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" fileSize \"KB \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) if (fileSize \u003c thresholdSize) return FileDelete, %LOG_FILE% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } showToolTip(level, message) { if (LOG_LEVEL \u003e level) return ToolTip, %message%, 5, 5 SetTimer, removeTooltipTimer, -7000 } removeTooltipTimer: { ToolTip return } initHotkey(description) { if GetKeyState(\"Ctrl\") { Send, {Ctrl Up} Sleep, 1 } if GetKeyState(\"Alt\") { Send, {Alt Up} Sleep, 1 } if GetKeyState(\"Shift\") { Send, {Shift Up} Sleep, 1 } if GetKeyState(\"LButton\") { Send, {LButton Up} Sleep, 1 } if GetKeyState(\"RButton\") { Send, {RButton Up} Sleep, 1 } KeyWait, Ctrl KeyWait, Alt KeyWait, Shift Sleep, 20 showToolTip(INFO, A_ScriptName \".\" description) } ;playBeep(1, 7902, 80) ;SUCCEED ;playBeep(1, 2489, 80) ;FAILED playBeep(times, freq, dur) { loop, % times { SoundBeep, freq, dur Sleep, 10 } } ;------------------------------------------------------------------------------- ; library functions ;------------------------------------------------------------------------------- getMouseCursorRect(ByRef startX, ByRef startY, ByRef width, ByRef height) { ;Mask Screen Gui, Color, FFFFFF Gui +LastFound WinSet, Transparent, 50 Gui, -Caption Gui, +AlwaysOnTop Gui, Show, x0 y0 h%A_ScreenHeight% w%A_ScreenWidth%, \"AutoHotkeySnapshotApp\" ;Drag Mouse CoordMode, Mouse, Screen WinGet, hw_frame_m, ID, \"AutoHotkeySnapshotApp\" hdc_frame_m := DllCall( \"GetDC\", \"uint\", hw_frame_m) KeyWait, LButton, D MouseGetPos, scanStartX, scanStartY Loop { Sleep, 10 KeyIsDown := GetKeyState(\"LButton\") if (KeyIsDown = 1) { MouseGetPos, scanX, scanY DllCall( \"gdi32.dll\\Rectangle\", \"uint\", hdc_frame_m, \"int\", 0, \"int\", 0, \"int\", A_ScreenWidth, \"int\", A_ScreenWidth) DllCall( \"gdi32.dll\\Rectangle\", \"uint\", hdc_frame_m, \"int\", scanStartX, \"int\", scanStartY, \"int\", scanX, \"int\", scanY) } else { break } } ;KeyWait, LButton, U MouseGetPos, scanEndX, scanEndY Gui Destroy if (scanStartX \u003c scanEndX) { startX := scanStartX width := scanEndX - scanStartX } else { startX := scanEndX width := scanStartX - scanEndX } if (scanStartY \u003c scanEndY) { startY := scanStartY height := scanEndY - scanStartY } else { startY := scanEndY height := scanStartY - scanEndY } CoordMode, Mouse, Client message := \"getMouseCursorRect() \" startX \", \" startY \", \" width \", \" height writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } setCaptureImageFile(startX, startY, width, height, fileName) { startTime := A_TickCount pToken := Gdip_StartUp() pArg := startX . \"|\" . startY . \"|\" . width . \"|\" . height pBitmap := Gdip_BitmapFromScreen(pArg) Gdip_SaveBitmapToFile(pBitmap, fileName) Gdip_DisposeImage(pBitmap) Gdip_Shutdown(pToken) endTime := A_TickCount - startTime message := \"Gdip_SaveBitmapToFile() \" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) message := \"setCaptureImageFile() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" startX \", \" startY \", \" width \", \" height \", \" fileName writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } Dependencies Libraries Remrks Gdip_All.ahk GDI+ 라이브러리 UwpOcr.ahk UWP (Universal Windows Platform) 라이브러리 https://github.com/dntco43u/promocode_helper/blob/main/promocode_helper.ahk ↩︎\n","categories":["dev"],"description":"화면 코드 클립보드 복사 매크로","excerpt":"화면 코드 클립보드 복사 매크로","ref":"/dev/promocode-helper/","tags":["autohotkey"],"title":"promocode-helper"},{"body":"\nGitHub repository 바로 가기\nautohotkey Shortcuts Shortcuts Remarks Ctrl+Shift+P Pause Ctrl+Shift+R Reload Ctrl+Shift+X Exit Ctrl+Shift+A 파일명 base64 인코딩 Ctrl+Shift+S 파일명 base64 디코딩 rename_helper.properties LOG_LEVEL=INFO Common.ahk 1 #include \u003cBase64\u003e #SingleInstance force #NoEnv #MaxHotkeysPerInterval 99000000 #HotkeyInterval 99000000 #KeyHistory 0 #InstallKeybdHook #InstallMouseHook #UseHook ListLines Off Process, Priority, , A SetTitleMatchMode, 2 SetTitleMatchMode, Fast SetBatchLines, -1 SetKeyDelay, -1, -1, Play SetMouseDelay, -1 SetDefaultMouseSpeed, 0 SetWinDelay, -1 SetControlDelay, -1 SendMode Input CoordMode, Mouse, Client CoordMode, Pixel, Client CoordMode, ToolTip, Screen FileEncoding, UTF-8 ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- global CURRENT_LOG_LEVEL := 0 global LOG_LEVEL_ARRAY := [[\"TRACE\", 1], [\"DEBUG\", 2], [\"INFO\", 3], [\"WARN\", 4], [\"ERROR\", 5], [\"SEVERE\", 6]] global LOG_FILE := A_ScriptDir \"\\log\\\" SubStr(A_ScriptName, 1, -4) \".log\" ;log file global PROPERTIES_FILE := A_ScriptDir \"\\\" SubStr(A_ScriptName, 1, -4) \".properties\" ;properties file ;------------------------------------------------------------------------------- ; init ;------------------------------------------------------------------------------- init() ;init init() { getProperties(PROPERTIES_FILE) ;getProperties runAsAdmin() removeLogFile(8192) } ;------------------------------------------------------------------------------- ; screen functions ;------------------------------------------------------------------------------- getPixelColor(pixelX, pixelY) { if (pixelX = \"\") || (pixelY = \"\") { MouseGetPos, pixelX, pixelY } PixelGetColor, color, pixelX, pixelY message := \"PixelGetColor() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" pixelX \", \" pixelY \" \" color writeLogFile(\"INFO\", A_ThisFunc, A_LineNumber, message) showToolTip(\"INFO\", message) return color } isColorFromPixel(startX, startY, color, variation) { endX := startX + 1 endY :=startY + 1 PixelSearch, foundX, foundY, startX, startY, endX, endY, color, variation, Fast result := ErrorLevel = 0 ? true : false message := \"PixelSearch() \" (result ? \"SUCCEED \" foundX \", \" foundY : \"FAILED \") \" \" color writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) showToolTip(\"WARN\", message) if result return true else return false } ;------------------------------------------------------------------------------- ; file functions ;------------------------------------------------------------------------------- removeFile(file) { FileDelete, %file% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" file writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) } getTextFile(textFile) { FileRead, outText, %textFile% message := \"FileRead() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) message := \"getTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) showToolTip(\"DEBUG\", message) return outText } setTextFile(outText, textFile) { FileAppend, % outText \"`r`n\", %textFile% message := \"FileAppend() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) message := \"setTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) showToolTip(\"DEBUG\", message) } ;------------------------------------------------------------------------------- ; common functions ;------------------------------------------------------------------------------- getProperties(propertiesFile) { FileRead, properties, %propertiesFile% if errorlevel return oProperties := StrSplit(properties, \"`r`n\") loop, % oProperties.MaxIndex() { if (InStr(oProperties[A_Index], \"LOG_LEVEL\")) { logLevelProperties := StrSplit(oProperties[A_Index], \"=\")[2] loop, % LOG_LEVEL_ARRAY.MaxIndex() { if (logLevelProperties = LOG_LEVEL_ARRAY[A_Index][1]) { CURRENT_LOG_LEVEL := LOG_LEVEL_ARRAY[A_Index][2] } } } } } runAsAdmin() { message := \"A_IsAdmin \" (A_IsAdmin = 1 ? \"SUCCEED\" : \"FAILED \") writeLogFile(\"DEBUG\", A_ThisFunc, A_LineNumber, message) showToolTip(\"DEBUG\", message) if A_IsAdmin return Run *RunAs \"%A_ScriptFullPath%\" ExitApp } writeLogFile(levelName, functionName, lineNumber, message) { level := 0 loop, % LOG_LEVEL_ARRAY.MaxIndex() { if (levelName = LOG_LEVEL_ARRAY[A_Index][1]) { level := LOG_LEVEL_ARRAY[A_Index][2] } } if (CURRENT_LOG_LEVEL \u003e level) return ;write log file FileAppend, % A_YYYY \"-\" A_MM \"-\" A_DD \" \" A_Hour \":\" A_Min \":\" A_Sec \".\" A_MSec \" \" levelName \" \" A_ScriptName \".\" functionName \"() Line \" lineNumber \" \" message \"`n\", %LOG_FILE% } removeLogFile(thresholdSize) { FileGetSize, fileSize, %LOG_FILE%, K message := \"FileGetSize() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" fileSize \"KB \" LOG_FILE writeLogFile(\"WARN\", A_ThisFunc, A_LineNumber, message) if (fileSize \u003c thresholdSize) return FileDelete, %LOG_FILE% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" LOG_FILE writeLogFile(\"WARN\", A_ThisFunc, A_LineNumber, message) showToolTip(\"WARN\", message) } showToolTip(levelName, message) { level := 0 loop, % LOG_LEVEL_ARRAY.MaxIndex() { if (levelName = LOG_LEVEL_ARRAY[A_Index][1]) { level := LOG_LEVEL_ARRAY[A_Index][2] } } if (CURRENT_LOG_LEVEL \u003e level) return ToolTip, %message%, 5, 5 SetTimer, removeTooltipTimer, -7000 } removeTooltipTimer: { ToolTip return } initHotkey(description) { if GetKeyState(\"Ctrl\") { Send, {Ctrl Up} Sleep, 1 } if GetKeyState(\"Alt\") { Send, {Alt Up} Sleep, 1 } if GetKeyState(\"Shift\") { Send, {Shift Up} Sleep, 1 } if GetKeyState(\"LButton\") { Send, {LButton Up} Sleep, 1 } if GetKeyState(\"RButton\") { Send, {RButton Up} Sleep, 1 } KeyWait, Ctrl KeyWait, Alt KeyWait, Shift Sleep, 20 showToolTip(\"INFO\", A_ScriptName \".\" description) } ;playBeep(1, 7902, 80) ;SUCCEED ;playBeep(1, 2489, 80) ;FAILED playBeep(times, freq, dur) { loop, % times { SoundBeep, freq, dur Sleep, 10 } } rename_helper.ahk 2 #include \u003cCommon\u003e ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- ;------------------------------------------------------------------------------- ; init ;------------------------------------------------------------------------------- ;------------------------------------------------------------------------------- ; hotkeys ;------------------------------------------------------------------------------- ^+p:: ;ctrl+shift+p { initHotkey(\"Pause\") Pause return } ^+r:: ;ctrl+shift+r { Reload return } ^+x:: ;ctrl+shift+x { ExitApp } ^+`:: ;ctrl+shift+` { initHotkey(\"getPixelColor\") getPixelColor(\"\", \"\") return } ^+z:: ;ctrl+shift+z { initHotkey(\"test\") test() return } ^+1:: ;ctrl+shift+1 { initHotkey(\"testEncodeBase64\") renameEncodeBase64() renameDecodeBase64() return } ^+a:: ;ctrl+shift+a { initHotkey(\"renameEncodeBase64\") renameEncodeBase64() return } ^+s:: ;ctrl+shift+s { initHotkey(\"renameDecodeBase64\") renameDecodeBase64() return } ;------------------------------------------------------------------------------- ; test ;------------------------------------------------------------------------------- test() { message := decodeString(encodeString(\"rename_helper\")) \" -\u003e \" encodeString(\"rename_helper\") writeLogFile(\"WARN\", A_ThisFunc, A_LineNumber, message) } ;------------------------------------------------------------------------------- ; biz functions ;------------------------------------------------------------------------------- renameEncodeBase64() { ;FileSelectFolder, selectedPath, *C:\\Users\\%A_UserName%\\Downloads\\gzmo5ajq FileSelectFolder, selectedPath, *C:\\Users\\%A_UserName%\\Downloads\\1 if ErrorLevel return renameEncodeFile := selectedPath \"\\\" \"renameCrypt.enc\" renameDecodeFile := selectedPath \"\\\" \"renameCrypt.dec\" removeFile(renameEncodeFile) removeFile(renameDecodeFile) rootPath := selectedPath loop Files, %selectedPath%\\*.*, DFR { SplitPath, A_LoopFileFullPath, , outDir, outExt, outNameNoExt loopPath := StrReplace(A_LoopFileFullPath, selectedPath \"\\\") cryptLoopPath := \"\" loopPathAttrib = \"\" oPathString := StrSplit(loopPath, \"\\\") if (InStr(A_LoopFileAttrib, \"D\")) { loopPathAttrib := \"D\" loop, % oPathString.MaxIndex() { cryptLoopPath := cryptLoopPath \"\\\" encodeString(oPathString[A_Index]) } } else { loopPathAttrib := \"F\" loop, % oPathString.MaxIndex() { if (A_Index = oPathString.MaxIndex()) { cryptLoopPath := cryptLoopPath \"\\\" encodeString(outNameNoExt) \".\" outExt } else { cryptLoopPath := cryptLoopPath \"\\\" encodeString(oPathString[A_Index]) } } } cryptLoopPath := SubStr(cryptLoopPath, 2, StrLen(cryptLoopPath)) encodeSource := A_LoopFileFullPath encodeTarget := rootPath \"\\\" cryptLoopPath setTextFile(loopPathAttrib \"█\" encodeSource \"█\" encodeTarget, renameEncodeFile) } if (copySourceFile(renameEncodeFile)) removeSourceFile(renameEncodeFile) removeFile(renameEncodeFile) playBeep(1, 7902, 80) ;SUCCEED } renameDecodeBase64() { FileSelectFolder, selectedPath, *C:\\Users\\%A_UserName%\\Downloads\\gzmo5ajq if ErrorLevel return renameEncodeFile := selectedPath \"\\\" \"renameCrypt.enc\" renameDecodeFile := selectedPath \"\\\" \"renameCrypt.dec\" removeFile(renameEncodeFile) removeFile(renameDecodeFile) rootPath := selectedPath loop Files, %selectedPath%\\*.*, DFR { SplitPath, A_LoopFileFullPath, , outDir, outExt, outNameNoExt loopPath := StrReplace(A_LoopFileFullPath, selectedPath \"\\\") cryptLoopPath := \"\" loopPathAttrib = \"\" oPathString := StrSplit(loopPath, \"\\\") if (InStr(A_LoopFileAttrib, \"D\")) { loopPathAttrib := \"D\" loop, % oPathString.MaxIndex() { cryptLoopPath := cryptLoopPath \"\\\" decodeString(oPathString[A_Index]) } } else { loopPathAttrib := \"F\" loop, % oPathString.MaxIndex() { if (A_Index = oPathString.MaxIndex()) { cryptLoopPath := cryptLoopPath \"\\\" decodeString(outNameNoExt) \".\" outExt } else { cryptLoopPath := cryptLoopPath \"\\\" decodeString(oPathString[A_Index]) } } } cryptLoopPath := SubStr(cryptLoopPath, 2, StrLen(cryptLoopPath)) decodeSource := A_LoopFileFullPath decodeTarget := rootPath \"\\\" cryptLoopPath setTextFile(loopPathAttrib \"█\" decodeSource \"█\" decodeTarget, renameDecodeFile) } if (copySourceFile(renameDecodeFile)) removeSourceFile(renameDecodeFile) removeFile(renameDecodeFile) playBeep(1, 7902, 80) ;SUCCEED } copySourceFile(renameCryptFile) { copyErrorLevel := 0 FileRead, cryptString, %renameCryptFile% if ErrorLevel return false oCryptString := StrSplit(cryptString, \"`r`n\") loop, % oCryptString.MaxIndex() { if (InStr(oCryptString[A_Index], \"█\")) { cryptType := StrSplit(oCryptString[A_Index], \"█\")[1] cryptSource := StrSplit(oCryptString[A_Index], \"█\")[2] cryptTarget := StrSplit(oCryptString[A_Index], \"█\")[3] message := \"\" if (cryptType = \"D\") { FileCreateDir, %cryptTarget% copyErrorLevel := ErrorLevel message := \"FileCreateDir() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" cryptSource \" -\u003e \" cryptTarget } else if (cryptType = \"F\") { FileCopy, %cryptSource%, %cryptTarget%, 1 copyErrorLevel := ErrorLevel message := \"FileCopy() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" cryptSource \" -\u003e \" cryptTarget } writeLogFile(\"INFO\", A_ThisFunc, A_LineNumber, message) showToolTip(\"INFO\", message) if copyErrorLevel { MsgBox, %cryptSource% return false } } } return true } removeSourceFile(renameCryptFile) { FileRead, cryptString, %renameCryptFile% if ErrorLevel return false oCryptString := StrSplit(cryptString, \"`r`n\") loop, % oCryptString.MaxIndex() { if (InStr(oCryptString[A_Index], \"█\")) { cryptType := StrSplit(oCryptString[A_Index], \"█\")[1] cryptSource := StrSplit(oCryptString[A_Index], \"█\")[2] message := \"\" if (cryptType = \"D\") { FileRemoveDir , %cryptSource%, 1 message := \"FileRemoveDir() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" cryptSource } else if (cryptType = \"F\") { FileDelete, %cryptSource% message := \"FileDelete() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" cryptSource } writeLogFile(\"INFO\", A_ThisFunc, A_LineNumber, message) showToolTip(\"INFO\", message) } } } ;XXX: Remove CRLF and use CRYPT_STRING_HEXRAW Crypt / Case of Base64, file name contains special characters that cannot be used encodeString(str, formatName := \"CRYPT_STRING_HEXRAW\", encoding := \"UTF-8\", NOCRLF := true) { chars := StrPut(str, encoding) - 1 VarSetCapacity(buff, size := chars \u003c\u003c (encoding = \"utf-16\" || encoding = \"cp1200\"), 0) StrPut(str, \u0026buff, chars, encoding) return cryptBinaryToString(\u0026buff, size, formatName, NOCRLF) } decodeString(encodedStr, formatName := \"CRYPT_STRING_HEXRAW\", encoding := \"UTF-8\") { size := cryptStringToBinary(encodedStr, data, formatName) return StrGet(\u0026data, size, encoding) } cryptBinaryToString(pData, size, formatName := \"CRYPT_STRING_HEXRAW\", NOCRLF := true) { static formats := { CRYPT_STRING_BASE64: 0x1, CRYPT_STRING_HEX: 0x4, CRYPT_STRING_HEXRAW: 0xC }, CRYPT_STRING_NOCRLF := 0x40000000 fmt := formats[formatName] | (NOCRLF ? CRYPT_STRING_NOCRLF : 0) if !DllCall(\"Crypt32\\CryptBinaryToString\", \"Ptr\", pData, \"UInt\", size, \"UInt\", fmt, \"Ptr\", 0, \"UIntP\", chars) throw \"CryptBinaryToString failed. LastError: \" . A_LastError VarSetCapacity(outData, chars \u003c\u003c !!A_IsUnicode) DllCall(\"Crypt32\\CryptBinaryToString\", \"Ptr\", pData, \"UInt\", size, \"UInt\", fmt, \"Str\", outData, \"UIntP\", chars) return outData } cryptStringToBinary(string, ByRef outData, formatName := \"CRYPT_STRING_HEXRAW\") { static formats := { CRYPT_STRING_BASE64: 0x1, CRYPT_STRING_HEX: 0x4, CRYPT_STRING_HEXRAW: 0xC } fmt := formats[formatName] chars := StrLen(string) if !DllCall(\"Crypt32\\CryptStringToBinary\", \"Ptr\", \u0026string, \"UInt\", chars, \"UInt\", fmt, \"Ptr\", 0, \"UIntP\", bytes, \"UIntP\", 0, \"UIntP\", 0) throw \"CryptStringToBinary failed. LastError: \" . A_LastError VarSetCapacity(outData, bytes) DllCall(\"Crypt32\\CryptStringToBinary\", \"Ptr\", \u0026string, \"UInt\", chars, \"UInt\", fmt, \"Str\", outData, \"UIntP\", bytes, \"UIntP\", 0, \"UIntP\", 0) return bytes } Dependencies Libraries Remrks Base64.ahk base64 라이브러리 https://github.com/dntco43u/rename_helper/blob/main/lib/Common.ahk ↩︎\nhttps://github.com/dntco43u/rename_helper/blob/main/rename_helper.ahk ↩︎\n","categories":["dev"],"description":"파일명 base64 인코딩/디코딩","excerpt":"파일명 base64 인코딩/디코딩","ref":"/dev/rename-helper/","tags":["autohotkey"],"title":"rename-helper"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/rest-api/","tags":"","title":"rest-api"},{"body":"\ngraph LR subgraph gvp6nx1a A1[python] --- B B[selenium] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 .env vi /opt/python/.env WEBDRIVER_URL=http://selenium:4444/wd/hub docker-compose.yml vi /opt/selenium/docker-compose.yml services: selenium: image: seleniarm/standalone-chromium:latest container_name: selenium networks: - dev ports: - 4444/tcp - 5900/tcp - 7900/tcp user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/selenium/config/passwd:/home/seluser/.vnc/passwd:ro - /home/dev/downloads/selenium:/home/seluser/files:rw privileged: true shm_size: 2gb restart: unless-stopped networks: dev: external: true passwd docker exec -it selenium x11vnc -storepasswd P*************************************************************** /home/seluser/.vnc/passwd proxy 구성 vi /opt/nginx/config/sites-available/selenium.conf ... location / { if ($allowed_country = no) { return 403; } include /etc/nginx/conf.d/include/proxy.conf; proxy_pass http://selenium:7900; proxy_buffering off; proxy_request_buffering off; } ... ","categories":["apps"],"description":"selenium 구성","excerpt":"selenium 구성","ref":"/apps/selenium/","tags":["selenium","docker"],"title":"selenium"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/selenium/","tags":"","title":"selenium"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/sptingboot/","tags":"","title":"sptingboot"},{"body":"\nGitHub repository 바로 가기\nthehell2 구성 config.ini set screenwidth 1280 set screenheight 720 set fullscreen on ... thehell2 Shortcuts Shortcuts Skills F1 플레임 링 F2 라이트닝 링 F3 파이어 월 F4 라이트닝 월 F5 마나 실드 F6 리플렉트 F7 힐링 F8 퓨리 (preset 용) Q 프리징 볼 W 파이어 블라스트 E 볼 라이트닝 R 홀리 볼트 T 플래시 Y 아케인 스타 A 포스 웨이브 S 엘리멘탈 D 텔레키네시스 F 텔레포트 G 골렘 H 골렘 (preset 용) Z 프로스트 노바 X 파이어 노바 C 라이트닝 노바 V 홀리 노바 B 아케인 노바 autohotkey ahk Shortcuts Shortcuts Remarks Configuration H preset1로 아이템 스왑 후 골렘 시전 이후 원복 config.json F8 preset2로 아이템 스왑 후 퓨리 시전 이후 원복 config.json F9 아이템 스왑 preset1 토글 config.json F10 아이템 스왑 preset2 토글 config.json F11 아이템 스왑 preset3 토글 config.json F12 아이템 스왑 preset4 토글 config.json Alt+Q cain 좌표로 이동 후 Identify all - Alt+W griswold 좌표로 이동 후 Repair all - Alt+E gillian 좌표로 이동 - Alt+R wirt 좌표로 이동 - Alt+T adria 좌표로 이동 후 Recharge all - Alt+Y pepin 좌표로 이동 - Alt+A crypt 좌표로 이동 - Alt+S abyss 좌표로 이동 - Alt+D hell 좌표로 이동 - Alt+F cave 좌표로 이동 - Alt+G catacomb 좌표로 이동 - Alt+H church 좌표로 이동 - Alt+X portal 좌표로 이동 - ` 아이템 정리 config.json Alt+V 포션 8개 구입 - Alt+B 그리스올드 오토갬블 config.json Ctrl+Shift+1 게임 새로 시작 config.json Ctrl+Shift+2 게임 재시작 config.json Ctrl+Shift+8 Save file 백업 - Ctrl+Shift+0 config.json 생성/초기화 - Ctrl+Shift+P 프로그램 멈춤 - Ctrl+Shift+R 프로그램 재시작 config.json Ctrl+Shift+X 프로그램 종료 - config.json 1 Type config.json objects array Remakrs - common.theHell2Path - app 폴더 Item moveItemDrop [“gold”], [“relict”], [“repair”], [“potion”, “healing”] 골드, 모든 렐릭, 리페어 오일 x, 힐링 포션, 풀 힐링 포션을 버림 Item moveItemBelt [“potion”, “mana”], [“holy”, “water”] 마나 포션 풀 마나 포션, 홀리 워터, 풀 홀리워터를 벨트에 채움 Gamble memory.buyItem.partDescription [\"+24 to magic\"] (all items) of wisdom Gamble memory.buyItem.partDescription [\"% to mana regeneration\", “+24 to magic”] replenishing (all items) of wisdom Gamble memory.buyItem.partDescription [“amulet”, “replenishing”, “wisdom”] replenishing amulet of wisdom Gamble memory.buyItem.partDescription [“amulet”, “% to mana regeneration”, “+24 to magic”] replenishing amulet of wisdom Potion memory.heal.enable - 1: 자동 회복 활성화 Potion memory.heal.lifeRatio - life 회복 비율 (%) Potion memory.heal.manaRatio - mana 회복 비율 (%) Potion memory.heal.lifeShortcut - life 물약 바로가기 Potion memory.heal.manaShortcut - mana 물약 바로가기 Potion memory.heal.term - 생명력 및 마나 확인 빈도 (ms 단위) Preset preset.enable - 0: 꺼짐 (기본값), 1: 켜짐 Preset preset.activeSlot - 0: 꺼짐 (기본값), 1,2,3인 경우 해당 슬롯으로 교체 Preset preset.order - 교체 순서 (변경 가능) Preset preset.position - 교체할 아이템의 인벤토리 위치 재고 목록의 왼쪽 상단 = [1, 1] / 오른쪽 하단 = [10, 7] { \"common\": { \"centerCoordinate\": [ 640, 330 ], \"difficulty\": 3, \"entrancePosition\": [ [ 57, 40 ], [ 25, 30 ], [ 49, 21 ], [ 17, 69 ], [ 41, 80 ], [ 80, 62 ], [ 37, 25 ] ], \"inventoryTopLeftCoordinate\": [ 832, 295 ], \"menuButtonCoordinate\": [ 355, 703 ], \"merchantButtonCoordinate\": [ 220, 490 ], \"merchantPosition\": [ [ 62, 71 ], [ 62, 63 ], [ 55, 44 ], [ 56, 58 ], [ 44, 68 ], [ 55, 79 ] ], \"merchnatTopLeftCoordinate\": [ 188, 105 ], \"mouseUpCorrectionSize\": 14, \"screenSize\": [ 1280, 720 ], \"theHell2Path\": \"c:\\\\GOG Games\\\\TH2\\\\\", \"theHell2Version\": \"1.0780\", \"winKey\": 1 }, \"equipment\": [ { \"coordinate\": [ 844, 145 ], \"itemType\": \"rightHand\" }, { \"coordinate\": [ 1071, 145 ], \"itemType\": \" leftHand\" }, { \"coordinate\": [ 960, 90 ], \"itemType\": \" head\" }, { \"coordinate\": [ 960, 176 ], \"itemType\": \" cloth\" }, { \"coordinate\": [ 960, 240 ], \"itemType\": \" belt\" }, { \"coordinate\": [ 844, 233 ], \"itemType\": \" gloves\" }, { \"coordinate\": [ 1073, 233 ], \"itemType\": \" shoes\" }, { \"coordinate\": [ 1020, 105 ], \"itemType\": \" amulet\" }, { \"coordinate\": [ 903, 220 ], \"itemType\": \" rightRing\" }, { \"coordinate\": [ 1017, 220 ], \"itemType\": \" leftRing\" } ], \"inventory\": [ { \"coordinate\": [ 832, 295 ], \"position\": [ 1, 1 ] }, { \"coordinate\": [ 861, 295 ], \"position\": [ 2, 1 ] }, { \"coordinate\": [ 890, 295 ], \"position\": [ 3, 1 ] }, { \"coordinate\": [ 919, 295 ], \"position\": [ 4, 1 ] }, { \"coordinate\": [ 948, 295 ], \"position\": [ 5, 1 ] }, { \"coordinate\": [ 977, 295 ], \"position\": [ 6, 1 ] }, { \"coordinate\": [ 1006, 295 ], \"position\": [ 7, 1 ] }, { \"coordinate\": [ 1035, 295 ], \"position\": [ 8, 1 ] }, { \"coordinate\": [ 1064, 295 ], \"position\": [ 9, 1 ] }, { \"coordinate\": [ 1093, 295 ], \"position\": [ 10, 1 ] }, { \"coordinate\": [ 832, 324 ], \"position\": [ 1, 2 ] }, { \"coordinate\": [ 861, 324 ], \"position\": [ 2, 2 ] }, { \"coordinate\": [ 890, 324 ], \"position\": [ 3, 2 ] }, { \"coordinate\": [ 919, 324 ], \"position\": [ 4, 2 ] }, { \"coordinate\": [ 948, 324 ], \"position\": [ 5, 2 ] }, { \"coordinate\": [ 977, 324 ], \"position\": [ 6, 2 ] }, { \"coordinate\": [ 1006, 324 ], \"position\": [ 7, 2 ] }, { \"coordinate\": [ 1035, 324 ], \"position\": [ 8, 2 ] }, { \"coordinate\": [ 1064, 324 ], \"position\": [ 9, 2 ] }, { \"coordinate\": [ 1093, 324 ], \"position\": [ 10, 2 ] }, { \"coordinate\": [ 832, 353 ], \"position\": [ 1, 3 ] }, { \"coordinate\": [ 861, 353 ], \"position\": [ 2, 3 ] }, { \"coordinate\": [ 890, 353 ], \"position\": [ 3, 3 ] }, { \"coordinate\": [ 919, 353 ], \"position\": [ 4, 3 ] }, { \"coordinate\": [ 948, 353 ], \"position\": [ 5, 3 ] }, { \"coordinate\": [ 977, 353 ], \"position\": [ 6, 3 ] }, { \"coordinate\": [ 1006, 353 ], \"position\": [ 7, 3 ] }, { \"coordinate\": [ 1035, 353 ], \"position\": [ 8, 3 ] }, { \"coordinate\": [ 1064, 353 ], \"position\": [ 9, 3 ] }, { \"coordinate\": [ 1093, 353 ], \"position\": [ 10, 3 ] }, { \"coordinate\": [ 832, 382 ], \"position\": [ 1, 4 ] }, { \"coordinate\": [ 861, 382 ], \"position\": [ 2, 4 ] }, { \"coordinate\": [ 890, 382 ], \"position\": [ 3, 4 ] }, { \"coordinate\": [ 919, 382 ], \"position\": [ 4, 4 ] }, { \"coordinate\": [ 948, 382 ], \"position\": [ 5, 4 ] }, { \"coordinate\": [ 977, 382 ], \"position\": [ 6, 4 ] }, { \"coordinate\": [ 1006, 382 ], \"position\": [ 7, 4 ] }, { \"coordinate\": [ 1035, 382 ], \"position\": [ 8, 4 ] }, { \"coordinate\": [ 1064, 382 ], \"position\": [ 9, 4 ] }, { \"coordinate\": [ 1093, 382 ], \"position\": [ 10, 4 ] }, { \"coordinate\": [ 832, 411 ], \"position\": [ 1, 5 ] }, { \"coordinate\": [ 861, 411 ], \"position\": [ 2, 5 ] }, { \"coordinate\": [ 890, 411 ], \"position\": [ 3, 5 ] }, { \"coordinate\": [ 919, 411 ], \"position\": [ 4, 5 ] }, { \"coordinate\": [ 948, 411 ], \"position\": [ 5, 5 ] }, { \"coordinate\": [ 977, 411 ], \"position\": [ 6, 5 ] }, { \"coordinate\": [ 1006, 411 ], \"position\": [ 7, 5 ] }, { \"coordinate\": [ 1035, 411 ], \"position\": [ 8, 5 ] }, { \"coordinate\": [ 1064, 411 ], \"position\": [ 9, 5 ] }, { \"coordinate\": [ 1093, 411 ], \"position\": [ 10, 5 ] }, { \"coordinate\": [ 832, 440 ], \"position\": [ 1, 6 ] }, { \"coordinate\": [ 861, 440 ], \"position\": [ 2, 6 ] }, { \"coordinate\": [ 890, 440 ], \"position\": [ 3, 6 ] }, { \"coordinate\": [ 919, 440 ], \"position\": [ 4, 6 ] }, { \"coordinate\": [ 948, 440 ], \"position\": [ 5, 6 ] }, { \"coordinate\": [ 977, 440 ], \"position\": [ 6, 6 ] }, { \"coordinate\": [ 1006, 440 ], \"position\": [ 7, 6 ] }, { \"coordinate\": [ 1035, 440 ], \"position\": [ 8, 6 ] }, { \"coordinate\": [ 1064, 440 ], \"position\": [ 9, 6 ] }, { \"coordinate\": [ 1093, 440 ], \"position\": [ 10, 6 ] }, { \"coordinate\": [ 832, 469 ], \"position\": [ 1, 7 ] }, { \"coordinate\": [ 861, 469 ], \"position\": [ 2, 7 ] }, { \"coordinate\": [ 890, 469 ], \"position\": [ 3, 7 ] }, { \"coordinate\": [ 919, 469 ], \"position\": [ 4, 7 ] }, { \"coordinate\": [ 948, 469 ], \"position\": [ 5, 7 ] }, { \"coordinate\": [ 977, 469 ], \"position\": [ 6, 7 ] }, { \"coordinate\": [ 1006, 469 ], \"position\": [ 7, 7 ] }, { \"coordinate\": [ 1035, 469 ], \"position\": [ 8, 7 ] }, { \"coordinate\": [ 1064, 469 ], \"position\": [ 9, 7 ] }, { \"coordinate\": [ 1093, 469 ], \"position\": [ 10, 7 ] } ], \"memory\": { \"buyItem\": { \"address\": [ \"0x00E1B318\" ], \"offset\": [ \"0x00\", \"0x0108\", \"0x0210\", \"0x0318\", \"0x0420\", \"0x0528\", \"0x0630\", \"0x0738\", \"0x0840\", \"0x0948\" ], \"partDescription\": [ [ \"% to mana regeneration\", \"+24 to magic\" ] ] }, \"heal\": { \"address\": [ \"0x0090A3D4\" ], \"enable\": 1, \"lifeRatio\": 0, \"lifeShortcut\": \"\", \"manaRatio\": 20, \"manaShortcut\": \"potion\", \"offset\": [ \"0x0198\", \"0x019C\", \"0x01AC\", \"0x01B0\" ], \"term\": 1000 }, \"map\": { \"address\": [ \"0x0090A3D4\" ], \"offset\": [ \"0x38\", \"0x3C\" ] } }, \"merchant\": [ { \"coordinate\": [ 188, 105 ], \"position\": [ 1, 1 ] }, { \"coordinate\": [ 217, 105 ], \"position\": [ 2, 1 ] }, { \"coordinate\": [ 246, 105 ], \"position\": [ 3, 1 ] }, { \"coordinate\": [ 275, 105 ], \"position\": [ 4, 1 ] }, { \"coordinate\": [ 304, 105 ], \"position\": [ 5, 1 ] }, { \"coordinate\": [ 333, 105 ], \"position\": [ 6, 1 ] }, { \"coordinate\": [ 362, 105 ], \"position\": [ 7, 1 ] }, { \"coordinate\": [ 391, 105 ], \"position\": [ 8, 1 ] }, { \"coordinate\": [ 420, 105 ], \"position\": [ 9, 1 ] }, { \"coordinate\": [ 449, 105 ], \"position\": [ 10, 1 ] }, { \"coordinate\": [ 188, 134 ], \"position\": [ 1, 2 ] }, { \"coordinate\": [ 217, 134 ], \"position\": [ 2, 2 ] }, { \"coordinate\": [ 246, 134 ], \"position\": [ 3, 2 ] }, { \"coordinate\": [ 275, 134 ], \"position\": [ 4, 2 ] }, { \"coordinate\": [ 304, 134 ], \"position\": [ 5, 2 ] }, { \"coordinate\": [ 333, 134 ], \"position\": [ 6, 2 ] }, { \"coordinate\": [ 362, 134 ], \"position\": [ 7, 2 ] }, { \"coordinate\": [ 391, 134 ], \"position\": [ 8, 2 ] }, { \"coordinate\": [ 420, 134 ], \"position\": [ 9, 2 ] }, { \"coordinate\": [ 449, 134 ], \"position\": [ 10, 2 ] }, { \"coordinate\": [ 188, 163 ], \"position\": [ 1, 3 ] }, { \"coordinate\": [ 217, 163 ], \"position\": [ 2, 3 ] }, { \"coordinate\": [ 246, 163 ], \"position\": [ 3, 3 ] }, { \"coordinate\": [ 275, 163 ], \"position\": [ 4, 3 ] }, { \"coordinate\": [ 304, 163 ], \"position\": [ 5, 3 ] }, { \"coordinate\": [ 333, 163 ], \"position\": [ 6, 3 ] }, { \"coordinate\": [ 362, 163 ], \"position\": [ 7, 3 ] }, { \"coordinate\": [ 391, 163 ], \"position\": [ 8, 3 ] }, { \"coordinate\": [ 420, 163 ], \"position\": [ 9, 3 ] }, { \"coordinate\": [ 449, 163 ], \"position\": [ 10, 3 ] }, { \"coordinate\": [ 188, 192 ], \"position\": [ 1, 4 ] }, { \"coordinate\": [ 217, 192 ], \"position\": [ 2, 4 ] }, { \"coordinate\": [ 246, 192 ], \"position\": [ 3, 4 ] }, { \"coordinate\": [ 275, 192 ], \"position\": [ 4, 4 ] }, { \"coordinate\": [ 304, 192 ], \"position\": [ 5, 4 ] }, { \"coordinate\": [ 333, 192 ], \"position\": [ 6, 4 ] }, { \"coordinate\": [ 362, 192 ], \"position\": [ 7, 4 ] }, { \"coordinate\": [ 391, 192 ], \"position\": [ 8, 4 ] }, { \"coordinate\": [ 420, 192 ], \"position\": [ 9, 4 ] }, { \"coordinate\": [ 449, 192 ], \"position\": [ 10, 4 ] }, { \"coordinate\": [ 188, 221 ], \"position\": [ 1, 5 ] }, { \"coordinate\": [ 217, 221 ], \"position\": [ 2, 5 ] }, { \"coordinate\": [ 246, 221 ], \"position\": [ 3, 5 ] }, { \"coordinate\": [ 275, 221 ], \"position\": [ 4, 5 ] }, { \"coordinate\": [ 304, 221 ], \"position\": [ 5, 5 ] }, { \"coordinate\": [ 333, 221 ], \"position\": [ 6, 5 ] }, { \"coordinate\": [ 362, 221 ], \"position\": [ 7, 5 ] }, { \"coordinate\": [ 391, 221 ], \"position\": [ 8, 5 ] }, { \"coordinate\": [ 420, 221 ], \"position\": [ 9, 5 ] }, { \"coordinate\": [ 449, 221 ], \"position\": [ 10, 5 ] }, { \"coordinate\": [ 188, 250 ], \"position\": [ 1, 6 ] }, { \"coordinate\": [ 217, 250 ], \"position\": [ 2, 6 ] }, { \"coordinate\": [ 246, 250 ], \"position\": [ 3, 6 ] }, { \"coordinate\": [ 275, 250 ], \"position\": [ 4, 6 ] }, { \"coordinate\": [ 304, 250 ], \"position\": [ 5, 6 ] }, { \"coordinate\": [ 333, 250 ], \"position\": [ 6, 6 ] }, { \"coordinate\": [ 362, 250 ], \"position\": [ 7, 6 ] }, { \"coordinate\": [ 391, 250 ], \"position\": [ 8, 6 ] }, { \"coordinate\": [ 420, 250 ], \"position\": [ 9, 6 ] }, { \"coordinate\": [ 449, 250 ], \"position\": [ 10, 6 ] }, { \"coordinate\": [ 188, 279 ], \"position\": [ 1, 7 ] }, { \"coordinate\": [ 217, 279 ], \"position\": [ 2, 7 ] }, { \"coordinate\": [ 246, 279 ], \"position\": [ 3, 7 ] }, { \"coordinate\": [ 275, 279 ], \"position\": [ 4, 7 ] }, { \"coordinate\": [ 304, 279 ], \"position\": [ 5, 7 ] }, { \"coordinate\": [ 333, 279 ], \"position\": [ 6, 7 ] }, { \"coordinate\": [ 362, 279 ], \"position\": [ 7, 7 ] }, { \"coordinate\": [ 391, 279 ], \"position\": [ 8, 7 ] }, { \"coordinate\": [ 420, 279 ], \"position\": [ 9, 7 ] }, { \"coordinate\": [ 449, 279 ], \"position\": [ 10, 7 ] }, { \"coordinate\": [ 188, 308 ], \"position\": [ 1, 8 ] }, { \"coordinate\": [ 217, 308 ], \"position\": [ 2, 8 ] }, { \"coordinate\": [ 246, 308 ], \"position\": [ 3, 8 ] }, { \"coordinate\": [ 275, 308 ], \"position\": [ 4, 8 ] }, { \"coordinate\": [ 304, 308 ], \"position\": [ 5, 8 ] }, { \"coordinate\": [ 333, 308 ], \"position\": [ 6, 8 ] }, { \"coordinate\": [ 362, 308 ], \"position\": [ 7, 8 ] }, { \"coordinate\": [ 391, 308 ], \"position\": [ 8, 8 ] }, { \"coordinate\": [ 420, 308 ], \"position\": [ 9, 8 ] }, { \"coordinate\": [ 449, 308 ], \"position\": [ 10, 8 ] }, { \"coordinate\": [ 188, 337 ], \"position\": [ 1, 9 ] }, { \"coordinate\": [ 217, 337 ], \"position\": [ 2, 9 ] }, { \"coordinate\": [ 246, 337 ], \"position\": [ 3, 9 ] }, { \"coordinate\": [ 275, 337 ], \"position\": [ 4, 9 ] }, { \"coordinate\": [ 304, 337 ], \"position\": [ 5, 9 ] }, { \"coordinate\": [ 333, 337 ], \"position\": [ 6, 9 ] }, { \"coordinate\": [ 362, 337 ], \"position\": [ 7, 9 ] }, { \"coordinate\": [ 391, 337 ], \"position\": [ 8, 9 ] }, { \"coordinate\": [ 420, 337 ], \"position\": [ 9, 9 ] }, { \"coordinate\": [ 449, 337 ], \"position\": [ 10, 9 ] }, { \"coordinate\": [ 188, 366 ], \"position\": [ 1, 10 ] }, { \"coordinate\": [ 217, 366 ], \"position\": [ 2, 10 ] }, { \"coordinate\": [ 246, 366 ], \"position\": [ 3, 10 ] }, { \"coordinate\": [ 275, 366 ], \"position\": [ 4, 10 ] }, { \"coordinate\": [ 304, 366 ], \"position\": [ 5, 10 ] }, { \"coordinate\": [ 333, 366 ], \"position\": [ 6, 10 ] }, { \"coordinate\": [ 362, 366 ], \"position\": [ 7, 10 ] }, { \"coordinate\": [ 391, 366 ], \"position\": [ 8, 10 ] }, { \"coordinate\": [ 420, 366 ], \"position\": [ 9, 10 ] }, { \"coordinate\": [ 449, 366 ], \"position\": [ 10, 10 ] }, { \"coordinate\": [ 188, 395 ], \"position\": [ 1, 11 ] }, { \"coordinate\": [ 217, 395 ], \"position\": [ 2, 11 ] }, { \"coordinate\": [ 246, 395 ], \"position\": [ 3, 11 ] }, { \"coordinate\": [ 275, 395 ], \"position\": [ 4, 11 ] }, { \"coordinate\": [ 304, 395 ], \"position\": [ 5, 11 ] }, { \"coordinate\": [ 333, 395 ], \"position\": [ 6, 11 ] }, { \"coordinate\": [ 362, 395 ], \"position\": [ 7, 11 ] }, { \"coordinate\": [ 391, 395 ], \"position\": [ 8, 11 ] }, { \"coordinate\": [ 420, 395 ], \"position\": [ 9, 11 ] }, { \"coordinate\": [ 449, 395 ], \"position\": [ 10, 11 ] }, { \"coordinate\": [ 188, 424 ], \"position\": [ 1, 12 ] }, { \"coordinate\": [ 217, 424 ], \"position\": [ 2, 12 ] }, { \"coordinate\": [ 246, 424 ], \"position\": [ 3, 12 ] }, { \"coordinate\": [ 275, 424 ], \"position\": [ 4, 12 ] }, { \"coordinate\": [ 304, 424 ], \"position\": [ 5, 12 ] }, { \"coordinate\": [ 333, 424 ], \"position\": [ 6, 12 ] }, { \"coordinate\": [ 362, 424 ], \"position\": [ 7, 12 ] }, { \"coordinate\": [ 391, 424 ], \"position\": [ 8, 12 ] }, { \"coordinate\": [ 420, 424 ], \"position\": [ 9, 12 ] }, { \"coordinate\": [ 449, 424 ], \"position\": [ 10, 12 ] } ], \"moveItem\": { \"moveItemBelt\": [ [ \"potion\", \"mana\" ], [ \"holy\", \"water\" ] ], \"moveItemDrop\": [ [ \"gold\" ], [ \"relict\" ], [ \"repair\" ], [ \"potion\", \"healing\" ] ] }, \"preset\": [ [ { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 2 ], \"itemType\": \"rightHand\", \"order\": 1, \"position\": [ 6, 6 ], \"remarks\": \"weapon name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" leftHand\", \"order\": 2, \"position\": [ 7, 1 ], \"remarks\": \" orb/shield name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" head\", \"order\": 3, \"position\": [ 9, 1 ], \"remarks\": \" helm name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 2, 3 ], \"itemType\": \" cloth\", \"order\": 4, \"position\": [ 9, 3 ], \"remarks\": \"armor name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 2, 1 ], \"itemType\": \" belt\", \"order\": 5, \"position\": [ 9, 6 ], \"remarks\": \" belt name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" gloves\", \"order\": 6, \"position\": [ 7, 3 ], \"remarks\": \" gloves name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" shoes\", \"order\": 7, \"position\": [ 7, 5 ], \"remarks\": \" shoes name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" amulet\", \"order\": 8, \"position\": [ 10, 7 ], \"remarks\": \" amulet name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" rightRing\", \"order\": 9, \"position\": [ 8, 7 ], \"remarks\": \" right ring name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" leftRing\", \"order\": 10, \"position\": [ 9, 7 ], \"remarks\": \" left ring name\" } ], [ { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 2 ], \"itemType\": \"rightHand\", \"order\": 1, \"position\": [ 6, 6 ], \"remarks\": \"weapon name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" leftHand\", \"order\": 2, \"position\": [ 7, 1 ], \"remarks\": \" orb/shield name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" head\", \"order\": 3, \"position\": [ 9, 1 ], \"remarks\": \" helm name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 3 ], \"itemType\": \" cloth\", \"order\": 4, \"position\": [ 9, 3 ], \"remarks\": \"armor name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 1 ], \"itemType\": \" belt\", \"order\": 5, \"position\": [ 9, 6 ], \"remarks\": \" belt name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" gloves\", \"order\": 6, \"position\": [ 7, 3 ], \"remarks\": \" gloves name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" shoes\", \"order\": 7, \"position\": [ 7, 5 ], \"remarks\": \" shoes name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" amulet\", \"order\": 8, \"position\": [ 8, 6 ], \"remarks\": \" amulet name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" rightRing\", \"order\": 9, \"position\": [ 7, 7 ], \"remarks\": \" right ring name\" }, { \"activeSlot\": 0, \"enable\": 1, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" leftRing\", \"order\": 10, \"position\": [ 8, 7 ], \"remarks\": \" left ring name\" } ], [ { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 2 ], \"itemType\": \"rightHand\", \"order\": 1, \"position\": [ 6, 6 ], \"remarks\": \"weapon name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" leftHand\", \"order\": 2, \"position\": [ 7, 1 ], \"remarks\": \" orb/shield name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" head\", \"order\": 3, \"position\": [ 9, 1 ], \"remarks\": \" helm name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 3 ], \"itemType\": \" cloth\", \"order\": 4, \"position\": [ 9, 3 ], \"remarks\": \"armor name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 1 ], \"itemType\": \" belt\", \"order\": 5, \"position\": [ 9, 6 ], \"remarks\": \" belt name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" gloves\", \"order\": 6, \"position\": [ 7, 3 ], \"remarks\": \" gloves name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" shoes\", \"order\": 7, \"position\": [ 7, 5 ], \"remarks\": \" shoes name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" amulet\", \"order\": 8, \"position\": [ 10, 7 ], \"remarks\": \" amulet name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" rightRing\", \"order\": 9, \"position\": [ 8, 7 ], \"remarks\": \" right ring name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" leftRing\", \"order\": 10, \"position\": [ 9, 7 ], \"remarks\": \" left ring name\" } ], [ { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 2 ], \"itemType\": \"rightHand\", \"order\": 1, \"position\": [ 6, 6 ], \"remarks\": \"weapon name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" leftHand\", \"order\": 2, \"position\": [ 7, 1 ], \"remarks\": \" orb/shield name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" head\", \"order\": 3, \"position\": [ 9, 1 ], \"remarks\": \" helm name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 3 ], \"itemType\": \" cloth\", \"order\": 4, \"position\": [ 9, 3 ], \"remarks\": \"armor name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 1 ], \"itemType\": \" belt\", \"order\": 5, \"position\": [ 9, 6 ], \"remarks\": \" belt name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" gloves\", \"order\": 6, \"position\": [ 7, 3 ], \"remarks\": \" gloves name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 2, 2 ], \"itemType\": \" shoes\", \"order\": 7, \"position\": [ 7, 5 ], \"remarks\": \" shoes name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" amulet\", \"order\": 8, \"position\": [ 10, 7 ], \"remarks\": \" amulet name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" rightRing\", \"order\": 9, \"position\": [ 8, 7 ], \"remarks\": \" right ring name\" }, { \"activeSlot\": 0, \"enable\": 0, \"itemSlotSize\": [ 1, 1 ], \"itemType\": \" leftRing\", \"order\": 10, \"position\": [ 9, 7 ], \"remarks\": \" left ring name\" } ] ], \"slot\": [ { \"activeSlot\": 1, \"coordinate\": [ 825, 80 ] }, { \"activeSlot\": 2, \"coordinate\": [ 845, 80 ] }, { \"activeSlot\": 3, \"coordinate\": [ 865, 80 ] } ] } thehell2_helper.ahk 2 #SingleInstance force #NoEnv #MaxHotkeysPerInterval 99000000 #HotkeyInterval 99000000 #KeyHistory 0 #InstallKeybdHook #UseHook #Include %A_ScriptDir%\\lib\\JSON.ahk #Include %A_ScriptDir%\\lib\\Object sort.ahk #Include %A_ScriptDir%\\lib\\String-object-file.ahk #Include %A_ScriptDir%\\lib\\classMemory.ahk ListLines Off Process, Priority, , A SetTitleMatchMode, 2 SetTitleMatchMode, Fast SetBatchLines, -1 SetKeyDelay, -1, -1, Play SetMouseDelay, -1 SetDefaultMouseSpeed, 0 SetWinDelay, -1 SetControlDelay, -1 SendMode Input CoordMode, Mouse, Client CoordMode, Pixel, Client CoordMode, ToolTip, Client global CONFIG_FILE := % A_ScriptDir \"\\config.json\" ;config file global LOG_FILE = % A_ScriptDir \"\\log\\thehell2.log\" ;log file global BAK_DIR := % A_ScriptDir \"\\save_mp\\\" ;save backup directory global TRACE := 1 ;log level global DEBUG := 2 ;log level global INFO := 3 ;log level global WARN := 4 ;log level global ERROR := 5 ;log level global X := 1 ;coordinate x global Y := 2 ;coordinate y global LOG_LEVEL := 2 ;current log level global CAIN := 1 ;merchant global GRISWOLD := 2 ;merchant global GILLIAN := 3 ;merchant global WIRT := 4 ;merchant global ADRIA := 5 ;merchant global PEPIN := 6 ;merchant global PORTAL := 1 ;entrance global CHRUCH := 2 ;entrance global CATACOMB := 3 ;entrance global CAVE := 4 ;entrance global HELL := 5 ;entrance global ABYSS := 6 ;entrance global CRYPT := 7 ;entrance global HORROR := 1 ;difficulty global PURGATORY := 2 ;difficulty global DOOM := 3 ;difficulty global m_commonMap := \"\" ;config.json common global m_slotArray := \"\" ;config.json slot global m_equipmentArray := \"\" ;config.json equipment global m_inventoryArray := \"\" ;config.json inventory global m_merchantArray := \"\" ;config.json merchant global m_presetArray := \"\" ;config.json preset global m_memoryMap := \"\" ;config.json memory global m_moveItemMap := \"\" ;config.json moveItem global m_classMem := \"\" ;_classMemory global m_message := \"\" ;m_message init() ;init ;lwin:: ;leftwin ;if (!isWinActive(\"ahk_class THEHELL2\", TRACE)) { ; Send, {LWin} ; Sleep, 1 ; return ;} ;if (m_commonMap.winKey) { ; Send, {LWin} ; Sleep, 1 ;} ;return h:: ;h input golem if (!isWinActive(\"ahk_class THEHELL2\", TRACE)) { Send, {h} Sleep, 1 return } inputSwapEquipment(1) inputCastSpell(\"G\", 1000, true) inputSwapEquipment(1) return f8:: ;f8 input fury inputSwapEquipment(2) inputCastSpell(\"F8\", 500, true) inputSwapEquipment(2) return f9:: ;f9 input swap equipment inputSwapEquipment(1) return f10:: ;f10 input swap equipment inputSwapEquipment(2) return f11:: ;f11 input swap equipment inputSwapEquipment(3) return f12:: ;f12 input swap equipment inputSwapEquipment(4) return ;F11:: ;f11 input magi ;inputSwapEquipment(3) ;inputUseItem(\"righthand\", 2, \"J\", 500, true) ;inputSwapEquipment(3) return ;F12:: ;f12 input item recharge ;inputItemRecharge(\"righthand\", 2, \"I\", 500, true) ;return !q:: ;alt+q talk to cain inputTalkToMerchant(CAIN, true) Send, {LAlt Up} Sleep, 1 return !w:: ;alt+w talk to griswold inputTalkToMerchant(GRISWOLD, true) Send, {LAlt Up} Sleep, 1 return !e:: ;alt+e talk to gillian inputTalkToMerchant(GILLIAN, false) Send, {LAlt Up} Sleep, 1 return !r:: ;alt+r talk to wirt inputTalkToMerchant(WIRT, false) Send, {LAlt Up} Sleep, 1 return !t:: ;alt+t talk to adria inputTalkToMerchant(ADRIA, true) Send, {LAlt Up} Sleep, 1 return !y:: ;alt+y talk to pepin inputTalkToMerchant(PEPIN, false) Send, {LAlt Up} Sleep, 1r return !a:: ;alt+a input move to crypt inputMoveToLocation(CRYPT, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !s:: ;alt+s input move to abyss inputMoveToLocation(ABYSS, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !d:: ;alt+d input move to hell inputMoveToLocation(HELL, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !f:: ;alt+f input move to cave inputMoveToLocation(CAVE, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !g:: ;alt+g input move to catacomb inputMoveToLocation(CATACOMB, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !h:: ;alt+h input move to chruch inputMoveToLocation(CHRUCH, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return !z:: ;alt+z test test() Send, {LAlt Up} Sleep, 1 return !x:: ;alt+x input move to portal inputMoveToLocation(PORTAL, m_commonMap.entrancePosition) Send, {LAlt Up} Sleep, 1 return `:: ;` input move item inputMoveItem() Send, {LAlt Up} Sleep, 1 return !v:: ;alt+v input buy potion inputBuyPotion(8) Send, {LAlt Up} Sleep, 1 return !b:: ;alt+b input buy item inputBuyItem() Send, {LAlt Up} Sleep, 1 return ^+1:: ;ctrl+shift+1 run game and talk to merchant inputMultiPlayer() inputCreateGame(m_commonMap.difficulty) inputTalkToMerchant(GRISWOLD, true) Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+2:: ;ctrl+shift+2 restart and talk to merchant inputNewGame() inputCreateGame(m_commonMap.difficulty) inputTalkToMerchant(GRISWOLD, true) Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+8:: ;ctrl+shift+8 write backup save file writeBackupSaveFile() Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+9:: ;ctrl+shift+9 input test coordinate inputTestCoordinate() Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+0:: ;ctrl+shift+0 write config file writeConfigFile() Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+a:: ;ctrl+shift+q get pixel color getPixelColor() Send, {LCtrl Up} Send, {LShift Up} Sleep, 1 return ^+p:: ;ctrl+shift+p ahk pause Pause ^+r:: ;ctrl+shift+r ahk reload Reload ^+x:: ;ctrl+shift+x ahk exitapp ExitApp inputHeal: ;timer input heal inputHeal() return removeToolTip: ;timer remove tooltip ToolTip return init() { ;run as admin runAsAdmin() ;get data configMap := readConfigFile() if (configMap = \"\") return m_commonMap := configMap.common m_slotArray := configMap.slot m_equipmentArray := configMap.equipment m_inventoryArray := configMap.inventory m_merchantArray := configMap.merchant m_presetArray := configMap.preset m_memoryMap := configMap.memory m_moveItemMap:= configMap.moveItem ;remove log file removeLogFile(1024) ;input heal if (m_memoryMap.heal.enable) SetTimer, inputHeal, % m_memoryMap.heal.term } /* input move to location */ inputMoveToLocation(location, positionArray) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return if (!initClassMemory()) return BlockInput, on ;get data addressArray := m_memoryMap.map.address offsetArray := m_memoryMap.map.offset moveToX := m_commonMap.centerCoordinate[X] moveToY := m_commonMap.centerCoordinate[Y] - 20 centerX := m_commonMap.centerCoordinate[X] centerY := m_commonMap.centerCoordinate[Y] ;move to location playerX := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[1]) playerY := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[2]) if ((playerX != positionArray[location][X]) || (playerY != positionArray[location][Y])) { m_classMem.write(m_classMem.BaseAddress + addressArray[1], positionArray[location][X], , offsetArray[1]) m_classMem.write(m_classMem.BaseAddress + addressArray[1], positionArray[location][Y], , offsetArray[2]) Sleep, 1 MouseMove, %moveToX%, %moveToY% Sleep, 1 Click, %moveToX%, %moveToY%, Left, Down Sleep, 1 Click, %moveToX%, %moveToY%, Left, Up Sleep, 300 } MouseMove, %centerX%, %centerY% Sleep, 1 BlockInput, off m_message := \"positionArray[\" location \"] Processed \" positionArray[location][X] \",\" positionArray[location][Y] writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) } /* input buy potion */ inputBuyPotion(amount) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return BlockInput, on MouseGetPos, mouseX, mouseY Send, {Shift Down} Sleep, 1 ;buy item loop, % amount { Click, %mouseX%, %mouseY%, Left, Down Sleep, 1 Click, %mouseX%, %mouseY%, Left, Up Sleep, 1 } Send, {Shift Up} Sleep, Up MouseMove, %mouseX%, %mouseY% Sleep, 1 BlockInput, off m_message := \"buyPotion \" amount \" Processed \" positionArray[location][X] \",\" positionArray[location][Y] writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) } /* input cast spell */ inputCastSpell(shortcut, term, isInstant) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return BlockInput, on Send, {%shortcut%} Sleep, 1 if (isInstant) { Sleep, %term% BlockInput, off return } MouseGetPos, mouseX, mouseY Click, %mouseX%, %mouseY%, Right, Down Sleep, 1 Click, %mouseX%, %mouseY%, Right, Up Sleep, %term% BlockInput, off m_message := \"castSpell \" shortcut \" Processed\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) } /* input active slot */ inputActiveSlot(activeSlot) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return BlockInput, on MouseGetPos, mouseX, mouseY ;open inventory Send, {i} Sleep, 1 ;swap slot activeSlotX := getSlotMap(m_slotArray, activeSlot).coordinate[X] activeSlotY := getSlotMap(m_slotArray, activeSlot).coordinate[Y] Click, %activeSlotX%, %activeSlotY%, Left, Down Sleep, 1 Click, %activeSlotX%, %activeSlotY%, Left, Up Sleep, 1 ;close inventory Send, {i} Sleep, 1 MouseMove, %mouseX%, %mouseY% Sleep, 1 BlockInput, off } /* input use item */ inputUseItem(itemType, slot, shortcut, term, isInstant) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return inputActiveSlot(slot) BlockInput, on inputCastSpell(shortcut, term, isInstant) BlockInput, off inputActiveSlot(1) } /* input item recharge */ inputItemRecharge(itemType, slot, shortcut, term, isInstant) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return inputActiveSlot(slot) BlockInput, on itemTypeCoordinate := getEquipmentMap(m_equipmentArray, itemType) itemTypeCoordinateX := itemTypeCoordinate.coordinate[X] itemTypeCoordinateY := itemTypeCoordinate.coordinate[Y] MouseMove, %itemTypeCoordinateX%, %itemTypeCoordinateY% Sleep, 1 BlockInput, off inputCastSpell(shortcut, 50, isInstant) BlockInput, on Sleep, term MouseGetPos, mouseX, mouseY Sleep, 1 Click, %mouseX%, %mouseY%, Left, Down Sleep, 1 Click, %mouseX%, %mouseY%, Left, Up Sleep, 1 ;close inventory Send, {i} Sleep, 1 BlockInput, off inputActiveSlot(1) } /* input move item */ inputMoveItem() { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return if (!initClassMemory()) return BlockInput, on ;get data centerX := m_commonMap.centerCoordinate[X] centerY := m_commonMap.centerCoordinate[Y] dropX := m_commonMap.centerCoordinate[X] dropY := m_commonMap.centerCoordinate[Y] addressArray := m_memoryMap.buyItem.address offsetArray := m_memoryMap.buyItem.offset moveItemBeltArray := m_moveItemMap.moveItemBelt moveItemDropArray := m_moveItemMap.moveItemDrop m_classMem.write(m_classMem.BaseAddress + addressArray[1], 128, , offsetArray[1]) MouseMove, %centerX%, %centerY% Sleep, 1 ;open inventory Send, {i} Sleep, 1 for k, v in m_inventoryArray { itemX := m_inventoryArray[A_Index].coordinate[X] itemY := m_inventoryArray[A_Index].coordinate[Y] itemCorrectionX := itemX - (m_commonMap.mouseUpCorrectionSize * 1) itemCorrectionY := itemY - (m_commonMap.mouseUpCorrectionSize * 1) MouseMove, %itemX%, %itemY% Sleep, 50 itemName := m_classMem.readString(m_classMem.BaseAddress + addressArray[1], 128, , offsetArray[1]) isBeltMatched := isMatchedItem(itemName, moveItemBeltArray) isDropMatched := isMatchedItem(itemName, moveItemDropArray) Sleep, 10 if (isBeltMatched) { ;move item Send, {Shift Down} Sleep, 1 Click, %itemX%, %itemY%, Left, Down Sleep, 1 Click, %itemCorrectionX%, %itemCorrectionY%, Left, Up Sleep, 1 Send, {Shift Up} Sleep, 1 Click, %itemCorrectionX%, %itemCorrectionY%, Left, Down Sleep, 1 Click, %itemX%, %itemY%, Left, Up Sleep, 1 m_message := itemName \" Processed\" multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) } else if (isDropMatched) { ;get item Click, %itemX%, %itemY%, Left, Down Sleep, 1 Click, %itemCorrectionX%, %itemCorrectionY%, Left, Up Sleep, 1 ;drop item Click, %dropX%, %dropY%, Left, Down Sleep, 1 Click, %dropX%, %dropY%, Left, Up Sleep, 1 m_message := itemName \" Processed\" multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) } MouseMove, %itemX%, %itemY% Sleep, 1 } ;close inventory Send, {i} Sleep, 1 BlockInput, off showToolTip(INFO, multiLineMessage) } /* input buy item */ inputBuyItem() { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return if (!initClassMemory()) return ;get data dropX := m_commonMap.screenSize[X] * 0.05 dropY := m_commonMap.screenSize[Y] * 0.05 addressArray := m_memoryMap.buyItem.address offsetArray := m_memoryMap.buyItem.offset partNameArray := m_memoryMap.buyItem.partName partDescriptionArray := m_memoryMap.buyItem.partDescription prevItemName := \"\" m_classMem.write(m_classMem.BaseAddress + addressArray[1], 128, , offsetArray[1]) loop { for k, v in m_merchantArray { itemX := m_merchantArray[A_Index].coordinate[X] itemY := m_merchantArray[A_Index].coordinate[Y] MouseMove, %itemX%, %itemY% Sleep, 50 itemName := m_classMem.readString(m_classMem.BaseAddress + addressArray[1], 128, , offsetArray[1]) if (itemName = prevItemName) continue itemDescription := itemName \"`n\" loop, 9 { itemDescription := itemDescription m_classMem.readString(m_classMem.BaseAddress + addressArray[1], 128, , offsetArray[1 + A_Index]) \"`n\" } itemDescriptionArray := StrSplit(itemDescription, \"Buy price\") isMatched := isMatchedItem(itemDescriptionArray[1], partDescriptionArray) ;Sleep, 1 if (isMatched) { ;buy item PlayBeep() Sleep, 1 Click, %itemX%, %itemY%, Left, Down Sleep, 1 MouseGetPos, changedMouseX, changedMouseY Click, %changedMouseX%, %changedMouseY%, Left, Up Sleep, 1 ;drop item Click, %dropX%, %dropY%, Left, Down Sleep, 1 Click, %dropX%, %dropY%, Left, Up Sleep, 1 m_message := itemName \" Processed\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) Sleep, 1 } else { ;buy and sell item loop, 2 { MouseGetPos, mouseX, mouseY Click, %mouseX%, %mouseY%, Left, Down Sleep, 1 MouseGetPos, changedMouseX, changedMouseY Click, %changedMouseX%, %changedMouseY%, Left, Up Sleep, 1 } } MouseMove, %itemX%, %itemY% Sleep, 1 prevItemName := itemName writeLogFile(TRACE, A_ThisFunc, A_LineNumber, prevItemName) writeLogFile(TRACE, A_ThisFunc, A_LineNumber, itemDescriptionArray[1]) } } } /* input heal */ inputHeal() { if (!isWinActive(\"ahk_class THEHELL2\", TRACE)) return if (!initClassMemory()) return ;get data addressArray := m_memoryMap.heal.address offsetArray := m_memoryMap.heal.offset lifeRatio := m_memoryMap.heal.lifeRatio manaRatio := m_memoryMap.heal.manaRatio lifeShortcut := m_memoryMap.heal.lifeShortcut manaShortcut := m_memoryMap.heal.manaShortcut lifeNow := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[1]) lifeMax := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[2]) manaNow := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[3]) manaMax := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[4]) lifeNowRatio := ((lifeNow / lifeMax) * 100) manaNowRatio := ((manaNow / manaMax) * 100) if (lifeNow = \"\") { m_message := \"m_classMem.read() Returned no value 0x\" Format(\"{:x}\", addressArray[1]) \",0x\" Format(\"{:x}\", offsetArray[1]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) return } ;mana heal if ((lifeNow \u003e 0) \u0026\u0026 (manaNowRatio \u003c manaRatio)) { ;mana heal if (manaShortcut = \"potion\") { loop, 8 { shortcutKey := 8 - (A_Index - 1) Send, {%shortcutKey%} Sleep, 10 manaNow := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[3]) manaMax := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[4]) manaNowRatio := ((manaNow / manaMax) * 100) Sleep, 1 if (manaNowRatio \u003e= manaRatio) break } } else if (manaShortcut = \"theMagi\") { inputUseItem(\"righthand\", 2, \"J\", 600, true) } else { Send, {%manaShortcut%} } Sleep, 1 m_message := manaShortcut \" Processed \" Format(\"{:d}\", manaNowRatio) \"% \" Format(\"{:d}\", (manaNow / 64)) \"/\" Format(\"{:d}\", (manaMax / 64)) multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) } ;life heal if ((lifeNow \u003e 0) \u0026\u0026 (lifeNowRatio \u003c lifeRatio)) { ;life heal if (lifeShortcut = \"potion\") { loop, 8 { shortcutKey := 8 - (A_Index - 1) Send, {%shortcutKey%} Sleep, 10 lifeNow := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[3]) lifeMax := m_classMem.read(m_classMem.BaseAddress + addressArray[1], , offsetArray[4]) lifeNowRatio := ((lifeNow / lifeMax) * 100) Sleep, 1 if (lifeNowRatio \u003e= lifeRatio) break } } else if (lifeShortcut = \"manaShield\") { inputCastSpell(\"F5\", 500, true) inputCastSpell(\"F7\", 500, true) } else { Send, {%lifeShortcut%} } Sleep, 1 m_message := lifeShortcut \" Processed \" Format(\"{:d}\", lifeNowRatio) \"% \" Format(\"{:d}\", (lifeNow / 64)) \"/\" Format(\"{:d}\", (lifeMax / 64)) multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) } showToolTip(INFO, multiLineMessage) } /* input talk to merchant */ inputTalkToMerchant(merchant, isButton) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return if (!initClassMemory()) return ;get data addressArray := m_memoryMap.map.address offsetArray := m_memoryMap.map.offset centerX := m_commonMap.centerCoordinate[X] centerY := m_commonMap.centerCoordinate[Y] buttonX := m_commonMap.merchantButtonCoordinate[X] buttonY := m_commonMap.merchantButtonCoordinate[Y] ;move to merchant inputMoveToLocation(merchant, m_commonMap.merchantPosition) Sleep, 100 BlockInput, on ;talk to merchant Click, %centerX%, %centerY%, Left, Down Sleep, 100 Click, %centerX%, %centerY%, Left, Up Sleep, 100 ;trade item Send, {Down} Sleep, 1 Send, {Enter} Sleep, 1 if (isButton) { Sleep, 100 Loop, 7 { Click, %buttonX%, %buttonY%, Left, Down Sleep, 1 Click, %buttonX%, %buttonY%, Left, Up Sleep, 1 } } MouseMove, %centerX%, %centerY% Sleep, 1 BlockInput, off } /* input new game */ inputNewGame() { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return BlockInput, on ;new game menuX := m_commonMap.menuButtonCoordinate[X] menuY := m_commonMap.menuButtonCoordinate[Y] Click, %menuX%, %menuY%, Left, Down Sleep, 1 Click, %menuX%, %menuY%, Left, Up Sleep, 1 Send, {Down} Sleep, 100 Send, {Enter} Sleep, 2800 BlockInput, off } /* input multi player */ inputMultiPlayer() { ;run application theHell2Command := \"cd \" m_commonMap.theHell2Path \" \u0026\u0026 TH2.exe\" Run, %COMSPEC% /c %theHell2Command% Sleep, 2000 if (!isWinActive(\"ahk_class SDlgDialog\", INFO)) return BlockInput, on ;multi player Send, {Down} Sleep, 100 Send, {Enter} Sleep, 100 ;select hero Send, {Enter} Sleep, 100 ;local area network (ipx) Send, {Down} Sleep, 100 Send, {Enter} Sleep, 200 BlockInput, off } /* input create game */ inputCreateGame(difficulty) { if (!isWinActive(\"ahk_class SDlgDialog\", INFO)) return BlockInput, on ;create game Send, {Enter} Sleep, 100 ;difficulty if (difficulty = 1) { Send, {Enter} Sleep, 2200 } else if (difficulty = 2) { Send, {Down} Sleep, 100 Send, {Enter} Sleep, 2200 } else if (difficulty = 3) { Send, {Up} Sleep, 100 Send, {Enter} Sleep, 2200 } BlockInput, off } /* input swap equipment */ inputSwapEquipment(preset) { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return if (m_presetArray[preset].Length() \u003c 1) { m_message := \"preset[\" preset \"] Returned .Length() \u003c 1\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) return } writeBackupSaveFile() MouseGetPos, mouseX, mouseY m_presetArray[preset] := ObjectSort(m_presetArray[preset], \"order\") enableItemCount := 0 for k, v in m_presetArray[preset] { if (!m_presetArray[preset][A_Index].enable) { if ((m_presetArray[preset].Length() = A_Index) \u0026\u0026 (enableItemCount = 0)) { m_message := \"preset[\" preset \"] Returned enableItemCount = 0\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) return } } else { enableItemCount += 1 if (enableItemCount = 1) { BlockInput, on ;open inventory Send, {i} Sleep, 1 } } } for k, v in m_presetArray[preset] { if (!m_presetArray[preset][A_Index].enable) continue if (m_presetArray[preset][A_Index].activeSlot \u003e 0) { ;swap slot activeSlotX := getSlotMap(m_slotArray, m_presetArray[preset][A_Index].activeSlot).coordinate[X] activeSlotY := getSlotMap(m_slotArray, m_presetArray[preset][A_Index].activeSlot).coordinate[Y] Click, %activeSlotX%, %activeSlotY%, Left, Down Sleep, 1 Click, %activeSlotX%, %activeSlotY%, Left, Up Sleep, 1 m_message := \"preset[\" preset \"] Processed \" m_presetArray[preset][A_Index].itemType \" activeSlot \" m_presetArray[preset][A_Index].activeSlot \" \" activeSlotX \",\" activeSlotY multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) if ((m_presetArray[preset][A_Index].position[X] = 0) || (m_presetArray[preset][A_Index].position[Y] = 0)) continue } ;get data itemSource := getInventoryMap(m_inventoryArray, m_presetArray[preset][A_Index]) itemSourceX := itemSource.coordinate[X] + ((m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[X]) - m_commonMap.mouseUpCorrectionSize) itemSourceY := itemSource.coordinate[Y] + ((m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[Y]) - m_commonMap.mouseUpCorrectionSize) itemSourceCorrectionX := itemSourceX - (m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[X]) itemSourceCorrectionY := itemSourceY - (m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[Y]) itemDestination := getEquipmentMap(m_equipmentArray, m_presetArray[preset][A_Index].itemType) itemDestinationX := itemDestination.coordinate[X] itemDestinationY := itemDestination.coordinate[Y] itemDestinationCorrectionX := itemDestinationX - (m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[X]) itemDestinationCorrectionY := itemDestinationY - (m_commonMap.mouseUpCorrectionSize * m_presetArray[preset][A_Index].itemSlotSize[Y]) ;validataion coordinate if ((m_presetArray[preset][A_Index].position[X] \u003c 1) || (m_presetArray[preset][A_Index].position[X] \u003e 10) || (m_presetArray[preset][A_Index].position[Y] \u003c 1) || (m_presetArray[preset][A_Index].position[Y] \u003e 7)) { m_message := \"preset[\" preset \"] Returned incorrect value \" m_presetArray[preset][A_Index].itemType \" position \" m_presetArray[preset][A_Index].position[X] \",\" m_presetArray[preset][A_Index].position[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, multiLineMessage) ;close inventory Send, {i} Sleep, 1 BlockInput, off return } if ((m_presetArray[preset][A_Index].itemSlotSize[X] \u003c 1) || (m_presetArray[preset][A_Index].itemSlotSize[X] \u003e 2) || (m_presetArray[preset][A_Index].itemSlotSize[Y] \u003c 1) || (m_presetArray[preset][A_Index].itemSlotSize[Y] \u003e 4)) { m_message := \"preset[\" preset \"] Returned incorrect value \" m_presetArray[preset][A_Index].itemType \" itemSlotSize \" m_presetArray[preset][A_Index].itemSlotSize[X] \",\" m_presetArray[preset][A_Index].itemSlotSize[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, multiLineMessage) ;close inventory Send, {i} Sleep, 1 BlockInput, off return } if ((itemSourceX \u003c 1) || (itemSourceY \u003c 1) || (itemSourceCorrectionX \u003c 1) || (itemSourceCorrectionY \u003c 1) || (itemDestinationX \u003c 1) || (itemDestinationY \u003c 1) || (itemDestinationCorrectionX \u003c 1) || (itemDestinationCorrectionY \u003c 1)) { m_message := \"preset[\" preset \"] Returned incorrect value \" m_presetArray[preset][A_Index].itemType \" src \" itemSourceX \",\" itemSourceY \" \" itemSourceCorrectionX \",\" itemSourceCorrectionY \" dest \" itemDestinationX \",\" itemDestinationY \" \" itemDestinationCorrectionX \",\" itemDestinationCorrectionY multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, multiLineMessage) ;close inventory Send, {i} Sleep, 1 BlockInput, off return } ;swap item Click, %itemSourceX%, %itemSourceY%, Left, Down Sleep, 1 Click, %itemSourceCorrectionX%, %itemSourceCorrectionY%, Left, Up Sleep, 1 Click, %itemDestinationCorrectionX%, %itemDestinationCorrectionY%, Left, Down Sleep, 1 Click, %itemDestinationX%, %itemDestinationY%, Left, Up Sleep, 1 Click, %itemSourceCorrectionX%, %itemSourceCorrectionY%, Left, Down Sleep, 1 Click, %itemSourceX%, %itemSourceY%, Left, Up Sleep, 1 m_message := \"preset[\" preset \"] Processed \" m_presetArray[preset][A_Index].itemType \" src \" itemSourceX \",\" itemSourceY \" \" itemSourceCorrectionX \",\" itemSourceCorrectionY \" dest \" itemDestinationX \",\" itemDestinationY \" \" itemDestinationCorrectionX \",\" itemDestinationCorrectionY multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) } ;close inventory Send, {i} Sleep, 1 MouseMove, %mouseX%, %mouseY% Sleep, 1 BlockInput, off showToolTip(INFO, multiLineMessage) } /* input test coordinate */ inputTestCoordinate() { if (!isWinActive(\"ahk_class THEHELL2\", INFO)) return BlockInput, on ;test m_commonMap coordinate MouseMove, m_commonMap.inventoryTopLeftCoordinate[X], m_commonMap.inventoryTopLeftCoordinate[Y] m_message := \"common.inventoryTopLeftCoordinate \" m_commonMap.inventoryTopLeftCoordinate[X] \",\" m_commonMap.inventoryTopLeftCoordinate[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) Sleep, 100 ;test m_slotArray coordinate for k, v in m_slotArray { MouseMove, m_slotArray[A_Index].coordinate[X], m_slotArray[A_Index].coordinate[Y] m_message := \"slot.activeSlot \" m_slotArray[A_Index].activeSlot \" \" m_slotArray[A_Index].coordinate[X] \",\" m_slotArray[A_Index].coordinate[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) Sleep, 100 } ;test m_equipmentArray coordinate for k, v in m_equipmentArray { MouseMove, m_equipmentArray[A_Index].coordinate[X], m_equipmentArray[A_Index].coordinate[Y] m_message := \"equipment.coordinate \" m_equipmentArray[A_Index].itemType \" \" m_equipmentArray[A_Index].coordinate[X] \",\" m_equipmentArray[A_Index].coordinate[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) Sleep, 100 } ;test m_inventoryArray coordinate for k, v in m_inventoryArray { MouseMove, m_inventoryArray[A_Index].coordinate[X], m_inventoryArray[A_Index].coordinate[Y] m_message := \"inventory.coordinate \" m_inventoryArray[A_Index].position[X] \",\" m_inventoryArray[A_Index].position[Y] \" \" m_inventoryArray[A_Index].coordinate[X] \",\" m_inventoryArray[A_Index].coordinate[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) Sleep, 100 } ;test m_merchantArray coordinate for k, v in m_merchantArray { MouseMove, m_merchantArray[A_Index].coordinate[X], m_merchantArray[A_Index].coordinate[Y] m_message := \"merchant.coordinate \" m_merchantArray[A_Index].position[X] \",\" m_merchantArray[A_Index].position[Y] \" \" m_merchantArray[A_Index].coordinate[X] \",\" m_merchantArray[A_Index].coordinate[Y] multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) Sleep, 100 } BlockInput, off writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) showToolTip(DEBUG, multiLineMessage) } /* is win active */ isWinActive(ahkClass, level) { if (!WinActive(ahkClass)) { m_message := \"!WinActive(\" chr(34) ahkClass chr(34) \") Returned\" writeLogFile(level, A_ThisFunc, A_LineNumber, m_message) showToolTip(level, m_message) return false } return true } /* init _ClassMemory */ initClassMemory() { if (_ClassMemory.__Class != \"_ClassMemory\") { m_message := m_message := \"_ClassMemory.__Class != \" chr(34) \"_ClassMemory\" chr(34) \" Failed\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) showToolTip(DEBUG, m_message) return false } m_classMem := new _ClassMemory(\"ahk_exe TH2.exe\",\" \", hProcessCopy) if (!isObject(m_classMem)) { m_message := \"!isObject(m_classMem) Failed\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, m_message) showToolTip(DEBUG, m_message) return false } return true } /* write backup save file */ writeBackupSaveFile() { FileCopyDir, % m_commonMap.theHell2Path \"save_mp\\\", % BAK_DIR A_Now \"\\\" m_message := \"FileCopyDir() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" SAVE_DIR \" \" BAK_DIR A_Now \"\\ \" writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) } /* read config file */ readConfigFile() { ;read config file FileRead, config, %CONFIG_FILE% m_message := \"FileRead() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" CONFIG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) try { configMap := JSON.Load(config) } catch e { m_message := \"JSON.Load() Failed \" CONFIG_FILE \"`n\" e.Message multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(ERROR, A_ThisFunc, A_LineNumber, m_message) showToolTip(ERROR, multiLineMessage) } m_message := \"JSON.Load() Processed \" CONFIG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) writeLogFile(TRACE, A_ThisFunc, A_LineNumber, config) showToolTip(INFO, multiLineMessage) return configMap } /* write config file */ writeConfigFile() { ;set base data baseTheHell2Path := \"c:\\GOG Games\\TH2\\\" baseTheHell2Version := \"1.0780\" baseDifficulty := DOOM baseScreenSizeArray := [1280, 720] baseInventoryTopLeftCoordinateArray := [832, 295] baseMerchantTopLeftCoordinateArray := [188, 105] baseMenuButtonCoordinateArray := [355, 703] baseMerchantButtonCoordinateArray := [220, 490] baseCenterCoordinateArray := [640, 330] baseMerchantPositionArray := [[62, 71], [62, 63], [55, 44], [56, 58], [44, 68], [55, 79]] baseEntrancePositionArray := [[57, 40], [25, 30], [49, 21], [17, 69], [41, 80], [80, 62], [37, 25]] baseMouseUpCorrectionSize := 14 baseInventoryGapSizeArray := [29, 29] baseSlot1CoordinateArray := [825, 80] baseSlotGapSize := 20 baseInventorySlotSizeArray := [10, 7] baseMerchantSlotSizeArray := [10, 12] baseSlotSize := 3 baseItemTypeArray := [\"rightHand\",\" leftHand\",\" head\",\" cloth\",\" belt\",\" gloves\",\" shoes\",\" amulet\",\" rightRing\",\" leftRing\"] baseItemRemarkArray := [\"weapon name\",\" orb/shield name\",\" helm name\",\"armor name\",\" belt name\",\" gloves name\",\" shoes name\",\" amulet name\",\" right ring name\",\" left ring name\"] basem_equipmentArray := [[844, 145], [1071, 145], [960, 90], [960, 176], [960, 240], [844, 233], [1073, 233], [1020, 105], [903, 220], [1017, 220]] baseitemSlotSizeArray := [[1, 2], [2, 2], [2, 2], [2, 3], [2, 1], [2, 2], [2, 2], [1, 1], [1, 1], [1, 1]] basePositionArray := [[6, 6], [7, 1], [9, 1], [9, 3], [9, 6], [7, 3], [7, 5], [10, 7], [8, 7], [9, 7]] baseMeomoryMapAddressArray := [\"0x0090A3D4\"] baseMeomoryMapOffsetArray := [\"0x38\", \"0x3C\"] baseMeomoryHealAddressArray := [\"0x0090A3D4\"] baseMeomoryHealOffsetArray := [\"0x0198\", \"0x019C\", \"0x01AC\", \"0x01B0\"] baseMeomoryHealRatioArray := [0, 20] baseMeomoryHealShortcutArray := [\"\", \"potion\"] baseMeomoryHealTerm := 1000 baseMeomoryBuyItemAddressArray := [\"0x00E1B318\"] baseMeomoryBuyItemOffsetArray := [\"0x00\", \"0x0108\", \"0x0210\", \"0x0318\", \"0x0420\", \"0x0528\", \"0x0630\", \"0x0738\", \"0x0840\", \"0x0948\"] baseMeomoryBuyItemPartDescriptionArray := [[\"% to mana regeneration\", \"+24 to magic\"]] baseMoveItemDropArray := [[\"gold\"], [\"relict\"], [\"repair\"], [\"potion\", \"healing\"]] baseMoveItemBeltArray := [[\"potion\", \"mana\"], [\"holy\", \"water\"]] configMap := Object() configMap.insert(\"moveItem\", m_moveItemMap) ;set m_commonMap m_commonMap := Object() m_commonMap.insert(\"theHell2Path\", baseTheHell2Path) m_commonMap.insert(\"theHell2Version\", baseTheHell2Version) m_commonMap.insert(\"difficulty\", baseDifficulty) m_commonMap.insert(\"mouseUpCorrectionSize\", baseMouseUpCorrectionSize) m_commonMap.insert(\"screenSize\", baseScreenSizeArray) m_commonMap.insert(\"inventoryTopLeftCoordinate\", baseInventoryTopLeftCoordinateArray) m_commonMap.insert(\"merchnatTopLeftCoordinate\", baseMerchantTopLeftCoordinateArray) m_commonMap.insert(\"merchnatTopLeftCoordinate\", baseMerchantTopLeftCoordinateArray) m_commonMap.insert(\"menuButtonCoordinate\", baseMenuButtonCoordinateArray) m_commonMap.insert(\"merchantButtonCoordinate\", baseMerchantButtonCoordinateArray) m_commonMap.insert(\"centerCoordinate\", baseCenterCoordinateArray) m_commonMap.insert(\"merchantPosition\", baseMerchantPositionArray) m_commonMap.insert(\"entrancePosition\", baseEntrancePositionArray) m_commonMap.insert(\"winKey\", false) configMap.insert(\"common\", m_commonMap) ;set m_slotArray m_slotArray := Array() loop, % baseSlotSize { coordinateArray := Array() coordinateArray.Push(baseSlot1CoordinateArray[X] + (baseSlotGapSize * (A_index - 1))) coordinateArray.Push(baseSlot1CoordinateArray[Y]) innerMap := Object() innerMap.insert(\"activeSlot\", A_index) innerMap.insert(\"coordinate\", coordinateArray) m_slotArray.Push(innerMap) } m_slotArray := ObjectSort(m_slotArray, \"activeSlot\") configMap.insert(\"slot\", m_slotArray) ;set m_equipmentArray m_equipmentArray := Array() for k, v in baseItemTypeArray { coordinateArray := Array() coordinateArray.Push(basem_equipmentArray[A_index][X]) coordinateArray.Push(basem_equipmentArray[A_index][Y]) innerMap := Object() innerMap.insert(\"itemType\", baseItemTypeArray[A_index]) innerMap.insert(\"coordinate\", coordinateArray) m_equipmentArray.Push(innerMap) } configMap.insert(\"equipment\", m_equipmentArray) ;set m_inventoryArray m_inventoryArray := Array() loop, % baseInventorySlotSizeArray[Y] { yIndex := A_index + 0 ;to number loop, % baseInventorySlotSizeArray[X] { xIndex := A_index + 0 ;to number positionArray := Array() positionArray.Push(xIndex) positionArray.Push(yIndex) coordinateArray := Array() coordinateArray.Push(baseInventoryTopLeftCoordinateArray[X] + (baseInventoryGapSizeArray[X] * (xIndex - 1))) coordinateArray.Push(baseInventoryTopLeftCoordinateArray[Y] + (baseInventoryGapSizeArray[Y] * (yIndex - 1))) innerMap := Object() innerMap.insert(\"position\", positionArray) innerMap.insert(\"coordinate\", coordinateArray) m_inventoryArray.Push(innerMap) } } configMap.insert(\"inventory\", m_inventoryArray) ;set m_merchantArray m_merchantArray := Array() loop, % baseMerchantSlotSizeArray[Y] { yIndex := A_index + 0 ;to number loop, % baseMerchantSlotSizeArray[X] { xIndex := A_index + 0 ;to number positionArray := Array() positionArray.Push(xIndex) positionArray.Push(yIndex) coordinateArray := Array() coordinateArray.Push(baseMerchantTopLeftCoordinateArray[X] + (baseInventoryGapSizeArray[X] * (xIndex - 1))) coordinateArray.Push(baseMerchantTopLeftCoordinateArray[Y] + (baseInventoryGapSizeArray[Y] * (yIndex - 1))) innerMap := Object() innerMap.insert(\"position\", positionArray) innerMap.insert(\"coordinate\", coordinateArray) m_merchantArray.Push(innerMap) } } configMap.insert(\"merchant\", m_merchantArray) ;set m_memoryMap mapMap := Object() mapMap.insert(\"address\", baseMeomoryMapAddressArray) mapMap.insert(\"offset\", baseMeomoryMapOffsetArray) healMap := Object() healMap.insert(\"address\", baseMeomoryHealAddressArray) healMap.insert(\"offset\", baseMeomoryHealOffsetArray) healMap.insert(\"enable\", true) healMap.insert(\"lifeRatio\", baseMeomoryHealRatioArray[1]) healMap.insert(\"manaRatio\", baseMeomoryHealRatioArray[2]) healMap.insert(\"lifeShortcut\", baseMeomoryHealShortcutArray[1]) healMap.insert(\"manaShortcut\", baseMeomoryHealShortcutArray[2]) healMap.insert(\"term\", baseMeomoryHealTerm) buyItemMap := Object() buyItemMap.insert(\"address\", baseMeomoryBuyItemAddressArray) buyItemMap.insert(\"offset\", baseMeomoryBuyItemOffsetArray) buyItemMap.insert(\"partDescription\", baseMeomoryBuyItemPartDescriptionArray) m_memoryMap := Object() m_memoryMap.insert(\"map\", mapMap) m_memoryMap.insert(\"heal\", healMap) m_memoryMap.insert(\"buyItem\", buyItemMap) configMap.insert(\"memory\", m_memoryMap) ;set m_moveItemMap m_moveItemMap := Object() m_moveItemMap.insert(\"moveItemDrop\", baseMoveItemDropArray) m_moveItemMap.insert(\"moveItemBelt\", baseMoveItemBeltArray) ;set m_presetArray m_presetArray := Array() presetInnerArray := Array() for k, v in baseItemTypeArray { positionArray := Array() positionArray.Push(basePositionArray[A_index][X]) positionArray.Push(basePositionArray[A_index][Y]) itemSlotSizeArray := Array() itemSlotSizeArray.Push(baseitemSlotSizeArray[A_index][X]) itemSlotSizeArray.Push(baseitemSlotSizeArray[A_index][Y]) innerMap:= Object() innerMap.insert(\"enable\", false) innerMap.insert(\"order\", A_Index) innerMap.insert(\"activeSlot\", false) innerMap.insert(\"remarks\", baseItemRemarkArray[A_index]) innerMap.insert(\"itemType\", baseItemTypeArray[A_index]) innerMap.insert(\"position\", positionArray) innerMap.insert(\"itemSlotSize\", itemSlotSizeArray) presetInnerArray.Push(innerMap) } presetInnerArray := ObjectSort(presetInnerArray, \"order\") loop, 4 { m_presetArray.Push(presetInnerArray) } configMap.insert(\"preset\", m_presetArray) ;write config file config := \"\" try { config := % JSON.Dump(configMap, , 2) } catch e { m_message := \"JSON.Dump() Failed \" CONFIG_FILE \"`n\" e.m_message writeLogFile(ERROR, A_ThisFunc, A_LineNumber, m_message) showToolTip(ERROR, m_message) return } m_message := \"JSON.Dump() Processed\" CONFIG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) writeLogFile(TRACE, A_ThisFunc, A_LineNumber, config) FileDelete, %CONFIG_FILE% m_message := \"FileDelete() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" CONFIG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) FileAppend, %config%, %CONFIG_FILE% m_message := \"FileAppend() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" CONFIG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, multiLineMessage) } /* get pixel color */ getPixelColor() { MouseGetPos, mouseX, mouseY PixelGetColor, color, %mouseX%, %mouseY% m_message := \"PixelGetColor() \"(ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \"color \" \" mouseX \",\" mouseY writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) } /* get inventory map */ getInventoryMap(m_inventoryArray, presetMap) { for k, v in m_inventoryArray { if ((m_inventoryArray[A_Index].position[X] = presetMap.position[X]) \u0026\u0026 (m_inventoryArray[A_Index].position[Y] = presetMap.position[Y])) return % m_inventoryArray[A_Index] } } /* get merchant map */ getMerchantMap(m_merchantArray, positionX, positionY) { for k, v in m_merchantArray { if ((m_merchantArray[A_Index].position[X] = positionX) \u0026\u0026 (m_merchantArray[A_Index].position[Y] = positionY)) return % m_merchantArray[A_Index] } } /* get equipment map */ getEquipmentMap(m_equipmentArray, itemType) { for k, v in m_equipmentArray { if (m_equipmentArray[A_Index].itemType = itemType) return % m_equipmentArray[A_Index] } } /* get slot map */ getSlotMap(m_slotArray, activeSlot) { for k, v in m_slotArray { if (m_slotArray[A_Index].activeSlot = activeSlot) return % m_slotArray[A_Index] } } /* is matched item */ isMatchedItem(itemDescription, partDescriptionArray) { for k, v in partDescriptionArray { itemIndex := A_index + 0 ;to number for k, v in partDescriptionArray[itemIndex] { partDescriptionIndex := A_index + 0 ;to number if (InStr(itemDescription, partDescriptionArray[itemIndex][partDescriptionIndex], false)) { isMatched := true } else { isMatched := false break } } if (isMatched) break } return isMatched } /* remove log file */ removeLogFile(thresholdSize) { FileGetSize, fileSize, %LOG_FILE%, K m_message := \"FileGetSize() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" fileSize \"bytes \" LOG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) if (fileSize \u003c thresholdSize) return FileDelete, %LOG_FILE% m_message := \"FileDelete() \" (ErrorLevel = 0 ? \"Processed\" : \"Failed\") \" \" LOG_FILE multiLineMessage := getToolTipMessage(multiLineMessage) writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, multiLineMessage) } /* write log file */ writeLogFile(level, functionName, lineNumber, message) { if (LOG_LEVEL \u003e level) return ;write log file levelName := \"\" switch (level) { case TRACE: levelName := \"TRACE\" case DEBUG: levelName := \"DEBUG\" case INFO: levelName := \"INFO\" case WARN: levelName := \"WARN\" case ERROR: levelName := \"ERROR\" default: } FileAppend, % A_YYYY \"-\" A_MM \"-\" A_DD \" \" A_Hour \":\" A_Min \":\" A_Sec \".\" A_MSec \" \" levelName \" \" A_ScriptName \".\" functionName \"() Line \" lineNumber \" \" message \"`n\", %LOG_FILE% } /* show tooltip */ showToolTip(level, message) { if (LOG_LEVEL \u003e level) return ToolTip, %message%, 8, 8 SetTimer, removeToolTip, -2000 } /* get tool tip message */ getToolTipMessage(multiLineMessage) { return % multiLineMessage m_message (m_message = \"\" ? \"\" : \"`n\") } /* play beep */ playBeep() { ;play beep loop, 3 { SoundBeep Sleep, 10 } } /* run as admin */ runAsAdmin() { m_message := \"A_IsAdmin \"(A_IsAdmin = 1 ? \"Processed\" : \"Failed\") writeLogFile(INFO, A_ThisFunc, A_LineNumber, m_message) showToolTip(INFO, m_message) if (A_IsAdmin) { return } else { Run *RunAs \"%A_ScriptFullPath%\" ExitApp } } /* test */ test() { } Dependencies Libraries Remrks Object sort.ahk Autohotkey 포럼 ObjectSort() 라이브러리 classMemory.ahk classMemory 라이브러리 JSON.ahk JSON 라이브러리 String-object-file.ahk String-object-file 라이브러리 Troubleshooting 사용자 입력 차단 안될 때\n실행 시 관리자 권한 확인\n아이템 swap 시에 적으로부터 공격받거나 무리한 연타 시 아이템 삭제됨\n원인 찾지 못함\nhttps://github.com/dntco43u/thehell2_helper/blob/main/config.json ↩︎\nhttps://github.com/dntco43u/thehell2_helper/blob/main/thehell2_helper.ahk ↩︎\n","categories":["dev"],"description":"Diablo The Hell 2 v1.0780 엘리멘탈리스트 매크로","excerpt":"Diablo The Hell 2 v1.0780 엘리멘탈리스트 매크로","ref":"/dev/thehell2-helper/","tags":["autohotkey"],"title":"thehell2-helper"},{"body":"\nGitHub repository 바로 가기\nautohotkey Shortcuts Shortcuts Remarks Ctrl+Shift+F1 Chat /bow Ctrl+Shift+F2 Chat /salute Ctrl+Shift+F3 Chat /dance Ctrl+Shift+F4 Chat /drums Ctrl+Shift+F5 Chat /lute Ctrl+Shift+F6 Chat /laugh Ctrl+Shift+F7 Chat /taunt Ctrl+Shift+F8 Chat /gunshow Ctrl+Shift+~ Identify all Ctrl+Shift+1 Move item from stash inventory Ctrl+Shift+2 Transmute item Ctrl+Shift+3 Restore shared stash Ctrl+Shift+4 Add enchant Ctrl+Shift+5 Disenchant and add enchant Ctrl+Shift+6 Inventory loop disenchant and add enchant Ctrl+Shift+7 Inventory loop add enchant Ctrl+Shift+8 Transmute scroll Ctrl+Shift+Tab Reroll world Ctrl+Shift+Q Backup shared stash Ctrl+Shift+W Backup save file Ctrl+Shift+E Gamble Ctrl+Shift+T Tarroch’s tomb golem soul Ctrl+Shift+Y Restart world Ctrl+Shift+A Auto spam toggle Ctrl+Shift+S Custom console Ctrl+Shift+D Buy item Ctrl+Shift+F Fish Ctrl+Shift+G Sell item Ctrl+Shift+H Hunt Ctrl+Shift+J Custom console Ctrl+Shift+L Login game Ctrl+Shift+N Copy item torchlight2_helper.properties LOGIN_PASSWORD=W*************************************************************** 구성 따로 분리한 구성 없이 소스에 하드코딩됨. 적용할 구성 외에 주석 처리할 것\n자동 인챈트 구성 ;Configuration examples filterStatObj := [[\"+\", 76]] ;lv38 (38*0.69)28x3=84, ceil(84*0.90)75.6 filterStatObj := [[\"+\", 111]] ;lv58 (58*0.69)41x3=123, ceil(123*0.90)110.7 filterStatObj := [[\"+\", 152]] ;lv81 (81*0.69)56x3=168, ceil(168*0.90)151.2 filterStatObj := [[\"+\", 184]] ;lv99 (99*0.69)68*3=204, ceil(204*0.90)183.6 filterStatObj := [[\"+\", 187]] ;lv100 (100*0.69)69*3=207, ceil(207*0.90)186.3 filterStatObj := [[\"+\", 195]] ;lv105 (105*0.69)72*3=216, ceil(216*0.90)194.4 자동 스팸 구성 ;Configuration examples Filter examples\u003cbr\u003e isAutoHealthPotion := true isAutoManaPotion := true isAutoPetPotion := false isAutoSkill := true isAutoAttack := true isDervish6 := true isDervish5 := true isDervish4 := true lowHealth90Coord := [38, 522] ;90% lowMana90Coord := [754, 522] ;90% lowHealth66Coord := [38, 543] ;66% lowMana66Coord := [754, 543] ;66% lowHealth33Coord := [38, 568] ;33% lowMana33Coord := [754, 568] ;33% lowPetHealthCoord := [38, 10] lowPetManaCoord := [38, 22] skill1Coord := [251, 575] skillXObj := [] activeskillCoord := [606, 582] berserkerChargeCoord := [474, 508] embermageChargeCoord := [467, 510] engineerChargeCoord := [467, 510] outlanderChargeCoord := [478, 516] torchlight2_helper.ahk 1 #SingleInstance force #NoEnv #MaxHotkeysPerInterval 99000000 #HotkeyInterval 99000000 #KeyHistory 0 #InstallKeybdHook #InstallMouseHook #UseHook ListLines Off Process, Priority, , A SetTitleMatchMode, 2 SetTitleMatchMode, Fast SetBatchLines, -1 SetKeyDelay, -1, -1, Play SetMouseDelay, -1 SetDefaultMouseSpeed, 0 SetWinDelay, -1 SetControlDelay, -1 SendMode Input CoordMode, Mouse, Client CoordMode, Pixel, Client CoordMode, ToolTip, Screen ;------------------------------------------------------------------------------- ; global variables ;------------------------------------------------------------------------------- global LOG_LEVEL := 2 ;current log level global TRACE := 1 ;log level global DEBUG := 2 ;log level global INFO := 3 ;log level global WARN := 4 ;log level global ERROR := 5 ;log level global SEVERE := 6 ;log level global KEYDOWN := 1 ;keyboard event global KEYUP := 2 ;keyboard event global KEYPRESS := 3 ;keyboard event global KEYRAW := 4 ;keyboard event global LOG_FILE := A_ScriptDir \"\\log\\torchlight2_helper.log\" ;log file global POWERFUL_FILE := A_ScriptDir \"\\res\\powerful.bmp\" ;powerful image file global SAVE_SRC_DIRECTORY := A_MyDocuments \"\\My Games\\Runic Games\\Torchlight 2\\save\" ;save source directory global SAVE_BAK_DIRECTORY := A_ScriptDir \"\\save\" ;save backup directory global MODSAVE_SRC_DIRECTORY := A_MyDocuments \"\\My Games\\Runic Games\\Torchlight 2\\modsave\" ;save source directory global MODSAVE_BAK_DIRECTORY := A_ScriptDir \"\\modsave\" ;save backup directory global CAPTURE2TEXT_FILE := A_ScriptDir \"\\Capture2Text\\Capture2Text.exe\" ;capture2text exe file, faster than Capture2Text_CLI.exe global DEFLAGGER_FILE := A_ScriptDir \"\\deflag\\deflag.bat\" ;deflag bat file global PROPERTIES_FILE := A_ScriptDir \"\\\" SubStr(A_ScriptName, 1, -4) \".properties\" ;properties file global LOGIN_PASSWORD := \"\" ;login password global X := 1 ;screen coordinate x global Y := 2 ;screen coordinate y global WIDTH := 3 ;screen coordinate width global HEIGHT := 4 ;screen coordinate height global KEY_1 := 1 ;key global KEY_2 := 2 ;key global KEY_3 := 3 ;key global KEY_4 := 4 ;key global KEY_Q := 5 ;key global KEY_W := 6 ;key global KEY_E := 7 ;key global KEY_R := 8 ;key global KEY_D := 9 ;key global KEY_F := 10 ;key global m_IsLoading := false global m_LastHDrinkHealth := A_TickCount - 8000 global m_LastHDrinkMana := A_TickCount - 8000 global m_LastHDrinkPetHealth := A_TickCount - 8000 global m_LastHDrinkPetMana := A_TickCount - 8000 global m_LastDervish6 := A_TickCount - 20000 global m_LastDervish5 := A_TickCount - 18000 global m_LastDervish4 := A_TickCount - 16000 ;------------------------------------------------------------------------------- ; init ;------------------------------------------------------------------------------- init() ;init /* init */ init() { initHotkey(\"initapp\") getProperties(getTextFile(PROPERTIES_FILE)) runAsAdmin() removeLogFile(8192) } ;------------------------------------------------------------------------------- ; test ;------------------------------------------------------------------------------- test() { ;getPixelColor(292, 228) testPixelColorInputAuto() ;testPixelColorInventory() ;testIsDisenchant() ;testTextFromOcr() ;testPixelColorocr() ;deflagSharedStash(MODSAVE_SRC_DIRECTORY) } ;------------------------------------------------------------------------------- ; hotkeys ;------------------------------------------------------------------------------- ^+f1:: ;ctrl+shift+f1 chat /bow { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /bow\") inputChat(\"/bow\") ;your character takes a bow return } ^+f2:: ;ctrl+shift+f2 chat /salute { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /salute\") inputChat(\"/salute\") ;your character salutes return } ^+f3:: ;ctrl+shift+f3 chat /dance { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /dance\") inputChat(\"/dance\") ;your character does a little dance until you move or do something else return } ^+f4:: ;ctrl+shift+f4 chat /drums { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /drums\") inputChat(\"/drums\") ;your character plays some imaginary drums return } ^+f5:: ;ctrl+shift+f5 chat /lute { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /lute\") inputChat(\"/lute\") ;your character plays on an imaginary lute return } ^+f6:: ;ctrl+shift+f6 chat /laugh { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /laugh\") inputChat(\"/laugh\") ;your character laughs return } ^+f7:: ;ctrl+shift+f7 chat /taunt { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /taunt\") inputChat(\"/taunt\") ;your character does a taunt return } ^+f8:: ;ctrl+shift+f8 chat /gunshow { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"chat /gunshow\") inputChat(\"/gunshow\") ;your character shows his guns arms return } ^+~:: ;ctrl+shift+~ { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"console\") inputConsole(\"Identifyall\") ;identify all return } ^+1:: ;ctrl+shift+1 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"move item from stash inventory\") inputMoveItemFromStashInventory() return } ^+2:: ;ctrl+shift+2 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"transmute item\") inputTransmuteItem() return } ^+3:: ;ctrl+shift+3 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"restore shared stash\") inputQuitGame() copySharedStash(MODSAVE_BAK_DIRECTORY, MODSAVE_SRC_DIRECTORY) copySharedStash(SAVE_BAK_DIRECTORY, SAVE_SRC_DIRECTORY) deflagSharedStash(MODSAVE_SRC_DIRECTORY) deflagSharedStash(SAVE_SRC_DIRECTORY) inputCreateGame(false) return } ^+4:: ;ctrl+shift+4 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"add enchant\") inputAddEnchant() return } ^+5:: ;ctrl+shift+5 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"disenchant and add enchant\") inputDisenchant() inputAddEnchant() return } ^+6:: ;ctrl+shift+6 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"inventory loop disenchant and add enchant\") ;element type ;filterTypeObj := [\"chance\", \"conveys\"] ;only element damage ;filterTypeObj := [\"chance\", \"+\"] ;only conveys ;filterTypeObj := [\"chance\", \"conveys \u0026\u0026 +\"] ;only conveys, only element damage ;element filter ;filterStatObj := [[\"conveys\", 95]] ;lv8 ;filterStatObj := [[\"conveys\", 235]] ;lv17 ;filterStatObj := [[\"conveys\", 445]] ;lv26 ;filterStatObj := [[\"conveys\", 850]] ;lv39 ;filterStatObj := [[\"conveys\", 900]] ;lv40 ;filterStatObj := [[\"conveys\", 1650]] ;lv54 ;filterStatObj := [[\"+\", 195]] ;lv55 ;filterStatObj := [[\"conveys\", 2000]] ;lv60 ;filterStatObj := [[\"conveys\", 2400]] ;lv65 ;filterStatObj := [[\"conveys\", 3350]] ;lv75 ;filterStatObj := [[\"conveys\", 3700]] ;lv79 ;filterStatObj := [[\"conveys\", 4300]] ;lv84 ;filterStatObj := [[\"+\", 306], [\"conveys\", 4800]] ;lv88 ;filterStatObj := [[\"+\", 325], [\"conveys\", 5500]] ;lv93 ;filterStatObj := [[\"conveys\", 5600]] ;lv94 ;filterStatObj := [[\"+\", 327]] ;lv95 ;filterStatObj := [[\"conveys\", 6000]] ;lv97 ;filterStatObj := [[\"+\", 345], [\"conveys\", 6350]] ;lv99 ;filterStatObj := [[\"+\", 347], [\"conveys\", 6500]] ;lv100 ;filterStatObj := [[\"+\", 365], [\"conveys\", 7350]] ;lv105 ;stat type ;filterTypeObj := [\"dex\", \"foc\", \"vit\"] ;only str ;filterTypeObj := [\"str\", \"foc\", \"vit\"] ;only dex filterTypeObj := [\"str\", \"dex\", \"vit\"] ;only foc ;filterTypeObj := [\"str\", \"dex\", \"foc\"] ;only vit ;filterTypeObj := [\"dex\", \"vit\", \"str \u0026\u0026 foc\"] ;only str, only foc ;filterTypeObj := [\"str\", \"dex\", \"vit \u0026\u0026 foc\"] ;only foc, only vit ;filterTypeObj := [\"foc\", \"vit\"] ;str, dex ;filterTypeObj := [\"dex\", \"vit\"] ;str, foc ;filterTypeObj := [\"dex\", \"foc\"] ;str, vit ;filterTypeObj := [\"str\", \"vit\"] ;dex, foc ;filterTypeObj := [\"str\", \"dex\"] ;foc, vit ;filterTypeObj := [\"dex\"] ;str, foc, vit ;stat filter ;filterStatObj := [[\"+\", 76]] ;lv38 (38*0.69)28x3=84, ceil(84*0.90)75.6 ;filterStatObj := [[\"+\", 111]] ;lv58 (58*0.69)41x3=123, ceil(123*0.90)110.7 ;filterStatObj := [[\"+\", 152]] ;lv81 (81*0.69)56x3=168, ceil(168*0.90)151.2 ;filterStatObj := [[\"+\", 184]] ;lv99 (99*0.69)68*3=204, ceil(204*0.90)183.6 ;filterStatObj := [[\"+\", 187]] ;lv100 (100*0.69)69*3=207, ceil(207*0.90)186.3 ;filterStatObj := [[\"+\", 195]] ;lv105 (105*0.69)72*3=216, ceil(216*0.90)194.4 filterStatObj := [[\"+\", 181]] ;filterStatObj := [[\"+\", 207]] ;filterStatObj := [[\"+\", 999]] inputInventoryLoopEnchant(filterTypeObj, filterStatObj) return } ^+7:: ;ctrl+shift+7 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"inventory loop add enchant\") inputInventoryLoopAddEnchant() return } ^+8:: ;ctrl+shift+8 { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"transmute scroll\") inputTransmuteScroll() return } ^+tab:: ;ctrl+shift+tab { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"reroll world\") inputQuitGame() deflagSharedStash(MODSAVE_SRC_DIRECTORY) deflagSharedStash(SAVE_SRC_DIRECTORY) inputCreateGame(true) return } ^+q:: ;ctrl+shift+q { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"backup shared stash\") inputSaveGame() deflagSharedStash(MODSAVE_SRC_DIRECTORY) deflagSharedStash(SAVE_SRC_DIRECTORY) copySharedStash(MODSAVE_SRC_DIRECTORY, MODSAVE_BAK_DIRECTORY) copySharedStash(SAVE_SRC_DIRECTORY, SAVE_BAK_DIRECTORY) playBeep(1) return } ^+w:: ;ctrl+shift+w { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"backup save file\") inputSaveGame() copySaveFile(MODSAVE_SRC_DIRECTORY, MODSAVE_BAK_DIRECTORY) copySaveFile(SAVE_SRC_DIRECTORY, SAVE_BAK_DIRECTORY) return } ^+e:: ;ctrl+shift+e { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"gamble\") inputGamble() return } ^+t:: ;ctrl+shift+t { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"tarroch's tomb golem soul\") inputConsole(\"item golem soul, 3\") ;golem soul inputGetItem() return } ^+y:: ;ctrl+shift+y { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"restart world\") inputQuitGame() deflagSharedStash(MODSAVE_SRC_DIRECTORY) deflagSharedStash(SAVE_SRC_DIRECTORY) inputCreateGame(false) return } ^+a:: ;ctrl+shift+a auto spam toggle { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"auto spam toggle \" (m_IsAutoInput ? \"off\" : \"on\")) m_IsAutoInput := !m_IsAutoInput if m_IsAutoInput { m_IsLoading := true SetTimer, inputAutoTimer, 1 } else { SetTimer, inputAutoTimer, Off } return } ^+s:: ;ctrl+shift+s console { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"console\") ;potion ;inputConsole(\"item rejuv potion 8, 1\") ;ultimate rejuvenation potion lv90 ;fish ;inputConsole(\"item fish_batfish, 1\") ;warsnout ;inputConsole(\"item fish_batfish_perm, 1\") ;giant warsnout ;spell ;inputConsole(\"item haste vi, 1\") ;haste lv83 ;inputConsole(\"item dervish vi, 1\") ;dervish ;inputConsole(\"item dervish v, 1\") ;dervish ;inputConsole(\"item dervish iv, 1\") ;dervish ;inputConsole(\"item summon skeleton vi, 1\") ;summon skeleton ;inputConsole(\"item summon skeleton v, 1\") ;summon skeleton ;inputConsole(\"item summon skeleton iv, 1\") ;summon skeleton ;inputConsole(\"item summon skeleton iii, 1\") ;summon skeleton ;inputConsole(\"item haste vi, 1\") ;haste lv83 ;inputConsole(\"item elemental overload vi, 1\") ;elemental overload lv83 ;inputConsole(\"item block vi, 1\") ;block lv83 ;inputConsole(\"item willpower vi, 1\") ;willpower lv83 ;inputConsole(\"item martial weapons expertise vi, 1\") ;martial weapons expertise lv83 ;inputConsole(\"item heal all vi, 1\") ;heal all lv83 ;inputConsole(\"item summon skeleton vi, 1\") ;summon skeleton lv83 ;inputConsole(\"item heal all vi, 1\") ;heal all ;inputConsole(\"item heal all v, 1\") ;heal all ;inputConsole(\"item heal all iv, 1\") ;heal all ;inputConsole(\"item heal all iii, 1\") ;heal all ;inputConsole(\"item heal all ii, 1\") ;heal all ;inputConsole(\"item heal all i, 1\") ;heal all ;inputConsole(\"item haste vi, 1\") ;haste ;inputConsole(\"item haste v, 1\") ;haste ;inputConsole(\"item haste iv, 1\") ;haste ;inputConsole(\"item haste iii, 1\") ;haste ;inputConsole(\"item haste ii, 1\") ;haste ;inputConsole(\"item haste i, 1\") ;haste ;inputConsole(\"item dervish vi, 1\") ;dervish ;inputConsole(\"item dervish v, 1\") ;dervish ;inputConsole(\"item dervish iv, 1\") ;dervish ;inputConsole(\"item dervish iii, 1\") ;dervish ;inputConsole(\"item dervish ii, 1\") ;dervish ;inputConsole(\"item dervish i, 1\") ;dervish ;inputConsole(\"item block vi, 1\") ;block ;inputConsole(\"item block v, 1\") ;block ;inputConsole(\"item block iv, 1\") ;block ;inputConsole(\"item block iii, 1\") ;block ;inputConsole(\"item block ii, 1\") ;block ;inputConsole(\"item block i, 1\") ;block ;inputConsole(\"item adventurer vi, 1\") ;adventurer ;inputConsole(\"item adventurer v, 1\") ;adventurer ;inputConsole(\"item adventurer iv, 1\") ;adventurer ;inputConsole(\"item adventurer iii, 1\") ;adventurer ;inputConsole(\"item adventurer ii, 1\") ;adventurer ;inputConsole(\"item adventurer i, 1\") ;adventurer ;inputConsole(\"item advanced spellcasting vi, 1\") ;concentration ;inputConsole(\"item advanced spellcasting v, 1\") ;concentration ;inputConsole(\"item advanced spellcasting iv, 1\") ;concentration ;inputConsole(\"item advanced spellcasting iii, 1\") ;concentration ;inputConsole(\"item advanced spellcasting ii, 1\") ;concentration ;inputConsole(\"item advanced spellcasting i, 1\") ;concentration ;inputConsole(\"item summon blood zombie, 1\") ;summon blood zombie ;inputConsole(\"item summon skeleton i, 1\") ;summon skeleton ;inputConsole(\"item summon archers i, 1\") ;summon archers ;inputConsole(\"item summon skeleton ii, 1\") ;summon skeleton ;inputConsole(\"item summon skeleton i, 1\") ;summon skeleton ;normal, magic weapons ;inputConsole(\"item staff_n00, 1\") ;inert staff lv1 ;inputConsole(\"item fist_n00, 1\") ;berserker claws lv1 ;inputConsole(\"item greathammer_n00, 1\") ;railman wrench lv1 ;inputConsole(\"item pistol_n00, 1\") ;initiate matchlock lv1 ;inputConsole(\"item rifle_n00b, 1\") ;rookie shotgonne lv5 ;rare ;inputConsole(\"item pistol_m01c, 32\") ;poacher's gun lv9 ;inputConsole(\"item wand_m01c, 32\") ;witch wand lv9 ;inputConsole(\"item zzz_sword_grom, 1\") ;grom's fireblade lv38 ;inputConsole(\"item zzz_sword_mc_iron, 8\") ;iron sword lv42 ;inputConsole(\"item zzz_sword_mc_gold, 1\") ;gold sword lv42 ;inputConsole(\"item wand_m04c, 32\") ;steel brand lv40 ;inputConsole(\"item axe_u05x, 1\") ;the axe of throwing lv40 ;inputConsole(\"item cannon_m05b, 32\") ;prototype falconet lv47 ;inputConsole(\"item wand_m07slots, 1\") ;silverisle dracoduceus lv79 ;inputConsole(\"item fist_m08, 32\") ;kideny dagger lv86 ;inputConsole(\"item fist_m08c, 32\") ;dragon talon lv95 ;inputConsole(\"item wand_m08slots, 1\") ;bedima augur wand lv94 ;inputConsole(\"item wand_m08c, 32\") ;archmage scepter lv96 ;inputConsole(\"item cannon_m08c, 32\") ;dwarven rune howitzer lv95 ;inputConsole(\"item pistol_m08c, 32\") ;over-under revolver lv95 ;rare weapon ;inputConsole(\"item staff_m01slots, 1\") ;striking dragon staff lv8 ;inputConsole(\"item staff_m02slots, 1\") ;ember-studded staff lv17 ;inputConsole(\"item staff_m03slots, 1\") ;arbiter staff lv26 ;inputConsole(\"item staff_m04slots, 1\") ;hexing staff lv38 ;inputConsole(\"item rifle_m01slots, 1\") ;ember-sights shotgonne lv9 ;inputConsole(\"item rifle_m02slots, 1\") ;four-gauge heavy rifle lv18 ;inputConsole(\"item rifle_m03slots, 1\") ;imperial trench-rifle lv27 ;inputConsole(\"item rifle_m04slots, 1\") ;air-cooled battle rifle lv39 ;inputConsole(\"item wand_m01slots, 1\") ;gem-studded wand lv9 ;inputConsole(\"item wand_m02slots, 1\") ;shalestone rod lv18 ;inputConsole(\"item wand_m03slots, 1\") ;dragonclaw rod lv27 ;inputConsole(\"item wand_m04slots, 1\") ;ember crook lv39 ;inputConsole(\"item cannon_m01slots, 1\") ;baroque culverin lv8 ;inputConsole(\"item cannon_m02slots, 1\") ;brass-bound culverin lv17 ;inputConsole(\"item cannon_m03slots, 1\") ;imperial autocannon lv26 ;inputConsole(\"item cannon_m04slots, 1\") ;imperial battle-cannon lv38 ;unique ;inputConsole(\"item berserker_05_pants_alt_set, 1\") ;savage pants lv75, appearance different from set ;inputConsole(\"item berserker_06_boots_alt_set, 1\") ;harbinger boots lv99, appearance different from set ;inputConsole(\"item caster_03_boots_alt_d, 1\") ;zidders' boots of the roo lv46, limoany cannot be installed, appearance different from set ;inputConsole(\"item netherim_02_shoulders_alt_set, 1\") ;incubus shoulders lv60, can't get knockback resistance, appearance different from set ;inputConsole(\"item shield_u02c, 1\") ;roundhaven lv23 ;inputConsole(\"item bone_01_ring_f_alt_b, 1\") ;the howing flame lv26 ;inputConsole(\"item zzz_immobresist, 1\") ;remobilizer lv23 ;inputConsole(\"item shield_u03c, 1\") ;crimson guard lv38 ;inputConsole(\"item z_amulet_axler, 1\") ;axler's commendation lv46 ;inputConsole(\"item shield_u05, 1\") ;the centerwing lv58 ;inputConsole(\"item hammer_u05, 1\") ;hammer of the ecclesiats lv61 ;inputConsole(\"item cannon_u05, 1\") pot-de-fer lv60 ;inputConsole(\"item cannon_u06, 1\") the kingmaker lv75 ;inputConsole(\"item z_shield_u07_set, 1\") ;the critical factor lv75 ;inputConsole(\"item clockwork_01_amulet_i_alt_b, 1\") ;crackledoom lv81 ;inputConsole(\"item clockwork_01_ring_p_alt_b, 1\") ;turquet band lv81 ;inputConsole(\"item bow_u07b, 1\") ;soulpiercer lv97 ;inputConsole(\"item shield_u07c, 1\") ;parma's coal-burner lv98 ;inputConsole(\"item caster_06_amulet_alt_set, 1\") ;trancendent icon lv99 ;inputConsole(\"item hammer_u07c, 1\") ;hammer of retribution lv100 ;inputConsole(\"item wand_u07c, 1\") ;galaxy quest lv100 ;inputConsole(\"item polearm_u07c, 1\") ;spear-bot 2300 lv100 ;inputConsole(\"item legendary2_wand06c, 1\") ;netherrealm wand lv105 ;inputConsole(\"item legendary2_pistol06c, 1\") ;netherrealm pistol lv105 ;inputConsole(\"item legendary2_hammer05c, 1\") ;netherrealm hammer lv105 ;inputConsole(\"item legendary2_axe05c, 1\") ;netherrealm axe lv105 ;inputConsole(\"item legendary2_cannon04c, 1\") ;netherrealm cannon lv105 ;inputConsole(\"item legendary2_staff06c, 1\") ;netherrealm staff lv105 ;inputConsole(\"item legendary2_rifle04c, 1\") ;netherrealm shotgonne lv105 ;inputConsole(\"item legendary2_fist06c, 1\") ;netherrealm claw lv105 ;inputConsole(\"item legendary2_hammer05c, 1\") ;netherrealm hammer lv105 ;inputConsole(\"item legendary2_shield05c, 1\") ;netherrealm shield lv105 ;legendary ;inputConsole(\"item legendary_staff01, 1\") ;heart of glass lv54 ;inputConsole(\"item legendary_pistol02, 1\") ;ator the fighting eagle lv65 ;inputConsole(\"item legendary_wand02, 1\") ;the black glove lv65 ;inputConsole(\"item legendary_greataxe02, 1\") ;all the colors of the dark lv79 ;inputConsole(\"item legendary_polearm02, 1\") ;battle royale lv79 ;inputConsole(\"item legendary_sword03, 1\") ;a taste of blood lv84 ;inputConsole(\"item legendary_bow03, 1\") ;tenebre 84 ;inputConsole(\"item legendary_wand04, 1\") ;four sided triangle lv88 ;inputConsole(\"item legendary_fist04, 1\") ;the beast with a million eyes lv88 ;inputConsole(\"item legendary_crossbow02, 1\") ;bittermoon lv94 ;inputConsole(\"item legendary_shield04, 1\") ;old master q lv99 ;inputConsole(\"item legendary_cannon03, 1\") ;oldboy lv99 ;inputConsole(\"item legendary_staff05, 1\") ;invincible lv99 ;inputConsole(\"item legendary_hammer04, 1\") ;quaertermass and the pit lv99 ;inputConsole(\"item legendary_greatsword03, 1\") ;twitch of the death nerve lv99 ;inputConsole(\"item legendary2_shield05, 1\") ;escutcheon lv105 ;inputConsole(\"item legendary2_shield05b, 1\") ;decisive sanctuary lv105 ;inputConsole(\"item legendary2_axe05, 1\") ;eight-armed axe lv105 ;inputConsole(\"item legendary2_axe05b, 1\") ;axe of the elder one lv105 ;inputConsole(\"item legendary2_fist06, 1\") ;clockmaster's tooth lv105 ;inputConsole(\"item legendary2_fist06b, 1\") ;bonepry wedge lv105 ;inputConsole(\"item legendary2_hammer05, 1\") ;arcgap's vice lv105 ;inputConsole(\"item legendary2_hammer05b, 1\") ;smithereen lv105 ;inputConsole(\"item legendary2_pistol06, 1\") ;blastmaw's trigger lv105 ;inputConsole(\"item legendary2_pistol06b, 1\") ;dispatch lv105 ;inputConsole(\"item legendary2_sword05, 1\") ;cerulean nightmare lv105 ;inputConsole(\"item legendary2_sword05b, 1\") ;shards of cobalt lv105 ;inputConsole(\"item legendary2_wand06, 1\") ;the prophecy lv105 ;inputConsole(\"item legendary2_wand06b, 1\") ;magus scream lv105 ;inputConsole(\"item legendary2_bow05, 1\") ;the serpent lv105 ;inputConsole(\"item legendary2_bow05b, 1\") ;dragonskull's balance lv105 ;inputConsole(\"item legendary2_cannon04, 1\") ;riftplane destroyer lv105 ;inputConsole(\"item legendary2_cannon04b, 1\") ;starfall's command lv105 ;inputConsole(\"item legendary2_crossbow03, 1\") ;the mandlebow lv105 ;inputConsole(\"item legendary2_crossbow03b, 1\") ;skullfire fangbow lv105 ;inputConsole(\"item legendary2_greataxe04, 1\") ;foe's collapse lv105 ;inputConsole(\"item legendary2_greataxe04b, 1\") ;ribcleave lv105 ;inputConsole(\"item legendary2_greathammer04, 1\") ;quientus lv105 ;inputConsole(\"item legendary2_greathammer04b, 1\") ;the final embrace lv105 ;inputConsole(\"item legendary2_polearm04, 1\") ;impulse lv105 ;inputConsole(\"item legendary2_polearm04b, 1\") ;bio-agitator lv105 ;inputConsole(\"item legendary2_rifle04, 1\") ;tri-force catalyst lv105 ;inputConsole(\"item legendary2_rifle04b, 1\") ;bloom`s margin lv105 ;inputConsole(\"item legendary2_staff06, 1\") ;dragoncoil lv105 ;inputConsole(\"item legendary2_staff06b, 1\") ;ophidian`s endgame lv105 ;inputConsole(\"item legendary2_greatsword04, 1\") ;glyphforge lv105 ;inputConsole(\"item legendary2_greatsword04b, 1\") ;mortal edge lv105 ;gem ;inputConsole(\"item tl2_venomember_rank1, 4\") ;venom ember speck lv8 ;inputConsole(\"item tl2_voidember_rank1, 4\") ;void ember speck lv8 ;inputConsole(\"item tl2_voidember_rank2, 4\") ;void ember chip lv22 ;inputConsole(\"item tl2_bloodember_rank1, 32\") ;blood ember speck lv8 ;inputConsole(\"item tl2_bloodember_rank2, 32\") ;blood ember chip lv22 ;inputConsole(\"item tl2_bloodember_rank3, 32\") ;blood ember shard lv36 ;inputConsole(\"item tl2_bloodember_rank4, 32\") ;blood ember lv50 ;inputConsole(\"item tl2_bloodember_rank7, 32\") ;giant blood ember lv92 ;inputConsole(\"item tl2_chaosember_rank1, 32\") ;chaos ember speck lv8 ;inputConsole(\"item tl2_chaosember_rank2, 32\") ;chaos ember chip lv22 ;inputConsole(\"item tl2_chaosember_rank3, 32\") ;chaos ember shard lv36 ;inputConsole(\"item tl2_chaosember_rank4, 32\") ;chaos ember lv50 ;inputConsole(\"item tl2_chaosember_rank5, 32\") ;giant chaos ember lv64 ;inputConsole(\"item tl2_chaosember_rank7, 32\") ;giant chaos ember lv92 ;inputConsole(\"item tl2_ironember_rank7, 32\") ;giant iron ember lv92 ;inputConsole(\"item tl2_eyeofwinterwidow, 4\") ;the eye of winter widow lv11 ;inputConsole(\"item tl2_eyeofstennbrun, 4\") ;the eye of the stennbrun lv13 ;inputConsole(\"item tl2_eyeofgrell, 4\") ;eye of grell lv12 ;inputConsole(\"item tl2_eyeofthewerewolf, 4\") ;the eye of the grizzled alpha lv39 ;inputConsole(\"item tl2_eyeofsister_aleera, 32\") ;eye of aleera lv47 ;inputConsole(\"item tl2_eyeofdarkalchemist, 4\") ;the eye of the dark alchemist lv48 ;inputConsole(\"item tl2_eyeofnetherlord, 4\") ;the eye of the netherlord lv50 ;inputConsole(\"item tl2_skull011, 4\") ;skull of festuur lv27 ;inputConsole(\"item tl2_skull021, 4\") ;skull of karandir lv52 ;inputConsole(\"item tl2_skull023, 4\") ;skull of limoany lv55 ;inputConsole(\"item tl2_skull024, 4\") ;lovantine skull lv57 ;inputConsole(\"item tl2_skull025, 4\") ;skull of macaburg lv58 ;inputConsole(\"item tl2_skull026, 4\") ;meerko skull lv60 ;inputConsole(\"item tl2_skull034, 4\") ;qzmoda skull lv72 ;inputConsole(\"item tl2_skull035, 4\") ;skull of reichliu lv73 ;inputConsole(\"item tl2_skull036, 4\") ;rambren skull lv75 ;inputConsole(\"item tl2_skull040, 4\") ;tibbeek skull lv81 ;inputConsole(\"item tl2_skull043, 4\") ;skull of vastok lv85 ;inputConsole(\"item tl2_skull044, 4\") ;vellinique skull lv87 ;inputConsole(\"item tl2_skull045, 4\") ;skull of whorlbarb lv88 ;inputConsole(\"item tl2_skull046, 4\") ;wfuntir skull lv90 ;inputConsole(\"item tl2_skull047, 4\") ;skull of x'n!troph lv91 ;inputConsole(\"item tl2_skull051, 4\") ;skull of zardon lv97 ;inputConsole(\"item tl2_skull052, 4\") ;zardon's mighty skull lv99 ;pet ;inputConsole(\"item petcollar_u13, 32\") ;epic collar lv99 ;inputConsole(\"item pettag_u13, 32\") ;epic stud lv98 ;inputConsole(\"item petcollar_u01, 32\") ;epic collar lv4 ;inputConsole(\"item pettag_u01, 32\") ;epic stud lv3 ;set valkyrie ;inputConsole(\"item light_g_chest_alt_set, 32\") ;valkyrie armor lv96 ;inputConsole(\"item light_g_belt_alt_set, 32\") ;valkyrie belt lv96 ;inputConsole(\"item light_g_boots_alt_set, 32\") ;valkyrie boots lv96 ;inputConsole(\"item light_g_pants_alt_set, 32\") ;valkyrie pants lv96 ;inputConsole(\"item light_g_ring_alt_set, 32\") ;valkyrie ring lv96 ;inputConsole(\"item light_g_shoulders_alt_set, 32\") ;valkyrie shoulders lv96 ;inputConsole(\"item light_g_amulet_alt_set, 32\") ;valkyrie amulet lv96 ;inputConsole(\"item light_g_gloves_alt_set, 32\") ;valkyrie gloves lv96 ;inputConsole(\"item light_g_helmet_alt_set, 32\") ;valkyrie helmet lv96 ;set dragonrift ;inputConsole(\"item medium_g_chest_alt_set, 1\") ;dragonrift armor lv94 ;inputConsole(\"item medium_g_belt_alt_set, 1\") ;dragonrift belt lv94 ;inputConsole(\"item medium_g_boots_alt_set, 1\") ;dragonrift boots lv94 ;inputConsole(\"item medium_g_pants_alt_set, 1\") ;dragonrift pants lv94 ;inputConsole(\"item medium_g_ring_alt_set, 1\") ;dragonrift ring lv94 ;inputConsole(\"item medium_g_shoulders_alt_set, 1\") ;dragonrift shoulders lv94 ;inputConsole(\"item medium_g_amulet_alt_set, 1\") ;dragonrift amulet lv94 ;inputConsole(\"item medium_g_gloves_alt_set, 1\") ;dragonrift gloves lv94 ;inputConsole(\"item medium_g_helmet_alt_set, 1\") ;dragonrift helmet lv94 ;set inquisitor ;inputConsole(\"item cloth_g_chest_alt_set, 32\") ;inquisitor armor lv92 ;inputConsole(\"item cloth_g_belt_alt_set, 32\") ;inquisitor belt lv92 ;inputConsole(\"item cloth_g_boots_alt_set, 32\") ;inquisitor boots lv92 ;inputConsole(\"item cloth_g_pants_alt_set, 32\") ;inquisitor pants lv92 ;inputConsole(\"item cloth_g_ring_alt_set, 32\") ;inquisitor ring lv92 ;inputConsole(\"item cloth_g_shoulders_alt_set, 32\") ;inquisitor shoulders lv92 ;inputConsole(\"item cloth_g_amulet_alt_set, 32\") ;inquisitor amulet lv92 ;inputConsole(\"item cloth_g_gloves_alt_set, 32\") ;inquisitor gloves lv92 ;inputConsole(\"item cloth_g_helmet_alt_set, 32\") ;inquisitor helmet lv92 ;set aristocrat (no amulet) ;inputConsole(\"item pimp_01_chest_alt_set, 1\") ;aristocrat armor lv91 ;inputConsole(\"item pimp_01_belt_alt_set, 32\") ;aristocrat belt lv91 ;inputConsole(\"item pimp_01_boots_alt_set, 1\") ;aristocrat boots lv91 ;inputConsole(\"item pimp_01_pants_alt_set, 1\") ;aristocrat pants lv91 ;inputConsole(\"item pimp_01_ring_alt_set, 32\") ;aristocrat ring lv91 ;inputConsole(\"item pimp_01_shoulders_alt_set, 1\") ;aristocrat shoulders lv91 ;inputConsole(\"item pimp_01_gloves_alt_set, 1\") ;aristocrat gloves lv91 ;inputConsole(\"item pimp_01_helmet_alt_set, 1\") ;aristocrat helmet lv91 ;set sentinel ;inputConsole(\"item vanquisher_01_chest_alt_set, 32\") ;sentinel armor lv58 ;inputConsole(\"item vanquisher_01_belt_alt_set, 32\") ;sentinel belt lv58 ;inputConsole(\"item vanquisher_01_boots_alt_set, 32\") ;sentinel boots lv58 ;inputConsole(\"item vanquisher_01_pants_alt_set, 32\") ;sentinel pants lv58 ;inputConsole(\"item vanquisher_01_ring_alt_set, 32\") ;sentinel ring lv58 ;inputConsole(\"item vanquisher_01_shoulders_alt_set, 32\") ;sentinel shoulders lv58 ;inputConsole(\"item vanquisher_01_amulet_alt_set, 32\") ;sentinel amulet lv58 ;inputConsole(\"item vanquisher_01_gloves_alt_set, 32\") ;sentinel gloves lv58 ;inputConsole(\"item vanquisher_01_helmet_alt_set, 32\") ;sentinel helmet lv58 ;set exorcist ;inputConsole(\"item varkolyn_01_chest_alt_set, 32\") ;exorcist armor lv44 ;inputConsole(\"item varkolyn_01_belt_alt_set, 32\") ;exorcist belt lv44 ;inputConsole(\"item varkolyn_01_boots_alt_set, 32\") ;exorcist boots lv44 ;inputConsole(\"item varkolyn_01_pants_alt_set, 32\") ;exorcist pants lv44 ;inputConsole(\"item varkolyn_01_ring_alt_set, 32\") ;exorcist ring lv44 ;inputConsole(\"item varkolyn_01_shoulders_alt_set, 32\") ;exorcist shoulders lv44 ;inputConsole(\"item varkolyn_01_amulet_alt_set, 32\") ;exorcist amulet lv44 ;inputConsole(\"item varkolyn_01_gloves_alt_set, 32\") ;exorcist gloves lv44 ;inputConsole(\"item varkolyn_01_helmet_alt_set, 32\") ;exorcist helmet lv44 ;set ironlord ;inputConsole(\"item stone_01_amulet_alt_set, 32\") ;granite amulet lv37 ;inputConsole(\"item stone_01_ring_alt_set, 32\") ;granite ring lv37 ;inputConsole(\"item stone_01_belt_alt_set, 32\") ;granite belt lv37 ;set janissary ;inputConsole(\"item dezrohir_02_belt_alt_set, 32\") ;janissary belt lv34 ;inputConsole(\"item dezrohir_02_amulet_alt_set, 32\") ;janissary amulet lv34 ;inputConsole(\"item dezrohir_02_ring_alt_set, 32\") ;janissary ring lv34 ;set ezrohir ;inputConsole(\"item dezrohir_01_chest_alt_set, 32\") ;ezrohir armor lv30 ;inputConsole(\"item dezrohir_01_belt_alt_set, 32\") ;ezrohir belt lv30 ;inputConsole(\"item dezrohir_01_boots_alt_set, 32\") ;ezrohir boots lv30 ;inputConsole(\"item dezrohir_01_pants_alt_set, 32\") ;ezrohir pants lv30 ;inputConsole(\"item dezrohir_01_ring_alt_set, 32\") ;ezrohir ring lv30 ;inputConsole(\"item dezrohir_01_shoulders_alt_set, 32\") ;ezrohir shoulders lv30 ;inputConsole(\"item dezrohir_01_amulet_alt_set, 32\") ;ezrohir amulet lv30 ;inputConsole(\"item dezrohir_01_gloves_alt_set, 32\") ;ezrohir gloves lv30 ;inputConsole(\"item dezrohir_01_helmet_alt_set, 32\") ;ezrohir helmet lv30 ;set clovenhoof ;inputConsole(\"item furhide_01_chest_alt_set, 32\") ;clovenhoof armor lv15 ;inputConsole(\"item furhide_01_belt_alt_set, 32\") ;clovenhoof belt lv15 ;inputConsole(\"item furhide_01_boots_alt_set, 32\") ;clovenhoof boots lv15 ;inputConsole(\"item furhide_01_pants_alt_set, 32\") ;clovenhoof pants lv15 ;inputConsole(\"item furhide_01_ring_alt_set, 32\") ;clovenhoof ring lv15 ;inputConsole(\"item furhide_01_shoulders_alt_set, 32\") ;clovenhoof shoulders lv15 ;inputConsole(\"item furhide_01_amulet_alt_set, 32\") ;clovenhoof amulet lv15 ;inputConsole(\"item furhide_01_gloves_alt_set, 32\") ;clovenhoof gloves lv15 ;inputConsole(\"item furhide_01_helmet_alt_set, 32\") ;clovenhoof helmet lv15 ;set runemaster ;inputConsole(\"item sturm_01_chest_alt_set, 32\") ;runemaster armor lv7 ;inputConsole(\"item sturm_01_belt_alt_set, 32\") ;runemaster belt lv7 ;inputConsole(\"item sturm_01_boots_alt_set, 32\") ;runemaster boots lv7 ;inputConsole(\"item sturm_01_pants_alt_set, 32\") ;runemaster pants lv7 ;inputConsole(\"item sturm_01_ring_alt_set, 32\") ;runemaster ring lv7 ;inputConsole(\"item sturm_01_shoulders_alt_set, 32\") ;runemaster shoulders lv7 ;inputConsole(\"item sturm_01_amulet_alt_set, 32\") ;runemaster amulet lv7 ;inputConsole(\"item sturm_01_gloves_alt_set, 32\") ;runemaster gloves lv7 ;inputConsole(\"item sturm_01_helmet_alt_set, 32\") ;runemaster helmet lv7 ;inputConsole(\"item zzz_sturm_01_helmet_alt_b, 1\") ;general grell's headpiece lv9 ;set ghastly ;inputConsole(\"item zzz_ghastly_boots, 1\") ;ghastly boots lv5 ;inputConsole(\"item zzz_ghastly_shoulders, 1\") ;ghastly shoulders lv5 ;inputConsole(\"item zzz_ghastly_gloves, 1\") ;ghastly gloves lv5 ;set emberweave ;inputConsole(\"item caster_05_chest_alt_set, 1\") ;emberweave armor lv70 ;inputConsole(\"item caster_05_belt_alt_set, 1\") ;emberweave belt lv70 ;inputConsole(\"item caster_05_boots_alt_set, 1\") ;emberweave boots lv70 ;inputConsole(\"item caster_05_pants_alt_set, 1\") ;emberweave pants lv70 ;inputConsole(\"item caster_05_ring_alt_set, 2\") ;emberweave ring lv75 ;inputConsole(\"item caster_05_shoulders_alt_set, 1\") ;emberweave shoulders lv70 ;inputConsole(\"item caster_05_amulet_alt_set, 1\") ;emberweave amulet lv70 ;inputConsole(\"item caster_05_gloves_alt_set, 1\") ;emberweave gloves lv70 ;inputConsole(\"item caster_05_helmet_alt_set, 1\") ;emberweave helmet lv70 ;set trancendent ;inputConsole(\"item caster_06_chest_alt_set, 1\") ;trancendent armor lv99 ;inputConsole(\"item caster_06_belt_alt_set, 1\") ;trancendent belt lv99 ;inputConsole(\"item caster_06_boots_alt_set, 1\") ;trancendent boots lv99 ;inputConsole(\"item caster_06_pants_alt_set, 1\") ;trancendent pants lv99 ;inputConsole(\"item caster_06_ring_alt_set, 2\") ;trancendent ring lv99 ;inputConsole(\"item caster_06_shoulders_alt_set, 1\") ;trancendent shoulders lv99 ;inputConsole(\"item caster_06_amulet_alt_set, 1\") ;trancendent amulet lv99 ;inputConsole(\"item caster_06_gloves_alt_set, 1\") ;trancendent gloves lv99 ;inputConsole(\"item caster_06_helmet_alt_set, 1\") ;trancendent helmet lv99 ;set ascendant ;inputConsole(\"item caster_x07_chest, 1\") ;ascendant armor lv105 ;inputConsole(\"item caster_x07_belt, 1\") ;ascendant belt lv105 ;inputConsole(\"item caster_x07_boots, 1\") ;ascendant boots lv105 ;inputConsole(\"item caster_x07_pants, 1\") ;ascendant pants lv105 ;inputConsole(\"item caster_x07_shoulders, 1\") ;ascendant shoulders lv105 ;inputConsole(\"item caster_x07_gloves, 1\") ;ascendant gloves lv105 ;inputConsole(\"item caster_x07_helmet, 1\") ;ascendant helmet lv105 ;set draketalon ;inputConsole(\"item berserker_x07_chest, 1\") ;draketalon armor lv105 ;inputConsole(\"item berserker_x07_belt, 1\") ;draketalon belt lv105 ;inputConsole(\"item berserker_x07_boots, 1\") ;draketalon boots lv105 ;inputConsole(\"item berserker_x07_pants, 1\") ;draketalon pants lv105 ;inputConsole(\"item berserker_x07_shoulders, 1\") ;draketalon shoulders lv105 ;inputConsole(\"item berserker_x07_gloves, 1\") ;draketalon gloves lv105 ;inputConsole(\"item berserker_x07_helmet, 1\") ;draketalon helmet lv105 ;set outercore ;inputConsole(\"item engineer_x07_chest, 1\") ;outercore armor lv105 ;inputConsole(\"item engineer_x07_belt, 1\") ;outercore belt lv105 ;inputConsole(\"item engineer_x07_boots, 1\") ;outercore boots lv105 ;inputConsole(\"item engineer_x07_pants, 1\") ;outercore pants lv105 ;inputConsole(\"item engineer_x07_shoulders, 1\") ;outercore shoulders lv105 ;inputConsole(\"item engineer_x07_gloves, 1\") ;outercore gloves lv105 ;inputConsole(\"item engineer_x07_helmet, 1\") ;outercore helmet ;set dominion ;inputConsole(\"item wanderer_x07_chest, 1\") ;dominion armor lv105 ;inputConsole(\"item wanderer_x07_belt, 1\") ;dominion belt lv105 ;inputConsole(\"item wanderer_x07_boots, 1\") ;dominion boots lv105 ;inputConsole(\"item wanderer_x07_pants, 1\") ;dominion pants lv105 ;inputConsole(\"item wanderer_x07_shoulders, 1\") ;dominion shoulders lv105 ;inputConsole(\"item wanderer_x07_gloves, 1\") ;dominion gloves lv105 ;inputConsole(\"item wanderer_x07_helmet, 1\") ;dominion helmet lv105 ;sturmbeorn ;inputConsole(\"item sturm_01_ring_p_alt_c, 32\") ;sturmbeorn ring lv9 ;inputConsole(\"item sturm_01_ring_f_alt_c, 32\") ;sturmbeorn ring lv9 ;inputConsole(\"item sturm_01_amulet_p_alt_c, 32\") ;sturmbeorn amulet lv9 ;inputConsole(\"item sturm_01_chest_alt_c, 32\") ;sturmbeorn armor lv9 ;inputConsole(\"item sturm_01_belt_alt_c, 32\") ;sturmbeorn belt lv9 ;inputConsole(\"item sturm_01_boots_alt_c, 32\") ;sturmbeorn boots lv9 ;inputConsole(\"item sturm_01_pants_alt_c, 32\") ;sturmbeorn pants lv9 ;inputConsole(\"item sturm_01_shoulders_alt_c, 32\") ;sturmbeorn shoulders lv9 ;inputConsole(\"item sturm_01_gloves_alt_c, 32\") ;sturmbeorn gloves lv9 ;inputConsole(\"item sturm_01_helmet_alt_c, 32\") ;sturmbeorn helmet lv9 inputGetItem() return } ^+d:: ;ctrl+shift+a buy item { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"buy item\") inputBuyItem(99) return } ^+f:: ;ctrl+shift+f { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"fish\") inputFish() return } ^+g:: ;ctrl+shift+g { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"sell item\") inputMoveItemFromPlayerInventory(true) return } ^+h:: ;ctrl+shift+h { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"hunt\") inputHunt() return } ^+j:: ;ctrl+shift+j console { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"console\") ;monster inputConsole(\"monster boss_spider_cave, 24\") ;inputConsole(\"monster boss_werewolf, 1\") ;inputConsole(\"monster boss_map_artificer, 1\") ;inputConsole(\"monster boss_map_robot, 1\") ;inputConsole(\"monster boss_map_wraithlord, 1\") ;inputConsole(\"monster boss_map_dragon, 1\") ;inputConsole(\"monster boss_map_spectraldragon, 1\") ;inputConsole(\"monster boss_netherim_shadow, 1\") Sleep, 10 pressKey(\"f\", KEYPRESS, 10) ;use best potion pressKey(\"Shift\", KEYDOWN, 10) pressKeyCustom(\"q\", KEYPRESS, 2000, 10) ;use skill pressKey(\"Shift\", KEYUP, 10) return } ^+l:: ;ctrl+shift+l { if !WinActive(\"ahk_exe Torchlight2.exe\") return initHotkey(\"login game\") inputLoginGame() inputShowInternetGame() return } ^+z:: ;ctrl+shift+tz { initHotkey(\"test\") test() return } ^+c:: ;ctrl+shift+c { initHotkey(\"get pixel color\") getPixelColor(\"\", \"\") return } ^+v:: ;ctrl+shift+v { initHotkey(\"is image from coordinate\") isImageFromCoordinate(0, 0, A_ScreenWidth, A_ScreenHeight, POWERFUL_FILE) return } ^+b:: ;ctrl+shift+b { initHotkey(\"get text from ocr\") getTextFromOcr(0, 0, A_ScreenWidth, A_ScreenHeight) return } ^+n:: ;ctrl+shift+n copy item { if !WinActive(\"ahk_exe TL2StashNinja.exe\") return initHotkey(\"copy item\") inputBuyItem(39) Sleep, 2500 if WinExist(\"ahk_exe Torchlight2.exe\") WinActivate Sleep, 3000 inputCreateGame(false) return } ^+p:: ;ctrl+shift+p { initHotkey(\"pause\") Pause return } ^+r:: ;ctrl+shift+r { Reload return } ^+x:: ;ctrl+shift+x { initHotkey(\"exitapp\") ExitApp } ;------------------------------------------------------------------------------- ; timers ;------------------------------------------------------------------------------- inputAutoTimer: ;timer input auto { if !WinActive(\"ahk_exe Torchlight2.exe\") return if isColorFromPixel(6, 6, \"0x000000\") || isColorFromPixel(6, 6, \"0x02051F\") { ;loading or dead m_IsLoading := true return } if !isColorFromPixel(6, 6, \"0x060818\") { ;in game pet portrait m_LastDervish6 := A_TickCount - 20000 m_LastDervish5 := A_TickCount - 18000 m_LastDervish4 := A_TickCount - 16000 return } showToolTip(DEBUG, \"inputAutoTimer:\") ;characterPreset := \"uf1sokbz\" ;characterPreset := \"xrpjzo2c\" ;characterPreset := \"jaq3gmvf\" ;characterPreset := \"nswh4rcj\" ;characterPreset := \"cxteb5uk\" characterPreset := \"zm6ahnbf\" ;characterPreset := \"f7ybsowu\" ;characterPreset := \"dajx8vtg\" isAutoHealthPotion := true isAutoManaPotion := true isAutoPetPotion := false isAutoSkill := true isAutoAttack := true isDervish6 := true isDervish5 := true isDervish4 := true lowHealth90Coord := [38, 522] ;90% lowMana90Coord := [754, 522] ;90% lowHealth66Coord := [38, 543] ;66% lowMana66Coord := [754, 543] ;66% lowHealth33Coord := [38, 568] ;33% lowMana33Coord := [754, 568] ;33% lowPetHealthCoord := [38, 10] lowPetManaCoord := [38, 22] skill1Coord := [251, 575] skillXObj := [] activeskillCoord := [606, 582] berserkerChargeCoord := [474, 508] embermageChargeCoord := [467, 510] engineerChargeCoord := [467, 510] outlanderChargeCoord := [478, 516] loop, 10 { skillXObj.insert(skill1Coord[X] + ((A_Index - 1) * 34)) } if isAutoHealthPotion { if !isColorFromPixel(lowHealth66Coord[X], lowHealth66Coord[Y], \"0x082BFE\") { if ((A_TickCount - m_LastHDrinkHealth) \u003e= 8000) { ;potion cooldown 8s pressKeyCustom(\"z\", KEYPRESS, 1, 1) ;use best potion m_LastHDrinkHealth := A_TickCount m_LastHDrinkHealth := A_TickCount showToolTip(INFO, \"inputAuto() lowHealth66\") } } } if isAutoManaPotion { if !isColorFromPixel(lowMana66Coord[X], lowMana66Coord[Y], \"0xFC0536\") { if ((A_TickCount - m_LastHDrinkMana) \u003e= 8000) { ;potion cooldown 8s pressKeyCustom(\"x\", KEYPRESS, 1, 1) ;use best potion m_LastHDrinkMana := A_TickCount showToolTip(INFO, \"inputAuto() lowMana33\") } } } if isAutoSkill { if isColorFromPixel(skillXObj[KEY_1], skill1Coord[Y], \"0x6B8A9C\") ;haste pressKeyCustom(\"1\", KEYPRESS, 1, 1) ;use skill if isDervish6 \u0026\u0026 ((A_TickCount - m_LastDervish4) \u003e= 16000) \u0026\u0026 isColorFromPixel(skillXObj[2], skill1Coord[Y], \"0x6A8DA3\") { ;devish vi pressKeyCustom(\"2\", KEYPRESS, 1, 1) ;use skill m_LastDervish6 := A_TickCount } else if isDervish5 \u0026\u0026 ((A_TickCount - m_LastDervish6) \u003e= 20000) \u0026\u0026 !isColorFromPixel(skillXObj[2], skill1Coord[Y], \"0x6A8DA3\") \u0026\u0026 isColorFromPixel(skillXObj[3], skill1Coord[Y], \"0x6A8DA3\") { ;devish v pressKeyCustom(\"3\", KEYPRESS, 1, 1) ;use skill m_LastDervish5 := A_TickCount } else if isDervish4 \u0026\u0026 ((A_TickCount - m_LastDervish5) \u003e= 18000) \u0026\u0026 !isColorFromPixel(skillXObj[2], skill1Coord[Y], \"0x6A8DA3\") \u0026\u0026 !isColorFromPixel(skillXObj[3], skill1Coord[Y], \"0x6A8DA3\") \u0026\u0026 isColorFromPixel(skillXObj[4], skill1Coord[Y], \"0x6A8DA3\") { ;devish iv pressKeyCustom(\"4\", KEYPRESS, 1, 1) ;use skill m_LastDervish4 := A_TickCount } if (characterPreset = \"uf1sokbz\") { ;if isColorFromPixel(embermageChargeCoord[X], embermageChargeCoord[Y], \"0x416262\") { ;embermage chargebar ;} if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { ;if !isColorFromPixel(lowMana66Coord[X], lowMana66Coord[Y], \"0xFC0536\") || !isColorFromPixel(lowHealth66Coord[X], lowHealth66Coord[Y], \"0x082BFE\") { ; if isColorFromPixel(skillXObj[KEY_W], skill1Coord[Y], \"0x003473\") { ;death's bounty ; pressKeyCustom(\"w\", KEYPRESS, 1, 1) ;use skill ; } ;} if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0xC1E6FF\") ;blazing pillar pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"a\", \"P\") { pressKeyCustom(\"q\", KEYPRESS, 500, \"\") } else if GetKeyState(\"s\", \"P\") { if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0xF7DF8F\") ;ice prison pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_W], skill1Coord[Y], \"0x630608\") ;hailstorm pressKeyCustom(\"w\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_D], skill1Coord[Y], \"0x00119D\") ;firestorm pressKeyCustom(\"d\", KEYPRESS, 1, 1) ;use skill } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0xB34205\") ;frost phase pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"xrpjzo2c\") { if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0x3B2A21\") ;iceshield pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if isColorFromPixel(berserkerChargeCoord[X], berserkerChargeCoord[Y], \"0x082F4C\") ;berserker chargebar pressKeyCustom(\"w\", KEYPRESS, 1, 1) if GetKeyState(\"a\", \"P\") { pressKeyCustom(\"q\", KEYPRESS, 1, \"\") } else if GetKeyState(\"s\", \"P\") { pressKeyCustom(\"r\", KEYPRESS, 1, \"\") } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0x69208B\") ;shadow burst pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"jaq3gmvf\") { if m_IsLoading { clickMouseCustom(\"\", \"\", \"Left\", 1, 500) ;use skill pressKeyCustom(\"y\", KEYPRESS, 1, 1) ;swap active skill clickMouseCustom(\"\", \"\", \"Left\", 1, 1) ;use skill m_IsLoading := false } if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0xFA6039\") ;forcefield pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if GetKeyState(\"a\", \"P\") { ;if isColorFromPixel(skillXObj[KEY_W], skill1Coord[Y], \"0x000C6E\") ;emberquake pressKeyCustom(\"w\", KEYPRESS, 1, 1) ;use skill pressKeyCustom(\"q\", KEYPRESS, 1, \"\") ;use skill } else if GetKeyState(\"s\", \"P\") { ;if isColorFromPixel(engineerChargeCoord[X], engineerChargeCoord[Y], \"0x22699D\") { ;engineer chargebar ; if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0x536C40\") ;dynamo field ; pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill ;} ;if isColorFromPixel(skillXObj[KEY_D], skill1Coord[Y], \"0xEF1862\") ;emberreach pressKeyCustom(\"d\", KEYPRESS, 1, 1) ;use skill pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0xDB301B\") ;storm burst pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"nswh4rcj\") { if isColorFromPixel(activeskillCoord[X], activeskillCoord[Y], \"0x6E1515\") ;shadowmantle clickMouseCustom(\"\", \"\", \"Left\", 1, 1) ;use skill ;use skil if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if !isColorFromPixel(lowMana66Coord[X], lowMana66Coord[Y], \"0xFC0536\") ;auto attack when low mana clickMouseCustom(\"\", \"\", \"Right\", 1, 1) ;click auto attack if GetKeyState(\"a\", \"P\") { if isColorFromPixel(outlanderChargeCoord[X], outlanderChargeCoord[Y], \"0x000E21\") ;outlander chargebar pressKeyCustom(\"w\", KEYPRESS, 500, \"\") ;use skill else pressKeyCustom(\"q\", KEYPRESS, 500, \"\") ;use skill } else if GetKeyState(\"s\", \"P\") { if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0x182634\") ;bramble wall pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0x263424\") ;stone pact pressKeyCustom(\"f\", KEYPRESS, 1, \"\") ;use skill if isColorFromPixel(skillXObj[KEY_D], skill1Coord[Y], \"0x140D7E\") ;blade pact pressKeyCustom(\"d\", KEYPRESS, 1, 1) ;use skill } } if GetKeyState(\"c\", \"P\") { } } else if (characterPreset = \"cxteb5uk\") { if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0xC1E6FF\") ;blazing pillar pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"a\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0xB34205\") ;frost phase pressKeyCustom(\"e\", KEYPRESS, 1, 1) pressKeyCustom(\"q\", KEYPRESS, 500, \"\") } else if GetKeyState(\"s\", \"P\") { if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0xF7DF8F\") ;ice prison pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_W], skill1Coord[Y], \"0x630608\") ;hailstorm pressKeyCustom(\"w\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_D], skill1Coord[Y], \"0x00119D\") ;firestorm pressKeyCustom(\"d\", KEYPRESS, 1, 1) ;use skill } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0xB34205\") ;frost phase pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"zm6ahnbf\") { if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0x3B2A21\") ;iceshield pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if isColorFromPixel(berserkerChargeCoord[X], berserkerChargeCoord[Y], \"0x082F4C\") ;berserker chargebar pressKeyCustom(\"w\", KEYPRESS, 1, 1) if GetKeyState(\"a\", \"P\") { pressKeyCustom(\"q\", KEYPRESS, 1, \"\") } else if GetKeyState(\"s\", \"P\") { pressKeyCustom(\"r\", KEYPRESS, 1, \"\") } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0x69208B\") ;shadow burst pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"f7ybsowu\") { if m_IsLoading { clickMouseCustom(\"\", \"\", \"Left\", 1, 500) ;use skill pressKeyCustom(\"y\", KEYPRESS, 1, 1) ;swap active skill clickMouseCustom(\"\", \"\", \"Left\", 1, 1) ;use skill m_IsLoading := false } if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0xFA6039\") ;forcefield pressKeyCustom(\"f\", KEYPRESS, 1, 1) ;use skill if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if GetKeyState(\"a\", \"P\") { } else if GetKeyState(\"s\", \"P\") { if isColorFromPixel(engineerChargeCoord[X], engineerChargeCoord[Y], \"0x22699D\") { ;engineer chargebar if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0x536C40\") ;dynamo field pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill } } } if GetKeyState(\"c\", \"P\") { if isColorFromPixel(skillXObj[KEY_E], skill1Coord[Y], \"0xDB301B\") ;storm burst pressKeyCustom(\"e\", KEYPRESS, 1, 1) } } else if (characterPreset = \"dajx8vtg\") { if isColorFromPixel(activeskillCoord[X], activeskillCoord[Y], \"0x6E1515\") ;shadowmantle clickMouseCustom(\"\", \"\", \"Left\", 1, 1) ;use skill ;use skil if GetKeyState(\"LButton\", \"P\") return if GetKeyState(\"a\", \"P\") || GetKeyState(\"s\", \"P\") { if !isColorFromPixel(lowMana66Coord[X], lowMana66Coord[Y], \"0xFC0536\") ;auto attack when low mana clickMouseCustom(\"\", \"\", \"Right\", 1, 1) ;click auto attack if GetKeyState(\"a\", \"P\") { if isColorFromPixel(skillXObj[KEY_W], skill1Coord[Y], \"0x014311\") ;venomous hail pressKeyCustom(\"w\", KEYPRESS, 1, 1) ;use skill pressKeyCustom(\"q\", KEYPRESS, 500, \"\") ;use skill } else if GetKeyState(\"s\", \"P\") { if isColorFromPixel(skillXObj[KEY_R], skill1Coord[Y], \"0x182634\") ;bramble wall pressKeyCustom(\"r\", KEYPRESS, 1, 1) ;use skill if isColorFromPixel(skillXObj[KEY_F], skill1Coord[Y], \"0x263424\") ;stone pact pressKeyCustom(\"f\", KEYPRESS, 1, \"\") ;use skill if isColorFromPixel(skillXObj[KEY_D], skill1Coord[Y], \"0x140D7E\") ;blade pact pressKeyCustom(\"d\", KEYPRESS, 1, 1) ;use skill } } if GetKeyState(\"c\", \"P\") { } } } if isAutoAttack { clickMouseCustom(\"\", \"\", \"Right\", 1, \"\") ;click auto attack } if isAutoPetPotion { if !isColorFromPixel(lowPetHealthCoord[X], lowPetHealthCoord[Y], \"0x0000DA\") { if ((A_TickCount - m_LastHDrinkPetHealth) \u003e= 8000) { pressKeyCustom(\"Shift\", KEYDOWN, 1, 1) pressKeyCustom(\"z\", KEYPRESS, 1, 1) ;use best potion pressKeyCustom(\"Shift\", KEYUP, 1, 1) m_LastHDrinkPetHealth := A_TickCount } } if !isColorFromPixel(lowPetManaCoord[X], lowPetManaCoord[Y], \"0xC9012F\") { if ((A_TickCount - m_LastHDrinkPetMana) \u003e= 8000) { pressKeyCustom(\"Shift\", KEYDOWN, 1, 1) pressKeyCustom(\"x\", KEYPRESS, 1, 1) ;use best potion pressKeyCustom(\"Shift\", KEYUP, 1, 1) m_LastHDrinkPetMana := A_TickCount } } } } removeTooltipTimer: ;timer remove tooltip { ToolTip return } ;------------------------------------------------------------------------------- ; input functions ;------------------------------------------------------------------------------- /* input chat inputChat(\"/help\") ;displays many commands that are gameplay related inputChat(\"/blowkiss\") ;your character blows a kiss inputChat(\"/bow\") ;your character takes a bow inputChat(\"/breakdance\") ;your character breakdances inputChat(\"/burp\") ;your character burps inputChat(\"/cls\") ;clears the chat inputChat(\"/clueless\") ;your character acts clueless inputChat(\"/cmon\") ;your character impatiently beckons someone to follow inputChat(\"/cough\") ;your character coughs inputChat(\"/cry\") ;your character starts crying inputChat(\"/dance\") ;your character does a little dance until you move or do something else inputChat(\"/despair\") ;your character loses all hope inputChat(\"/drums\") ;your character plays some imaginary drums inputChat(\"/emote\") ;functions like a /me command inputChat(\"/emotes\") ;displays many commands, but not all of them inputChat(\"/facepalm\") ;your character facepalms inputChat(\"/gunshow\") ;your character shows his guns arms inputChat(\"/jump\") ;your character tries to jump but can't inputChat(\"/laugh\") ;your character laughs inputChat(\"/lute\") ;your character plays on an imaginary lute inputChat(\"/oops\") ;your character says oops inputChat(\"/roll\") ;you roll a 1d100 inputChat(\"/salute\") ;your character salutes inputChat(\"/slap\") ;your character slaps someone's face inputChat(\"/slowclap\") ;your character claps ironically inputChat(\"/taunt\") ;your character does a taunt inputChat(\"/victory\") ;your character acts victorious inputChat(\"/wave\") ;your character waves inputChat(\"/whathaveidone\") ;your character falls to his knees in dispair inputChat(\"/pvp\") ;toggles pvp flag */ inputChat(chat) { pressKey(\"Enter\", KEYPRESS, 100) pressKey(chat, KEYRAW, 100) ;press chat pressKey(\"Enter\", KEYPRESS, 100) } /* input hunt ng cycle skeleton level ng: lv55, ng+2:81, ng+3:100, ng+4: lv120, ng+5: lv120 registering a potion on a hotkey and turn on cheat engine unlimited hotbar consume switch pet to be passive toggle item filter */ inputHunt() { MouseGetPos, itemX, itemY loop { loop, 20 { clickMouse(itemX, itemY, \"Right\", 10) ;spawn skeleton } Sleep, 10 pressKey(\"f\", KEYPRESS, 10) ;use best potion pressKey(\"Shift\", KEYDOWN, 10) moveMouse(itemX, itemY - 80, 10) ;to avoid interfering with image search ;pressKeyCustom(\"q\", KEYPRESS, 500, 10) ;use skill pressKeyCustom(\"q\", KEYPRESS, 500, 10) ;use skill pressKey(\"Shift\", KEYUP, 10) } } /* input buy item */ inputBuyItem(times) { MouseGetPos, itemX, itemY pressKey(\"Shift\", KEYDOWN, 40) ;buy item loop, % times { clickMouse(itemX, itemY, \"Left\", 40) ;click buy item } pressKey(\"Shift\", KEYUP, 40) ;buy item } /* input console */ inputConsole(command) { pressKey(\"Insert\", KEYPRESS, 40) ;open console pressKey(command, KEYRAW, 40) ;press command pressKey(\"Enter\", KEYPRESS, 40) ;press command pressKey(\"Insert\", KEYPRESS, 40) ;close console } /* input get item */ inputGetItem() { pressKey(\"Shift\", KEYDOWN, 40) ;select pet loop, { clickMouse(\"\", \"\", \"Right\", 1) ;click get item } pressKey(\"Shift\", KEYUP, 40) ;select pet } /* input login game */ inputLoginGame() { loginCoord := [765, 587] loginTitleCoord := [289, 174] passwordCursorCoord := [309, 324] clickMouse(loginCoord[X], loginCoord[Y], \"Left\", 100) ;click mainmenu login clickMouse(passwordCursorCoord[X], passwordCursorCoord[Y], \"Left\", 100) ;click cursor to password pressKey(LOGIN_PASSWORD, KEYRAW, 100) ;press password pressKey(\"Enter\", KEYPRESS, 100) ;press password sleepUntilPixelFound(false, loginTitleCoord[X], loginTitleCoord[Y], \"0x0A1A39\", 10, 5000) ;sleep until pixel not found } /* input show internet game */ inputShowInternetGame() { mainMenuResumeCoord := [397, 553] internetCoord := [397, 301] clickMouse(mainMenuResumeCoord[X], mainMenuResumeCoord[Y], \"Left\", 100) ;click mainmenu resume clickMouse(internetCoord[X], internetCoord[Y], \"Left\", 100) ;click cursor to password } /* input create game */ inputCreateGame(isReroll) { mainMenuResumeCoord := [397, 553] lanCoord := [397, 343] lanTitleCoord := [322, 41] lanCreateGameCoord := [654, 563] lanReRollCoord := [603, 305] lanCreateGameOkCoord := [639, 388] singlePlayerCoord := [397, 256] clickMouseCustom(mainMenuResumeCoord[X], mainMenuResumeCoord[Y], \"Left\", 100, 100) ;click mainmenu resume if isReroll { clickMouse(lanCoord[X], lanCoord[Y], \"Left\", 100) ;click mainmenu lan sleepUntilPixelFound(true, lanTitleCoord[X], lanTitleCoord[Y], \"0xFFFFFF\", 10, 5000) ;sleep until pixel found clickMouse(lanCreateGameCoord[X], lanCreateGameCoord[Y], \"Left\", 100) ;click mainmenu create game clickMouse(lanReRollCoord[X], lanReRollCoord[Y], \"Left\", 100) ;click mainmenu reroll clickMouse(lanCreateGameOkCoord[X], lanCreateGameOkCoord[Y], \"Left\", 100) ;click mainmenu ok } else { clickMouse(singlePlayerCoord[X], singlePlayerCoord[Y], \"Left\", 100) ;click mainmenu single player } } /* input save game */ inputSaveGame() { optionCoord := [789, 5] optionSaveCoord := [475, 412] pressKey(\"Esc\", KEYPRESS, 40) ;close clickMouse(optionCoord[X], optionCoord[Y], \"Left\", 100) ;click option clickMouse(optionSaveCoord[X], optionSaveCoord[Y], \"Left\", 100) ;click option save } /* input quit game */ inputQuitGame() { optionCoord := [789, 5] optionQuitCoord := [399, 344] mainMenuBottomLeftCoord := [21, 578] pressKey(\"Esc\", KEYPRESS, 40) ;close clickMouse(optionCoord[X], optionCoord[Y], \"Left\", 100) ;click option clickMouse(optionQuitCoord[X], optionQuitCoord[Y], \"Left\", 100) ;click option quit sleepUntilPixelFound(true, mainMenuBottomLeftCoord[X], mainMenuBottomLeftCoord[Y], \"0xFFFFFF\", 10, 5000) ;sleep until pixel found Sleep, 100 } /* input fish recommend toggle item fliter */ inputFish() { startTime := A_TickCount fishCoord := [397, 294] fishDialogCoord := [567, 214] fishDialogOkCoord := [584, 443] MouseGetPos, holeX, holeY Loop { totalCount++ clickMouseCustom(holeX, holeY, \"Right\", 100, 100) ;click well if !sleepUntilPixelFound(true, fishCoord[X], fishCoord[Y], \"0x232026\", 10, 3000) ;sleep until pixel found continue clickMouseCustom(fishCoord[X], fishCoord[Y], \"Left\", 100, 100) ;click fish button if !sleepUntilPixelFound(true, fishDialogCoord[X], fishDialogCoord[Y], \"0x00000C\", 10, 3000) ;sleep until pixel found continue clickMouseCustom(fishDialogOkCoord[X], fishDialogOkCoord[Y], \"Left\", 100, 100) ;click fish dialog button if (Mod(A_Index, 100) = 0) { endTime := A_TickCount - startTime message := \"inputFish() total:\" totalCount \", elapsedTime:\" formatHhmmss(endTime) \", speed/case:\" Round(endTime / totalCount) \"ms\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } } } /* input move item from merchant invetory */ inputMoveItemFromMerchantInvetory() { inventoryGap := [46, 46] merchantInventoryCoord := [26, 55] merchantColorObj := [\"0x081C18\", \"0x082421\", \"0x082925\", \"0x102C29\", \"0x082926\", \"0x082421\", \"0x082421\", \"0x081F1E\", \"0x081C18\", \"0x103029\", \"0x102F2B\", \"0x103431\", \"0x10332F\", \"0x103029\", \"0x082821\", \"0x08201B\", \"0x081E18\", \"0x102D29\", \"0x103431\", \"0x183C39\", \"0x113532\", \"0x10312B\", \"0x0B2A24\", \"0x082822\", \"0x082018\", \"0x10332E\", \"0x10312C\", \"0x10312B\", \"0x133734\", \"0x113631\", \"0x102E29\", \"0x082621\", \"0x081918\", \"0x082B29\", \"0x10302A\", \"0x103431\", \"0x103831\", \"0x10302E\", \"0x103029\", \"0x082521\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 10) ;to avoid interfering with image search pressKey(\"Shift\", KEYDOWN, 10) ;move item loop, 5 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x merchantInventoryIndex++ mouseX := merchantInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := merchantInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, merchantColorObj[merchantInventoryIndex]) continue else clickMouse(mouseX, mouseY, \"Left\", 10) ;click stash invetory item move to player } } pressKey(\"Shift\", KEYUP, 10) ;move item playBeep(3) } /* input move item from player invetory */ inputMoveItemFromPlayerInventory(isSell) { inventoryGap := [46, 46] playerInventoryCoord := [443, 341] petInventoryCoord := [26, 341] petSellAllCoord := [316, 526] playerInventoryColorObj := [\"0x132C42\", \"0x183C5A\", \"0x183F60\", \"0x1E4668\", \"0x184163\", \"0x214568\", \"0x214263\", \"0x1F3752\", \"0x18334A\", \"0x183C5A\", \"0x18405B\", \"0x183F60\", \"0x21496B\", \"0x194061\", \"0x214263\", \"0x15334C\", \"0x13304A\", \"0x184163\", \"0x214363\", \"0x1E4163\", \"0x21466B\", \"0x214865\", \"0x21415E\", \"0x183958\", \"0x102C42\", \"0x183852\", \"0x153452\", \"0x21415F\", \"0x183856\", \"0x1B3A57\", \"0x183552\", \"0x183452\"] petInventoryColorObj := [\"0x102C42\", \"0x193D5B\", \"0x183E5D\", \"0x1B4266\", \"0x184163\", \"0x214563\", \"0x214163\", \"0x1C3856\", \"0x18324A\", \"0x183C5A\", \"0x18415D\", \"0x204266\", \"0x214668\", \"0x1C4163\", \"0x214163\", \"0x183652\", \"0x102E46\", \"0x184163\", \"0x214363\", \"0x184163\", \"0x1E4668\", \"0x214968\", \"0x214161\", \"0x1F3C5A\", \"0x102A40\", \"0x183452\", \"0x113452\", \"0x21415C\", \"0x183A5A\", \"0x1A3A56\", \"0x133451\", \"0x183452\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 10) ;to avoid interfering with image search pressKey(\"Shift\", KEYDOWN, 10) ;move item loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x playerInventoryIndex++ mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, playerInventoryColorObj[playerInventoryIndex]) continue else clickMouse(mouseX, mouseY, \"Left\", 10) ;click player invetory item move to stash } } Sleep, 10 if isSell { clickMouse(petSellAllCoord[X], petSellAllCoord[Y], \"Left\", 10) ;click sell all pressKey(\"Shift\", KEYUP, 10) ;move item return } loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x petInventoryIndex++ mouseX := petInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := petInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, petInventoryColorObj[petInventoryIndex]) continue else clickMouse(mouseX, mouseY, \"Left\", 10) ;click player invetory item move to stash } } pressKey(\"Shift\", KEYUP, 10) ;move item playBeep(3) } /* input move item from stash invetory */ inputMoveItemFromStashInventory() { inventoryGap := [46, 46] stashInventoryCoord := [26, 55] stashColorObj := [\"0x081C18\", \"0x082221\", \"0x082821\", \"0x082923\", \"0x082623\", \"0x082321\", \"0x082321\", \"0x081C18\", \"0x081C18\", \"0x103029\", \"0x102D29\", \"0x103231\", \"0x102E29\", \"0x102F29\", \"0x082821\", \"0x081D18\", \"0x082018\", \"0x103029\", \"0x103431\", \"0x183C39\", \"0x103431\", \"0x103029\", \"0x082C29\", \"0x082821\", \"0x08221A\", \"0x10312D\", \"0x103029\", \"0x103431\", \"0x103532\", \"0x103331\", \"0x103029\", \"0x082821\", \"0x081D18\", \"0x0B2C29\", \"0x10312C\", \"0x103431\", \"0x103831\", \"0x103031\", \"0x103029\", \"0x082825\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 40) ;to avoid interfering with image search pressKey(\"Shift\", KEYDOWN, 40) ;move item loop, 5 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x stashInventoryIndex++ mouseX := stashInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := stashInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, stashColorObj[stashInventoryIndex]) continue else clickMouse(mouseX, mouseY, \"Left\", 40) ;click stash invetory item move to player } } pressKey(\"Shift\", KEYUP, 40) ;move item pressKey(\"Esc\", KEYPRESS, 40) ;close playBeep(3) } /* input gamble */ inputGamble() { weaponTab := [136, 281] armorTab := [178, 281] clickMouse(weaponTab[X], weaponTab[Y], \"Left\", 40) ;click inventory tab inputMoveItemFromMerchantInvetory() clickMouse(armorTab[X], armorTab[Y], \"Left\", 40) ;click inventory tab inputMoveItemFromMerchantInvetory() inputMoveItemFromPlayerInventory(true) } /* input transmute scroll */ inputTransmuteScroll() { inventoryGap := [46, 46] playerInventoryCoord := [443, 378] petInventoryCoord := [26, 379] playerInventoryTabCoord := [645, 522] petInventoryTabCoord := [213, 522] transmuteCoord := [271, 233] playerInventoryColorObj := [\"0x5C8DB5\", \"0x84A9C6\", \"0x81A7C6\", \"0x89AAC6\", \"0x7BA2C6\", \"0x84AAC7\", \"0x84AAC6\", \"0x5A8CB5\", \"0x4A79AD\", \"0x7BA6C6\", \"0x81A7C6\", \"0x84A8C6\", \"0x82AAC6\", \"0x7BA2C6\", \"0x6F98BD\", \"0x527EA5\", \"0x496E97\", \"0x6594B6\", \"0x6594B5\", \"0x6B99B9\", \"0x74A2C5\", \"0x5D8FB6\", \"0x5A8BB1\", \"0x517BA4\"] petInventoryColorObj := [\"0x5285AD\", \"0x84A9C6\", \"0x7CA3C6\", \"0x8CAAC6\", \"0x7BA2C6\", \"0x84AAC9\", \"0x84AAC6\", \"0x5A8CB5\", \"0x4073A2\", \"0x7BA1C6\", \"0x81A7C6\", \"0x81A7C6\", \"0x84AACB\", \"0x7BA1C6\", \"0x6D97BD\", \"0x5284A7\", \"0x466B94\", \"0x6394B9\", \"0x6B95B5\", \"0x6899BA\", \"0x7BA5C6\", \"0x6493BD\", \"0x6396B5\", \"0x527EA6\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 40) ;to avoid interfering with image search clickMouse(playerInventoryTabCoord[X], playerInventoryTabCoord[Y], \"Left\", 40) ;click inventory tab clickMouse(petInventoryTabCoord[X], petInventoryTabCoord[Y], \"Left\", 40) ;click inventory tab pressKey(\"Shift\", KEYDOWN, 40) ;move item loop, 3 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x playerInventoryIndex++ mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, playerInventoryColorObj[playerInventoryIndex]) break, 2 ;exit if the first space or middle of the inventory is empty clickMouse(mouseX, mouseY, \"Left\", 70) ;click inventory item move to transmuter if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item } } loop, 3 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x petInventoryIndex++ mouseX := petInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := petInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, petInventoryColorObj[petInventoryIndex]) break, 2 ;exit if the first space or middle of the inventory is empty clickMouse(mouseX, mouseY, \"Left\", 70) ;click inventory item move to transmuter if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item } } pressKey(\"Shift\", KEYUP, 40) ;move item if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item moveMouse(playerInventoryCoord[X], playerInventoryCoord[Y], 40) ;show item description playBeep(3) } /* input transmute item */ inputTransmuteItem() { inventoryGap := [46, 46] playerInventoryCoord := [443, 341] petInventoryCoord := [26, 341] transmuteCoord := [271, 233] playerInventoryColorObj := [\"0x132C42\", \"0x183C5A\", \"0x183F60\", \"0x1E4668\", \"0x184163\", \"0x214568\", \"0x214263\", \"0x1F3752\", \"0x18334A\", \"0x183C5A\", \"0x18405B\", \"0x183F60\", \"0x21496B\", \"0x194061\", \"0x214263\", \"0x15334C\", \"0x13304A\", \"0x184163\", \"0x214363\", \"0x1E4163\", \"0x21466B\", \"0x214865\", \"0x21415E\", \"0x183958\", \"0x102C42\", \"0x183852\", \"0x153452\", \"0x21415F\", \"0x183856\", \"0x1B3A57\", \"0x183552\", \"0x183452\"] petInventoryColorObj := [\"0x102C42\", \"0x193D5B\", \"0x183E5D\", \"0x1B4266\", \"0x184163\", \"0x214563\", \"0x214163\", \"0x1C3856\", \"0x18324A\", \"0x183C5A\", \"0x18415D\", \"0x204266\", \"0x214668\", \"0x1C4163\", \"0x214163\", \"0x183652\", \"0x102E46\", \"0x184163\", \"0x214363\", \"0x184163\", \"0x1E4668\", \"0x214968\", \"0x214161\", \"0x1F3C5A\", \"0x102A40\", \"0x183452\", \"0x113452\", \"0x21415C\", \"0x183A5A\", \"0x1A3A56\", \"0x133451\", \"0x183452\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 40) ;to avoid interfering with image search pressKey(\"Shift\", KEYDOWN, 40) ;move item loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x playerInventoryIndex++ mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, playerInventoryColorObj[playerInventoryIndex]) break, 2 ;exit if the first space or middle of the inventory is empty clickMouse(mouseX, mouseY, \"Left\", 70) ;click inventory item move to transmuter if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item } } loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x petInventoryIndex++ mouseX := petInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := petInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, petInventoryColorObj[petInventoryIndex]) break, 2 ;exit if the first space or middle of the inventory is empty clickMouse(mouseX, mouseY, \"Left\", 70) ;click inventory item move to transmuter if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item } } pressKey(\"Shift\", KEYUP, 40) ;move item if isColorFromPixel(transmuteCoord[X], transmuteCoord[Y], \"0xB4B1B4\") clickMouse(transmuteCoord[X], transmuteCoord[Y], \"Left\", 70) ;click transmute item moveMouse(playerInventoryCoord[X], playerInventoryCoord[Y], 40) ;show item description playBeep(3) } /* input item to enchanter */ inputMovetItem(pixelX, pixelY) { pressKey(\"Shift\", KEYDOWN, 40) ;move item clickMouse(pixelX, pixelY, \"Left\", 40) ;click inventory item move to enchanter pressKey(\"Shift\", KEYUP, 40) ;move item } /* input disenchant */ inputDisenchant() { disenchantCoord := [303, 241] clickMouse(disenchantCoord[X], disenchantCoord[Y], \"Left\", 40) ;click disenchant item } /* input add enchant */ inputAddEnchant() { enchantSlotCoord := [188, 102] enchantCoord := [302, 184] enchantDialogCoord := [363, 186] enchantOkCoord := [493, 405] clickMouse(enchantCoord[X], enchantCoord[Y], \"Left\", 40) ;click enchant item clickMouse(enchantOkCoord[X], enchantOkCoord[Y], \"Left\", 40) ;click enchant ok moveMouse(enchantSlotCoord[X], enchantSlotCoord[Y], 40) ;show item description } /* input inventory loop enchant */ inputInventoryLoopEnchant(filterTypeObj, filterStatObj) { inventoryGap := [46, 46] playerInventoryCoord := [443, 341] enchantSlotCoord := [188, 102] disenchantButtonCoord := [292, 228] playerInventoryColorObj := [\"0x132C42\", \"0x183C5A\", \"0x183F60\", \"0x1E4668\", \"0x184163\", \"0x214568\", \"0x214263\", \"0x1F3752\", \"0x18334A\", \"0x183C5A\", \"0x18405B\", \"0x183F60\", \"0x21496B\", \"0x194061\", \"0x214263\", \"0x15334C\", \"0x13304A\", \"0x184163\", \"0x214363\", \"0x1E4163\", \"0x21466B\", \"0x214865\", \"0x21415E\", \"0x183958\", \"0x102C42\", \"0x183852\", \"0x153452\", \"0x21415F\", \"0x183856\", \"0x1B3A57\", \"0x183552\", \"0x183452\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 40) ;to avoid interfering with image search loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x playerInventoryIndex++ mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, playerInventoryColorObj[playerInventoryIndex]) continue inputMovetItem(mouseX, mouseY) sleepUntilPixelFound(true, disenchantButtonCoord[X], disenchantButtonCoord[Y], \"0x134968\", 10, 200) ;sleep until pixel found inputLoopEnchant(filterTypeObj, filterStatObj) inputMovetItem(\"\", \"\") } } playBeep(3) } /* input inventory loop add enchant */ inputInventoryLoopAddEnchant() { inventoryGap := [46, 46] playerInventoryCoord := [443, 341] petInventoryCoord := [26, 341] disenchantButtonCoord := [292, 228] playerInventoryColorObj := [\"0x132C42\", \"0x183C5A\", \"0x183F60\", \"0x1E4668\", \"0x184163\", \"0x214568\", \"0x214263\", \"0x1F3752\", \"0x18334A\", \"0x183C5A\", \"0x18405B\", \"0x183F60\", \"0x21496B\", \"0x194061\", \"0x214263\", \"0x15334C\", \"0x13304A\", \"0x184163\", \"0x214363\", \"0x1E4163\", \"0x21466B\", \"0x214865\", \"0x21415E\", \"0x183958\", \"0x102C42\", \"0x183852\", \"0x153452\", \"0x21415F\", \"0x183856\", \"0x1B3A57\", \"0x183552\", \"0x183452\"] petInventoryColorObj := [\"0x102C42\", \"0x193D5B\", \"0x183E5D\", \"0x1B4266\", \"0x184163\", \"0x214563\", \"0x214163\", \"0x1C3856\", \"0x18324A\", \"0x183C5A\", \"0x18415D\", \"0x204266\", \"0x214668\", \"0x1C4163\", \"0x214163\", \"0x183652\", \"0x102E46\", \"0x184163\", \"0x214363\", \"0x184163\", \"0x1E4668\", \"0x214968\", \"0x214161\", \"0x1F3C5A\", \"0x102A40\", \"0x183452\", \"0x113452\", \"0x21415C\", \"0x183A5A\", \"0x1A3A56\", \"0x133451\", \"0x183452\"] moveMouse(A_ScreenWidth, A_ScreenHeight, 10) ;to avoid interfering with image search loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x playerInventoryIndex++ mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, playerInventoryColorObj[playerInventoryIndex]) continue inputMovetItem(mouseX, mouseY) sleepUntilPixelFound(true, disenchantButtonCoord[X], disenchantButtonCoord[Y], \"0x134968\", 10, 200) ;sleep until pixel found inputAddEnchant() inputMovetItem(\"\", \"\") } } loop, 4 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x petInventoryIndex++ mouseX := petInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := petInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) if isColorFromPixel(mouseX, mouseY, petInventoryColorObj[petInventoryIndex]) continue inputMovetItem(mouseX, mouseY) sleepUntilPixelFound(true, disenchantButtonCoord[X], disenchantButtonCoord[Y], \"0x134968\", 10, 200) ;sleep until pixel found inputAddEnchant() inputMovetItem(\"\", \"\") } } playBeep(3) } /* input loop enchant */ inputLoopEnchant(filterTypeObj, filterStatObj) { startTime := A_TickCount enchantSlotCoord := [188, 102] disenchantCoord := [303, 241] enchantCoord := [302, 184] enchantDialogCoord := [363, 186] enchantOkCoord := [493, 405] powerfulCoord := [489, 314] ocrRect := [222, 84, 142, 430] clickMouse(disenchantCoord[X], disenchantCoord[Y], \"Left\", 40) ;click disenchant item loop { clickMouse(enchantCoord[X], enchantCoord[Y], \"Left\", \"\") ;click enchant item sleepUntilPixelFound(true, enchantDialogCoord[X], enchantDialogCoord[Y], \"0xFFFFFF\", 1, 5000) ;sleep until pixel found enchantmentCount++ totalCount++ isPowerful := isImageFromCoordinate(powerfulCoord[X], powerfulCoord[Y], 1, 3, POWERFUL_FILE) clickMouse(enchantOkCoord[X], enchantOkCoord[Y], \"Left\", 40) ;click enchant ok if isPowerful { powerfulCount++ if (enchantmentCount \u003e= 3) { x3PowerfulCount++ moveMouse(enchantSlotCoord[X] - 1, enchantSlotCoord[Y] - 1, 1) ;refresh mouse cursor moveMouse(enchantSlotCoord[X], enchantSlotCoord[Y], 40) ;show item description playBeep(1) ;sleepUntilPixelFound(true, ocrRect[X], ocrRect[Y], \"0x02141C\", 10, 5000) ;sleep until pixel found if isDisenchant(getTextFromOcr(ocrRect[X], ocrRect[Y], ocrRect[WIDTH], ocrRect[HEIGHT]), filterTypeObj, filterStatObj) { clickMouse(disenchantCoord[X], disenchantCoord[Y], \"Left\", 40) ;click disenchant item enchantmentCount := 0 } else { playBeep(2) break } } } else { clickMouse(disenchantCoord[X], disenchantCoord[Y], \"Left\", 40) ;click disenchant item enchantmentCount := 0 } } moveMouse(enchantSlotCoord[X], enchantSlotCoord[Y], 40) ;show item description endTime := A_TickCount - startTime message := \"inputLoopEnchant() total:\" totalCount \", powerful:\" powerfulCount \"(\" formatPercent(powerfulCount, totalCount) \"), x3Powerful:\" x3PowerfulCount \"(\" formatPercent(x3PowerfulCount, totalCount) \"), elapsedTime:\" formatHhmmss(endTime) \", speed/case:\" Round(endTime / totalCount) \"ms\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } ;------------------------------------------------------------------------------- ; screen functions ;------------------------------------------------------------------------------- /* get text from ocr ocr unrecognized case netherrealm axe */ getTextFromOcr(startX, startY, width, height) { endX := startX + width endY :=startY + height startTime := A_TickCount RunWait, %CAPTURE2TEXT_FILE% --s \"%startX% %startY% %endX% %endY%\" --clipboard, , Hide ;as the area narrows the speed increase endTime := A_TickCount - startTime message := \"RunWait() CAPTURE2TEXT_FILE speed:\" Round(endTime) \"ms\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) ocrText := trim(clipboard, \"`n`r`t \") filteredOcrText := filterOcrText(ocrText) message := \"getTextFromOcr() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" filteredOcrText: \" filteredOcrText \", ocrText: \" ocrText writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return filteredOcrText } /* is image from coordinate */ isImageFromCoordinate(startX, startY, width, height, imageFile) { endX := startX + width endY :=startY + height ImageSearch, foundX, foundY, startX, startY, endX, endY, %imageFile% result := ErrorLevel = 0 ? true : false message := \"ImageSearch() \" (result ? \"succeed \" foundX \", \" foundY : \"failed\") \", \" imageFile writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return result } /* is color from pixel */ isColorFromPixel(startX, startY, color) { endX := startX + 1 endY :=startY + 1 PixelSearch, foundX, foundY, startX, startY, endX, endY, color, ,Fast result := ErrorLevel = 0 ? true : false message := \"PixelSearch() \" (result ? \"succeed \" foundX \", \" foundY : \"failed\") \" \" color writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) if result return true else return false } ;------------------------------------------------------------------------------- ; etc functions ;------------------------------------------------------------------------------- /* is disenchant */ isDisenchant(enchantText, filterTypeObj, filterStatObj) { if (enchantText = \"\") return true if (filterTypeObj = \"\") return false for k, v in filterTypeObj { if InStr(filterTypeObj[A_index], \"\u0026\u0026\") { filterOrObj := StrSplit(filterTypeObj[A_index], \"\u0026\u0026\") for k, v in filterOrObj { if InStr(enchantText, trim(filterOrObj[A_index]), false) ;case insensitive filterOrCount++ } if (filterOrObj.MaxIndex() = filterOrCount) return true } else { if InStr(enchantText, filterTypeObj[A_index], false) ;case insensitive return true } } if (filterStatObj = \"\") return false if InStr(enchantText, \"+\") { enchantStatObj := StrSplit(enchantText, \"+\") for k, v in enchantStatObj { enchantTotalStat += trim(StrSplit(enchantStatObj[A_Index], \" \")[1]) } for k, v in filterStatObj { if (filterStatObj[A_Index][1] = \"+\") filterStat := filterStatObj[A_Index][2] } } else if InStr(enchantText, \"conveys\", false) { ;case insensitive enchantTotalStat := trim(StrSplit(StrSplit(enchantText, \"Conveys \")[2], \" \")[1]) for k, v in filterStatObj { if (filterStatObj[A_Index][1] = \"conveys\") filterStat := filterStatObj[A_Index][2] } } if (filterStat \u003c= enchantTotalStat) return false else return true } /* filter ocr text */ filterOcrText(ocrText) { if InStr(ocrText, \"Enchantments: 3\", false) return trim(StrSplit(trim(StrSplit(trim(StrSplit(ocrText, \"Enchantments: 3\")[2]), \"Set:\")[1]), \"Requires\")[1]) ;\"Enchantments: ocrText Set: Requires\" else ;when ocr scan fails return \"\" } /* sleep until pixel found */ sleepUntilPixelFound(isFound, pixelX, pixelY, searchColor, delay, maxDelay) { loop { if (maxDelay \u003c= (delay * A_Index)) { writeLogFile(WARN, A_ThisFunc, A_LineNumber, \"maxDelay over \" maxDelay \"ms\") return false } if (isFound = isColorFromPixel(pixelX, pixelY, searchColor)) return true else Sleep, %delay% } } ;------------------------------------------------------------------------------- ; test functions ;------------------------------------------------------------------------------- /* test text from ocr */ testTextFromOcr() { ocrRect := [222, 84, 142, 430] inputDisenchant() inputAddEnchant() getTextFromOcr(ocrRect[X], ocrRect[Y], ocrRect[WIDTH], ocrRect[HEIGHT]) sleepUntilPixelFound(true, ocrRect[X], ocrRect[Y], \"0x02141C\", 10, 5000) showToolTip(INFO, \"ocr complete\") } /* test is disenchant */ testIsDisenchant() { ;enchantText := \"+211 Focus AttribL or ?h' ,7 . \u0026Dex ?,\" enchantText := \"+211 Focus AttribL or ?h' ,7 . \u0026Dex ?s\" ;enchantText :=\"+297 Ice Damage \" ;enchantText := \"+86 lce Damage Conveys 2710 lce[ or_. : . . Strength 104 \u0026 Dex Legendary Claw Col Number Four of Five\" ;filterTypeObj := [\"chance\", \"conveys \u0026\u0026 +\"] ;only conveys, only element damage filterTypeObj := [\"str att\", \"dex att\", \"vit att\"] ;only foc ;filterStatObj := [[\"+\", 200], [\"conveys\", 3900]] filterStatObj := [[\"+\", 207]] message := isDisenchant(enchantText, filterTypeObj, filterStatObj) writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) } /* test pixel color ocr */ testPixelColorOcr() { ocrRect := [222, 84, 142, 430] getPixelColor(ocrRect[X], ocrRect[Y]) } /* test pixel color input auto */ testPixelColorInputAuto() { skill1Coord := [251, 575] skillXObj := [] activeskillCoord := [606, 582] lowHealth90Coord := [38, 522] ;90% lowMana90Coord := [754, 522] ;90% lowHealth66Coord := [38, 543] ;66% lowMana66Coord := [754, 543] ;66% lowHealth33Coord := [38, 568] ;33% lowMana33Coord := [754, 568] ;33% lowPetHealthCoord := [38, 10] lowPetManaCoord := [38, 22] berserkerChargeCoord := [474, 508] embermageChargeCoord := [467, 510] engineerChargeCoord := [467, 510] outlanderChargeCoord := [478, 516] writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"in game pet portrait\") getPixelColor(6, 6) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"skillXCoord\") loop, 10 { skillXObj.insert(skill1Coord[X] + ((A_Index - 1) * 34)) if (A_Index = 1) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"KEY_1234\") if (A_Index = 5) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"KEY_QWER\") if (A_Index = 9) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"KEY_DF\") getPixelColor(skillXObj[A_Index], skill1Coord[Y]) } writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"activeskillCoord\") getPixelColor(activeskillCoord[X], activeskillCoord[Y]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"lowHealthCoord90\") getPixelColor(lowHealthCoord90[X], lowHealthCoord90[Y]) getPixelColor(lowMana90Coord[X], lowMana90Coord[Y]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"lowHealthCoord66\") getPixelColor(lowHealth66Coord[X], lowHealth66Coord[Y]) getPixelColor(lowMana66Coord[X], lowMana66Coord[Y]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"lowHealthCoord33\") getPixelColor(lowHealth33Coord[X], lowHealth33Coord[Y]) getPixelColor(lowMana33Coord[X], lowMana33Coord[Y]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"lowPetHealthCoord\") getPixelColor(lowPetHealthCoord[X], lowPetHealthCoord[Y]) getPixelColor(lowPetManaCoord[X], lowPetManaCoord[Y]) writeLogFile(INFO, A_ThisFunc, A_LineNumber, \"chargeCoord\") getPixelColor(berserkerChargeCoord[X], berserkerChargeCoord[Y]) getPixelColor(embermageChargeCoord[X], embermageChargeCoord[Y]) getPixelColor(engineerChargeCoord[X], engineerChargeCoord[Y]) getPixelColor(outlanderChargeCoord[X], outlanderChargeCoord[Y]) } /* test pixel color inventory */ testPixelColorInventory() { inventoryGap := [46, 46] playerInventoryCoord := [443, 378] petInventoryCoord := [26, 379] loop, 3 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x mouseX := playerInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := playerInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) getPixelColor(mouseX, mouseY) } } loop, 3 { ;inventory y yIndex := A_index + 0 ;to number loop, 8 { ;inventory x mouseX := petInventoryCoord[X] + ((A_index - 1) * inventoryGap[X]) mouseY := petInventoryCoord[Y] + ((yIndex - 1) * inventoryGap[Y]) getPixelColor(mouseX, mouseY) } } } ;------------------------------------------------------------------------------- ; file functions ;------------------------------------------------------------------------------- getTextFile(textFile) { FileRead, outText, %textFile% message := \"FileRead() \" (ErrorLevel = 0 ? \"SUCCEED\" : \"FAILED \") \" \" textFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) message := \"getTextFile() \" outText \" (\" StrLen(outText) \")\" writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) return outText } /* deflag shared stash */ deflagSharedStash(targetDirectory) { startTime := A_TickCount RunWait, %DEFLAGGER_FILE% \"%targetDirectory%\\sharedstash_v2.bin\" , , Hide endTime := A_TickCount - startTime message := \"RunWait() DEFLAGGER_FILE speed:\" Round(endTime) \"ms\" writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } /* copy save file */ copySaveFile(sourceDirectory, targetDirectory) { FileCopyDir, %sourceDirectory%, % targetDirectory \"\\save_backup\\\" A_Now message := \"FileCopyDir() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" sourceDirectory \", \" targetDirectory \"\\save_backup\\\" A_Now writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) Sleep, 100 } /* copy shared stash */ copySharedStash(sourceDirectory, targetDirectory) { if !InStr(FileExist(targetDirectory), \"D\") { FileCreateDir, %targetDirectory% message := \"FileCreateDir() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" targetDirectory writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) } sourceFile := sourceDirectory \"\\sharedstash_v2.bin\" targetFile := targetDirectory \"\\sharedstash_v2.bin\" FileCopy, %sourceFile%, %targetFile%, true message := \"FileCopy() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" sourceFile \", \" targetFile writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) Sleep, 100 } ;------------------------------------------------------------------------------- ; common functions ;------------------------------------------------------------------------------- getProperties(outText) { if errorlevel return oProperties := StrSplit(outText, \"`n\") loop, % oProperties.MaxIndex() { varName := StrSplit(oProperties[A_Index], \"=\")[1] varValue := StrSplit(oProperties[A_Index], \"=\")[2] switch (varName) { case \"LOGIN_PASSWORD\": LOGIN_PASSWORD := varValue default: } } } /* run as admin */ runAsAdmin() { message := \"A_IsAdmin \" (A_IsAdmin = 1 ? \"succeed\" : \"failed\") writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) if A_IsAdmin return Run *RunAs \"%A_ScriptFullPath%\" ExitApp } /* write log file */ writeLogFile(level, functionName, lineNumber, message) { if (LOG_LEVEL \u003e level) return ;write log file levelName := \"\" switch (level) { case TRACE: levelName := \"TRACE\" case DEBUG: levelName := \"DEBUG\" case INFO: levelName := \"INFO\" case WARN: levelName := \"WARN\" case ERROR: levelName := \"ERROR\" default: } FileAppend, % A_YYYY \"-\" A_MM \"-\" A_DD \" \" A_Hour \":\" A_Min \":\" A_Sec \".\" A_MSec \" \" levelName \" \" A_ScriptName \".\" functionName \"() Line \" lineNumber \" \" message \"`n\", %LOG_FILE% } /* remove log file */ removeLogFile(thresholdSize) { FileGetSize, fileSize, %LOG_FILE%, K message := \"FileGetSize() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" fileSize \"KB \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) if (fileSize \u003c thresholdSize) return FileDelete, %LOG_FILE% message := \"FileDelete() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" LOG_FILE writeLogFile(DEBUG, A_ThisFunc, A_LineNumber, message) showToolTip(DEBUG, message) } /* show tooltip */ showToolTip(level, message) { if (LOG_LEVEL \u003e level) return ToolTip, %message%, 0, 0 clipboard := message SetTimer, removeTooltipTimer, -2500 } /* init hotkey */ initHotkey(description) { if GetKeyState(\"Ctrl\") { Send, {Ctrl Up} Sleep, 1 } if GetKeyState(\"Alt\") { Send, {Alt Up} Sleep, 1 } if GetKeyState(\"Shift\") { Send, {Shift Up} Sleep, 1 } if GetKeyState(\"LButton\") { Send, {LButton Up} Sleep, 1 } if GetKeyState(\"RButton\") { Send, {RButton Up} Sleep, 1 } KeyWait, Ctrl KeyWait, Alt KeyWait, Shift Sleep, 100 showToolTip(INFO, \"initHotkey() \" description) } /* press keyboard */ pressKey(key, event, delay) { switch (event) { case KEYDOWN: Send, {%key% Down} Sleep, 40 case KEYUP: Send, {%key% Up} Sleep, 40 case KEYPRESS: Send, {%key% Down} Sleep, 40 Send, {%key% Up} if (delay = \"\") return Sleep, %delay% case KEYRAW: SendRaw, %key% if (delay = \"\") return Sleep, %delay% default: } } /* press keyboard fast */ pressKeyCustom(key, event, pressingTime, delay) { switch (event) { case KEYDOWN: Send, {%key% Down} Sleep, %pressingTime% case KEYUP: Send, {%key% Up} Sleep, %pressingTime% case KEYPRESS: Send, {%key% Down} Sleep, %pressingTime% Send, {%key% Up} if (delay = \"\") return Sleep, %delay% default: } } /* click mouse */ clickMouse(coordX, coordY, button, delay) { Send, {Click, %coordX%, %coordY%, %button%, Down} Sleep, 40 Send, {Click, %coordX%, %coordY%, %button%, Up} if (delay = \"\") return Sleep, %delay% } /* click mouse fast */ clickMouseCustom(coordX, coordY, button, pressingTime, delay) { Send, {Click, %coordX%, %coordY%, %button%, Down} Sleep, %pressingTime% Send, {Click, %coordX%, %coordY%, %button%, Up} if (delay = \"\") return Sleep, %delay% } /* move mouse */ moveMouse(coordX, coordY, delay) { MouseMove, %coordX%, %coordY% Sleep, %delay% } /* speak tts */ speakTts(message) { sapi := ComObjCreate(\"SAPI.SpVoice\") sapi.Rate := -1 sapi.Voice := sapi.GetVoices().Item(1) sapi.speak(message) } /* play beep */ playBeep(times) { loop, % times { SoundBeep, 7902, 120 Sleep, 10 } } /* formatPercent */ formatPercent(numerator, denominator) { return Round((numerator / denominator) * 100, 2) \"%\" } /* format hh:mm:ss */ formatHhmmss(ms) { VarSetCapacity(hhmmss, 256), DllCall(\"GetDurationFormat\", \"uint\", 2048, \"uint\", 0, \"ptr\", 0, \"int64\", ms*10000, \"wstr\", \"d' days 'h':'mm':'ss\", \"wstr\", hhmmss, \"int\", 256) return hhmmss } /* get pixel color */ getPixelColor(pixelX, pixelY) { if (pixelX = \"\") || (pixelY = \"\") { MouseGetPos, pixelX, pixelY } PixelGetColor, color, pixelX, pixelY message := \"PixelGetColor() \" (ErrorLevel = 0 ? \"succeed\" : \"failed\") \" \" pixelX \", \" pixelY \" \" color writeLogFile(INFO, A_ThisFunc, A_LineNumber, message) showToolTip(INFO, message) return color } https://github.com/dntco43u/torchlight2_helper/blob/main/torchlight2_helper.ahk ↩︎\n","categories":["dev"],"description":"Torchlight II v1.25.5.6 매크로","excerpt":"Torchlight II v1.25.5.6 매크로","ref":"/dev/torchlight2-helper/","tags":["autohotkey"],"title":"torchlight2-helper"},{"body":"\ngraph TB A0[duckdns] \u003c-- dns --\u003e B[uptime-kuma] subgraph cloud A1[ec4mrjp5] \u003c-- https --\u003e B A2[m7jrgve9] \u003c-- https --\u003e B A3[gvp6nx1a] \u003c-- http --\u003e B A1 \u003c-- tcp --\u003e B A2 \u003c-- tcp --\u003e B A3 \u003c-- tcp --\u003e B end A4[agq3mbw2] \u003c-- https --\u003e B A4 \u003c-- tcp --\u003e B subgraph home-lab A5[sj9n7air] \u003c-- http --\u003e A4 A5[sj9n7air] \u003c-- tcp --\u003e A4 end A10[eiyzti2t] \u003c-- https --\u003e B A10[eiyzti2t] \u003c-- tcp --\u003e B container 구성 docker-compose.yml vi /opt/uptime-kuma/docker-compose.yml services: uptime-kuma: image: louislam/uptime-kuma:latest container_name: uptime-kuma networks: - dev ports: - 3001/tcp extra_hosts: - \"host.docker.internal:host-gateway\" user: 0:0 volumes: - /opt/uptime-kuma/data:/app/data:rw - /var/run/docker.sock:/var/run/docker.sock:ro #- /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro restart: unless-stopped networks: dev: external: true 데모 페이지 바로 가기\nTroubleshooting getaddrinfo EAI_AGAIN\n모니터링되는 사이트에 대한 DNS 조회가 어떤 이유로 시간 초과됨을 의미합니다.\n이는 하루에 수천 개의 모니터링 요청을 수행할 때 지극히 정상입니다.\n이러한 경우 경고가 표시되지 않도록 하려면 다시 시도를 2 또는 3 이상으로 설정해야 합니다.\n그렇게 하면 경고를 트리거 하기 전에 사이트가 실제로 다운되었는지 확인할 수 있습니다.\nduckdns 서버에서 주기적으로 발생. 무료 서비스라 감내해야 함\n","categories":["apps"],"description":"uptime-kuma 구성","excerpt":"uptime-kuma 구성","ref":"/apps/uptime-kuma/","tags":["uptime-kuma","docker"],"title":"uptime-kuma"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/uptime-kuma/","tags":"","title":"uptime-kuma"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/vue.js/","tags":"","title":"vue.js"},{"body":"\ngraph LR subgraph gvp6nx1a B[webtop] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/webtop/docker-compose.yml services: webtop: image: raindev11/webtop:latest container_name: webtop networks: - dev ports: - 3000/tcp - 3001/tcp user: 0:0 environment: - PUID=1000 - PGID=1000 - TZ=Asia/Seoul - START_DOCKER=false - DRINODE=/dev/dri/renderD128 volumes: - /opt/webtop/config:/config:rw - /var/run/docker.sock:/var/run/docker.sock:ro security_opt: - seccomp:unconfined shm_size: 2gb devices: - /dev/dri:/dev/dri privileged: true restart: unless-stopped networks: dev: external: true proxy 구성 authelia 구성\nvi /opt/nginx/config/sites-available/webtop.conf ... location /authelia { if ($allowed_country = no) { return 403; } include /etc/nginx/snippets/authelia-api.conf; } location / { if ($allowed_country = no) { return 403; } proxy_pass http://webtop:3000; include /etc/nginx/snippets/authelia-auth.conf; add_header 'Cross-Origin-Embedder-Policy' 'require-corp'; add_header 'Cross-Origin-Opener-Policy' 'same-origin'; add_header 'Cross-Origin-Resource-Policy' 'same-site'; proxy_buffering off; proxy_request_buffering off; } ... Troubleshooting failed to load listeners: can’t create unix socket /var/run/docker.sock: device or resource busy\nSTART_DOCKER=false 환경 변수 추가 (docker-compose.yml)\n","categories":["apps"],"description":"webtop 구성","excerpt":"webtop 구성","ref":"/apps/webtop/","tags":["webtop","docker"],"title":"webtop"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/webtop/","tags":"","title":"webtop"},{"body":"\ngraph LR subgraph gvp6nx1a B[archivebox] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 .env vi /opt/archivebox/.env ADMIN_USERNAME=dev ADMIN_PASSWORD=k*************************************************************** docker-compose.yml vi /opt/archivebox/docker-compose.yml services: archivebox: image: archivebox/archivebox:sha-5c1a14e container_name: archivebox networks: - dev ports: - 8000/tcp user: 0:0 environment: - ALLOWED_HOSTS=* - MEDIA_MAX_SIZE=750m - ADMIN_USERNAME=$ADMIN_USERNAME - ADMIN_PASSWORD=$ADMIN_PASSWORD - TZ=Asia/Seoul volumes: - /opt/archivebox/data:/data:rw restart: unless-stopped networks: dev: external: true 설치 cd /opt/archivebox/ \u0026\u0026 docker compose run archivebox init host 구성 logrotate sudo vi /etc/logrotate.d/archivebox /opt/archivebox/data/logs/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 999 999 sharedscripts postrotate docker restart archivebox \u003e/dev/null 2\u003e\u00261 || true endscript } Troubleshooting PermissionError: [Errno 13] Permission denied: ‘/data/logs/errors.log’\ncontainer 실행 계정 (999:999) 변경\nsudo sed -Ei \"s/create 0664 dev dev/create 0664 999 999/g\" /etc/logrotate.d/archivebox \u0026\u0026 \\ sudo logrotate -v /etc/logrotate.d/archivebox \u0026\u0026 \\ docker exec -it nginx nginx -s reload References https://github.com/ArchiveBox/ArchiveBox/wiki/Install ","categories":["apps"],"description":"archivebox 구성","excerpt":"archivebox 구성","ref":"/apps/archivebox/","tags":["archivebox","docker"],"title":"archivebox"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/archivebox/","tags":"","title":"archivebox"},{"body":"\ngraph LR subgraph gvp6nx1a B1[apps] \u003c-- proxy --\u003e B C[nginx] -- login --\u003e B[authelia] C -- login --\u003e D1[apps] end F[client] -- https --\u003e C container 구성 docker-compose.yml vi /opt/authelia/docker-compose.yml services: authelia: image: authelia/authelia:latest container_name: authelia networks: - dev ports: - 9091/tcp user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/authelia/config:/config:rw restart: unless-stopped networks: dev: external: true configuration.yml app url admiin 접근 guest 접근 login 페이지 privatebin pb.gvp6nx1a.duckdns.org O X X webtop wb.gvp6nx1a.duckdns.org O O X esportshlper es.gvp6nx1a.duckdns.org O O X g4f g4.gvp6nx1a.duckdns.org O O X authelia au.gvp6nx1a.duckdns.org O O O vi /opt/authelia/config/configuration.yml server: address: 'tcp://:9091/authelia' log: level: 'info' identity_validation: reset_password: jwt_secret: 'p***************************************************************' default_redirection_url: 'https://au.gvp6nx1a.duckdns.org/' duo_api: hostname: 'gvp6nx1a.duckdns.org' integration_key: 'c***************************************************************' secret_key: 'b***************************************************************' authentication_backend: password_reset: disable: false file: path: '/config/users_database.yml' password: algorithm: 'argon2id' iterations: 3 memory: 65536 parallelism: 4 key_length: 32 salt_length: 16 access_control: default_policy: 'deny' rules: - domain_regex: '^(pb).gvp6nx1a.duckdns.org' subject: 'group:guests' policy: 'one_factor' - domain_regex: '^(wb|es|g4).gvp6nx1a.duckdns.org' subject: 'group:admins' policy: 'one_factor' - domain: 'au.gvp6nx1a.duckdns.org' policy: 'bypass' session: name: 'authelia_session' secret: 'K***************************************************************' expiration: '1h' inactivity: '5m' remember_me: '1M' domain: 'gvp6nx1a.duckdns.org' regulation: max_retries: 3 find_time: '2m' ban_time: '5m' storage: encryption_key: 'E***************************************************************' local: path: '/config/db.sqlite3' notifier: disable_startup_check: false smtp: host: 'smtp.mail.yahoo.com' port: 465 timeout: '5 seconds' username: 'x*******@yahoo.com' password: '****************' sender: 'Authelia \u003cx*******-********@yahoo.com\u003e' identifier: 'localhost' subject: '[Authelia] {title}' startup_check_address: 'x*******-********@yahoo.com' disable_require_tls: false disable_html_emails: false tls: skip_verify: false minimum_version: 'TLS1.2' users_database.yml 암호 hash 생성\ndocker run -it --rm authelia/authelia:latest authelia crypto hash generate argon2 --password '***************' \u0026\u0026 \\ docker run -it --rm authelia/authelia:latest authelia crypto hash generate argon2 --password '***************' Digest: $argon2id$v=19$m=65536,t=3,p=4******************************************************************* Digest: $argon2id$v=19$m=65536,t=3,p=4******************************************************************* vi /opt/authelia/config/users_database.yml users: dev: password: '$argon2id$v=19$m=65536,t=3,p=4*******************************************************************' displayname: 'dev' email: 'x*******-********@yahoo.com' groups: - 'admins' - 'guests' disabled: false guest: password: '$argon2id$v=19$m=65536,t=3,p=4*******************************************************************' displayname: 'guest' email: '' groups: - 'guests' disabled: false proxy 구성 vi /opt/nginx/config/sites-available/authelia.conf ... location / { if ($allowed_country = no) { return 403; } proxy_pass http://authelia:9091; client_body_buffer_size 128k; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503; send_timeout 5m; proxy_read_timeout 360; proxy_send_timeout 360; proxy_connect_timeout 360; proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Uri $request_uri; proxy_set_header X-Forwarded-Ssl on; proxy_redirect http:// $scheme://; proxy_http_version 1.1; proxy_set_header Connection \"\"; proxy_cache_bypass $cookie_session; proxy_no_cache $cookie_session; proxy_buffers 64 256k; set_real_ip_from 172.18.0.0/24; real_ip_header Forwarded-For; real_ip_recursive on; } ... vi /opt/nginx/config/snippets/authelia-api.conf internal; set $upstream_authelia http://authelia:9091/api/verify; proxy_pass_request_body off; proxy_pass $upstream_authelia; proxy_set_header Content-Length \"\"; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503; client_body_buffer_size 128k; proxy_set_header Host $host; proxy_set_header X-Original-URL $scheme://$http_host$request_uri; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $remote_addr; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Uri $request_uri; proxy_set_header X-Forwarded-Ssl on; proxy_redirect http:// $scheme://; proxy_http_version 1.1; proxy_set_header Connection \"\"; proxy_cache_bypass $cookie_session; proxy_no_cache $cookie_session; proxy_buffers 4 32k; send_timeout 5m; proxy_read_timeout 240; proxy_send_timeout 240; proxy_connect_timeout 240; vi /opt/nginx/config/snippets/authelia-auth.conf auth_request /authelia; auth_request_set $target_url https://$http_host$request_uri; auth_request_set $user $upstream_http_remote_user; auth_request_set $email $upstream_http_remote_email; auth_request_set $groups $upstream_http_remote_groups; proxy_set_header Remote-User $user; proxy_set_header Remote-Email $email; proxy_set_header Remote-Groups $groups; error_page 401 =302 https://au.gvp6nx1a.duckdns.org/?rd=$target_url; client_body_buffer_size 128k; proxy_next_upstream error timeout invalid_header http_500 http_502 http_503; send_timeout 5m; proxy_read_timeout 360; proxy_send_timeout 360; proxy_connect_timeout 360; proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection upgrade; proxy_set_header Accept-Encoding gzip; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $http_host; proxy_set_header X-Forwarded-Uri $request_uri; proxy_set_header X-Forwarded-Ssl on; proxy_redirect http:// $scheme://; proxy_http_version 1.1; proxy_set_header Connection \"\"; proxy_cache_bypass $cookie_session; proxy_no_cache $cookie_session; proxy_buffers 64 256k; set_real_ip_from 10.0.0.0/8; set_real_ip_from 172.0.0.0/8; set_real_ip_from 192.168.0.0/16; set_real_ip_from fc00::/7; real_ip_header Forwarded-For; real_ip_recursive on; ","categories":["apps"],"description":"authelia 구성","excerpt":"authelia 구성","ref":"/apps/authelia/","tags":["authelia","nginx","docker"],"title":"authelia"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/authelia/","tags":"","title":"authelia"},{"body":"\ngraph LR subgraph gvp6nx1a A7[code-server] \u003c-- http --\u003e A13[nginx] end A13 \u003c-- https --\u003e B[client] container 구성 .env vi /opt/code-server/.env PASSWORD=1*************************************************************** docker-compose.yml 1 vi /opt/code-server/docker-compose.yml services: code-server: image: lscr.io/linuxserver/code-server:4.16.1 container_name: code-server networks: - dev ports: - 8443/tcp user: 0:0 environment: - PUID=0 - PGID=0 - TZ=Asia/Seoul - PASSWORD=$PASSWORD - PROXY_DOMAIN=co.gvp6nx1a.duckdns.org - DEFAULT_WORKSPACE=/ volumes: - /:/rootfs:rw - /opt/code-server/config:/config:rw - /opt/code-server/workbench/workbench.html:/usr/lib/code-server/lib/vscode/out/vs/code/browser/workbench/workbench.html:rw - /opt/code-server/font:/usr/lib/code-server/src/browser/pages/font:rw restart: unless-stopped networks: dev: external: true 공통 구성 font D2Coding 구성\nvi /opt/code-server/font/font.css @font-face { font-family: 'D2Coding'; font-style: normal; font-weight: 400; font-display: swap; src: url('./d2coding-full.woff2') format('woff2'); } @font-face { font-family: 'D2Coding'; font-style: normal; font-weight: 700; font-display: swap; src: url('./d2coding-bold-full.woff2') format('woff2'); } vi /opt/code-server/workbench/workbench.html ... \u003chead\u003e \u003c!-- custom-font --\u003e \u003clink rel=\"stylesheet\" type=\"text/css\" href={{BASE}}/\"_static/src/browser/pages/font.css\"\u003e \u003c/head\u003e ... License 상업적 이용 제한 없음\ncode-server: MIT 2 D2Coding: OFL 3 Troubleshpooting log를 yyyymmdd* 형식의 폴더에 쌓는다 /opt/code-server/config/data/logs/\n일일 스케줄링되는 cleanup_disk.sh에서 0일 이후 로그 삭제하도록 구성\ncodercom/code-server 이미지보다 linuxserver/code-server가 더 가볍다 ↩︎\nhttps://github.com/coder/code-server/blob/main/LICENSE ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"code-server 구성","excerpt":"code-server 구성","ref":"/infra/code-server/","tags":["code-server","docker"],"title":"code-server"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/code-server/","tags":"","title":"code-server"},{"body":"\ngraph LR subgraph cloud A1[ec4mrjp5] \u003c-- https --\u003e B[dashy] A2[m7jrgve9] \u003c-- https --\u003e B A3[gvp6nx1a] \u003c-- http --\u003e B end A4[agq3mbw2] \u003c-- https --\u003e B subgraph home-lab A5[sj9n7air] \u003c-- http --\u003e A4 end B \u003c-- https --\u003e A6[client] container 구성 docker-compose.yml vi /opt/dashy/docker-compose.yml services: dashy: image: lissy93/dashy:latest container_name: dashy networks: - dev ports: - 8080/tcp user: 0:0 environment: - UID=1000 - GID=1000 - MODE_ENV=production - TZ=Asia/Seoul volumes: - /opt/dashy/config/conf.yml:/app/user-data/conf.yml:rw - /opt/dashy/item-icons:/app/user-data/item-icons:rw restart: unless-stopped networks: dev: external: true 암호 구성 로그인 암호 sha256 hash 생성 후 구성에 저장\necho -n \"2***************************************************************\" | sha256sum 7*************************************************************** vi /opt/dashy/config/conf.yml appConfig: auth: users: - user: dev hash: 7*************************************************************** type: admin ... 데모 페이지 바로 가기\nTroubleshooting Browserslist: caniuse-lite is outdated. Please run: npx update-browserslist-db@latest\ndocker exec -it dashy npx update-browserslist-db@latest ","categories":["apps"],"description":"dashy 구성","excerpt":"dashy 구성","ref":"/apps/dashy/","tags":["dashy","docker"],"title":"dashy"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/dashy/","tags":"","title":"dashy"},{"body":"\nwindows 구성 개요 Mdir 참조 확장자별 색상 기타 편의 구성 D2Coding 의존 다운로드 doublecmd-settings.zip\nD2Coding-Ver1.3.2-20180524.zip\nFilename Remarks sevenzip.ini 7z 플러그인 colors.json 모든 색상 설정 ignorelist.txt 파일/폴더 무시 doublecmd.xml 모든 주요 프로그램 설정 extassoc.xml 파일 확장자 연관 설정 gitbash로 설치 curl https://dntco43u.github.io/infra/doublecmd-settings.zip -o $USERPROFILE/Downloads/doublecmd-settings.zip \u0026\u0026 \\ 7z x -y -o\"$APPDATA/doublecmd\" $USERPROFILE/Downloads/doublecmd-settings.zip \u0026\u0026 \\ rm $USERPROFILE/Downloads/doublecmd-settings.zip License 상업적 이용 제한 없음\nDouble Commander: GNU GPL v2 1 D2Coding: OFL 2 References https://github.com/doublecmd/doublecmd https://doublecmd.github.io/doc/en/configuration.html https://github.com/doublecmd/doublecmd?tab=GPL-2.0-1-ov-file ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"Double Commander 구성","excerpt":"Double Commander 구성","ref":"/infra/doublecmd/","tags":["doublecmd"],"title":"doublecmd"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/doublecmd/","tags":"","title":"doublecmd"},{"body":"\ngraph LR subgraph gvp6nx1a A[docker.sock] --\u003e B B[dozzle] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/dozzle/docker-compose.yml services: dozzle: image: amir20/dozzle:latest container_name: dozzle networks: - dev ports: - 8080/tcp user: 0:0 environment: - DOZZLE_AUTH_PROVIDER=simple - TZ=Asia/Seoul volumes: - /var/run/docker.sock:/var/run/docker.sock:ro - /opt/dozzle/config:/data:rw command: - --filter= - --level=INFO - --no-analytics restart: unless-stopped networks: dev: external: true users.yml 암호 구성 yml 생성\ndocker run --rm amir20/dozzle generate dev --password 1*************************************************************** \u003e /opt/dozzle/config/users.yml \u0026\u0026 \\ cat /opt/dozzle/config/users.yml \u0026\u0026 \\ cd /opt/dozzle \u0026\u0026 docker compose rm -f -s \u0026\u0026 docker compose up -d ","categories":["apps"],"description":"dozzle 구성","excerpt":"dozzle 구성","ref":"/apps/dozzle/","tags":["dozzle","docker"],"title":"dozzle"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/dozzle/","tags":"","title":"dozzle"},{"body":"\nwindows 구성 개요 레벨별 색상 구성\nd{4}[\\\\/-]\\\\d{2}[\\\\/-]\\\\d{2}\\\\s\\\\d{2}:\\\\d{2}:\\\\d{2}.*TRACE|DEBUG d{4}[\\\\/-]\\\\d{2}[\\\\/-]\\\\d{2}\\\\s\\\\d{2}:\\\\d{2}:\\\\d{2}.*INFO|NOTICE d{4}[\\\\/-]\\\\d{2}[\\\\/-]\\\\d{2}\\\\s\\\\d{2}:\\\\d{2}:\\\\d{2}.*WARN d{4}[\\\\/-]\\\\d{2}[\\\\/-]\\\\d{2}\\\\s\\\\d{2}:\\\\d{2}:\\\\d{2}.*ERROR|SEVERE|CRITICAL D2Coding 의존\n다운로드 klogg-settings.zip\nD2Coding-Ver1.3.2-20180524.zip\nFilename Remarks klogg.conf 구성 gitbash로 설치 curl https://dntco43u.github.io/infra/klogg-settings.zip -o $USERPROFILE/Downloads/klogg-settings.zip \u0026\u0026 \\ 7z x -y -o\"$USERPROFILE/Downloads\" $USERPROFILE/Downloads/klogg-settings.zip \u0026\u0026 \\ mv $USERPROFILE/Downloads/klogg.conf \"$PROGRAMFILES/klogg\" \u0026\u0026 \\ rm $USERPROFILE/Downloads/klogg-settings.zip License 상업적 이용 제한 없음\nklogg: GNU GPL v1 1 D2Coding: OFL 2 References https://github.com/variar/klogg https://github.com/variar/klogg?tab=License-1-ov-file ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"KLOGG 구성","excerpt":"KLOGG 구성","ref":"/infra/klogg/","tags":["klogg"],"title":"klogg"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/klogg/","tags":"","title":"klogg"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/nginx/","tags":"","title":"nginx"},{"body":"\ngraph LR subgraph gvp6nx1a A1[host] --\u003e E2 E2[node-exporter] -- http --\u003e A3[prometheus] end A2[host] --\u003e E3 E3[node-exporter] -- https --\u003e A3 container 구성 docker-compose.yml 수집 데이터에 접근하기 위해 host 모드로 구성\nvi /opt/node-exporter/docker-compose.yml services: node-exporter: image: prom/node-exporter:latest container_name: node-exporter network_mode: host pid: host user: 1000:1000 volumes: - /:/rootfs:ro - /proc:/rootfs/proc:ro - /sys:/rootfs/sys:ro - /run/udev/data:/run/udev/data:ro - /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket:ro - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro - /opt/node-exporter/config/web.yml:/etc/web.yml:rw command: - --web.config.file=/etc/web.yml - --path.rootfs=/rootfs - --path.procfs=/rootfs/proc - --path.sysfs=/rootfs/sys - --collector.filesystem.mount-points-exclude=^/(rootfs/)?(dev|etc|proc|run|sys)($$|/) - --collector.processes - --collector.systemd - --collector.interrupts restart: unless-stopped web.yml http basic auth 구성\npip install bcrypt \u0026\u0026 \\ tee ~/gen-password.py \u003c\u003cEOF import getpass import bcrypt password = getpass.getpass(\"password: \") hashed_password = bcrypt.hashpw(password.encode(\"utf-8\"), bcrypt.gensalt()) print(hashed_password.decode()) EOF python3 ~/gen-password.py password: $*********************************************************** pip uninstall -y bcrypt \u0026\u0026 rm ~/gen-password.py \u0026\u0026 \\ tee /opt/node-exporter/config/web.yml \u003c\u003cEOF basic_auth_users: dev: $*********************************************************** EOF host 구성 proxy 구성 특정 ip만 허용하도록 구성\nvi /opt/nginx/config/sites-available/node-exporter.conf ... location / { include /etc/nginx/conf.d/include/proxy.conf; proxy_pass http://host.docker.internal:9100; proxy_intercept_errors on; allow 192.168.0.0/16; allow 2**.**.**.*; #sj9n7air allow 1**.***.**.**; #gvp6nx1a deny all; } ... Troubleshooting Recommended for prometheus-node-exporter the arguments ‘–collector.systemd –collector.processes’ because the graph uses some of their metrics. 1\ncollector.systemd, collector.processes 옵션 추가 (docker-compose.yml)\nts=2023-09-17T03:49:50.864Z caller=collector.go:169 level=error msg=“collector failed” name=netclass duration_seconds=0.294694918 err=“could not get net class info: failed to read file \"/host/sys/class/net/veth10d18cc/speed\": no such device”\ndocker 구성 변경 network_mode: host (docker-compose.yml)\nudev 오류\n/run/udev/data mount 구성 (docker-compose.yml)\nhttps://grafana.com/grafana/dashboards/1860-node-exporter-full ↩︎\n","categories":["apps"],"description":"node-exporter 구성","excerpt":"node-exporter 구성","ref":"/apps/node-exporter/","tags":["node-exporter","docker"],"title":"node-exporter"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/node-exporter/","tags":"","title":"node-exporter"},{"body":"\ngraph LR subgraph gvp6nx1a A1[docker.sock] ---\u003e B B[portainer] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 docker-compose.yml vi /opt/portainer/docker-compose.yml services: portainer: image: portainer/portainer-ce:alpine container_name: portainer networks: - dev ports: - 8000/tcp - 9443/tcp user: 0:0 volumes: - /var/run/docker.sock:/var/run/docker.sock:ro - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro - /opt/portainer/data:/data:rw restart: unless-stopped networks: dev: external: true ","categories":["apps"],"description":"portainer 구성","excerpt":"portainer 구성","ref":"/apps/portainer/","tags":["portainer","docker"],"title":"portainer"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/portainer/","tags":"","title":"portainer"},{"body":"\ngraph TB subgraph ec4mrjp5 B13[sshd] -- log --\u003e A13[promtail] B12[selinux] -- log --\u003e A13 B11[nginx] -- log --\u003e A13 end A13 \u003c-- https --\u003e A7[loki] subgraph m7jrgve9 B23[sshd] -- log --\u003e A23[promtail] B22[selinux] -- log --\u003e A23 B21[nginx] -- log --\u003e A23 end A23 \u003c-- https --\u003e A7[loki] subgraph gvp6nx1a B33[sshd] -- log --\u003e A33[promtail] B32[selinux] -- log --\u003e A33 B31[nginx] -- log --\u003e A33 A33 \u003c-- http --\u003e A7[loki] end container 구성 .env vi /opt/promtail/.env LOKI_URL=http://loki:3100/loki/api/v1/push LOKI_USERNAME=dev LOKI_PASSWORD=a*************************************************************** docker-compose.yml vi /opt/promtail/docker-compose.yml services: promtail: image: grafana/promtail:latest container_name: promtail networks: - dev ports: - 9080/tcp user: 0:0 environment: - LOKI_URL=$LOKI_URL - LOKI_USERNAME=$LOKI_USERNAME - LOKI_PASSWORD=$LOKI_PASSWORD - TZ=Asia/Seoul volumes: - /var/log/secure:/var/log/secure:ro - /var/log/audit/audit.log:/var/log/audit/audit.log:ro - /opt/promtail/config:/etc/promtail:ro - /opt/nginx/log:/var/log/nginx:ro command: - --config.file=/etc/promtail/config.yml - --config.expand-env=true restart: unless-stopped networks: dev: external: true config.yml 수집할 로그 구성\nFilepath Remarks /var/log/nginx/*_access.log nginx site별 access 로그 /var/log/secure sshd 로그 /var/log/audit/audit.log selinux 감사 로그 vi /opt/promtail/config/config.yml server: http_listen_port: 9080 grpc_listen_port: 0 positions: filename: /tmp/positions.yaml clients: - url: ${LOKI_URL} basic_auth: username: ${LOKI_USERNAME} password: ${LOKI_PASSWORD} scrape_configs: - job_name: nginx static_configs: - targets: - localhost labels: job: nginx instance: gvp6nx1a __path__: /var/log/nginx/*_access.log - job_name: secure static_configs: - targets: - localhost labels: job: secure instance: gvp6nx1a __path__: /var/log/secure - job_name: audit static_configs: - targets: - localhost labels: job: audit instance: gvp6nx1a __path__: /var/log/audit/audit.log host 구성 logrotate create 방식으로 구성. promtail 서비스 재시작 필요\nType inode 변경 안정성 Remarks copytruncate X 전송 속도에 따라 유실 우려 원본 로그 파일을 복사한 뒤 원본 파일의 내용을 비움 create O 무결성 보장 기존 파일을 삭제하고 새로운 파일을 만듦 sudo vi /etc/logrotate.d/nginx /opt/nginx/log/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d nocompress create 0664 dev dev sharedscripts postrotate docker exec nginx nginx -s reload \u003e/dev/null 2\u003e\u00261 || true docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } sudo vi /etc/logrotate.d/rsyslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 root root sharedscripts postrotate /usr/bin/systemctl -s HUP kill rsyslog.service \u003e/dev/null 2\u003e\u00261 || true docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } ","categories":["apps"],"description":"promtail 구성","excerpt":"promtail 구성","ref":"/apps/promtail/","tags":["promtail","docker"],"title":"promtail"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/promtail/","tags":"","title":"promtail"},{"body":"\nwindows 구성 개요 색상 1 접속 정보를 제외하고 구성된 dev@hostaddr 세션 D2Coding 의존 다운로드 putty-sessions.zip\nD2Coding-Ver1.3.2-20180524.zip\nFilename Remarks putty-sessions.reg 세션 정보 레지스트리 gitbash로 설치 curl https://dntco43u.github.io/infra/putty-sessions.zip -o $USERPROFILE/Downloads/putty-sessions.zip \u0026\u0026 \\ 7z x -y -o\"$USERPROFILE/Downloads\" $USERPROFILE/Downloads/putty-sessions.zip \u0026\u0026 \\ reg import $USERPROFILE/Downloads/putty-sessions.reg \u0026\u0026 \\ find $USERPROFILE/Downloads/ -type f -name putty-sessions.* -exec rm {} \\; License 상업적 이용 제한 없음\nputty: MIT 1 D2Coding: OFL 2 https://stackoverflow.com/questions/49075439/putty-monokai-color-scheme-manually ↩︎ ↩︎\nhttps://www.chiark.greenend.org.uk/~sgtatham/putty/licence.html ↩︎\n","categories":["infra"],"description":"PuTTY 구성","excerpt":"PuTTY 구성","ref":"/infra/putty/","tags":["putty"],"title":"putty"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/putty/","tags":"","title":"putty"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/vpn/","tags":"","title":"vpn"},{"body":"\ngraph LR subgraph 443/tcp A[client] -- https 차단 --- B[firewall] A1[client] \u003c-- vless+ws 우회 --\u003e B end B \u003c-- vless+ws 우회 --\u003e G[nginx-proxy] G \u003c--\u003e I[xray] I \u003c-- https 요청/응답 --\u003e L[internet] container 구성 docker-compose.yml vi /opt/xray/docker-compose.yml services: xray: image: teddysun/xray:1.7.5 container_name: xray networks: - dev ports: - 9000/tcp user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/xray/config:/etc/xray:rw - /opt/.acme/*.$HOSTNAME.duckdns.org_ecc/fullchain.cer:/etc/ssl/*.$HOSTNAME.duckdns.org/fullchain.pem:ro - /opt/.acme/*.$HOSTNAME.duckdns.org_ecc/*.$HOSTNAME.duckdns.org.key:/etc/ssl/*.$HOSTNAME.duckdns.org/privkey.pem:ro restart: unless-stopped networks: dev: external: true vless-websocket-tls (서버) vi /opt/xray/config/config.json { \"log\":{ \"loglevel\":\"warning\" }, \"inbounds\":[ { \"port\":9000, \"protocol\":\"vless\", \"settings\":{ \"clients\":[ { \"id\":\"5*******-****-****-****-************\", \"flow\":\"xtls-rprx-direct\" } ], \"decryption\":\"none\", \"fallbacks\":[] }, \"streamSettings\":{ \"network\":\"ws\", \"security\":\"tls\", \"tlsSettings\":{ \"serverName\":\"xr.gvp6nx1a.duckdns.org\", \"certificates\":[ { \"certificateFile\":\"/etc/ssl/*.gvp6nx1a.duckdns.org/fullchain.pem\", \"keyFile\":\"/etc/ssl/*.gvp6nx1a.duckdns.org/privkey.pem\" } ] }, \"wsSettings\":{ \"path\":\"/w*******\", \"headers\":{} } }, \"tag\":\"inbound\", \"sniffing\":{ \"enabled\":true, \"destOverride\":[ \"http\", \"tls\" ] } } ], \"outbounds\":[ { \"protocol\":\"freedom\" } ] } vless-websocket-tls (클라이언트) vi $USERPROFILE/AppData/Local/qv2ray/connections/maellhfkxqke.qv2ray.json { \"outbounds\": [ { \"protocol\": \"vless\", \"settings\": { \"vnext\": [ { \"address\": \"xr.gvp6nx1a.duckdns.org\", \"port\": 443, \"users\": [ { \"encryption\": \"none\", \"id\": \"5*******-****-****-****-************\" } ] } ] }, \"streamSettings\": { \"network\": \"ws\", \"security\": \"tls\", \"tlsSettings\": { \"disableSystemRoot\": false, \"serverName\": \"xr.gvp6nx1a.duckdns.org\" }, \"wsSettings\": { \"path\": \"/w*******\" }, \"xtlsSettings\": { \"disableSystemRoot\": false } } } ] } proxy 구성 vi /opt/nginx/config/sites-available/xray.conf ... location /w******* { if ($allowed_country = no) { return 403; } include /etc/nginx/conf.d/include/proxy.conf; proxy_pass https://xray:9000; keepalive_timeout 65; client_max_body_size 0; } ... 테스트 dns 누출 확인\nhttps://www.cloudflare.com/ssl/encrypted-sni/ https://dnsleaktest.com/ https://ipleak.net/ References https://guide.v2fly.org/en_US/advanced/wss_and_web.html#note https://github.com/zyaowei/trojan_v2_docker_onekey ","categories":["apps"],"description":"xray vless + websocket + tls 구성","excerpt":"xray vless + websocket + tls 구성","ref":"/apps/xray/","tags":["xray","docker","vpn"],"title":"xray"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/xray/","tags":"","title":"xray"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/code-formatter/","tags":"","title":"code-formatter"},{"body":"\nLicense 상업적 이용 제한 없음\ndbeaver-ce: Apaache v2 1 D2Coding: OFL 2 Troubleshooting Error resolving dependencies Maven artifact ‘maven:/com.oracle.database.xml:xmlparserv2:RELEASE’ not found\noracle driver 설치 실패. dbeaver 관리자 권한으로 실행\nError : 1031, Position : 0, SQL = ALTER SESSION SET “_optimizer_push_pred_cost_based” = FALSE, Original SQL = ALTER SESSION SET “_optimizer_push_pred_cost_based” = FALSE, Error Message = ORA-01031: 권한이 불충분합니다\ndbeaver ui에서 Edit Connection -\u003e Connection settings -\u003e Oracle properties 탭 -\u003e Use metadata queries optimizer 체크 해제\nInvalid preference category path: org.eclipse.debug.ui.ConsolePreferencePage (bundle: org.eclipse.ui.console, page: org.eclipse.ui.internal.console.ansi.preferences.AnsiConsolePreferencePage)\ndbeaver v22.2.3 이후부터 발생함. 재설치나 수동 리셋해도 반복됨\n오류 없는 마지막 구버전 dbeaver-ce-22.2.2-x86_64-setup.exe\ndbeaver v25.3.0 에러 메시지 로그 외에는 사용에 지장 없음 (2025-12)\npostgresql ERROR: operator is not unique: “char” || text\nposggresql v15 이상에서 발생함. dbeaver v22.3.1에서 수정\nhttps://dbeaver.io/product/dbeaver_license.txt ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"dbeaver 구성","excerpt":"dbeaver 구성","ref":"/infra/dbeaver/","tags":["dbeaver","ide"],"title":"dbeaver"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/dbeaver/","tags":"","title":"dbeaver"},{"body":"\ngraph TB subgraph gvp6nx1a A[server] \u003c-- ssh-keygen --\u003e B1[ssh-key] A[server] \u003c-- gpg --\u003e B2[gpg-key] end A \u003c-- ssh --\u003e C[client] C \u003c-- ssh --\u003e D[github] A \u003c-- ssh --\u003e D key 구성 ssh 키 생성\nmkdir -p ~/ssh_keys \u0026\u0026 \\ ssh-keygen -t ed25519 -P \"\" -C github-eddsa-key-$(date +%Y%m%d) -f ~/ssh_keys/dntco43u@github \u0026\u0026 \\ mv ~/ssh_keys/dntco43u@github ~/ssh_keys/dntco43u@github.pem \u0026\u0026 \\ cat ~/ssh_keys/dntco43u@github.pub \u0026\u0026 \\ cat ~/ssh_keys/dntco43u@github.pem 클라이언트에 원본 키 다운로드\nrclone copy -vv -P gvp6nx1a-ftp:/home/dev/ssh_keys $USERPROFILE/AppData/LocalLow/ssh_keys \u0026\u0026 \\ git config --global user.name \"dntco43u\" \u0026\u0026 \\ git config --global user.email \"x*******-********@yahoo.com\" \u0026\u0026 \\ git config --global --add safe.directory '*' \u0026\u0026 \\ eval \"$(ssh-agent -s)\" \u0026\u0026 \\ ssh-add $USERPROFILE/AppData/LocalLow/ssh_keys/dntco43u@github.pem \u0026\u0026 \\ ssh -T git@github.com Hi dntco43u! You've successfully authenticated, but GitHub does not provide shell access. 서버에 원본 키 보관 (optional)\nmv ~/ssh_keys/dntco43u@github.pem ~/.ssh \u0026\u0026 \\ chmod 400 ~/.ssh/dntco43u@github.pem \u0026\u0026 \\ sudo dnf update -y \u0026\u0026 sudo dnf install -y git \u0026\u0026 \\ git config --global user.name \"dntco43u\" \u0026\u0026 \\ git config --global user.email \"x*******-********@yahoo.com\" \u0026\u0026 \\ git config --global --add safe.directory '*' \u0026\u0026 \\ eval \"$(ssh-agent -s)\" \u0026\u0026 \\ ssh-add ~/.ssh/dntco43u@github.pem \u0026\u0026 \\ ssh -T git@github.com \u0026\u0026 \\ rm -rf ~/ssh_keys gpg 키 생성\nsudo dnf -y update \u0026\u0026 sudo dnf -y install pinentry \u0026\u0026 \\ gpg --default-new-key-algo \"ed25519/cert,sign+cv25519/encr\" --gen-key Real name::dntco43u Email address:x*******-********@yahoo.com gpg --list-keys pub ed25519 2024-06-03 [SC] [expires: 2026-06-03] E*************************************** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e sub cv25519 2024-06-03 [E] [expires: 2026-06-03] mkdir -p ~/pgp_keys \u0026\u0026 \\ gpg --output ~/pgp_keys/dntco43u@ec4mrjp5.pub --armor --export E*************************************** \u0026\u0026 \\ gpg --output ~/pgp_keys/dntco43u@ec4mrjp5.key --armor --export-secret-key E*************************************** 클라이언트에 복사 키 다운로드\nrclone copy -vv -P gvp6nx1a-ftp:/home/dev/pgp_keys $USERPROFILE/AppData/LocalLow/pgp_keys \u0026\u0026 \\ gpg --import $USERPROFILE/AppData/LocalLow/pgp_keys/dntco43u@ec4mrjp5.pub \u0026\u0026 \\ gpg --import $USERPROFILE/AppData/LocalLow/pgp_keys/dntco43u@ec4mrjp5.key \u0026\u0026 \\ echo \"test\" | gpg --clearsign gpg --fingerprint \u0026\u0026 \\ git config --global user.signingkey E*************************************** \u0026\u0026 \\ git config --global commit.gpgsign true \u0026\u0026 \\ ssh -T git@github.com [keyboxd] --------- pub ed25519 2024-06-03 [SC] [expires: 2026-06-03] E*** **** **** **** **** ***** **** **** **** **** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e sub cv25519 2024-06-03 [E] [expires: 2026-06-03] touch testfile \u0026\u0026 \\ git add . \u0026\u0026 git commit -m \"Test gpg signature\" \u0026\u0026 git push \u0026\u0026 \\ rm testfile \u0026\u0026 \\ git add . \u0026\u0026 git commit -m \"Test gpg signature\" \u0026\u0026 git push \u0026\u0026 \\ git log --show-signature -1 commit 6*************************************** (HEAD -\u003e main) gpg: Signature made Sat Dec 13 20:09:52 2025 KST gpg: using EDDSA key E*************************************** gpg: Good signature from \"dntco43u \u003cx*******-********@yahoo.com\u003e\" [unknown] gpg: WARNING: This key is not certified with a trusted signature! gpg: There is no indication that the signature belongs to the owner. Primary key fingerprint: E*** **** **** **** **** ***** **** **** **** **** Author: dntco43u \u003cx*******-********@yahoo.com\u003e Date: Sat Dec 13 20:09:52 2025 +0900 Test gpg signature 서버에서 복사 키 삭제\nrm -rf ~/pgp_keys 저장소 원본 키 삭제 (optional)\ngpg --list-keys \u0026\u0026 gpg --list-secret-keys [keyboxd] --------- pub ed25519 2024-06-03 [SC] [expires: 2026-06-03] E*************************************** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e sub cv25519 2024-06-03 [E] [expires: 2026-06-03] [keyboxd] --------- sec ed25519 2024-06-03 [SC] [expires: 2026-06-03] E*************************************** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e ssb cv25519 2024-06-03 [E] [expires: 2026-06-03] gpg --delete-secret-key E*************************************** \u0026\u0026 \\ gpg --delete-key E*************************************** 만료일 삭제 (optional)\ngpg --quick-set-expire E*************************************** 0y \u0026\u0026 \\ gpg --quick-set-expire E*************************************** 0y '*' gpg --fingerprint pub ed25519 2024-06-03 [SC] E*** **** **** **** **** ***** **** **** **** **** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e sub cv25519 2024-06-03 [E] gpg --list-secret-keys --keyid-format=long sec ed25519/C*************** 2024-06-03 [SC] E*************************************** uid [ unknown] dntco43u \u003cx*******-********@yahoo.com\u003e ssb cv25519/E*************** 2024-06-03 [E] gpg --keyserver keyserver.ubuntu.com --send-keys C*************** windows 구성 gitbash vi ~/.bashrc TITLEPREFIX=$(echo \"$USERNAME\"@\"$COMPUTERNAME\" | tr '[:upper:]' '[:lower:]') cd ~/workspace License 상업적 이용 제한 없음\ngit-for-windows: GNU GPL v2 1 D2Coding: OFL 2 Troubleshooting gitbash 환경 변수 참조\necho $APPDATA gitbash path 역슬래시 사용\nls '\\\\sj9n7air\\d2' References https://github.com/git-for-windows/git https://github.com/git-for-windows/git?tab=License-1-ov-file#readme ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n","categories":["infra"],"description":"github 구성","excerpt":"github 구성","ref":"/infra/github/","tags":["github"],"title":"github"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/ide/","tags":"","title":"ide"},{"body":"\nwindows 구성 개요 들여쓰기 탭 대신 공백 2자리 키워드 표준화 키워드 대문자 탭 크기 0 콤마 뒤 열 공백 추가 파싱 에러 허용 BETWEEN 키워드 행 확장 거부 IN 키워드 행 확장 거부 dbeaver Options command line “c:\\Users\\dev\\AppData\\Roaming\\SqlFormatter\\SqlFormatter.exe” /is:\" \" /sk- /uk /st:0 /sac /ae /ebc- /eil- Formatter External formatter Use temp file Uncheck 1 SELECT * FROM TABLE1 t WHERE a \u003e 100 AND b BETWEEN 12 AND 45; SELECT t.* , j1.x , j2.y FROM TABLE1 t JOIN JT1 j1 ON j1.a = t.a LEFT OUTER JOIN JT2 j2 ON j2.a = t.a AND j2.b = j1.b WHERE t.xxx IS NOT NULL; DELETE FROM TABLE1 WHERE a = 1; UPDATE TABLE1 SET a = 2 WHERE a = 1 SELECT table1.id , table2.number , SUM(table1.amount) FROM table1 INNER JOIN table2 ON table1.id = table2.table1_id WHERE table1.id IN ( SELECT table1_id FROM table3 WHERE table3.name = 'Foo Bar' AND table3.type = 'unknown_type' ) GROUP BY table1.id , table2.number ORDER BY table1.id; command options Options Remarks is indentString (default: \\t) st spacesPerTab (default: 4) mw maxLineWidth (default: 999) sb statementBreaks (default: 2) cb clauseBreaks (default: 1) tc trailingCommas (default: false) sac spaceAfterExpandedComma (default: false) ebc expandBetweenConditions (default: true) ebe expandBooleanExpressions (default: true) ecs expandCaseStatements (default: true) ecl expandCommaLists (default: true) eil expandInLists (default: true) uk uppercaseKeywords (default: true) sk standardizeKeywords (default: false) ae allowParsingErrors (default: false) e extensions (default: sql) r recursive (default: false) b backups (default: true) b outputFileOrFolder (default: none; if set, overrides the backup option) l languageCode (default: current if supported or EN; valid values include EN, FR and ES) License 상업적 이용 제한 없음\nAGPL v3.0.1 2 Troubleshooting Unrecognized arguments found!\ndbeaver ui에서 SQL Format -\u003e Use temp file 옵션 체크 해제\nReferences https://github.com/TaoK/PoorMansTSqlFormatter https://github.com/TaoK/PoorMansTSqlFormatter/issues/285 ↩︎\nhttps://github.com/TaoK/PoorMansTSqlFormatter?tab=AGPL-3.0-1-ov-file ↩︎\n","categories":["infra"],"description":"PoorMansTSqlFormatter 구성","excerpt":"PoorMansTSqlFormatter 구성","ref":"/infra/poormans-tsql-formatter/","tags":["code-formatter","dbeaver","ide"],"title":"PoorMansTSqlFormatter"},{"body":"\nGitHub repository 바로 가기\ncontainer 구성 Dockerfile vi /opt/bdkqpr0x/Dockerfile FROM ibm-semeru-runtimes:open-17-jre #RUN adduser --no-create-home -u 1000 dev RUN mkdir -p /usr/share/java \u0026\u0026 \\ chown -R 1000 /usr/share/java USER 1000 COPY --chown=1000:1000 build/libs/*.jar /usr/share/java/app.jar WORKDIR /usr/share/java host 구성 bdkqpr0x.sh 1 vi /home/dev/.local/bin/bdkqpr0x.sh #!/bin/bash # bdkqpr0x source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp docker run \\ -i --rm --name=bdkqpr0x --network=dev \\ --add-host=host.docker.internal:host-gateway --user=1000:1000 \\ -e TZ=Asia/Seoul \\ -v /opt/bdkqpr0x/log:/usr/share/java/log:rw \\ -v /opt/bdkqpr0x/data:/usr/share/java/data:rw \\ e7hnr8ov/bdkqpr0x:open-17-jre \\ java -Dspring.profiles.active=prod -Xms2G -Xmx2G \\ -jar /usr/share/java/app.jar \\ --job.name=\"$1\" chunkSize=\"$2\" requestDate=\"$3\" \u003e \"$log_file\" echo \"--job.name=$1 chunkSize=$2 requestDate=$3\" \u003e \"$msg_file\" tail -n3 \"$log_file\" | head -n1 \u003e\u003e \"$msg_file\" #show count send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" post_build.sh 2 vi /opt/bdkqpr0x/config/post_build.sh #!/bin/bash # 자동 build 후 처리 source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp jenkins_bot_key=\"$3\" tel_chat_id=\"$4\" { echo \"$1 #$2\" show_file_stat \"/opt/$1/build/libs/$1-0.0.1-SNAPSHOT.jar\" cd \"/opt/$1\" || exit 1 docker build -t \"e7hnr8ov/$1:open-17-jre\" \"/opt/$1\" if [ -f \"docker-compose.yml\" ]; then docker compose rm -f -s docker compose up -d docker exec -i \"$1\" date +\"%Z %F %T\" fi } \u003e \"$log_file\" read -ra args \u003c \u003c(docker images -q -f dangling=true) docker rmi \"${args[@]}\" rm -rf \"/opt/$1/build\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$jenkins_bot_key\" \"$tel_chat_id\" \"$msg_file\" rm \"$msg_file\" logrotate sudo vi /etc/logrotate.d/bdkqpr0x /opt/bdkqpr0x/log/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 dev dev sharedscripts postrotate docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } Jobs Jobs Command File Remarks bd01 bdkqpr0x.sh bd01 10000 $(date +%Y%m%d) us-500.csv pgsql -\u003e Oracle, pgsql -\u003e File -\u003e Oracle bd02 bdkqpr0x.sh bd02 10000 $(date +%Y%m%d) us-500.csv Oracle -\u003e pgsql, Oracle -\u003e File -\u003e pgsql bd03 bdkqpr0x.sh bd03 10000 $(date +%Y%m%d) music_tag.csv Oracle -\u003e Oracle, Oracle -\u003e File -\u003e Oracle bd04 bdkqpr0x.sh bd04 10000 $(date +%Y%m%d) system_events.csv pgsql -\u003e Oracle, pgsql -\u003e File -\u003e Oracle Troubleshooting =\u003e ERROR [2/5] RUN adduser –no-create-home -u 1000 dev\nibm-semeru-runtimes:open-17-jre 이미지 업데이트로 Dockerfile build 시 계정 생성 구성 삭제\nvi /opt/bdkqpr0x/Dockerfile #RUN adduser --no-create-home -u 1000 dev Oracle 부적합한 열유형\nvi $PROJECT_PATH/src/main/resources/mybatis-config.xml ... \u003csetting name=\"jdbcTypeForNull\" value=\"NULL\" /\u003e ... mybaris oracle에서 paramter값 null 처리 구성\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/bdkqpr0x.sh ↩︎\nhttps://hu.gvp6nx1a.duckdns.org/infra/jenkins/#post_buildsh ↩︎\n","categories":["dev"],"description":"springboot 배치 샘플","excerpt":"springboot 배치 샘플","ref":"/dev/bdkqpr0x/","tags":["oracle","postgresql","mybatis","sptingboot","docker"],"title":"bdkqpr0x"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/database/","tags":"","title":"database"},{"body":"\nGitHub repository 바로 가기\ncontainer 구성 .env vi /opt/python/.env ... INVEN_USERNAME=n******* INVEN_PASSWORD=5*************************************************************** ... inven_helper.sh 1 #!/bin/bash # inven_helper source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp for ((i=1; i\u003c=2; i++)); do docker run \\ -i --rm --name=py-inven-helper --network=dev --user=0:0 \\ --env-file=/opt/python/.env \\ -v /home/dev/workspace/inven_helper/inven_helper.py:/data/inven_helper.py:rw \\ e7hnr8ov/python:3-slim \\ python /data/inven_helper.py \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" sleep 5 done inven_helper.py 2 from selenium import webdriver from selenium.webdriver.common.by import By from selenium.webdriver.common.keys import Keys from selenium.webdriver.support.ui import WebDriverWait from selenium.webdriver.support import expected_conditions as ec from lxml.html import fromstring import os, sys, time try: executor = str(os.environ.get(\"WEBDRIVER_URL\")) options = webdriver.ChromeOptions() #options.add_argument('--disable-gpu') options.add_argument('--headless') options.add_argument('--blink-settings=imagesEnabled=false') options.add_argument('--no-sandbox') options.add_argument('--disable-dev-shm-usage') options.add_argument('--lang=en_US') options.add_argument('--mute-audio') options.add_argument('user-agent=Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.0.0 Safari/537.36 Edg/107.0.1418.35') driver = webdriver.Remote(command_executor=executor, options=options) driver.set_window_size(1280, 720) # https://it.inven.co.kr/ url = 'https://it.inven.co.kr/' driver.switch_to.window(driver.window_handles[0]) driver.get(url) print('driver.get=' + url) try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"itBody\"]/div[1]/section/article/section[1]/div[1]/div/a'))) driver.find_element(By.XPATH, '//*[@id=\"itBody\"]/div[1]/section/article/section[1]/div[1]/div/a').click() except: pass print('debug:1') # https://member.inven.co.kr/user/scorpio/mlogin try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"loginBtn\"]'))) username = str(os.environ.get(\"INVEN_USERNAME\")) password = str(os.environ.get(\"INVEN_PASSWORD\")) # print('INVEN_USERNAME=' + username) # print('INVEN_PASSWORD=' + password) driver.find_element(By.XPATH, '//*[@id=\"user_id\"]').send_keys(username) driver.find_element(By.XPATH, '//*[@id=\"password\"]').send_keys(password) driver.find_element(By.XPATH, '//*[@id=\"password\"]').send_keys(Keys.ENTER) except: pass print('debug:2') # Change Password try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"btn-extend\"]'))) driver.find_element(By.XPATH, '//*[@id=\"btn-extend\"]').click() wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"btn-ok\"]'))) driver.find_element(By.XPATH, '//*[@id=\"btn-ok\"]').click() except: pass print('debug:3') # https://it.inven.co.kr/ try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"itBody\"]/div[1]/section/article/section[1]/div[1]/div/form/ul/li[6]/button'))) driver.find_element(By.XPATH, '//*[@id=\"comItBanner\"]/div[4]/a/span').click() except: pass print('debug:4') # Guaranteed tab open time time.sleep(10) # https://imart.inven.co.kr/attendance/ Check Attendance driver.switch_to.window(driver.window_handles[1]) try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"invenAttendCheck\"]/div/div[2]/div/div[3]/div[1]/div[4]/a'))) driver.find_element(By.XPATH, '//*[@id=\"invenAttendCheck\"]/div/div[2]/div/div[3]/div[1]/div[4]/a').click() except: pass print('debug:5') try: wait = WebDriverWait(driver, 3).until(ec.alert_is_present()) alert = driver.switch_to.alert print('alert.text=' + alert.text) alert.accept() except: pass print('debug:6') # if time.localtime().tm_wday == 2: try: driver.find_element(By.XPATH, '//*[@id=\"invenAttendCheck\"]/div/div[2]/div/div[3]/div[1]/div[3]/a').click() driver.switch_to.window(driver.window_handles[2]) wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"imageCollectDiv\"]/div/div[2]/div[2]/div[1]/div[19]/div/label/span'))) vote_text = driver.find_element(By.XPATH, '//*[@id=\"imageCollectDiv\"]/div/div[2]/div[2]/div[2]').text if vote_text == '투표에 참여 완료했습니다.': print('div.text=' + vote_text) else: driver.find_element(By.XPATH, '//*[@id=\"imageCollectDiv\"]/div/div[2]/div[2]/div[1]/div[19]/div/label/span').click() driver.find_element(By.XPATH, '//*[@id=\"imageCollectDiv\"]/div/div[2]/div[2]/div[2]/div/button').click() driver.close() driver.switch_to.window(driver.window_handles[1]) except: pass driver.close() print('debug:7') # https://it.inven.co.kr/ driver.switch_to.window(driver.window_handles[0]) driver.find_element(By.XPATH, '//*[@id=\"comItBanner\"]/div[5]/a/span').click() print('debug:8') # https://imart.inven.co.kr/imarble/ Dice for i in range(8): driver.switch_to.window(driver.window_handles[1]) try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"imarbleBoard\"]/div[4]/img'))) driver.find_element(By.XPATH, '//*[@id=\"imarbleBoard\"]/div[4]/img').click() except: pass try: wait = WebDriverWait(driver, 3).until(ec.alert_is_present()) alert = driver.switch_to.alert alert_text = alert.text print('alert.text=' + alert.text.replace(\"\\n\", \" \")) alert.accept() if alert_text.startswith('주사위 1개를 \\'5제니\\'로 구매하실 수 있습니다.'): try: wait = WebDriverWait(driver, 3).until(ec.alert_is_present()) alert = driver.switch_to.alert alert.accept() except: pass if alert_text == '오늘의 주사위를 모두 사용하셨습니다.': driver.close() break except: pass time.sleep(10) driver.execute_script('window.open(\"about:blank\", \"_blank\");') driver.switch_to.window(driver.window_handles[2]) url = 'https://imart.inven.co.kr/imarble/' driver.get(url) print('driver.get=' + url) driver.switch_to.window(driver.window_handles[1]) driver.close() print('debug:9') # https://it.inven.co.kr/ Advertisement driver.switch_to.window(driver.window_handles[0]) try: wait = WebDriverWait(driver, 5).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"topskyAd\"]/div/img'))) xpaths = ['//*[@id=\"topskyAd\"]/div/img', '//*[@id=\"rightThumbNailAd\"]/img'] for j in xpaths: # print(\"xpaths=\" + j) driver.find_element(By.XPATH, j).click() driver.switch_to.window(driver.window_handles[1]) driver.close() driver.switch_to.window(driver.window_handles[0]) except: pass print('debug:10') # https://it.inven.co.kr/ driver.switch_to.window(driver.window_handles[0]) res = driver.page_source parser = fromstring(res) article_list = parser.xpath('//*[@id=\"commu-nav\"]/ul/li[6]/ol') parsed_articles = article_list[0].xpath('.//li') links = [] for article in parsed_articles: parsed_link = article.xpath('.//a[@href]') link = parsed_link[0].get('href') links.append(link) # print(\"links=\" + str(links)) print('debug:11') # https://links.inven.co.kr/ Brand partners for i in links: # https://zotac.inven.co.kr/ No like button if i == 'https://zotac.inven.co.kr/': break driver.switch_to.window(driver.window_handles[0]) driver.execute_script('window.open(\"about:blank\", \"_blank\");') driver.switch_to.window(driver.window_handles[1]) driver.get(i) print('driver.get=' + i) try: wait = WebDriverWait(driver, 3).until(ec.element_to_be_clickable((By.XPATH, '//*[@id=\"brandSubscribe\"]/div[1]/button'))) for j in range(3): driver.find_element(By.XPATH, '//*[@id=\"brandSubscribe\"]/div[1]/button').click() if j \u003c= 1: time.sleep(5) except: pass driver.close() print('debug:12') # close driver.switch_to.window(driver.window_handles[0]) driver.close() driver.quit() print('debug:13') except Exception as error: print(error) pass Troubleshooting 간헐적으로 실행 도중 종료\n원인 찾지 못함. 일단 sh에서 2회 실행\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/inven_helper.sh ↩︎\nhttps://github.com/dntco43u/inven_helper/blob/main/inven_helper.py ↩︎\n","categories":["dev"],"description":"inven 출석 봇","excerpt":"inven 출석 봇","ref":"/dev/inven-helper/","tags":["python","selenium"],"title":"inven-helper"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/mybatis/","tags":"","title":"mybatis"},{"body":"\nGitHub repository 바로 가기\ncontainer 구성 .env vi /opt/python/.env ... NAVER_USERNAME=u*******@naver.com NAVER_PASSWORD=r*************** ... navergame_helper.sh 1 #!/bin/bash # navergame_helper source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp for ((i=1; i\u003c=2; i++)); do docker run \\ -i --rm --name=py-navergame-helper --network=dev --user=0:0 \\ --env-file=/opt/python/.env \\ -v /home/dev/workspace/navergame_helper/navergame_helper.py:/data/navergame_helper.py:rw \\ e7hnr8ov/python:3-slim \\ python /data/navergame_helper.py \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" sleep 5 done navergame_helper.py 2 from selenium import webdriver # type: ignore from selenium.webdriver.common.by import By # type: ignore from selenium.webdriver.support.ui import WebDriverWait # type: ignore from selenium.webdriver.support import expected_conditions as ec # type: ignore from lxml.html import fromstring # type: ignore import os, sys, time, random escape_html_table = { \"\u0026\": \"\u0026amp;\", '\"': \"\u0026quot;\", \"'\": \"\u0026apos;\", \"\u003e\": \"\u0026gt;\", \"\u003c\": \"\u0026lt;\", } def escape_html(text): return \"\".join(escape_html_table.get(c,c) for c in text) def get_ticket_page(): driver.get('https://game.naver.com/ticket') time.sleep(3) #동적 element btn_collect_xpath = '//*[@id=\"root\"]/div[1]/div[2]/div/button[2]/span' #티켓 모으기 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_collect_xpath))).click() time.sleep(3) #동적 element try: executor = str(os.environ.get(\"WEBDRIVER_URL\")) #print(executor) options = webdriver.ChromeOptions() options.add_argument('--headless') options.add_argument(\"--disable-blink-features=AutomationControlled\") options.add_argument('--blink-settings=imagesEnabled=false') options.add_argument('--mute-audio') options.add_argument('--no-sandbox') options.add_argument('--disable-dev-shm-usage') options.add_argument('--mute-audio') options.add_argument(\"--start-maximized\") options.add_argument('--lang=en_US') user_agent = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36 Edg/126.0.0.0' options.add_argument('user-agent=' + user_agent) driver = webdriver.Remote(command_executor=executor, options=options) #로그인 https://nid.naver.com/nidlogin.login try: username = str(os.environ.get(\"NAVER_USERNAME\")) password = str(os.environ.get(\"NAVER_PASSWORD\")) #print(username + '/' + password) driver.get('https://nid.naver.com/nidlogin.login') btn_login_xpath = '//*[@id=\"log.login\"]/span' btn_login = WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_login_xpath))) input_id = driver.find_element(By.XPATH, '//*[@id=\"id\"]') input_pw = driver.find_element(By.XPATH, '//*[@id=\"pw\"]') driver.execute_script('arguments[0].value=arguments[1]', input_id, username) time.sleep(random.uniform(1,3)) #봇 감지 회피 driver.execute_script('arguments[0].value=arguments[1]', input_pw, password) time.sleep(random.uniform(1,3)) #봇 감지 회피 btn_login.click() print('[x] 로그인') except Exception as e1: print('[ ] 로그인') pass #기기 등록 요청 #등록하지 않음, 기기 등록을 하게 되면 실행시 불필요한 네이버 알림 추가됨 #//*[@id=\"new.save\"] //*[@id=\"new.dontsave\"] try: btn_dont_xpath = '//*[@id=\"new.dontsave\"]' WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_dont_xpath))).click() print('[x] 기기 등록 요청') except Exception as e1: print('[ ] 기기 등록 요청') pass #네이버게임 롤 라운지 https://game.naver.com/lounge/League_of_Legends/home try: is_success = False driver.get('https://game.naver.com/lounge/League_of_Legends/home') #XXX: 봇 감지될 시 http 404 time.sleep(6) res = driver.page_source parser = fromstring(res) xpaths = ['//*[@id=\"root\"]/div/div/div[3]/div[1]/div/div[2]/div[2]/ul/li[1]/a' , '//*[@id=\"root\"]/div/div/div[3]/div[1]/div/div[3]/div[2]/ul/li[1]/a'] for xpath in xpaths: elem = parser.xpath(xpath) if(len(elem) \u003e 0): link_latest_xpath = xpath #라운지 최신 글 is_success = True break WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, link_latest_xpath))).click() print('[x] 일일 퀘스트 최신 글 보기') if (is_success == False): print('[ ] 일일 퀘스트 최신 글 보기\\n' + link_latest_xpath) except Exception as e11: #print('e: ' + escape_html(str(121))) pass #일일 퀘스트 버프 try: driver.refresh() time.sleep(6) #page_load_xpath = '//*[@id=\"panelCenter\"]/div/div/div[3]' #WebDriverWait(driver, 6).until(ec.presence_of_element_located((By.XPATH, page_load_xpath))) res = driver.page_source parser = fromstring(res) xpath = '' xpaths = ['//*[@id=\"panelCenter\"]/div/div/div[2]/div[2]/div/button[1]/em' , '//*[@id=\"panelCenter\"]/div/div/div[2]/div[3]/div/button[1]/em' , '//*[@id=\"panelCenter\"]/div/div/div[3]/div[2]/div/button[1]/em' , '//*[@id=\"panelCenter\"]/div/div/div[3]/div[3]/div/button[1]/em'] for xpath in xpaths: elem = parser.xpath(xpath) #print(str(len(elem)) + xpath) if(len(elem) \u003e 0 and '버프' in elem[0].text): btn_buff_xpath = xpath.replace('/em', '') break btn_buff = WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_buff_xpath))) btn_buff.click() time.sleep(1) btn_buff.click() print('[x] 일일 퀘스트 버프하기') except Exception as e10: print('[ ] 일일 퀘스트 버프하기\\n' + btn_buff_xpath) pass #네이버게임 라운지 티켓 https://game.naver.com/ticket #button 주소 //*[@id=\"root\"]/div[2]/div[4]/ul + idx + ]/div/button/div[2] #disalbed 확인 주소 //*[@id=\"root\"]/div[2]/div[4]/ul + idx + ]/div/button try: driver.get('https://game.naver.com/ticket') time.sleep(3) #동적 element res = driver.page_source parser = fromstring(res) xpath = '' xpaths = ['//*[@id=\"root\"]/div[2]/div[3]/ul/li[1]/div/button/div[2]' , '//*[@id=\"root\"]/div[2]/div[4]/ul/li[1]/div/button/div[2]'] for xpath in xpaths: elem = parser.xpath(xpath) if(len(elem) \u003e 0 and '응모' in elem[0].text): prefix_xpath = xpath.replace('/li[1]/div/button/div[2]', '') break except Exception as e21: print('e: 요소 탐색 실패\\n' + prefix_xpath) #print('e: ' + escape_html(str(e21))) pass try: idx = 1 suffix_xpath = ']/div/button/div[2]' btn_ticket_xpath = prefix_xpath + '/li[' + str(idx) + suffix_xpath #print(btn_ticket_xpath) WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_ticket_xpath))) res = driver.page_source parser = fromstring(res) ul = parser.xpath(prefix_xpath) lis = ul[0].xpath('.//li') xpaths = [] for li in lis: ticket_name = li.xpath('.//div/div[2]/p')[0].text #print('idx=' + str(idx)) #print('name=' + ticket_name) if ticket_name.startswith('네이버페이'): xpaths.append(prefix_xpath + '/li[' + str(idx) + suffix_xpath) idx += 1 #print(prefix_xpath) except Exception as e22: #print('e: 요소 탐색 실패\\n' + prefix_xpath) pass try: is_success = False for xpath in xpaths: try: btn_challenge_xpath = xpath.replace('/button/div[2]', '/button') btn_challenge = driver.find_element(By.XPATH, btn_challenge_xpath) if not (btn_challenge.get_attribute('disabled')): #print ('active ticket xpath: ' + xpath) WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, xpath))).click() is_success = True print('[x] 일일 퀘스트 응모 도전') break except Exception as e2: print('e :' + xpath) pass if (is_success == False): print('[ ] 일일 퀘스트 응모 도전\\n' + xpath) except Exception as e10: #print('e: 요소 탐색 실패 ' + escape_html(str(e10))) pass #일일 퀘스트 완료 보상 #기준 xpath 검색 try: get_ticket_page() is_success = False res = driver.page_source parser = fromstring(res) xpaths = ['//*[@id=\"root\"]/div[2]/div[3]/ul/li[1]/div/div[3]/button' , '//*[@id=\"root\"]/div[2]/div[4]/ul/li[1]/div/div[3]/button'] for xpath in xpaths: elem = parser.xpath(xpath) if(len(elem) \u003e 0 and len(elem[0].text) \u003e 0): #하러가기, 티켓받기, 보상받기, 완료 is_success = True prefix_xpath = xpath.replace('/ul/li[1]/div/div[3]/button', '') break if (is_success == False): print('e: 요소 탐색 실패\\n' + prefix_xpath) except Exception as e20: #print('e: ' + escape_html(str(e20))) pass try: get_ticket_page() btn_today_xpath = prefix_xpath + '/ul/li[1]/div/div[3]/button' #오늘의 티켓 받기 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_today_xpath))).click() print('[x] 오늘의 티켓 받기') except Exception as e3: print('[ ] 오늘의 티켓 받기\\n' + btn_today_xpath) pass try: get_ticket_page() btn_view_xpath = prefix_xpath + '/ul/li[2]/div[1]/div[3]/button' #가입 라운지에서 최신 글 보기 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_view_xpath))).click() print('[x] 최신 글 보기 받기') except Exception as e4: print('[ ] 최신 글 보기 받기\\n' + btn_view_xpath) pass try: get_ticket_page() btn_buff_xpath = prefix_xpath + '/ul/li[3]/div[1]/div[3]/button' #게임 라운지에서 버프하기 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_buff_xpath))).click() print('[x] 라운지에서 버프하기 받기') except Exception as e5: print('[ ] 리운지에서 버프하기 받기\\n' + btn_buff_xpath) pass try: get_ticket_page() btn_challenge_xpath = prefix_xpath + '/ul/li[4]/div[1]/div[3]/button' #라운지 티켓으로 응모 도전 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_challenge_xpath))).click() print('[x] 응모 도전 받기') except Exception as e6: print('[ ] 응모 도전 받기\\n' + btn_challenge_xpath) pass try: get_ticket_page() btn_reward_xpath = prefix_xpath + '/div/div[1]/div[2]/button' #일일 퀘스트 완료 보상 WebDriverWait(driver, 6).until(ec.element_to_be_clickable((By.XPATH, btn_reward_xpath))).click() print('[x] 일일 퀘스트 완료 보상 받기') except Exception as e7: print('[ ] 일일 퀘스트 완료 보상 받기\\n' + btn_reward_xpath) pass except Exception as e: print('e: ' + escape_html(str(e))) finally: driver.quit() Troubleshooting 간헐적으로 실행 도중 종료\n원인 찾지 못함. 일단 sh에서 2회 실행\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/navergame_helper.sh ↩︎\nhttps://github.com/dntco43u/navergame_helper/blob/main/navergame_helper.py ↩︎\n","categories":["dev"],"description":"navergame 출석 봇","excerpt":"navergame 출석 봇","ref":"/dev/navergame-helper/","tags":["python","selenium"],"title":"navergame-helper"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/postgresql/","tags":"","title":"postgresql"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/python/","tags":"","title":"python"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/react/","tags":"","title":"react"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/references/","tags":"","title":"references"},{"body":"작성 중 ","categories":["dev"],"description":"태그 에디터","excerpt":"태그 에디터","ref":"/dev/tag-edit/","tags":["postgresql","sptingboot","rest-api","react","docker"],"title":"tag-edit (작성 중)"},{"body":"작성 중 ","categories":["references"],"description":"대용량 데이터베이스 솔루션 I 도서 정리, 요약","excerpt":"대용량 데이터베이스 솔루션 I 도서 정리, 요약","ref":"/ref/database-solution-1/","tags":["database"],"title":"대용량 데이터베이스 솔루션 I (작성 중)"},{"body":"작성 중 ","categories":["references"],"description":"대용량 데이터베이스 솔루션 II 도서 정리, 요약","excerpt":"대용량 데이터베이스 솔루션 II 도서 정리, 요약","ref":"/ref/database-solution-2/","tags":["database"],"title":"대용량 데이터베이스 솔루션 II (작성 중)"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/bash/","tags":"","title":"bash"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/duckdns/","tags":"","title":"duckdns"},{"body":"\ngraph LR subgraph gvp6nx1a A1[sshd] -- log --\u003e B[fail2ban] A2[vsftpd] -- log --\u003e B A1[sshd] \u003c-- 22/tcp --\u003e A3 A2[vsftpd] \u003c-- 21/tcp --\u003e A3 end B -- ip/port bsn/unban --\u003e A3[iptables] B -- https --\u003e C[telegram] A3 \u003c-- 6****/tcp --\u003e D1[client] host 구성 설치 sudo dnf -y update \u0026\u0026 sudo dnf install -y fail2ban whois jail.local sudo vi /etc/fail2ban/jail.local [INCLUDES] before = paths-fedora.conf [DEFAULT] ignoreip = 192.168.192.1 2**.**.**.* 1**.***.**.* 1**.***.**.** 1**.***.**.** ignorecommand = bantime = 1h findtime = 1h maxretry = 10 maxmatches = %(maxretry)s backend = auto usedns = warn logencoding = auto enabled = false mode = normal filter = %(__name__)s[mode=%(mode)s] blocktype = DROP destemail = x*******-********@yahoo.com sender = x*******-********@yahoo.com mta = sendmail protocol = tcp chain = \u003cknown/chain\u003e port = 0:65535 fail2ban_agent = Fail2Ban/%(fail2ban_version)s banaction = iptables-multiport banaction_allports = iptables-allports action = %(action_local)s action_ = %(banaction)s[port=\"%(port)s\", protocol=\"%(protocol)s\", chain=\"%(chain)s\"] action_mw = %(action_)s %(mta)s-whois[sender=\"%(sender)s\", dest=\"%(destemail)s\", protocol=\"%(protocol)s\", chain=\"%(chain)s\"] action_mwl = %(action_)s %(mta)s-whois-lines[sender=\"%(sender)s\", dest=\"%(destemail)s\", logpath=\"%(logpath)s\", chain=\"%(chain)s\"] action_xarf = %(action_)s xarf-login-attack[service =%(__name__)s, sender=\"%(sender)s\", logpath=\"%(logpath)s\", port=\"%(port)s\"] action_cf_mwl = cloudflare[cfuser=\"%(cfemail)s\", cftoken=\"%(cfapikey)s\"] %(mta)s-whois-lines[sender=\"%(sender)s\", dest=\"%(destemail)s\", logpath=\"%(logpath)s\", chain=\"%(chain)s\"] action_blocklist_de = blocklist_de[email=\"%(sender)s\", service=\"%(__name__)s\", apikey=\"%(blocklist_de_apikey)s\", agent=\"%(fail2ban_agent)s\"] action_abuseipdb = abuseipdb action_local = iptables-multiport[chain=\"%(chain)s\", protocol=\"%(protocol)s\", port=\"%(port)s\", blocktype=\"%(blocktype)s\"] telegram telegram.local sudo vi /etc/fail2ban/action.d/telegram.local [Definition] actionstart = actionstop = actioncheck = actionban = /home/dev/.local/bin/notify_fail2ban.sh actionban \u003cname\u003e \u003cip\u003e actionunban = /home/dev/.local/bin/notify_fail2ban.sh actionunban \u003cname\u003e \u003cip\u003e 11-sshd.local sudo vi /etc/fail2ban/jail.d/11-sshd.local [sshd] filter = sshd[mode=aggressive] logpath = %(syslog_authpriv)s action = %(action_local)s chain = INPUT protocol = tcp port = 22 maxretry = 1 enabled = true 12-vsftpd.local sudo vi /etc/fail2ban/jail.d/12-vsftpd.local [vsftpd] filter = vsftpd logpath = %(vsftpd_log)s action = %(action_local)s chain = INPUT protocol = tcp port = 21,6****:6**** maxretry = 1 enabled = true 구성 적용 sudo fail2ban-server restart \u0026\u0026 \\ sudo fail2ban-client restart \u0026\u0026 \\ sudo systemctl restart fail2ban \u0026\u0026 sudo systemctl status fail2ban \u0026\u0026 \\ sudo systemctl list-units --type service sudo fail2ban-client status sshd; sudo fail2ban-client status vsftpd logrotate sudo vi /etc/logrotate.d/fail2ban /var/log/fail2ban.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate /usr/bin/fail2ban-client flushlogs \u003e/dev/null || true endscript } 밴 등록/취소 1 sudo fail2ban-client set sshd banip 1.1.1.1; sudo fail2ban-client set sshd unbanip 1.1.1.1; sudo fail2ban-client set vsftpd banip 1.1.1.1; sudo fail2ban-client set vsftpd unbanip 1.1.1.1 vi /home/dev/.local/bin/notify_fail2ban.sh #!/bin/sh # fail2ban 알림 . /home/dev/.bashrc . /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp action=\"$1\" name=\"$2\" ip=\"$3\" { if [ \"$action\" = \"actionstart\" ]; then echo [\"$name\"] started fi if [ \"$action\" = \"actionstop\" ]; then echo [\"$name\"] stopped fi if [ \"$action\" = \"actionban\" ]; then echo [\"$name\"] Ban \"$ip\" whois \"$ip\" | grep -iE \"^(address|country)\" \\ | sed -E 's/^(country|address)(.*:)( +)(.*)/\\1: \\4/gI' fi if [ \"$action\" = \"actionunban\" ]; then echo [\"$name\"] Unban \"$ip\" fi } \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" Troubleshooting fail2ban action firewallcmd 발생 시 firewalld에서 docker chain 사라짐\nfail2ban의 action_local 방식 변경 (jail.local): firewallcmd-multiport -\u003e iptables-multiport\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/notify_fail2ban.sh ↩︎\n","categories":["apps"],"description":"fail2ban sshd + vsftpd 구성","excerpt":"fail2ban sshd + vsftpd 구성","ref":"/apps/fail2ban/","tags":["fail2ban"],"title":"fail2ban"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/fail2ban/","tags":"","title":"fail2ban"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/grafana/","tags":"","title":"grafana"},{"body":"\ngraph LR A1[my.jdownloader.org] \u003c-- tcp/api --\u003e B[jdownloader] A1 \u003c-- https --\u003e D[client] host 구성 포트 개방 sudo firewall-cmd --permanent --add-forward-port=port=6****:proto=tcp:toport=3129 \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all container 구성 .env vi /opt/jdownloader/.env JD_EMAIL=x*******-********@yahoo.com JD_PASSWORD=y*************************************************************** docker-compose.yml vi /opt/jdownloader/docker-compose.yml services: jdownloader: image: antlafarge/jdownloader:alpine container_name: jdownloader networks: - dev ports: - 3129:3129/tcp user: 1000:1000 environment: - UID=1000 - GID=1000 - JD_DEVICENAME=$HOSTNAME - JD_EMAIL=$JD_EMAIL - JD_PASSWORD=$JD_PASSWORD volumes: - /etc/timezone:/etc/timezone:ro - /etc/localtime:/etc/localtime:ro - /opt/jdownloader/config:/jdownloader/cfg:rw - /opt/jdownloader/config/org.jdownloader.extensions.eventscripter.EventScripterExtension.scripts.json:/jdownloader/cfg/org.jdownloader.extensions.eventscripter.EventScripterExtension.scripts.json:ro - /home/dev/downloads:/jdownloader/downloads:rw restart: unless-stopped networks: dev: external: true org.jdownloader.api.myjdownloader.MyJDownloaderSettings.json 포트 구성\nvi /opt/jdownloader/config/org.jdownloader.api.myjdownloader.MyJDownloaderSettings.json { \"uniquedeviceidsaltv2\": \"2***************************************************************\", \"autoconnectenabledv2\": true, \"debugenabled\": false, \"uniquedeviceid\": null, \"lastupnpport\": 0, \"lastlocalport\": 3129, \"latesterror\": \"NONE\", \"preferredipversion\": \"SYSTEM\", \"manuallocalport\": 3129, \"password\": \"y***************************************************************\", \"serverhost\": \"api.jdownloader.org\", \"directconnectmode\": \"LAN\", \"devicename\": \"g*******\", \"manualremoteport\": 6****, \"uniquedeviceidv2\": \"2*******************************\", \"email\": \"x*******-********@yahoo.com\" } org.jdownloader.extensions.eventscripter.EventScripterExtension.scripts.json 사용자 정의 javascript\n자동 업데이트 (default) 다운로드 준비 시 알림 다운로드 완료 후 알리고 rclone 모니터링 폴더로 이동시킨다 vi /opt/jdownloader/config/org.jdownloader.extensions.eventscripter.EventScripterExtension.scripts.json ... \"name\": \"Auto-update\", \"script\": \" disablePermissionChecks(); if (callAPI('update', 'isUpdateAvailable') \u0026\u0026 isDownloadControllerIdle() \u0026\u0026 !callAPI('linkcrawler', 'isCrawling') \u0026\u0026 !callAPI('linkgrabberv2', 'isCollecting') \u0026\u0026 !callAPI('extraction', 'getQueue').length \u003e 0) { callAPI('update', 'restartAndUpdate'); } \" ... \"name\": \"started\", \"script\": \" disablePermissionChecks(); if (isDownloadControllerIdle()) { startDownloads(); var tel_chat_id = '1*********'; var tel_bot_key = '6*********************************************'; var text = '\u003cb\u003ejdownloader\u003c/b\u003e\\\\nstarted'; postPage('https://api.telegram.org/bot' + tel_bot_key + '/sendMessage', 'parse_mode=HTML\u0026disable_web_page_preview=False\u0026chat_id=' + tel_chat_id + '\u0026text=' + escape(text)); } \" ... \"name\": \"download-completed\", \"script\": \" disablePermissionChecks(); if (package.isFinished()) { var isMoved = getPath(package.getDownloadFolder()).moveTo(getPath('/jdownloader/downloads/watched/')); var tel_chat_id = '1*********'; var tel_bot_key = '6*********************************************'; if (isMoved) { var text = '\u003cb\u003ejdownloader\u003c/b\u003e\\\\n' + package.getName() + ', ' + (package.getBytesTotal() / (1024 * 1024 * 1024)).toFixed(2) + ' GiB download completed'; postPage('https://api.telegram.org/bot' + tel_bot_key + '/sendMessage', 'parse_mode=HTML\u0026disable_web_page_preview=False\u0026chat_id=' + tel_chat_id + '\u0026text=' + escape(text)); } else { var text = '\u003cb\u003ejdownloader\u003c/b\u003e\\\\n' + package.getName() + ', ' + (package.getBytesTotal() / (1024 * 1024 * 1024)).toFixed(2) + ' GiB move failed'; postPage('https://api.telegram.org/bot' + tel_bot_key + '/sendMessage', 'parse_mode=HTML\u0026disable_web_page_preview=False\u0026chat_id=' + tel_chat_id + '\u0026text=' + escape(text)); } package.remove(); } \" ... Troubleshooting 자동 업데이트 시 사용자 스크립트 삭재됨\n자동 업데이트 시 변경되지 않도록 EventScripterExtension.scripts.json을 읽기 전용으로 마운트 (docker-compose.yml)\nISP DLIVE에서 api.jdownloader.org IP 차단 (88.99.115.46)\n우회 필요. xray/wireguard로 우회됨을 확인 (2025-04)\n","categories":["apps"],"description":"jdownloader 구성","excerpt":"jdownloader 구성","ref":"/apps/jdownloader/","tags":["jdownloader","docker"],"title":"jdownloader"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/jdownloader/","tags":"","title":"jdownloader"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/keepass/","tags":"","title":"keepass"},{"body":"\ngraph LR subgraph agq3mbw2 A[openwrt] --- B1[keepass.kdbx] A[openwrt] --- B2[ssh] end B2 ---- D[duckdns] D \u003c-- ssh --\u003e C1[clients] C1 --- C2[keepass.keyx] openwrt 구성 포트 개방 vi /etc/config/firewall ... config redirect option dest 'lan' option target 'DNAT' option name 'agq3mbw2-ssh' option src 'wan' option dest_port '22' list proto 'tcp' option dest_ip '192.168.192.1' option family 'ipv4' option src_dport '5****' ... /etc/init.d/firewall restart 계정 추가 client windows android echo \"dev:x:1000:1000:dev:/home/dev:/bin/ash\" \u003e\u003e /etc/passwd \u0026\u0026 \\ echo \"dev:x:1000:dev\" \u003e\u003e /etc/group \u0026\u0026 \\ echo \"dev:19073:0:99999:7:::\" \u003e\u003e /etc/shadow \u0026\u0026 \\ passwd dev _*************************************************************** mkdir -p /home/dev/.ssh \u0026\u0026 \\ echo \"ssh-ed25519 A******************************************************************* agq3mbw2-eddsa-key-20230927 \" | sudo tee /home/dev/.ssh/authorized_keys \u0026\u0026 \\ chmod 755 /home \u0026\u0026 \\ chmod 755 /home/dev \u0026\u0026 \\ chmod 700 /home/dev/.ssh \u0026\u0026 \\ chmod 600 /home/dev/.ssh/authorized_keys \u0026\u0026 \\ chown -R dev:dev /home/dev echo \"vscp5ekq:x:1001:1000:vscp5ekq:/home/vscp5ekq:/bin/ash\" \u003e\u003e /etc/passwd \u0026\u0026 \\ echo \"agq3mbw2:x:1000:vscp5ekq\" \u003e\u003e /etc/group \u0026\u0026 \\ echo \"vscp5ekq:.:0:0:99999:7:::\" \u003e\u003e /etc/shadow \u0026\u0026 \\ passwd vscp5ekq Z*************************************************************** mkdir -p /home/vscp5ekq/.ssh \u0026\u0026 \\ echo \"ssh-rsa A*****************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************== generated by Keepass2Android \" | sudo tee /home/vscp5ekq/.ssh/authorized_keys \u0026\u0026 \\ chmod 755 /home \u0026\u0026 \\ chmod 755 /home/vscp5ekq \u0026\u0026 \\ chmod 700 /home/vscp5ekq/.ssh \u0026\u0026 \\ chmod 600 /home/vscp5ekq/.ssh/authorized_keys \u0026\u0026 \\ chown -R vscp5ekq:dev /home/vscp5ekq dropbear cat \u003c\u003c EOF | tee /etc/config/dropbear config dropbear option Port '22' option PasswordAuth 'off' option RootPasswordAuth 'off' option GatewayPorts 'on' EOF /etc/init.d/dropbear restart 패키지 설치 opkg update \u0026\u0026 \\ opkg install luci-app-ddns drill curl openssh-sftp-server ddns vi /etc/config/ddns config ddns 'global' option ddns_dateformat '%F %R' option ddns_loglines '250' option ddns_rundir '/var/run/ddns' option ddns_logdir '/var/log/ddns' option use_curl '1' config service 'duckdns' option service_name 'duckdns.org' option use_ipv6 '0' option enabled '1' option password 'b*******-****-****-****-************' option use_https '1' option ip_source 'network' option ip_network 'wan' option interface 'wan' option use_syslog '2' option check_unit 'minutes' option force_unit 'minutes' option retry_unit 'seconds' option param_enc 'https://www.duckdns.org/update?domains=agq3mbw2\u0026token=b*******-****-****-****-************' option cacert '/etc/ssl/certs/ca-certificates.crt' option lookup_host 'sj9n7air.duckdns.org' option domain 'sj9n7air.duckdns.org' option username 'sj9n7air' /etc/init.d/ddns restart db 권한 chown dev:dev -R /usr/share/keepass \u0026\u0026 \\ chmod 770 /usr/share/keepass \u0026\u0026 \\ chmod 660 /usr/share/keepass/fhy8vp3u.kdbx windows 구성 KeePass.config.xml vi $APPDATA/KeePass/KeePass.config.xml ... \u003cDatabasePath\u003esftp://sj9n7air.duckdns.org:5****/usr/share/keepass/fhy8vp3u.kdbx\u003c/DatabasePath\u003e \u003cKeyFilePath\u003e..\\..\\Users\\dev\\AppData\\Roaming\\KeePass\\fhy8vp3u.keyx\u003c/KeyFilePath\u003e ... License 상업적 이용 제한 없음\nkeepass: GNU GPL 1 D2Coding: OFL 2 Troubleshooting android 버전은 ssh키를 앱에서 관리하고 외부키를 사용할 수 없음 3\n각 클라이언트별 계정 생성 외에는 방법이 없다\nReferences https://www.duckdns.org/install.jsp#openwrt https://keepass.info/help/v2/license.html ↩︎\nhttps://github.com/naver/d2codingfont ↩︎\n최신 버전은 가능하다고 함 (구버전 해당 없음) https://github.com/PhilippC/keepass2android/issues/2009 ↩︎\n","categories":["infra"],"description":"keepass.kdbx를 openwrt openssh-sftp-server에 올려 home-lab 패스워드 관리자 구성","excerpt":"keepass.kdbx를 openwrt openssh-sftp-server에 올려 home-lab 패스워드 관리자 구성","ref":"/infra/keepass-openwrt-sftp/","tags":["openwrt","sftp","duckdns","keepass"],"title":"keepass openwrt sftp 구성"},{"body":"\nGitHub repository 바로 가기\ncontainer 구성 .env vi /opt/python/.env PGSQL_HOST=host.docker.internal PGSQL_PORT=5432 PGSQL_DB=dev PGSQL_USER=dev PGSQL_PASSWORD=y*************************************************************** PAWAN_API_KEY=p************************************************** GROQ_API_KEY=g******************************************************* GEMINI_API_KEY=A************************************** DEEPL_API_KEY=9************************************** XWDFELA2_BOT_KEY=7********************************************* PROXY_HOST=2**.**.**.* PROXY_PORT=6**** Dockerfile vi /opt/python/Dockerfile FROM python:3-slim ENV TZ=Asia/Seoul RUN apt-get update \u0026\u0026 \\ apt-get install -y python3 \u0026\u0026 \\ python -m pip install --no-cache-dir --upgrade pip \\ pycryptodome \\ psycopg2-binary \\ requests bs4 lxml \\ selenium \\ deep-translator deepl \\ python-telegram-bot \\ g4f[all] openai groq google-generativeai \u0026\u0026 \\ apt-get autoremove -y \u0026\u0026 \\ apt-get clean autoclean \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* docker build -t e7hnr8ov/python:3-slim /opt/python med_exam.sh 1 vi ~/.local/bin/med_exam.sh #!/bin/bash # med_exam source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh container=\"py-med-exam\" docker ps -q --filter \"name=$container\" | xargs -r docker stop sleep 1 docker run \\ -i --rm --name=\"$container\" --network=dev --user=0:0 \\ --add-host=host.docker.internal:host-gateway \\ --env-file=/opt/python/.env \\ -v /home/dev/workspace/med_exam:/opt/python:rw \\ e7hnr8ov/python:3-slim \\ python /opt/python/med_exam.py \"$@\" Jobs Command Remarks py_med_exam.sh -i RT51KR-PK01 기초 데이터 생성 py_med_exam.sh -d 8************ 기초 데이터 삭제 py_med_exam.sh -a 8************ 기초 데이터 생성 py_med_exam.sh -u 8************ 주민등록번호 암호화 py_med_exam.sh -j 9********************== 주민등록번호 복호화 py_med_exam.sh -k 9********************== 암호화 키 갱신 데모 페이지 2 바로 가기 1 바로 가기 2 Troubleshooting python 패키지 g4f 프롬프트 1000자 제한 3\nif(re.compile(r\"^$|.*{\\\"code\\\":[0-9]{3}.*|.*message exceeds.*\").match(res)): #빈값, raw값, 메시지 1000자 초과 재시도 python 패키지 google-trans-new 번역 불가\n패키지 삭제\ngoogletrans==4.0.0-rc1\n10.38 The conflict is caused by:\n10.38 googletrans 4.0.0rc1 depends on httpx==0.13.3\n10.38 groq 0.11.0 depends on httpx\u003c1 and \u003e=0.23.0\npython 패키지 googletrans, groq 의존성 충돌\nTypeError: not all arguments converted during string formatting\npython 패키지 psycopg2 execute 파라미터 마지막 “,” 추가\ncur.execute(\"DELETE FROM dev.medi_exam WHERE user_id = %s\", (row[j],)) SQL Error [0A000]: ERROR: cannot use column reference in DEFAULT expression\nERROR: cannot use column reference in DEFAULT expression\nERROR: cannot use column reference in DEFAULT expression\npython 패키지 psycopg2 오류. db 컬럼 default값 ‘‘로 변경\ngrafana 절사 오류 (소수점 정밀도 3)\nregexp_replace(trunc(extract(epoch FROM T1.exam_tm - drg_adm_tm) / (60 * 60), 1)::TEXT, '(^[0-9]+)(.0)', '\\\\1') grafana table에서 다른 컬럼값 사용\n${__data.fields[\"prod_link\"]} ${__value.raw} https://github.com/dntco43u/s6h7k8rv/blob/main/med_exam.sh ↩︎\nhttps://github.com/dntco43u/med_exam ↩︎\nhttps://discord.com/channels/1205230024970469488/1259285338673643701 ↩︎\n","categories":["dev"],"description":"건강검진 및 생동성, 임상시험 피실험자에게 공개된 검사 데이터를 가공 후 시각화하고 AI들의 소견 출력","excerpt":"건강검진 및 생동성, 임상시험 피실험자에게 공개된 검사 데이터를 가공 후 시각화하고 AI들의 소견 출력","ref":"/dev/med-exam/","tags":["postgresql","python","grafana"],"title":"med-exam"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/openwrt/","tags":"","title":"openwrt"},{"body":"\ngraph LR subgraph gvp6nx1a A1[apps] \u003c-- tcp --\u003e B2[postgresql] end B2 \u003c-- tcp --\u003e D[client] host 구성 사설 인증서로 외부 접속 개방 sudo rm -rf /var/lib/pgsql \u0026\u0026 \\ sudo dnf -y update \u0026\u0026 \\ sudo dnf module remove -y postgresql:16/server \u0026\u0026 \\ sudo dnf module install -y postgresql:16/server \u0026\u0026 \\ sudo postgresql-setup --initdb sudo vi /var/lib/pgsql/data/pg_hba.conf ... # \"local\" is for Unix domain socket connections only local all all trust # IPv4 local connections: host all all 127.0.0.1/32 trust # IPv6 local connections: host all all ::1/128 trust # Allow replication connections from localhost, by a user with the # replication privilege. local replication all trust host replication all 127.0.0.1/32 trust host replication all ::1/128 trust host all all all scram-sha-256 sudo vi /var/lib/pgsql/data/postgresql.conf ... # - Connection Settings - listen_addresses = '*' # - Authentication - password_encryption = scram-sha-256 # - SSL - ssl = on ssl_cert_file = '/var/lib/pgsql/server.crt' ssl_key_file = '/var/lib/pgsql/server.key' ssl_ciphers = ' ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ARIA256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384' ssl_ecdh_curve = 'X448:secp521r1:secp384r1' ssl_min_protocol_version = 'TLSv1.2' ssl_dh_params_file = '/opt/nginx/ssl/dhparam.pem' ... cd /usr/share/pki/ca-trust-source/anchors \u0026\u0026 \\ sudo openssl req -new -x509 -nodes -text -out server.crt \\ -keyout server.key -subj '/C=KR/ST=Seoul/L=Jungnang/O=fhy8vp3u/OU=dev/CN=fhy8vp3u/emailAddress=x*******-********@yahoo.com' \u0026\u0026 \\ sudo openssl x509 -in server.crt -noout -dates \u0026\u0026 \\ sudo chown dev:dev server.{key,crt} \u0026\u0026 \\ sudo chmod 0400 server.key \u0026\u0026 \\ sudo mv /usr/share/pki/ca-trust-source/anchors/server.crt /var/lib/pgsql/server.crt \u0026\u0026 \\ sudo mv /usr/share/pki/ca-trust-source/anchors/server.key /var/lib/pgsql/server.key \u0026\u0026 \\ sudo chown postgres:postgres /var/lib/pgsql/server.crt \u0026\u0026 \\ sudo chown postgres:postgres /var/lib/pgsql/server.key 디스크 mount Note 기본적으로 유일한 방법은 FAQ에 설명 된대로 “allocsize\"마운트 옵션을 사용하는 것입니다.\nInnoDB는 최대 16kB의 64페이지를 읽으므로 “allocsize=1M\"이 가장 좋습니다.\n고객과 마찬가지로 많은 DBA 또는 시스템 관리자도 이러한 동작을 인식하지 못할 수 있으며 실행 중인 시스템에서만 감지할 수 있습니다.\n슬프게도, 나는 그것이 효과가 없었다고 말해야합니다. 미리 할당 된 공간의 크기는 원래 실행에서와 같이 계속 커졌습니다.\n더 나쁜 것은이 명령을 실행 한 후 시작한 실행에도 영향을 미치지 않았다는 것입니다.\n이는 마운트된 XFS 파일 시스템에 대해 “allocsize” 값을 변경할 수 없으며, 마운트 시 해당 값이 마운트 해제될 때까지 유효하다는 것을 증명합니다.\n마운트 해제 한 다음 새로 마운트하여 “allocsize = 1M\"을 제공 할 때만 고정 크기가 사전 할당 금액으로 표시되었습니다.\nDBA의 관점에서 볼 때 이 변경으로 인해 MySQL 인스턴스의 종료를 피할 수 없음을 의미합니다. (물론 Galera 클러스터에 대해 이야기하면 노드를 한 번에 하나씩 처리 할 수 있기 때문에 시스템을 계속 사용할 수 있습니다.)\n디스크 mount 구성 noatime,nodiratime,logbufs=8,logbsize=256k,allocsize=1m (벤치마크 결과는 이전 구성과 속도 차이 없음)\nsudo vi /etc/fstab ... UUID=1475585f-cb15-4080-9012-48b9b7d9d1ed / xfs defaults,noatime,nodiratime,logbufs=8,logbsize=256k,allocsize=1m 0 0 ... sudo mount -a 포트 개방 sudo firewall-cmd --permanent --add-forward-port=port=5****:proto=tcp:toport=5432 \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all 내/외부망 테스트 sudo psql -U postgres -h 127.0.0.1 -p 5432 -d postgres; sudo psql -U postgres -h 1**.****.**.** -p 5**** -d postgres 암호화 패키지 설치 sudo dnf -y update \u0026\u0026 sudo dnf install -y postgresql-contrib --postgre 계정 로그인. 해당 schema에서 실행. CREATE EXTENSION pgcrypto; GRANT ALL PRIVILEGES ON ALL FUNCTIONS IN SCHEMA dev TO dev; GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA dev TO dev; License 상업적 이용 제한 없음\nPostgreSQL License 1 Troubleshooting The hostname 1**.****.. could not be verified by hostnameverifier PgjdbcHostnameVerifier.\n연결 시 sslmode 확인\npsql: could not connect to server: No such file or directory\n연결 포트 확인\nCould not open extension control file “/usr/share/pgsql/extension/pgcrypto.control”: No such file or directory.\n암호화 패키지 누락\nhttps://www.postgresql.org/about/licence/ ↩︎\n","categories":["infra"],"description":"postgresql 구성","excerpt":"postgresql 구성","ref":"/infra/postgresql/","tags":["rhel","postgresql"],"title":"postgresql"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/proxmox/","tags":"","title":"proxmox"},{"body":"\nproxmox 기타 local-lvm 삭제 lvremove /dev/pve/data \u0026\u0026 \\ lvresize -l +100%FREE /dev/pve/root \u0026\u0026 \\ resize2fs /dev/mapper/pve-root node 이름 변경 TARGET_HOST=xxxxxxxx \u0026\u0026 \\ sed -i \"s/$TARGET_HOST/p6dhywxp/\" /etc/hostname \u0026\u0026 \\ sed -i \"s/$TARGET_HOST/p6dhywxp/\" /etc/hosts \u0026\u0026 \\ sed -i \"s/$TARGET_HOST/p6dhywxp/\" /etc/postfix/main.cf \u0026\u0026 \\ mv /var/lib/rrdcached/db/pve2-node/$TARGET_HOST /var/lib/rrdcached/db/pve2-node/p6dhywxp \u0026\u0026 \\ mv /var/lib/rrdcached/db/pve2-storage/$TARGET_HOST /var/lib/rrdcached/db/pve2-storage/p6dhywxp \u0026\u0026 \\ rm -rf /var/lib/rrdcached/db/pve2-{node,storage}/$TARGET_HOST \u0026\u0026 \\ ls /var/lib/rrdcached/db/pve2-{node,storage} \u0026\u0026 \\ systemctl stop pve-cluster \u0026\u0026 systemctl stop pvestatd \u0026\u0026 \\ systemctl restart pve-cluster \u0026\u0026 systemctl restart pvestatd no-subscription web–ui에서 node -\u003e hostname -\u003e repositories -\u003e disable enterprise/enable no subscription\nvi /etc/apt/sources.list.d/pve-enterprise.list # deb https://enterprise.proxmox.com/debian... bookworm eve-enterprise vi /etc/apt/sources.list deb http://download.proxmox.com/debian/pve bookworm pve-no-subscription vi /etc/apt/sources.list.d/ceph.list # deb https://enterprise.proxmox.com/debian... bookworm enterprise deb http://download.proxmox.com/debian/ce... bookworm no-subscription 구독 팝업 삭제 cp /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js{,.bak} \u0026\u0026 \\ sed -i \"/^ *checked_command:/,/^ *[a-zA-Z_]+:/{ s/status\\.toLowerCase() !== 'active'/\\0 \\\u0026\\\u0026 false/ }\" /usr/share/javascript/proxmox-widget-toolkit/proxmoxlib.js microcode 패치 bash -c \"$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/misc/microcode.sh)\" repo, subscription nag 비활성화 bash -c \"$(wget -qLO - https://github.com/tteck/Proxmox/raw/main/misc/post-pve-install.sh)\" use tablet for pointer 비활성화 for vm in $(qm list | awk '{print $1}' | grep [0-9]); do qm set $vm --tablet 0; done 절전 공통 powertop apt update -y \u0026\u0026 \\ apt install powertop -y \u0026\u0026 \\ powertop --auto-tune \u0026\u0026 \\ systemctl enable powertop \u0026\u0026 systemctl restart powertop aspm dmesg | grep ASPM \u0026\u0026 \\ lspci -vv | awk '/ASPM/{print $0}' RS= | grep --color -P '(^[a-z0-9:.]+|ASPM )' aspm.py 1 재시작 시 aspm 활성화\ncd /usr/local/bin \u0026\u0026 curl -OL https://raw.githubusercontent.com/0x666690/ASPM/main/aspm.py crontab -e ... @reboot /usr/bin/python3 /usr/local/bin/aspm.py ... systemctl restart crond intel cpu cup 세대에 따라 절전 구성 지원 범위가 다르므로 테스트할 것\nCPU hwp/epb intel_pstate scaling_governor j5005 2 × ✓ ✓ hwp/epb 구성 예 3\nx86_energy_perf_policy --hwp-min 8 --hwp-max 10 --turbo-enable 0; x86_energy_perf_policy --hwp-epp 255 --turbo-enable 0; x86_energy_perf_policy --hwp-epp 0 --turbo-enable 1; x86_energy_perf_policy --hwp-min 8 --hwp-max 28 --turbo-enable 1; 구성 확인\ncat /sys/devices/system/cpu/cpu*/power/energy_perf_bias \u0026\u0026 \\ cat /sys/devices/system/cpu/cpu*/cpufreq/energy_performance_preference intel_pstate 4 구성 예\necho 70 | tee /sys/devices/system/cpu/intel_pstate/max_perf_pct; echo 100 | tee /sys/devices/system/cpu/intel_pstate/max_perf_pct; 재시작해도 구성 유지하려면 커널 구성에 반영\nvi /etc/default/grub ... GRUB_CMDLINE_LINUX=\"intel_pstate=active pcie_aspm=force pcie_aspm.policy=powersupersave\" ... update-grub \u0026\u0026 update-initramfs -u 구성 확인\ncat /sys/devices/system/cpu/intel_pstate/no_turbo \u0026\u0026 \\ cat /sys/devices/system/cpu/intel_pstate/status \u0026\u0026 \\ cat /sys/devices/system/cpu/intel_pstate/num_pstates \u0026\u0026 \\ cat /sys/devices/system/cpu/intel_pstate/turbo_pct \u0026\u0026 \\ cat /sys/devices/system/cpu/intel_pstate/max_perf_pct \u0026\u0026 \\ cat /sys/devices/system/cpu/intel_pstate/min_perf_pct governor 구성 예\necho \"powersave\" | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; echo \"performance\" | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor; echo 800000 | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_min_freq; echo 2800000 | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq; echo 2800000 | tee /sys/devices/system/cpu/cpu*/cpufreq/scaling_setspeed; cpufrequtils 5\napt update -y \u0026\u0026 apt install -y cpufrequtils \u0026\u0026 \\ cat \u003c\u003c 'EOF' \u003e /etc/default/cpufrequtils GOVERNOR=\"powersave\" EOF cat /etc/default/cpufrequtils \u0026\u0026 \\ cpufreq-info 구성 확인\ncat /sys/devices/system/cpu/cpu*/cpufreq/scaling_governor \u0026\u0026 \\ cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_min_freq \u0026\u0026 \\ cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_max_freq \u0026\u0026 \\ cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_setspeed iommu (VT-d) dmesg | grep -e DMAR -e IOMMU \u0026\u0026 \\ vi /etc/default/grub ... GRUB_CMDLINE_LINUX=\"intel_iommu=on\" ... update-grub \u0026\u0026 reboot disk qcow2 이미지 결합 qemu-img info /var/lib/vz/images/100/vm-100-disk-0.qcow2 \u0026\u0026 \\ qm config 100 \u0026\u0026 \\ pvesm status \u0026\u0026 \\ qm set 100 -scsi0 /var/lib/vz/images/100/vm-100-disk-0.qcow2 disk passthrough lsblk |awk 'NR==1{print $0\" DEVICE-ID(S)\"}NR\u003e1{dev=$1;printf $0\" \";system(\"find /dev/disk/by-id -lname \\\"*\"dev\"\\\" -printf \\\" %p\\\"\");print \"\";}'|grep -v -E 'part|lvm' \u0026\u0026 \\ qm config 100 | egrep --color -i \"^(sata|scsi)\" qm set 100 -scsi1 /dev/disk/by-id/ata-WDC_WD******-*******_**-******** uuid로 디스크 식별자 고정 6 \"$(readlink -f /dev/disk/by-uuid/f*******-****-****-****-************)\" 기타 모든 SMART와 비SMART, 쓰기 캐시, apm 상태\nsmartctl -x /dev/sda \u0026\u0026 \\ hdparm -W /dev/sda \u0026\u0026 \\ hdparm -B /dev/sda hdd 절전 모드 헤드 파킹 비활성화\nhdparm -C /dev/disk/by-uuid/f*******-****-****-****-************ \u0026\u0026 \\ hdparm -S 0 /dev/disk/by-uuid/f*******-****-****-****-************ ssd 파티션 정렬 상태\napt install -y parted \u0026\u0026 \\ parted /dev/nvme0n1 nic 7 nic 이름 변경 ip addr vi /etc/network/interfaces Proxmox naming convention\nName Remarks eno1 최초의 온보드 NIC enp3s0f1 PCI 버스 3, 슬롯 0에 있는 NIC의 기능 1 service networking restart wakeonlan ethtool -s enp2s0 wol g \u0026\u0026 \\ ethtool enp2s0 | grep Wake-on \u0026\u0026 \\ vi /etc/network/interfaces iface enp2s0 inet manual post-up /usr/sbin/ethtool -s enp2s0 wol g eee 비활성화 8 realtek nic가 간헐적으로 끊어질 때 시도할 것\nethtool --show-eee enp2s0 \u0026\u0026 \\ ethtool --set-eee enp2s0 eee off tx-lpi off r8169 -\u003e r8168 apt update -y \u0026\u0026 \\ apt install pve-headers build-essential -y \u0026\u0026 \\ curl -OL https://github.com/sbwml/package_kernel_r8168/releases/download/8.053.00/r8168-8.053.00.tar.bz2 \u0026\u0026 \\ tar -xvf r8168-8.053.00.tar.bz2 \u0026\u0026 \\ cd r8168-8.053.00 \u0026\u0026 \\ chmod 700 autorun.sh \u0026\u0026 \\ ./autorun.sh \u0026\u0026 \\ echo \"blacklist r8169\" \u003e\u003e /etc/modprobe.d/pve-blacklist.conf \u0026\u0026 \\ cat /etc/modprobe.d/pve-blacklist.conf \u0026\u0026 \\ lspci -vv \u0026\u0026 \\ lsmod | grep \"r816\" \u0026\u0026 \\ systemctl restart networking \u0026\u0026 \\ ip addr \u0026\u0026 \\ cd .. \u0026\u0026 rm r8168-8.053.00.tar.bz2 \u0026\u0026 rm -rf /r8168-8.053.00 echo 0 | tee /sys/class/net/enp2s0/device/link/l1_1_aspm \u0026\u0026 \\ echo 0 | tee /sys/class/net/enp2s0/device/link/l1_2_aspm \u0026\u0026 \\ echo 1 | tee /sys/class/net/enp2s0/device/link/l1_aspm r8168 -\u003e r8169 apt update -y \u0026\u0026 \\ apt install pve-kernel pve-headers build-essential -y \u0026\u0026 \\ modprobe -r -v r8168 \u0026\u0026 \\ modprobe -v r8169 \u0026\u0026 \\ echo \"blacklist r8168\" \u003e\u003e /etc/modprobe.d/pve-blacklist.conf \u0026\u0026 \\ cat /etc/modprobe.d/pve-blacklist.conf \u0026\u0026 \\ update-grub \u0026\u0026 \\ update-initramfs -u \u0026\u0026 \\ reboot lspci -vv \u0026\u0026 \\ insmod /lib/modules/6.8.12-1-pve/kernel/drivers/net/phy/realtek.ko \u0026\u0026 \\ insmod /lib/modules/6.8.12-1-pve/kernel/drivers/net/ethernet/realtek/r8169.ko \u0026\u0026 \\ find / -name *r8168* -exec rm -rf {} \\; License 상업적 이용 제한 없음\npve-no-subscription | AGPL v3 9 Troubleshooting web-ui 501\nsystemctl restart pveproxy dmesg [ 1075.771449] r8168 0000:02:00.0: Unable to change power state from unknown to D0, device inaccessible\n[ 1075.772728] r8168 0000:02:00.0: Unable to change power state from D3cold to D0, device inaccessible\nr8111gn은 r8168 + l1_aspm으로 구성하면 정상 작동하지만 l1_1_aspm이나 l1_2_aspm을 추가하면 먹통 됨\nr8168 드라이버가 aspm 문제를 해결할 때까지 r8169 사용할 것\nReferences https://manpages.debian.org/experimental/linux-cpupower/x86_energy_perf_policy.8.en.html https://manpages.debian.org/bookworm/smartmontools/smartctl.8.en.html https://proxmox.com/en/products/proxmox-virtual-environment/comparison https://z8.re/blog/aspm.html https://www.reddit.com/r/Proxmox/comments/tgojp1/removing_proxmox_subscription_notice/?tl=ko https://www.reddit.com/r/linux4noobs/comments/1fzupnf/why_linux_by_default_install_r8169_instead_of/ https://www.reddit.com/r/linux4noobs/comments/168ca7f/r8168_driver_installed_instead_of_r8169_on_ubuntu/ https://www.reddit.com/r/Proxmox/comments/150stgh/proxmox_8_rtl8169_nic_dell_micro_formfactors_in/ https://medium.com/@pattapongj/how-to-fix-network-issues-after-upgrading-proxmox-from-7-to-8-and-encountering-the-r8169-error-d2e322cc26ed https://rovingclimber.com/2023/07/28/proxmox-8-debian-12-with-realtek-rtl8111h-nic/ https://rovingclimber.com/category/home-server/ https://mattgadient.com/7-watts-idle-on-intel-12th-13th-gen-the-foundation-for-building-a-low-power-server-nas/ https://github.com/0x666690/ASPM ↩︎\nintel_pstate=per_cpu_perf_limits 공통 cpufreq에 접근 가능하나 passive로 변경됨 ↩︎\n–hwp-min, –hwp-max, –hwp-desired의 경우 값 옵션은 100MHz 단위. 12는 1200MHz를 의미 ↩︎\nhttps://www.kernel.org/doc/html/latest/admin-guide/pm/intel_pstate.html ↩︎\ngorvernor와 같은 설정을 참조 ↩︎\nhttps://forum.proxmox.com/threads/system-disk-number-changed-when-i-add-new-drive.98338/ ↩︎\n구형 realtek nic들과 linux 사이에 해결할 수 없는 문제가 많음. r8168과 r8169 드라이버는 의견도 갈리고 커널과 드라이버 버전 경우의 수도 많아서 양쪽을 테스트할 것 ↩︎\nhttps://en.wikipedia.org/wiki/Energy-Efficient_Ethernet ↩︎\nhttps://forum.proxmox.com/threads/does-proxmox-still-offer-a-fully-free-version.146066/ ↩︎\n","categories":["infra"],"description":"proxmox 기타 구성 메모","excerpt":"proxmox 기타 구성 메모","ref":"/infra/proxmox-etc/","tags":["proxmox"],"title":"proxmox 기타 구성"},{"body":"\ngraph LR subgraph gvp6nx1a B1[jackett] \u003c-- https/api --\u003e B B[qbittorrent] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 .env vi /opt/qbittorrent/.env TEL_BOT_KEY=6********************************************* TEL_CHAT_ID=1********* docker-compose.yml vi /opt/qbittorrent/docker-compose.yml services: qbittorrent: image: lscr.io/linuxserver/qbittorrent:latest container_name: qbittorrent networks: - dev ports: - 8080/tcp - 6881:6881 user: 0:0 environment: - PUID=1000 - PGID=1000 - UMASK=022 - TZ=Asia/Seoul - WEBUI_PORT=8080 - TORRENTING_PORT=6881 - TEL_BOT_KEY=$TEL_BOT_KEY - TEL_CHAT_ID=$TEL_CHAT_ID volumes: - /opt/qbittorrent/config:/config:rw - /opt/qbittorrent/watched:/watched:rw - /home/dev/videos:/videos:rw - /home/dev/.local/bin/utils.sh:/config/utils.sh:ro - /home/dev/downloads:/downloads:rw - /home/dev/videos:/videos:rw restart: unless-stopped networks: dev: external: true jackett plugin vi /opt/qbittorrent/config/qBittorrent/nova3/engines/jackett.json { \"api_key\": \"s*******************************\", \"thread_count\": 20, \"tracker_first\": false, \"url\": \"https://ja.gvp6nx1a.duckdns.org\" } 완료 시 1 vi /opt/qbittorrent/config/qbittorrent_complete.sh #!/bin/bash # qbittorrent 다운로드 알림 source /config/utils.sh log_file=/tmp/$(basename \"$0\" | sed 's/.sh//').log msg_file=/tmp/$(basename \"$0\" | sed 's/.sh//').tmp gib=$(awk 'BEGIN {printf \"%.2f\", '\"$2\"' / (1024 * 1024 * 1024)}') echo \"$1, $gib GiB download completed\" \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" #do not download 폴더, 파일 삭제 find \"/downloads/watched\" -type d -name \".unwanted\" | sed 's/\\/.unwanted/\"/' | sed 's/^/\"/g' | xargs rm -rf find \"/downloads/watched\" -type f -name \"*.\\!qB\" find \"/downloads/complete\" -type d -name \".unwanted\" | sed 's/\\/.unwanted/\"/' | sed 's/^/\"/g' | xargs rm -rf find \"/downloads/complete\" -type f -name \"*.\\!qB\" host 구성 포트 개방 sudo firewall-cmd --permanent --add-forward-port=port=6****:proto={tcp,udp}:toport=6881 \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all crond 2 vi ~/.local/bin/update_ipfilter.sh #!/bin/bash # ipfilter.dat 데이터베이스 갱신 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp { curl http://upd.emule-security.org/ipfilter.zip \\ -o /opt/qbittorrent/config/ipfilter.zip 7z e /opt/qbittorrent/config/ipfilter.zip \\ -o/opt/qbittorrent/config mv /opt/qbittorrent/config/guarding.p2p \\ /opt/qbittorrent/config/ipfilter.dat rm /opt/qbittorrent/config/ipfilter.zip } \u003e \"$log_file\" show_file_stat /opt/qbittorrent/config/ipfilter.dat \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" docker restart qbittorrent \u0026\u0026 \\ grep \"IP filter\" /opt/qbittorrent/config/qBittorrent/data/logs/qbittorrent.log Troubleshooting libtorrent v2.0 메모리 누수\nlibtorrent v1.2를 사용하는 마지막 버전 v4.3.9로 고정 3\nv5.1.2 메모리 누수 없음 (2025-11)\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/qbittorrent_complete.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/update_ipfilter.sh ↩︎\nhttps://www.reddit.com/r/qBittorrent/comments/suuoi3/does_441_fix_440s_memory_leak_issues/ ↩︎\n","categories":["apps"],"description":"qbittorrent 구성","excerpt":"qbittorrent 구성","ref":"/apps/qbittorrent/","tags":["torrent","docker"],"title":"qbittorrent"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/rclone/","tags":"","title":"rclone"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/rhel/","tags":"","title":"rhel"},{"body":"\nhost 구성 설치 sudo dnf -y update \u0026\u0026 \\ sudo dnf install -y samba wsdd \u0026\u0026 \\ sudo systemctl enable wsdd \u0026\u0026 sudo systemctl enable smb \u0026\u0026 \\ sudo systemctl restart wsdd \u0026\u0026 sudo systemctl restart smb \u0026\u0026 \\ sudo systemctl status wsdd \u0026\u0026 sudo systemctl status smb 포트 개방 smb: 139/tcp, 445/tcp\nwsdd: 3702/udp, 5357/tcp 1 sudo firewall-cmd --permanent --add-port={139,445}/tcp \u0026\u0026 \\ sudo firewall-cmd --permanent --add-port=3702/udp \u0026\u0026 \\ sudo firewall-cmd --permanent --add-port=5357/tcp \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all selinux sudo setsebool -P samba_export_all_ro on \u0026\u0026 \\ sudo setsebool -P samba_export_all_rw on \u0026\u0026 \\ sudo chcon -R -t samba_share_t /mnt/d2 \u0026\u0026 \\ ls -lZ /mnt/d2 \u0026\u0026 \\ sudo semanage boolean -l | grep samba smb.conf vi /etc/samba/smb.conf ... [global] workgroup = WORKGROUP server min protocol = SMB3 client min protocol = SMB3 security = USER wins support = yes [d2] path = /mnt/d2 guest ok = no writable = yes valid users = dev create mask = 0660 directory mask = 0770 wsdd sudo vi /usr/lib/systemd/system/wsdd.service # Command-line options for wsdd OPTIONS=\"--interface eth0 --ipv4only --shortlog\" 암호, 권한 구성 sudo chown -R dev:dev /mnt/d2 \u0026\u0026 \\ sudo chmod -R 0660 /mnt/d2 \u0026\u0026 \\ sudo chmod -R ug+X /mnt/d2 \u0026\u0026 \\ sudo smbpasswd -a dev ***************** sudo systemctl restart smb License 상업적 이용 제한 없음\nsamba: GNU GPL v3 2 wsdd: MIT 3 Troubleshooting 네트워크에 samba가 노출되지 않음\nwsdd 서비스 확인. nic 이름이 변경된 경우 wsdd 구성 변경 필요\nsudo systemctl status wsdd \u0026\u0026 sudo systemctl status smb 원본과 달리 samba에서 8.3형식으로 파일명이 변경됨 4 5\n파일명이 samba 표준과 어긋남 (후행 공백 등)\nvi /etc/samba/smb.conf ... [global] mangled names = no ... samba 구성 변경으로 접근하기보다 원본 폴더명을 변경하는 식으로 해결할 것\nReferences https://unix.stackexchange.com/questions/600026/samba-share-with-force-user-is-still-not-writable-unless-files-have-777-permis/750152#750152 https://forum.level1techs.com/t/synology-ds1618-performance-tweaking-enabling-smb-multichannel/138719/1 https://superuser.com/questions/1587290/why-is-smb-client-not-capable-of-using-rss-although-its-enabled https://docs.microsoft.com/en-us/archive/blogs/josebda/the-basics-of-smb-multichannel-a-feature-of-windows-server-2012-and-smb-3-0 https://lokna.no/?p=1617 https://en.wikipedia.org/wiki/Samba_(software) https://github.com/christgau/wsdd ↩︎\nhttps://www.samba.org/samba/ms_license.html ↩︎\nhttps://github.com/christgau/wsdd/blob/master/LICENSE ↩︎\nhttps://superuser.com/questions/458995/files-folders-get-weird-names-and-become-inaccessible-on-samba-share ↩︎\nhttps://forums.truenas.com/t/smb-mangles-long-file-names-to-dos8-3-why-have-i-fixed-it/10784/10 ↩︎\n","categories":["infra"],"description":"samba 구성","excerpt":"samba 구성","ref":"/infra/samba/","tags":["samba","wsdd"],"title":"samba"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/samba/","tags":"","title":"samba"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/sftp/","tags":"","title":"sftp"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/sh/","tags":"","title":"sh"},{"body":"\ngraph LR subgraph gvp6nx1a B[slskd] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] host 구성 포트 개방 sudo firewall-cmd --permanent --add-forward-port=port=6****:proto=tcp:toport=2234 \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all container 구성 docker-compose.yml vi /opt/slskd/docker-compose.yml services: slskd: image: slskd/slskd:latest container_name: slskd networks: - dev ports: - 5030/tcp - 2234:6****/tcp user: 1000:1000 environment: - SLSKD_REMOTE_CONFIGURATION=true - TZ=Asia/Seoul volumes: - /opt/slskd/config:/app:rw - /home/dev/downloads:/downloads:rw - /mnt/pc9xqpnh-gdrive/music:/music:rw restart: unless-stopped networks: dev: external: true ","categories":["apps"],"description":"slskd 구성","excerpt":"slskd 구성","ref":"/apps/slskd/","tags":["slskd","docker"],"title":"slskd"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/slskd/","tags":"","title":"slskd"},{"body":"\ngraph LR subgraph gvp6nx1a B[teldrive] \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[client] container 구성 .env vi /opt/teldrive/.env POSTGRES_USER=teldrive POSTGRES_PASSWORD=X*************************************************************** docker-compose.yml vi /opt/teldrive/docker-compose.yml services: teldrive: image: ghcr.io/tgdrive/teldrive:latest container_name: teldrive networks: - dev ports: - 59314:8080/tcp user: 1000:1000 environment: - TZ=Asia/Seoul volumes: - /opt/teldrive/config/config.toml:/config.toml:rw - /opt/teldrive/config/storage.db:/storage.db:rw restart: unless-stopped depends_on: - teldrive_db teldrive_db: image: groonga/pgroonga:latest-alpine-17 container_name: teldrive_db networks: - dev user: 1000:1000 environment: - POSTGRES_DB=postgres - POSTGRES_USER=$POSTGRES_USER - POSTGRES_PASSWORD=$POSTGRES_PASSWORD - TZ=Asia/Seoul volumes: - /opt/teldrive/data:/var/lib/postgresql/data restart: unless-stopped networks: dev: external: true config.toml vi /opt/teldrive/config/config.toml [db] data-source = \"postgres://teldrive:X***************************************************************@teldrive_db/postgres\" [jwt] secret = \"7***************************************************************\" [tg] app-id = 2******* app-hash = \"f*******************************\" rate = 50 #ban 되지 않기 위한 속도 제한 rate-burst = 20 rate-limit = true [tg.stream] multi-threads = 6 stream-buffers = 20 [tg.uploads] encryption-key = \"b***************************************************************\" db 초기화 sudo rm -rf /opt/teldrive/data/* proxy 구성 vi /opt/nginx/config/conf.d/include/proxy.conf proxy_http_version 1.1; # Proxy SSL proxy_ssl_server_name on; # Proxy headers proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Forwarded $proxy_add_forwarded; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Protocol $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header Connection \"\"; # Proxy timeouts proxy_connect_timeout 180s; proxy_send_timeout 180s; proxy_read_timeout 180s; ... vi /opt/nginx/config/sites-available/teldrive.conf ... location / { if ($allowed_country = no) { return 403; } include /etc/nginx/conf.d/include/proxy.conf; # webdav 공통 proxy_buffering off; proxy_request_buffering off; client_max_body_size 0; keepalive_timeout 180s; proxy_pass http://teldrive:8080; } ... Troubleshooting 봇 추가 시 속도 하락 (2025-10)\n봇 삭제 시 속도 정상화\n","categories":["apps"],"description":"teldrive 구성","excerpt":"teldrive 구성","ref":"/apps/teldrive/","tags":["teldrive","docker"],"title":"teldrive"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/teldrive/","tags":"","title":"teldrive"},{"body":"\nhost 구성 패키지 설치 1 sudo dnf -y update \u0026\u0026 \\ sudo dnf install -y unzip \u0026\u0026 curl -sSL instl.vercel.app/rclone | bash \u0026\u0026 sudo dnf remove -y unzip \u0026\u0026 \\ cat ~/.config/rclone/rclone.conf crond 2 3 vi ~/.local/bin/rclone_move.sh #!/bin/bash # rclone으로 이동 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp cat /dev/null \u003e \"$log_file\" flock -n /tmp/rclone.lock \\ rclone move \\ \"$1\" \"$2\" \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file \"$log_file\" --log-level DEBUG \\ --delete-empty-src-dirs grep -oE '^Transferred:.*100%.*\\/s' \"$log_file\" \\ | head -n 1 | sed 's/\\t//g' | sed 's/ */ /g' \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" graph TB subgraph ec4mrjp5 F2[icnex2pa.py] -- tcp --\u003e F1[oracle] F3[.dbpasswd] -- 일일 생성 --\u003e F2 end subgraph gvp6nx1a A1[backup-data] -- 일일 생성 --\u003e A[rclone] end F3 -- ssh --\u003e A A -- 최신 일로부터 7개 --\u003e D[ftp] A -- 최신 일로부터 7개 --\u003e C[s3] A -- 최신 일로부터 7개 --\u003e E[teambition] vi ~/.local/bin/conf_backup.sh #!/bin/bash # conf 백업 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp today=$(date +%Y%m%d) key=$(ssh dev@1**.***.**.* -p 6**** -i /home/dev/.ssh/dev@ec4mrjp5.pem cat /home/dev/.local/etc/.dpasswd) if [[ \"$HOSTNAME\" == \"gvp6nx1a\" ]]; then net_type=\"lan\" else net_type=\"wan\" fi { if [ -z \"$key\" ]; then err \"MANDATORY PARAMETER MISSING\" exit 1 fi if [ ! -d \"/tmp/conf_$HOSTNAME\" ]; then mkdir -p \"/tmp/conf_$HOSTNAME\" fi if [ -f \"/tmp/conf_$HOSTNAME/conf_$today.7z\" ]; then rm \"/tmp/conf_$HOSTNAME/conf_$today.7z\" fi #excludelist에서 절대 경로 인식 -spf2 7z a -mx9 -xr@/home/dev/.local/etc/.7zexc_conf -spf2 -p\"$key\" -mhc=on \\ -mhe=on \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ /etc/{fstab,profile.d,motd.d,logrotate.d,vsftpd,samba,fail2ban,ansible} 7z a -mx9 -xr@/home/dev/.local/etc/.7zexc_conf -spf2 -p\"$key\" -mhc=on \\ -mhe=on \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ /home/dev 7z a -mx9 -xr@/home/dev/.local/etc/.7zexc_conf -spf2 -p\"$key\" -mhc=on \\ -mhe=on \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ /opt #sj9n7air-ftp rclone delete \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --min-age 7d \\ \"sj9n7air-ftp:/mnt/d2/backups/$HOSTNAME\" rclone copy \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --ignore-times \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ \"sj9n7air-ftp:/mnt/d2/backups/$HOSTNAME\" #ahgcnzl5-s3 rclone delete \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --min-age 7d \\ \"ahgcnzl5-s3:/ahgcnzl5/backups/$HOSTNAME\" rclone copy \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --ignore-times \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ \"ahgcnzl5-s3:/ahgcnzl5/backups/$HOSTNAME\" #gvp6nx1a-alist-ndgzbj1c@teambition eval rclone delete \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --min-age 7d \\ \"gvp6nx1a-alist-$net_type:/ndgzbj1c@teambition/backups/$HOSTNAME\" eval rclone copy \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_conf_backup.log --log-level DEBUG \\ --include \"{conf_*.7z}\" \\ --ignore-times \\ \"/tmp/conf_$HOSTNAME/conf_$today.7z\" \\ \"gvp6nx1a-alist-$net_type:/ndgzbj1c@teambition/backups/$HOSTNAME\" } \u003e \"$log_file\" { show_file_stat \"/tmp/conf_$HOSTNAME/conf_$today.7z\" echo \"key=$key\" } \u003e \"$msg_file\" rm -rf \"/tmp/conf_$HOSTNAME\" \u003e\u003e \"$log_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" License 상업적 이용 제한 없음\nMIT 4 https://github.com/tgdrive/rclone ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/rclone_move.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/conf_backup.sh ↩︎\nhttps://rclone.org/licence/ ↩︎\n","categories":["infra"],"description":"teldrive 지원하는 포크 된 rclone 구성","excerpt":"teldrive 지원하는 포크 된 rclone 구성","ref":"/infra/tgdrive-rclone/","tags":["rclone"],"title":"tgdrive/rclone"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/torrent/","tags":"","title":"torrent"},{"body":"\nGitHub repository 바로 가기\nhost 구성 의존 패키지 설치 distro RHEL openwrt sudo dnf -y update \u0026\u0026 sudo dnf install -y bc opkg update \u0026\u0026 opkg install bc coreutils-numfmt coreutils-date coreutils-stat utils.sh distro RHEL openwrt vi ~/.local/bin/utils.sh vi /usr/sbin/utils.sh #!/bin/sh # 공통 함수 # Dependency packages: # rhel bc # openwrt bc, coreutils-numfmt, coreutils-date, coreutils-stat ######################################## # error 출력 # Arguments: # * ######################################## err() { echo \"[$(date +'%Y-%m-%dT%H:%M:%S')] $*\" \u003e\u00262 } ######################################## # 두 날짜 사이의 유효 날짜 반환 # Arguments: # old_date # new_date # Outputs: # yyyymmdd ######################################## get_valid_dates() { old_date=\"$1\" new_date=\"$2\" for i in $(seq -w \"$old_date\" \"$new_date\"); do date -d \"$i\" +%Y%m%d 2\u003e /dev/null done } ######################################## # 상태 표시줄 출력 # Arguments: # current # total # unit ######################################## show_progress_bar() { bar_size=18 current=\"$1\" total=\"$2\" unit=\"$3\" percent=$(echo \"scale=2; 100 * $current / $total\" | bc) done=$(echo \"scale=0; $bar_size * $percent / 100\" | bc) todo=$(echo \"scale=0; $bar_size - $done\" | bc) done_sub_bar=$(printf \"%${done}s\" | sed 's/ /█/g') todo_sub_bar=$(printf \"%${todo}s\" | sed 's/ /▒/g') if [ \"$unit\" = \"%\" ]; then printf \"%s\\n\" \"${done_sub_bar}${todo_sub_bar} ${percent}${unit}\" else printf \"%s\\n\" \"${done_sub_bar}${todo_sub_bar} ${current}/${total}${unit}\" fi } ######################################## # stat 요약 출력 # Arguments: # file_path ######################################## show_file_stat() { file_path=\"$1\" file_info=$(stat --printf=\"%n,%s,%y\" \"$file_path\") if [ -z \"$file_info\" ]; then err \"FILE NOT FOUND\" printf \"%s\\n\" \"File not found\" return 1 fi file_info_name=$(basename \"$(echo \"$file_info\" | cut -d ',' -f1)\") file_info_size=$(numfmt --to=iec \"$(echo \"$file_info\" | cut -d ',' -f2)\")\"B\" file_info_mtime=$(echo \"$file_info\" | cut -d ',' -f3) file_info_mtime=$(echo \"$file_info_mtime\" | cut -d '.' -f1) printf \"%s\\n\" \"$file_info_name: $file_info_size, $file_info_mtime\" } ######################################## # df 요약 출력 # Arguments: # disk_path ######################################## show_disk_stat() { disk_path=\"$1\" # disk_path 뒤 공백 추가, 앞자리가 동일한 경우 disk_info=$(df | grep \"$disk_path \" | awk '{print $1\",\"$2\",\"$3}') if [ -z \"$disk_info\" ]; then err \"DISK NOT FOUND\" printf \"%s\\n\" \"Disk not found\" return 1 fi disk_info_filesystem=$(echo \"$disk_info\" | cut -d ',' -f1) disk_info_size=$(($(echo \"$disk_info\" | cut -d ',' -f2) * 1024)) disk_info_used=$(($(echo \"$disk_info\" | cut -d ',' -f3) * 1024)) disk_info_size_iec=$(numfmt --to=iec \"$disk_info_size\")\"B\" disk_info_used_iec=$(numfmt --to=iec \"$disk_info_used\")\"B\" printf \"%s\\n\" \"$disk_info_filesystem: $disk_info_used_iec/$disk_info_size_iec\" show_progress_bar \"$disk_info_used\" \"$disk_info_size\" \"%\" } ######################################## # telegram 전송 # Arguments: # telegram_bot_key # telegram_chat_id ######################################## send_tel_msg() { telegram_bot_key=\"$1\" telegram_chat_id=\"$2\" msg_file=\"$3\" if [ -z \"$(cat \"$msg_file\")\" ]; then err \"NO MESSAGES\" return 1 fi msg_head=\"\u003cb\u003e$0\u003c\\/b\u003e\\n\" sed -i \"1s|^|$msg_head|g\" \"$msg_file\" msg=$(\u003c \"$msg_file\" head -c 4096) curl \\ --data parse_mode=HTML \\ --data disable_web_page_preview=True \\ --data chat_id=\"$telegram_chat_id\" \\ --data-urlencode text=\"$msg\" \\ https://api.telegram.org/bot\"$telegram_bot_key\"/sendMessage } ######################################## # secret 마스킹 # Arguments: # secret # unmask_len # Outputs: # unmasked secret + masked secret ######################################## show_secret() { secret=\"$1\" unmask_len=\"$2\" secret_len=$((\"${#secret}\" - \"$unmask_len\")) left=\"$(echo \"$secret\" | sed -E \"s/(\\S{0,$unmask_len})(.*)/\\1/g\")\" right=\"$(printf \"%${secret_len}s\" | sed 's/ /*/g')\" echo \"$left$right\" } ######################################## # 날짜명 기준 이후 file/dir 삭제 # Arguments: # base_date # base_path # cut_option ######################################## delete_over_date() { base_date=\"$1\" base_path=\"$2\" cut_option=\"$3\" dates=$(find \"$base_path\"/ -mindepth 1 -maxdepth 1 -exec basename {} \\; \\ | $cut_option) for d in $dates; do if [ \"$base_date\" -gt \"$d\" ]; then path=\"$base_path/$d\" rm -rf \"${path:?}\"* fi done } ######################################## # user 복사 # Arguments: # src_user # dest_user ######################################## copy_user() { src_user=\"$1\" dest_user=\"$2\" src_groups=$(id -Gn \"$src_user\" | sed \"s/ /,/g\" \\ | sed -r \"s/\\\u003c$src_user\\\u003e\\b,?//g\") src_shell=$(awk -F : -v name=\"$src_user\" '(name == $1) { print $7 }' \\ /etc/passwd) useradd --groups \"$src_groups\" --shell \"$src_shell\" --create-home \"$dest_user\" passwd \"$dest_user\" } ######################################## # 무작위 문자열 생성 # Arguments: # len ######################################## rand_string() { len=\"$1\" tr -dc A-Za-z0-9 \u003c/dev/urandom | head -c \"$len\" } ","categories":["dev"],"description":"공통 sh","excerpt":"공통 sh","ref":"/dev/utils-sh/","tags":["sh","bash"],"title":"utils.sh"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/wsdd/","tags":"","title":"wsdd"},{"body":"\ngraph LR subgraph gvp6nx1a A[acme.sh] ---\u003e A2[ssl-cert] A2 \u003c---\u003e A3[apps] end F3[zerossl] -- dns-api --\u003e A container 구성 .env vi /opt/.acme/.env DuckDNS_Token=b*******-****-*********-************ zerossl 계정 등록 docker run -it --rm --name=acme --user=0:0 \\ --env-file /opt/.acme/.env \\ -e TZ=Asia/Seoul \\ -v /opt/.acme:/acme.sh:rw \\ neilpang/acme.sh:latest \\ acme.sh --set-default-ca --register-account --server zerossl -m x*******-********@yahoo.com --eab-kid j********************* --eab-hmac-key D************************************************************************************* SSL 인증서 최초 발급 docker run -it --rm --name=acme --user=0:0 \\ -e TZ=Asia/Seoul \\ -v /opt/.acme:/acme.sh:rw \\ neilpang/acme.sh:latest \\ acme.sh --issue --dns dns_duckdns -d \"$HOSTNAME.duckdns.org\" --keylength ec-384 --force \u0026\u0026 \\ docker run -it --rm --name=acme --user=0:0 \\ -e TZ=Asia/Seoul \\ -v /opt/.acme:/acme.sh:rw \\ neilpang/acme.sh:latest \\ acme.sh --issue --dns dns_duckdns -d \"*.$HOSTNAME.duckdns.org\" --keylength ec-384 --force host 구성 crond 1 vi /home/dev/.local/bin/acme_cron.sh #!/bin/bash # acme.sh 인증서 갱신 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp old_file_date=$(stat --printf=\"%y\" \\ /opt/.acme/\"$HOSTNAME\".duckdns.org_ecc/fullchain.cer) old_file_date=$(echo \"$old_file_date\" | cut -d ' ' -f1 | sed -E 's/-//g') docker run \\ -i --rm --name=acme --network=dev --user=0:0 \\ --env-file=/opt/.acme/.env \\ -e TZ=Asia/Seoul \\ -v /opt/.acme:/acme.sh:rw \\ neilpang/acme.sh:latest \\ acme.sh --cron --debug \u003e \"$log_file\" skip_renew_msg=\"Skip.*Next renewal time is:.*\" if grep -qoE \"$skip_renew_msg\" \"$log_file\"; then cert_exp_date=\"$(date \"+%Y%m%d\" -d \"$old_file_date 90 day\")\" fi total_period=$(get_valid_dates \"$old_file_date\" \"$cert_exp_date\" | wc -l) current_period=$(get_valid_dates \"$(date \"+%Y%m%d\")\" \"$cert_exp_date\" | wc -l) echo \"old_file_date=$old_file_date\" echo \"cert_exp_date=$cert_exp_date\" echo \"total_period=$total_period\" echo \"current_period=$current_period\" { grep -oE \"Your cert key is in:.*|The intermediate CA cert is in:.*|\\ And the full chain certs is there:.*|$skip_renew_msg|Error.*\" \"$log_file\" if grep -qoE \"$skip_renew_msg\" \"$log_file\"; then show_progress_bar \"$current_period\" \"$total_period\" \"d\" fi } \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" License 상업적 이용 제한 없음\nGNU GPL v3 1 https://github.com/dntco43u/s6h7k8rv/blob/main/acme_cron.sh ↩︎ ↩︎\n","categories":["infra"],"description":"acme.sh SSL 인증서 dnsapi 갱신 구성","excerpt":"acme.sh SSL 인증서 dnsapi 갱신 구성","ref":"/infra/acme-sh/","tags":["acme.sh","docker","zerossl"],"title":"acme.sh"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/acme.sh/","tags":"","title":"acme.sh"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/alist/","tags":"","title":"alist"},{"body":"Deprecated teambition 트래픽 정책 변경과 보안 이슈가 잦음\nteambition -\u003e teldrive 마이그레이션 완료 후 삭제할 것\ngraph LR A1[webdrives] -- mount --- B[alist] subgraph gvp6nx1a B \u003c-- proxy --\u003e C[nginx] end C \u003c-- https --\u003e D[rclone] container 구성 docker-compose.yml vi /opt/alist/docker-compose.yml services: alist: image: xhofe/alist:v3.27.0 #보안 이슈로 롤백 https://singingdalong.blogspot.com/2025/06/Alist-project-issue-8649.html#gsc.tab=0 container_name: alist networks: - dev ports: - 5244:5244/tcp user: 0:0 environment: - PUID=1000 - PGID=1000 - UMASK=022 - TZ=Asia/Seoul volumes: - /opt/alist/config:/opt/alist/data:rw restart: unless-stopped networks: dev: external: true config.json 로그 생성 차단\nvi /opt/alist/config/config.json ... \"temp_dir\": \"data/temp\", \"bleve_dir\": \"data/bleve\", \"log\": { \"enable\": false, \"name\": \"data/log/log.log\", \"max_size\": 0, \"max_backups\": 0, \"max_age\": 7, \"compress\": false }, ... proxy 구성 vi /opt/nginx/config/conf.d/include/proxy.conf proxy_http_version 1.1; # Proxy SSL proxy_ssl_server_name on; # Proxy headers proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Forwarded $proxy_add_forwarded; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Protocol $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header Connection \"\"; # Proxy timeouts proxy_connect_timeout 180s; proxy_send_timeout 180s; proxy_read_timeout 180s; ... vi /opt/nginx/config/sites-available/alist.conf ... include /etc/nginx/conf.d/include/proxy.conf; location / { if ($allowed_country = no) { return 403; } proxy_pass http://alist:5244; } location /dav { if ($allowed_country = no) { return 403; } # webdav 공통 proxy_buffering off; proxy_request_buffering off; client_max_body_size 0; keepalive_timeout 180s; proxy_pass http://alist:5244/dav; } ... Note WebAV 액세스 객체와 alist가 LAN인 경우 두 모드 간에 속도 차이가 없습니다. 에이전트 모드를 선택하는 것이 좋습니다. 외부 네트워크인 경우 302 점프는 서버를 우회하여 네트워크 디스크에 직접 액세스할 수 있습니다. 속도가 더 빠르고 alist 서버의 대역폭을 차지하지 않습니다. 그러나 302 점프는 각 네트워크 디스크에 맞게 요청 헤더를 설정해야 할 수 있습니다. 에이전시 모델에는 이러한 우려가 없습니다. 또한 302는 여러 IP에 대한 동시 액세스 문제도 있습니다. 1\nteambition webdav 구성. rclone과 정상 작동 (2015-11)\n302 redirect Use s3 upload method Troubleshooting “error_code”:31326, “error_msg”:“anti hotlinking”\nbaidu 대용량 파일 다운로드 시 오류. User-Agent: pan.baidu.com 변경\nteambition 프리티어 트래픽 정책 변경 (2023-11)\n트래픽 허용량이 너무 작아짐\nnginx 405 오류\nalist에서 Use s3 upload method 활성화\nnginx 413 오류\nnginx에서 client_max_body_size 구성 추가 (webdav 공통)\nvi /opt/nginx/config/sites-available/alist.conf ... client_max_body_size 0; ... AlistGo/alist 프로젝트 이슈 #8649 2\nxhofe/alist:v3.27.0 사용 권고\n보안 취약점: CVE-2024-47067 3\nAList는 여러 저장소를 지원하는 파일 리스트 프로그램입니다.\nAList에는 helper.go에 반영된 크로스 사이트 스크립팅 취약점이 포함되어 있습니다.\n엔드포인트 /i/:link_name는 사용자가 제공한 값을 받아들여 응답에 반영합니다.\n엔드포인트는 application/xml 응답을 반환하여 XHTML을 통해 HTML 태그를 사용할 수 있게 하여 XSS 취약점으로 이어집니다.\n이 취약점은 3.29.0에서 수정되었습니다.\nxhofe/alist:v3.29.0 사용 권고\nhttps://post.smzdm.com/p/agqo096d/ ↩︎\nhttps://singingdalong.blogspot.com/2025/06/Alist-project-issue-8649.html#gsc.tab=0 ↩︎\nhttps://www.cvedetails.com/cve/CVE-2024-47067/ ↩︎\n","categories":["apps"],"description":"alist + nginx webdav 구성","excerpt":"alist + nginx webdav 구성","ref":"/apps/alist/","tags":["alist","nginx","docker"],"title":"alist (deprecated)"},{"body":"\n환경 변수 파일별 구분 Filename Remarks /etc/environment 모든 프로세스에 대해 기본 환경을 지정하는 변수를 정의. 로그인 시. profile이라는 로그인 프로파일을 읽기 전에 시스템은 /etc/environment 파일에서 환경 변수를 설정 /etc/profile, /etc/bashrc 전체 사용자에게 적용 ~/.bashrc, ~/.profile, ~/.bash_profile 해당 사용자에게만 적용 /etc/profile, .profile shell이 bash가 아니라도 로그인하면 로드되어 적용되고. bashrc 와. bash_login, .bash_profile은 bash shell로 로그인 되었을 경우만 적용 ~/.bash_logout 로그인 shell이 로그아웃할 때 수행 Note 무엇을 하는지 알지 못하면 이 파일을 변경하는 것은 좋지 않습니다.\n/etc/profile.d/에 custom.sh 셸 스크립트를 만들어 환경에 대한 사용자 지정 변경을 하는 것이 훨씬 좋습니다.\n이렇게 하면 향후 업데이트에서 병합할 필요가 없습니다.\nroot 계정도 적용하기 위해서는 /etc/bashrc의 수정이 필요하지만 /etc/bashrc 수정은 권장사항이 아니다\n지역적으로는 ~/.bashrc로 구성 (사용자 계정에만 적용)\n전역적으로는 비로그인, 비대화형 쉘이라 하더라도 /etc/profile.d/dev.sh에서 구성\n대화/비대화식 구분 Filename Interactive login Interactive non-login Script /etc/profile A /etc/bash.bashrc A ~/.bashrc B ~/.bash_profile B1 ~/.bash_login B2 ~/.profile B3 BASH_ENV A ~/.bash_logout C 실행 순서 bash 대화형 세션의 경우 다음 순서로 시작 파일을 검색\nOrder Filename 1 /etc/profile.d/xxx.sh 2 /etc/profile 3 /etc/bashrc 4 ~/.bashrc 5 ~/.bash_profile $BASH_ENV 비대화식 쉘 스크립트가 실행하기 전에 구문 분석하는 파일의 경로 이름으로 설정\nFilename Variables crontab (최상단) BASH_ENV=\"$HOME/.bashrc_non_interactive\" ~/.profile BASH_ENV=\"$HOME/.profile\", “$HOME/scripts/myscript.sh” ~/.bashrc BASH_ENV=\"$HOME/.bashrc\" $PATH RHEL9 type 로그인 shell 비로그인 shell echo $PATH /home/dev/.local/bin:/usr/local/bin:/usr/local/sbin:/usr/sbin echo $PATH PATH=/root/.local/bin:/root/bin:/usr/bin:/bin Troubleshooting /home/dev/.local/bin/cleanup_disk.sh: line 38: xfs_fsr: command not found\n/home/dev/.local/bin/cleanup_disk.sh: line 39: hdparm: command not found\n/home/dev/.local/bin/cleanup_disk.sh: line 43: xfs_db: command not found\ncrontab 비로그인 shell에서 /usr/sbin/ 바이너리를 찾지 못함\n위에서 언급한 대로 /sbin/ 바이너리들은 PATH에 구성되어 있지 않음\n비로그인 쉘의 경우/sbin/에 위치한 바이너리는 절대 경로를 입력하는 것을 선호\n","categories":["infra"],"description":"bash 환경 변수 메모","excerpt":"bash 환경 변수 메모","ref":"/infra/bash-env/","tags":["rhel","bash"],"title":"bash 환경 변수"},{"body":"\nhost 구성 패키지 설치 Note docker-compose 패키지 저장소에 추가되었으므로 패키지로 설치해 사용\n또한 바이너리명이 변경되었음. docker-compose -\u003e docker compose\nsudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo \u0026\u0026 \\ sudo dnf update -y \u0026\u0026 sudo dnf upgrade -y \u0026\u0026 \\ sudo dnf install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin \u0026\u0026 \\ sudo systemctl restart docker \u0026\u0026 \\ sudo systemctl enable docker \u0026\u0026 \\ sudo systemctl status docker.service \u0026\u0026 \\ sudo docker run -it --rm busybox nslookup google.com docker-compose 설치 sudo curl -L \"https://github.com/docker/compose/releases/download/v2.6.0/docker compose-$(uname -s)-$(uname -m)\" -o /usr/local/bin/docker compose \u0026\u0026 \\ sudo chmod +x /usr/local/bin/docker compose \u0026\u0026 \\ sudo ln -s /usr/local/bin/docker compose /usr/bin/docker compose \u0026\u0026 \\ sudo docker compose --version 권한 구성 sudo usermod -aG docker dev cat /etc/group | grep docker logout bridge network 관리 편의를 위해 다수의 컨테이너를 bridge로 구성할 것이다\nsudo docker network create --driver bridge --gateway 172.18.0.1 --subnet 172.18.0.0/24 dev docker login docker login -u e*******; L*************************************************************** docker 최상위 폴더 Note 서비스 데이터를 /home에 저장하는 것을 좋아하지 않습니다. 많은 사람들이 Docker를 사용하지만 그 이유를 이해할 수 없습니다.\n그것에 대해 특별히 나쁜 것은 없으며, 데이터베이스를 / etc에 저장하는 것과 같은 지저분한 imho입니다. :-)\n/srv 는 응용 프로그램 / 서비스 데이터를 저장하기 위한 것이므로 사용합니다.\n/opt는 원래 많은 상용 공급업체에서 시스템 파일과 혼합되지 않은 장소에 앱/데이터를 설치하기 위해 사용하는 오래된 표준입니다.\ndocker 최상위 폴더는 현재 뚜렷한 표준이 없음. 여기서는 /opt/apps/로 구성\n컨테이너 log 크기 제한 sudo du -h --max-depth=1 /var/lib/docker | sort -rh cat \u003c\u003c EOF | sudo tee /etc/docker/daemon.json { \"log-driver\": \"local\", \"log-opts\": { \"max-size\": \"10m\" } } EOF sudo systemctl restart docker \u0026\u0026 \\ docker info --format '{{.LoggingDriver}}' \u0026\u0026 \\ docker inspect -f '{{.HostConfig.LogConfig.Type}}' $(docker ps --format \"{{.Names}}\") 디스크 용량 확보 docker container prune -f \u0026\u0026 \\ docker network prune -f \u0026\u0026 \\ docker volume prune -f \u0026\u0026 \\ docker system prune -f \u0026\u0026 \\ docker buildx prune -af \u0026\u0026 \\ docker builder prune -a \u0026\u0026 \\ docker images -a | grep none | awk '{ print $3; }' | xargs docker rmi --force \u0026\u0026 \\ docker rmi $(docker images -q -f dangling=true) sudo find /var/lib/docker/overlay2/ -type f -name *-json.log \u0026\u0026 \\ sudo truncate -s 0 /var/lib/docker/containers/*/*-json.log docker log sudo dockerd --debug License 상업적 이용 제한 없음\ndocker-engine: Apache v2 1 유료 구독 필요 (exceeding 250 employees OR with annual revenue surpassing $10 million USD)\ndocker-desktop 2 Troubleshooting ‘version’ is obsolete\ndocker-compose.yml 버전 명시 일괄 삭제\nsudo find /opt/ -type f -name docker-compose.yml -exec sed -i -z 's/version: \"3.8\"\\n//g' {} \\; References https://www.reddit.com/r/selfhosted/comments/yv8npf/best_practice_dockercompose_setup/ https://www.reddit.com/r/selfhosted/comments/r5i5f9/how_do_you_structure_your_docker_files/ https://www.reddit.com/r/linuxadmin/comments/18z2cxv/what_is_the_srv_directory_and_why_does_it_exist/ https://www.reddit.com/r/docker/comments/125ke3b/are_there_any_best_practices_for_volume_storage/ https://docs.linuxserver.io/general/volumes/#mapping-a-volume-to-your-container https://www.reddit.com/r/docker/comments/xe4u9n/where_is_stated_that_docker_engine_not_docker/?tl=ko https://docs.docker.com/engine/install/rhel/ https://www.docker.com/pricing/ ↩︎\nhttps://docs.docker.com/engine/#licensing ↩︎\n","categories":["infra"],"description":"docker 구성","excerpt":"docker 구성","ref":"/infra/docker/","tags":["docker"],"title":"docker"},{"body":"","categories":"","description":"","excerpt":"","ref":"/categories/etc/","tags":"","title":"etc"},{"body":"\ngraph TB subgraph gvp6nx1a A1[loki] -- http --\u003e B[grafana] A2[postgresql] -- tcp --\u003e B A3[prometheus] -- http --\u003e B A4[postgres-exporter] -- http --\u003e A3 A2 -- tcp --\u003e A4 E1[promtail] -- http --\u003e A1 E2[node-exporter] -- http --\u003e A3 C[nginx] \u003c-- http --\u003e B end E3[node-exporter] -- https --\u003e A3 E4[promtail] -- https --\u003e A1 D[client] \u003c-- https --\u003e C container 구성 docker-compose.yml network bridge 구성이어도 host를 허용하도록 구성\nvi /opt/grafana/docker-compose.yml services: grafana: image: grafana/grafana:11.2.1 container_name: grafana networks: - dev ports: - 3000/tcp extra_hosts: - \"host.docker.internal:host-gateway\" user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/grafana/config/grafana.ini:/etc/grafana/grafana.ini:rw - /opt/grafana/config/init_script.sh:/init_script.sh:rw - /opt/grafana/data:/var/lib/grafana:rw entrypoint: /init_script.sh restart: unless-stopped networks: dev: external: true grafana 공통 변경할 구성 host에 mount\nsudo docker cp grafana:/etc/grafana/grafana.ini /opt/grafana/config/grafana.ini 로그인 없이 view 허용 1\nvi /opt/grafana/config/grafana.ini ... [auth.anonymous] enabled = true org_name = fhy8vp3u org_role = Viewer hide_version = false [security] cookie_samesite = lax allow_embedding = true ... 데모 페이지 nginx 2 nginx access 로그 시각화 (loki 3 + promtail 4)\n바로 가기\nlogs 5 selinux, ssh, nginx access 로그 시각화 (loki 3 + promtail 4)\n바로 가기\npostgres 6 postgresql DB 상태 시각화 (postgres-exporter 7 + prometheus 8)\n바로 가기\nssh 9 ssh 로그 시각화 (loki 3 + promtail 4)\n바로 가기\nnode-rhel 10 RHEL 메트릭 시각화 (node-exporter 11 + prometheus 8)\n바로 가기\nnode-owrt 12 openwrt 메트릭 시각화 (node-exporter-lua 11 + prometheus 8)\n바로 가기\nLicense 상업적 이용 제한 없음\ngrafana v8+: AGPL v3 13 Troubleshooting postgresql where 절 동적 sql 적용\nvariable 조건 중 다중 조건이 활성화되는 경우 IN 연산자 자동 적용\n대시보드 초기화 시 dock menu 닫기\nrun.sh 실행 전에 init_script.sh를 먼저 실행하도록 변경 (docker-compose.yml)\nvi /opt/grafana/config/init_script.sh #!/bin/bash find /usr/share/grafana/public/build -type f -name \"*.js\" | xargs sed -i 's/this.megaMenuDocked=\\(!!\\(.*\\) xxl)),\\)/this.megaMenuDocked=false,/g' bash -c /run.sh chmod 755 /opt/grafana/config/init_script.sh \u0026\u0026 \\ chown dev:dev /opt/grafana/config/init_script.sh SQLite database file has broader permissions than it should 14\ndocker exec -it grafana chmod 640 /var/lib/grafana/grafana.db Skipping finding plugins as directory does not exist\ndocker exec -it grafana mkdir -p /usr/share/grafana/plugins-bundled The Dashboards has been changed by someone else\n버전 충돌. 최신 버전으로 재작업 혹은 json 최하단의 version을 현재 version과 맞춰 저장 15\nhttps://community.grafana.com/t/public-dashboard-grafana-in-external-link-without-login-tutorial/59221/6 ↩︎\nhttps://grafana.com/grafana/dashboards/13865-fgc-nginx01-web-analytics/ ↩︎\nhttps://dntco43u.github.io/apps/loki/#local-configyaml-1 ↩︎ ↩︎ ↩︎\nhttps://dntco43u.github.io/apps/promtail/#configyml ↩︎ ↩︎ ↩︎\nhttps://grafana.com/grafana/dashboards/13359-logs/ ↩︎\nhttps://grafana.com/grafana/dashboards/9628-postgresql-database/ ↩︎\nhttps://dntco43u.github.io/apps/pgsql-exporter/ ↩︎\nhttps://dntco43u.github.io/apps/prometheus/#%EC%9D%BC%EB%B0%98-%EA%B5%AC%EC%84%B1 ↩︎ ↩︎ ↩︎\nhttps://grafana.com/grafana/dashboards/17514-ssh-logs/ ↩︎\nhttps://grafana.com/grafana/dashboards/12486-node-exporter-full/ ↩︎\nhttps://dntco43u.github.io/apps/node-exporter/ ↩︎ ↩︎\nhttps://grafana.com/grafana/dashboards/11147-openwrt/ ↩︎\nhttps://grafana.com/licensing/ ↩︎\nhttps://community.grafana.com/t/migration-from-grafana-7-4-2-to-7-4-3/44525 ↩︎\nhttps://community.grafana.com/t/recurrent-issue-the-dashboards-has-been-changed-by-someone-else/41349/9 ↩︎\n","categories":["infra"],"description":"grafana 구성","excerpt":"grafana 구성","ref":"/infra/grafana/","tags":["grafana","docker"],"title":"grafana"},{"body":"\ngraph LR subgraph gvp6nx1a B[immich] \u003c-- proxy --\u003e C[nginx] G[immich-go] \u003c-- api --\u003e B G1[vsftpd] --- G end C \u003c-- https --\u003e D[client] F1[rclone] -- tcp --\u003e G1 container 구성 .env vi /opt/immich/.env TZ=Asia/Seoul IMMICH_VERSION=release DB_PASSWORD=postgres DB_USERNAME=postgres DB_DATABASE_NAME=immich docker-compose.yml vi /opt/immich/docker-compose.yml services: immich-server: image: ghcr.io/immich-app/immich-server:${IMMICH_VERSION:-release} container_name: immich networks: - dev ports: - 2283:2283/tcp environment: - TZ=Asia/Seoul volumes: - /opt/immich/data:/data:rw restart: unless-stopped depends_on: - redis - database immich-machine-learning: image: ghcr.io/immich-app/immich-machine-learning:${IMMICH_VERSION:-release} container_name: immich_machine_learning networks: - dev environment: - TZ=Asia/Seoul volumes: - /opt/immich/cache:/cache:rw restart: unless-stopped redis: image: docker.io/valkey/valkey:8-bookworm@sha256:fea8b3e67b15729d4bb70589eb03367bab9ad1ee89c876f54327fc7c6e618571 container_name: immich_redis networks: - dev environment: - TZ=Asia/Seoul restart: unless-stopped database: image: ghcr.io/immich-app/postgres:14-vectorchord0.4.3-pgvectors0.2.0@sha256:c44be5f2871c59362966d71eab4268170eb6f5653c0e6170184e72b38ffdf107 container_name: immich_postgres networks: - dev user: 0:0 environment: - TZ=Asia/Seoul - POSTGRES_PASSWORD=${DB_PASSWORD} - POSTGRES_USER=${DB_USERNAME} - POSTGRES_DB=${DB_DATABASE_NAME} - POSTGRES_INITDB_ARGS='--data-checksums' volumes: - /opt/immich/db_data:/var/lib/postgresql/data shm_size: 128mb restart: unless-stopped networks: dev: external: true db 초기화 sudo rm -rf /opt/immich/db_data \u0026\u0026 sudo mkdir /opt/immich/db_data host 구성 immich-go 로컬 폴더에서 immich 서버로 벌크 업로드\ncd ~ \u0026\u0026 \\ curl -L https://github.com/simulot/immich-go/releases/download/v0.28.0/immich-go_Linux_arm64.tar.gz \u003e immich-go.tar.gz \u0026\u0026 \\ tar -zxvf immich-go.tar.gz \u0026\u0026 \\ rm ~/{LICENSE,immich-go.tar.gz} \u0026\u0026 \\ sudo mv immich-go /usr/local/bin /usr/local/bin/immich-go upload from-folder --server http://localhost:2283 --api-key 4***************************************** /home/dev/workspace/vscp5ekq/pictures crond 1 vi ~/.local/bin/immich_go.sh #!/bin/bash # immich-go로 로컬 폴더에서 immich 서버로 업로드 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp WORK_DIR=\"$1\" cat /dev/null \u003e \"$log_file\" flock -n /tmp/immich-go.lock \\ /usr/local/bin/immich-go upload from-folder \\ --no-ui \\ --skip-verify-ssl \\ --server http://localhost:2283 \\ --api-key 4***************************************** \\ --log-file=\"$log_file\" \\ \"$WORK_DIR\" touch \"$msg_file\" { grep -oE \"uploaded\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' grep -oE \"upload error\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' grep -oE \"file not selected\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' grep -oE \"server's asset upgraded with the input\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' grep -oE \"server has same asset\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' grep -oE \"server has a better asset\\s*:\\s*[0-9]*\" \"$log_file\" | sed 's/ */ /g' } \u003e\u003e \"$msg_file\" # 마이그레이션된 파일 갯수가 일치하면 원본 삭제 file_cnt=$(find \"$WORK_DIR\" -type f | wc -l) dup_cnt=$(grep -oE \"server has same asset\\s*:\\s*[0-9]*\" \"$log_file\" | grep -oE \"[0-9]*\") if [[ $file_cnt -gt 0 \u0026\u0026 $file_cnt -eq $dup_cnt ]]; then if [ ! -d /tmp/immich-go ]; then mkdir -p /tmp/immich-go fi mv -f \"$WORK_DIR\"/* /tmp/immich-go rm -rf /tmp/immich-go sed -i \"1i\\Deletion of files ($file_cnt) successfully migrated completed\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" fi rm \"$msg_file\" https://github.com/dntco43u/s6h7k8rv/blob/main/immich_go.sh ↩︎\n","categories":["apps"],"description":"immich 구성","excerpt":"immich 구성","ref":"/apps/immich/","tags":["immich","docker"],"title":"immich"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/immich/","tags":"","title":"immich"},{"body":"\ngraph LR A1 -- tftp --\u003e A2[client] subgraph agq3mbw2 B[netbootxyz] -- tftp --\u003e A1[dhcp] subgraph sj9n7air B \u003c-- proxy --\u003e C[nginx] end end C \u003c-- https --\u003e D[client] host 구성 포트 개방 tftp: 69번 포트\ndhcp: 67번 포트(server, relay agent), 68번 포트(client) 1\ncat /usr/lib/firewalld/services/dhcp.xml | grep port \u0026\u0026 \\ cat /usr/lib/firewalld/services/tftp.xml | grep port \u003cport protocol=\"udp\" port=\"67\"/\u003e \u003cport protocol=\"udp\" port=\"69\"/\u003e sudo firewall-cmd --permanent --add-port=69/udp \u0026\u0026 \\ sudo firewall-cmd --permanent --add-port=8080/tcp \u0026\u0026 \\ sudo firewall-cmd --permanent --remove-port=16000/tcp \u0026\u0026 \\ sudo firewall-cmd --permanent --remove-port=10809/tcp \u0026\u0026 \\ sudo firewall-cmd --permanent --remove-port=67/udp \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all selinux sudo setsebool -P tftp_anon_write 1 \u0026\u0026 \\ sudo setsebool -P tftp_home_dir 1 \u0026\u0026 \\ getsebool -a | grep tftp container 구성 docker-compose.yml vi /opt/netbootxyz/docker-compose.yml services: netbootxyz: image: lscr.io/linuxserver/netbootxyz:latest container_name: netbootxyz networks: - dev ports: - 69:69/udp - 3000:3000/tcp - 8080:80/tcp user: 0:0 environment: - PUID=1000 - PGID=1000 - TZ=Asia/Seoul - PORT_RANGE=30000:30010 - NGINX_PORT=80 - WEB_APP_PORT=3000 volumes: - /opt/netbootxyz/config:/config:rw - /opt/netbootxyz/assets:/assets:rw restart: unless-stopped networks: dev: external: true boot.cfg vi /opt/netbootxyz/config/menus/local/boot.cfg ... # set location of custom netboot.xyz live assets #set live_endpoint https://github.com/netbootxyz set live_endpoint http://sj9n7air:8080 ###################################### # Media Locations for Licensed Distros ###################################### set rhel_base_url set win_base_url ${live_endpoint}/custom/releases/download/windows11 set github_user dntco43u ... menu.ipxe 멀티 부팅 2\nLenovo Diagnostics UEFI Hirens BootCD PE Macrium Reflect vi /opt/netbootxyz/config/menus/local/menu.ipxe #!ipxe :custom_menu clear custom_choice menu User menu item ldiag_uefi ${space} Lenovo Diagnostics UEFI 4.34 item hiren_bootcd ${space} Hirens BootCD PE 1.0 item macrium_reflect ${space} Macrium Reflect 8.0 choose --default ${menu} menu || goto custom_exit echo ${cls} goto ${menu} || chain ${menu}.ipxe || goto custom_exit goto custom_exit # Lenovo Diagnostics UEFI :ldiag_uefi imgfree kernel ${live_endpoint}/custom/releases/download/ldiag/4.34.001-uefi-x64/BOOTX64.efi boot || goto custom_exit # Hirens BootCD PE :hiren_bootcd imgfree kernel https://boot.netboot.xyz/wimboot initrd -n bootmgr ${live_endpoint}/custom/releases/download/hbcd/1.0.8/BOOTMGR bootmgr || initrd -n bootmgr.efi ${live_endpoint}/custom/releases/download/hbcd/1.0.8/bootmgr.efi bootmgr.efi || initrd -n bcd ${live_endpoint}/custom/releases/download/hbcd/1.0.8/boot/bcd bcd || initrd -n boot.sdi ${live_endpoint}/custom/releases/download/hbcd/1.0.8/boot/boot.sdi boot.sdi || initrd -n boot.wim ${live_endpoint}/custom/releases/download/hbcd/1.0.8/sources/boot.wim boot.wim boot || goto custom_exit # Macrium Reflect :macrium_reflect imgfree kernel https://boot.netboot.xyz/wimboot initrd -n bootmgr ${live_endpoint}/custom/releases/download/macrium/8.0.7783/BOOTMGR bootmgr || initrd -n bootmgr.efi ${live_endpoint}/custom/releases/download/macrium/8.0.7783/bootmgr.efi bootmgr.efi || initrd -n bcd ${live_endpoint}/custom/releases/download/macrium/8.0.7783/boot/bcd bcd || initrd -n boot.sdi ${live_endpoint}/custom/releases/download/macrium/8.0.7783/boot/boot.sdi boot.sdi || initrd -n boot.wim ${live_endpoint}/custom/releases/download/macrium/8.0.7783/sources/boot.wim boot.wim boot || goto custom_exit :custom_exit clear menu exit 0 openwrt 구성 dhcp 서버 vi /etc/dnsmasq.conf #pxe boot dhcp-match=set:bios,60,PXEClient:Arch:00000 dhcp-boot=tag:bios,netboot.xyz.kpxe,,sj9n7air dhcp-match=set:efi32_0,60,PXEClient:Arch:00002 dhcp-boot=tag:efi32_0,netboot.xyz.efi,,sj9n7air dhcp-match=set:efi32_1,60,PXEClient:Arch:00006 dhcp-boot=tag:efi32_1,netboot.xyz.efi,,sj9n7air dhcp-match=set:efi64_0,60,PXEClient:Arch:00007 dhcp-boot=tag:efi64_0,netboot.xyz.efi,,sj9n7air dhcp-match=set:efi64_1,60,PXEClient:Arch:00008 dhcp-boot=tag:efi64_1,netboot.xyz.efi,,sj9n7air dhcp-match=set:efi64_2,60,PXEClient:Arch:00009 dhcp-boot=tag:efi64_2,netboot.xyz.efi,,sj9n7air /etc/init.d/dnsmasq restart Troubleshooting boot.cfg, menu.ipxe, custom.ipxe 수정 사항 반영 안 됨\n직접 수정 시 반영되지 않고 web-ui에서 수정해야 반영됨\niso 사용 불가\n압축 해제 후 사용 (iventoy는 iso 지원)\n7z x -y -o/opt/netbootxyz/assets/custom/releases/download/windows11/x64/ /opt/netbootxyz/assets/custom/releases/download/windows11/x64/Win11_23H2_English_x64.iso iventoy의 경우 외부 dhcp를 사용하더라도 67번 개방 필요 ↩︎\nhttps://github.com/dntco43u/netboot.xyz-custom/blob/main/custom.ipxe ↩︎\n","categories":["apps"],"description":"openwrt dhcp + netbootxyz pxe 구성","excerpt":"openwrt dhcp + netbootxyz pxe 구성","ref":"/apps/netbootxyz/","tags":["openwrt","pxeboot","docker"],"title":"netbootxyz"},{"body":"\ngraph LR A5[server] \u003c-- https --\u003e B[nginx] subgraph gvp6nx1a A1[apps] \u003c-- http --\u003e B[nginx] A2[geoip] -- country-code --\u003e B B -- log --\u003e A3[promtail] A3 -- http --\u003e A7[loki] A4[acme.sh] -- ssl-cert --\u003e B end A7 \u003c-- https --\u003e E[server] A6[zerossl] -- dns-api --\u003e A4 B \u003c-- https --\u003e C1[client] container 구성 Dockerfile vi /opt/nginx/Dockerfile FROM nginx:alpine-slim AS builder RUN apk update \u0026\u0026 \\ apk add --no-cache --virtual .build-deps \\ gcc \\ geoip-dev \\ git \\ libc-dev \\ libmaxminddb \\ libmaxminddb-dev \\ make \\ openssl-dev \\ pcre-dev \\ python3-dev \\ py3-pip \\ zlib-dev \u0026\u0026 \\ rm -rf /var/cache/apk/* WORKDIR /usr/local RUN git clone https://github.com/leev/ngx_http_geoip2_module.git --depth=1 RUN wget http://nginx.org/download/nginx-${NGINX_VERSION}.tar.gz \u0026\u0026 \\ mkdir -p /usr/src \u0026\u0026 \\ tar -zxC /usr/src -f nginx-${NGINX_VERSION}.tar.gz RUN CONFARGS=$(nginx -V 2\u003e\u00261 | sed -n -e 's/^.*arguments: //p') \\ cd /usr/src/nginx-$NGINX_VERSION \u0026\u0026 \\ ./configure --with-compat $CONFARGS \\ --add-dynamic-module=/usr/local/ngx_http_geoip2_module/ \u0026\u0026 \\ make \u0026\u0026 \\ make modules \u0026\u0026 \\ make install \u0026\u0026 \\ mkdir -p /usr/local/nginx/modules/ FROM nginx:alpine-slim COPY --from=builder /usr/local/nginx/modules/ngx_http_geoip2_module.so /usr/lib/nginx/modules/ngx_http_geoip2_module.so RUN apk update \u0026\u0026 \\ apk add --no-cache \\ libmaxminddb \\ openssl \u0026\u0026 \\ rm -rf /var/cache/apk/* docker build -t e7hnr8ov/nginx:alpine /opt/nginx docker-compose.yml network bridge 구성이어도 host를 허용하도록 구성\nvi /opt/nginx/docker-compose.yml services: nginx: image: e7hnr8ov/nginx:alpine container_name: nginx networks: - dev ports: - 80:80/tcp - 443:443/tcp extra_hosts: - \"host.docker.internal:host-gateway\" user: 0:0 environment: - TZ=Asia/Seoul volumes: - /opt/nginx/config:/etc/nginx:rw - /opt/nginx/ssl/dhparam.pem:/etc/ssl/dhparam.pem:ro - /opt/nginx/ssl/openssl.cnf:/etc/ssl/openssl.cnf:ro - /opt/nginx/webroot:/usr/share/nginx/html:ro - /opt/nginx/log:/var/log/nginx:rw - /opt/geoipupdate/data:/usr/share/geoip:ro - /opt/.acme/*.$HOSTNAME.duckdns.org_ecc/fullchain.cer:/etc/ssl/*.$HOSTNAME.duckdns.org/fullchain.pem:ro - /opt/.acme/*.$HOSTNAME.duckdns.org_ecc/*.$HOSTNAME.duckdns.org.key:/etc/ssl/*.$HOSTNAME.duckdns.org/privkey.pem:ro restart: unless-stopped networks: dev: external: true openssl openssl 암호 정책과 dhparam.pem 생성\nsudo docker cp nginx:/etc/ssl/openssl.cnf /opt/nginx/ssl/openssl.cnf \u0026\u0026 \\ sudo openssl dhparam -out ~/dhparam1.pem 4096 \u0026\u0026 \\ sudo mv ~/dhparam1.pem /opt/nginx/ssl/dhparam.pem vi /opt/nginx/ssl/openssl.cnf [default_conf] ssl_conf = ssl_sect [ssl_sect] system_default = system_default_sect [system_default_sect] MinProtocol = TLSv1.2 #CipherString = DEFAULT@SECLEVEL=2 Ciphersuites = TLS_AES_256_GCM_SHA384 CipherString = ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ARIA256-GCM-SHA384 *.conf 변경할 구성 host에 mount\nsudo docker cp nginx:/etc/nginx /opt/nginx/config \u0026\u0026 \\ chown dev:dev -R /opt/nginx 모듈, 사용자 구성 참조. 수집 데이터 활용을 위해 json log 구성\n/opt/nginx/config/nginx.conf # Load modules include /etc/nginx/modules-enabled/*.conf; ... log_format json escape=json '{' '\"msec\": \"$msec\", ' '\"connection\": \"$connection\", ' '\"connection_requests\": \"$connection_requests\", ' '\"pid\": \"$pid\", ' '\"request_id\": \"$request_id\", ' '\"request_length\": \"$request_length\", ' '\"remote_addr\": \"$remote_addr\", ' '\"remote_user\": \"$remote_user\", ' '\"remote_port\": \"$remote_port\", ' '\"time_local\": \"$time_local\", ' '\"time_iso8601\": \"$time_iso8601\", ' '\"request\": \"$request\", ' '\"request_uri\": \"$request_uri\", ' '\"args\": \"$args\", ' '\"status\": \"$status\", ' '\"body_bytes_sent\": \"$body_bytes_sent\", ' '\"bytes_sent\": \"$bytes_sent\", ' '\"http_referer\": \"$http_referer\", ' '\"http_user_agent\": \"$http_user_agent\", ' '\"http_x_forwarded_for\": \"$http_x_forwarded_for\", ' '\"http_host\": \"$http_host\", ' '\"server_name\": \"$server_name\", ' '\"request_time\": \"$request_time\", ' '\"upstream\": \"$upstream_addr\", ' '\"upstream_connect_time\": \"$upstream_connect_time\", ' '\"upstream_header_time\": \"$upstream_header_time\", ' '\"upstream_response_time\": \"$upstream_response_time\", ' '\"upstream_response_length\": \"$upstream_response_length\", ' '\"upstream_cache_status\": \"$upstream_cache_status\", ' '\"ssl_protocol\": \"$ssl_protocol\", ' '\"ssl_cipher\": \"$ssl_cipher\", ' '\"scheme\": \"$scheme\", ' '\"request_method\": \"$request_method\", ' '\"server_protocol\": \"$server_protocol\", ' '\"pipe\": \"$pipe\", ' '\"gzip_ratio\": \"$gzip_ratio\", ' '\"http_cf_ray\": \"$http_cf_ray\",' '\"geoip_country_code\": \"$geoip2_data_country_code\"' '}'; access_log /var/log/nginx/_access.log json buffer=64k flush=10s; error_log /var/log/nginx/_error.log warn; ... # Load configs include /etc/nginx/conf.d/*.conf; include /etc/nginx/sites-enabled/*.conf; ... cloudflare real ip (optional)\n... ssl_prefer_server_ciphers off; real_ip_header CF-Connecting-IP; ... /opt/nginx/config/conf.d/default.conf server { listen 80 default_server; server_name _; return 301 https://$host$request_uri; } server { listen 443 ssl default_server; http2 on; server_name _; set $forward_scheme https; set $server 127.0.0.1; set $port 443; ssl_reject_handshake on; # Custom SSL ssl_certificate /etc/ssl/*.gvp6nx1a.duckdns.org/fullchain.pem; ssl_certificate_key /etc/ssl/*.gvp6nx1a.duckdns.org/privkey.pem; # SSL include /etc/nginx/conf.d/include/force-ssl.conf; # nginxconfig.io include /etc/nginx/conf.d/include/security.conf; include /etc/nginx/conf.d/include/general.conf; # Block Exploits include /etc/nginx/conf.d/include/block-exploits.conf; # error pages include /usr/share/nginx/html/nginx-errors/nginx-errors.conf; # logging access_log /var/log/nginx/fallback_access.log json buffer=64k flush=10s; error_log /dev/null crit; return 444; } server { listen 80; server_name localhost 127.0.0.1 172.18.0.3; location /nginx_status { stub_status on; access_log off; allow 127.0.0.1; allow 172.16.0.0/12; deny all; } location /print_args { include /etc/nginx/snippets/print-args.conf; access_log off; allow 127.0.0.1; allow 172.16.0.0/12; deny all; } } 디버그\nvi /opt/nginx/config/snippets/print-args.conf add_header Content-Type text/plain; add_header print-NGINX-uri $uri; return 200 \"arg_name: $arg_name args: $args uri:$uri content_length: $content_length content_type: $content_type document_root: $document_root document_uri: $document_uri host: $host host_name: $hostname http_name: $http_name https: $https is_args: $is_args nginx_version: $nginx_version pid: $pid query_string: $query_string real_ip: $remote_addr forwarded_for: $proxy_add_x_forwarded_for request: $request request_method: $request_method server_name: $server_name server_port: $server_port server_protocol: $server_protocol status: $status time_local: $time_local geoip2_data_country_code: $geoip2_data_country_code\"; 해외 ip 차단\n/opt/nginx/config/conf.d/geoip.conf geoip2 /usr/share/geoip/GeoLite2-Country.mmdb { $geoip2_data_country_code country iso_code; } fastcgi_param COUNTRY_CODE $geoip2_data_country_code; add_header X-Country-Code \"$geoip2_data_country_code\" always; map $geoip2_data_country_code $allowed_country { default no; '' yes; #lan ip KR yes; } 봇 차단\n/opt/nginx/config/conf.d/include/block-exploits.conf ... # Blcok bots if ($http_user_agent ~* (AhrefsBot|BLEXBot|DotBot|SemrushBot|Eyeotabot|PetalBot|MJ12bot|brands-bot|bbot|AhrefsBo|MegaIndex|UCBrowser|Mb2345Browser|MicroMessenger|LieBaoFast|Headless|netEstate|newspaper|Adsbot/3.1|WordPress/|ltx71) ) { return 403; } location /robots.txt { return 200 \"User-agent: *\\nDisallow: /\"; } ssl 정책\n/opt/nginx/config/conf.d/include/force-ssl.conf # SSL ssl_session_timeout 1d; ssl_session_cache shared:MozSSL:10m; ssl_session_tickets off; ssl_prefer_server_ciphers off; # OCSP Stapling ssl_stapling on; ssl_stapling_verify on; resolver 127.0.0.11 1.1.1.1 1.0.0.1 valid=60s; resolver_timeout 2s; # ssllabs ssl_protocols TLSv1.2 TLSv1.3; ssl_ciphers ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:ECDHE-ARIA256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384; ssl_ecdh_curve X448:secp521r1:secp384r1; # Diffie-Hellman parameter for DHE ciphersuites ssl_dhparam /etc/ssl/dhparam.pem; gzip으로 정적 파일 응답 속도 개선\n/opt/nginx/config/conf.d/include/general.conf ... # gzip gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml application/json application/javascript application/rss+xml application/atom+xml image/svg+xml; proxy 일반\n/opt/nginx/config/conf.d/include/proxy.conf proxy_http_version 1.1; # Proxy SSL proxy_ssl_server_name on; # Proxy headers proxy_set_header Host $host; proxy_set_header Upgrade $http_upgrade; proxy_set_header Connection $connection_upgrade; proxy_set_header X-Real-IP $remote_addr; proxy_set_header Forwarded $proxy_add_forwarded; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Protocol $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header X-Forwarded-Port $server_port; proxy_set_header Connection \"\"; # Proxy timeouts proxy_connect_timeout 180s; proxy_send_timeout 180s; proxy_read_timeout 180s; # nginx-proxy-manager #add_header X-Served-By $host; #roxy_set_header X-Forwarded-Scheme $scheme; #proxy_set_header X-Forwarded-By $server_addr:$server_port; # HSTS (ngx_http_headers_module is required) (63072000 seconds = 2 years) add_header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\" always; 보안 정책과 HSTS\n/opt/nginx/config/conf.d/include/security.conf # security headers add_header X-XSS-Protection \"1; mode=block\" always; add_header X-Content-Type-Options \"nosniff\" always; add_header Referrer-Policy \"no-referrer-when-downgrade\" always; add_header Content-Security-Policy \"default-src 'self' http: https: ws: wss: data: blob: 'unsafe-inline'; frame-ancestors 'self';\" always; add_header Permissions-Policy \"interest-cohort=()\" always; # HSTS (ngx_http_headers_module is required) (63072000 seconds = 2 years) add_header Strict-Transport-Security \"max-age=63072000; includeSubDomains; preload\" always; # wiki add_header X-Frame-Options SAMEORIGIN; add_header X-Robots-Tag none; # files location ~ /\\.(?!well-known) { deny all; } site 예제 /opt/nginx/config/sites-available/portainer.conf server { listen 80; return 301 https://po.gvp6nx1a.duckdns.org$request_uri; server_name po.gvp6nx1a.duckdns.org; } server { listen 443 ssl; http2 on; server_name po.gvp6nx1a.duckdns.org; # reverse proxy location / { if ($allowed_country = no) { return 403; } include /etc/nginx/conf.d/include/proxy.conf; proxy_pass https://portainer:9443; } # Custom SSL ssl_certificate /etc/ssl/*.gvp6nx1a.duckdns.org/fullchain.pem; ssl_certificate_key /etc/ssl/*.gvp6nx1a.duckdns.org/privkey.pem; # SSL include /etc/nginx/conf.d/include/force-ssl.conf; # nginxconfig.io include /etc/nginx/conf.d/include/security.conf; include /etc/nginx/conf.d/include/general.conf; # Block Exploits include /etc/nginx/conf.d/include/block-exploits.conf; # error pages include /usr/share/nginx/html/nginx-errors/nginx-errors.conf; # logging access_log /var/log/nginx/portainer_access.log json buffer=64k flush=10s; error_log /var/log/nginx/portainer_error.log warn; } site 추가 docker exec -it nginx find /etc/nginx/sites-enabled/ -name \"*.conf\" -exec unlink {} \\; docker exec -it nginx find /etc/nginx/sites-available/ -name \"*.conf\" -exec ln -s {} /etc/nginx/sites-enabled/ \\; docker exec -it nginx nginx -t \u0026\u0026 docker exec -it nginx nginx -s reload error page 1 한글화 (optional)\ncd /opt/nginx/webroot \u0026\u0026 \\ git clone https://github.com/bartosjiri/nginx-errors.git \u0026\u0026 \\ find /opt/nginx/webroot -name \".git*\" -exec rm -rf {} \\; host 구성 port 개방 sudo firewall-cmd --permanent --add-port={80,443}/tcp \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all crond 2 3 vi ~/.local/bin/update_cfip.sh #!/bin/bash # cloudflare ip 갱신 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp { echo \"# Cloudflare real ip\" \\ \u003e /opt/nginx/config/conf.d/include/ip-ranges.conf for i in $(curl -s -L https://www.cloudflare.com/ips-v4); do echo \"set_real_ip_from $i;\" \\ \u003e\u003e /opt/nginx/config/conf.d/include/ip-ranges.conf done for i in $(curl -s -L https://www.cloudflare.com/ips-v6); do echo \"set_real_ip_from $i;\" \\ \u003e\u003e /opt/nginx/config/conf.d/include/ip-ranges.conf done } \u003e \"$log_file\" show_file_stat /opt/nginx/config/conf.d/include/ip-ranges.conf \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" vi /opt/geoipupdate/.env GEOIPUPDATE_ACCOUNT_ID=9***** GEOIPUPDATE_LICENSE_KEY=S*************************************** vi ~/.local/bin/update_geoip.sh #!/bin/bash # geoip2 데이터베이스 갱신 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp docker run \\ -i --rm --name=geoipupdate --network=dev --user=0:0 \\ --env-file /opt/geoipupdate/.env \\ -e GEOIPUPDATE_EDITION_IDS=\"GeoLite2-Country\" \\ -v /opt/geoipupdate/data:/usr/share/GeoIP:rw \\ maxmindinc/geoipupdate:latest \u003e \"$log_file\" show_file_stat /opt/geoipupdate/data/GeoLite2-Country.mmdb \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" logrotate sudo vi /etc/logrotate.d/nginx /opt/nginx/log/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d nocompress create 0664 dev dev sharedscripts postrotate docker exec nginx nginx -s reload \u003e/dev/null 2\u003e\u00261 || true docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } 테스트 openssl 구성 확인\ndocker exec -it nginx openssl version \u0026\u0026 docker exec -it nginx openssl ciphers -v ocsp 테스트\ndocker exec -i nginx openssl s_client -connect hu.gvp6nx1a.duckdns.org:443 -status \u003c /dev/null cbc 암호 거부 테스트\ndocker exec -it nginx openssl s_client -connect hu.gvp6nx1a.duckdns.org:443 -cipher ECDHE-ECDSA-AES128-SHA256 -tls1_2 renegotiating 거부 테스트 (/opt/nginx/ssl/openssl.cnf unmount 후 테스트)\ndocker exec -it nginx openssl s_client -connect hu.gvp6nx1a.duckdns.org:443 -tls1_2 bot 거부 테스트\ncurl -I --user-agent \"Mozilla/5.0 (compatible; SemrushBot/7~b|; +http://www.semrush.com/bot.html)\" https://po.gvp6nx1a.duckdns.org 높은 점수 달성을 위한 구성\nEC 384 bits 인증서 HTTP Strict Transport Security 구성 (security.conf) OCSP Stapling 구성 (force-ssl.conf) DHE ciphersuites 구성 (force-ssl.conf) 취약성 없는 암호화 방식으로만 구성 (force-ssl.conf, openssl.cnf) 바로 가기\n바로 가기\nLicense 상업적 이용 제한 없음\nnginx(not plus): BSD 2-Clause 4 Troubleshooting webdav TLS 1.3 구성 실패\nTLS 1.2 호환되도록 구성\nTLS_CHACHA20_POLY1305_SHA256 암호화 비권장 구성 (\u003cwww.immuniweb.com\u003e)\n구성 삭제\nError response from daemon: driver failed programming external connectivity on endpoint nginx (2c91db9c75e735c2de08cf071208da8b56b0f61c9472c2deb382da08a622dc43): (COMMAND_FAILED: ‘/usr/sbin/iptables -w10 -t nat -A DOCKER -p tcp -d 0/0 –dport 443 -j DNAT –to-destination 172.18.0.3:443 ! -i br-d77060f818ff’ failed: iptables: No chain/target/match by that name.\nsudo service docker restart References https://ssl-config.mozilla.org/#server=nginx\u0026version=1.27.3\u0026config=modern\u0026openssl=3.4.0\u0026guideline=5.7 https://www.getpagespeed.com/server-setup/nginx/tuning-proxy_buffer_size-in-nginx https://www.digitalocean.com/community/tools/nginx?global.https.sslProfile=modern https://www.ssllabs.com/ https://www.immuniweb.com/ssl/ https://github.com/bartosjiri/nginx-errors.git ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/update_cfip.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/update_geoip.sh ↩︎\nhttps://nginx.org/LICENSE ↩︎\n","categories":["infra"],"description":"nginx reverse proxy 구성","excerpt":"nginx reverse proxy 구성","ref":"/infra/nginx/","tags":["nginx","docker","web-server","reverse-proxy"],"title":"nginx"},{"body":"\ncontainer 구성 .env 1 E2.1 Micro (Always Free)에서 실행하고 생성되는 것을 확인 이미지는 AlmaLinux로 설치 후 rockylinux로 마이그레이션됨을 확인 vi /opt/oci-capacity/config/.env OCI_REGION=ap-seoul-1 OCI_USER_ID=ocid1.user.oc1..a*********************************************************** OCI_TENANCY_ID=ocid1.tenancy.oc1..a*********************************************************** OCI_KEY_FINGERPRINT=7*:**:**:**:**:**:**:**:**:**:**:**:**:**:**:** # absolute path (including directories) or direct public accessible URL OCI_PRIVATE_KEY_FILENAME=\"/opt/oci-arm-host-capacity/dev@oci_api_key.pem\" OCI_SUBNET_ID=ocid1.subnet.oc1.ap-seoul-1.a*********************************************************** OCI_IMAGE_ID=ocid1.image.oc1..a*********************************************************** # Always free ARM: 1,2,3,4. Always free AMD x64: 1 OCI_OCPUS=1 # Always free ARM: 6,12,18,24. NB! Oracle Linux Cloud Developer Image requires minimum 8. Always free AMD x64: 1 OCI_MEMORY_IN_GBS=6 # Or \"VM.Standard.E2.1.Micro\" for Always free AMD x64 OCI_SHAPE=VM.Standard.A1.Flex OCI_MAX_INSTANCES=1 # Your public key ~/.ssh/id_rsa.pub contents # NB! No new lines / line endings allowed! Put inside double quotes OCI_SSH_PUBLIC_KEY=\"ssh-ed25519 A******************************************************************* gvp6nx1a-eddsa-key-20230927\" # Is now optional for ARM since Always Free ARMs can be created in any AD. # ListAvailabilityDomains API call will be used for retrieval https://docs.oracle.com/en-us/iaas/api/#/en/identity/20160918/AvailabilityDomain/ListAvailabilityDomains # # NB! Always free AMD x64 instances should be created only in \"main\" (Always Free Eligible) AD, # you must set it manually in this case! # # If you wanna specify more than one, set as a PHP array in OciConfig constructor (inside index.php file) OCI_AVAILABILITY_DOMAIN= # Optional. If not set, default value depends on OCI_IMAGE_ID will be used. # Minimum is 47 for AMD x64 or 50 for ARM, maximum is 200 for Always Free accounts OCI_BOOT_VOLUME_SIZE_IN_GBS=50 # Optional. If set, will be used instead OCI_IMAGE_ID. Cannot be used together with OCI_BOOT_VOLUME_SIZE_IN_GBS. # Open https://cloud.oracle.com/block-storage/boot-volumes, click non-used and copy it's OCID # NB! You must specify OCI_AVAILABILITY_DOMAIN also as they should be located in the same one OCI_BOOT_VOLUME_ID=gvp6nx1a OCI_IN_TRANSIT_ENCRYPTION=false Dockerfile vi /opt/oci-capacity/Dockerfile FROM alpine:3.19 ENV TZ=Asia/Seoul RUN apk update \u0026\u0026 \\ apk add --no-cache tzdata \\ php82 \\ php82-curl \\ php82-dom \\ php82-tokenizer \\ php82-xmlwriter \\ php82-xml \\ composer \\ git \u0026\u0026 \\ ln -sf /usr/share/zoneinfo/$TZ /etc/localtime \u0026\u0026 \\ echo $TZ \u003e /etc/timezone \u0026\u0026 \\ cd /opt \u0026\u0026 \\ git clone https://github.com/hitrov/oci-arm-host-capacity.git \u0026\u0026 \\ cd /opt/oci-arm-host-capacity \u0026\u0026 \\ composer install \u0026\u0026 \\ apk del git \u0026\u0026 \\ rm /var/cache/apk/* EXPOSE 80 docker build -t e7hnr8ov/oci-arm-host-capacity:alpine /opt/oci-capacity host 구성 crond 2 vi ~/.local/bin/oci.sh #!/bin/bash # oci arm 인스턴스 생성 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log for (( ; ; )); do docker run \\ -i --rm --name=oci-capacity --network=dev --user=0:0 \\ -e TZ=Asia/Seoul \\ -v /opt/oci-capacity/config/dev@oci_api_key.pem:/opt/oci-arm-host-capacity/dev@oci_api_key.pem:ro \\ -v /opt/oci-capacity/config/.env:/opt/oci-arm-host-capacity/.env:ro \\ e7hnr8ov/oci-capacity:alpine \\ php82 /opt/oci-arm-host-capacity/index.php \u003e \"$log_file\" sleep 10 done oci 콘솔 Note 유휴 컴퓨트 인스턴스 회수\n유휴 상시 무료 컴퓨트 인스턴스는 Oracle에서 회수할 수 있습니다.\nOracle은 7일 동안 다음이 참인 경우 가상 머신 및 베어 메탈 컴퓨팅 인스턴스를 유휴 상태로 간주합니다.\n95번째 백분위수의 CPU 사용률은 15% 미만\n네트워크 사용률은 15% 미만\n메모리 사용률이 15% 미만 ( A1 셰이프 에만 적용됨 ) Always Free 태그는 없지만 지난 몇 년간 프리 티어 계정에서 잘 작동 중 (2025-12) 3\n벤치마크 geekbench5 4 yabs.sh Troubleshooting ubuntu update 후 부팅 불가 (oraclecloud 자체 패키지와 ubuntu 충돌)\nA1 서버 삭제 후 다시 생성해야 함. OS 이미지는 RHEL 권장\n“code”: “NotAuthorizedOrNotFound”,\n“message”: “Authorization failed or requested resource not found.”\n콘솔 web-ui에서 vcn 변경 여부 확인 api 구성에서 .env subnet id 확인 https://github.com/hitrov/oci-arm-host-capacity.git ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/oci.sh ↩︎\nhttps://www.reddit.com/r/selfhosted/comments/14n5opq/oracle_cloud_always_free_tier_and_arm_ampere_a1/ ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/yabs.sh ↩︎\n","categories":["etc"],"description":"oraclecloud 프리 티어 계정에서 VM.Standard.A1.Flex 인스턴스 생성","excerpt":"oraclecloud 프리 티어 계정에서 VM.Standard.A1.Flex 인스턴스 생성","ref":"/etc/oci-arm-host-capacity/","tags":["oraclecloud","docker"],"title":"oci-arm-host-capacity"},{"body":"\ncontainer 구성 Dockerfile (x86) sudo vi /opt/instantclient/Dockerfile #FIXME: ubuntu 최신 버전 libaio1 없으므로 22.04로 build FROM ubuntu:22.04 ARG DEBIAN_FRONTEND=noninteractive ENV TZ=Asia/Seoul ENV ORACLE_HOME=/opt/oracle/instantclient ENV PATH=$PATH:$ORACLE_HOME ENV LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$ORACLE_HOME ENV SQLPATH=${INSTANT_CLIENT_PATH}:${SQLPATH} ENV TNS_ADMIN=/opt/oracle/instantclient/network/admin RUN apt-get update \u0026\u0026 \\ apt-get install -y tzdata \\ libaio1 \\ python3 \\ python3-pip \\ curl \\ unzip \u0026\u0026 \\ ln -sf /usr/share/zoneinfo/$TZ /etc/localtime \u0026\u0026 \\ echo $TZ \u003e /etc/timezone \u0026\u0026 \\ echo /opt/oracle/instantclient \u003e /etc/ld.so.conf.d/oic.conf \u0026\u0026 \\ ldconfig \u0026\u0026 \\ curl https://download.oracle.com/otn_software/linux/instantclient/1919000/instantclient-basiclite-linux.x64-19.19.0.0.0dbru.el9.zip -so /tmp/instantclient.zip \u0026\u0026 \\ unzip -o /tmp/instantclient.zip -d /opt/oracle \u0026\u0026 \\ rm /tmp/instantclient.zip \u0026\u0026 \\ curl https://download.oracle.com/otn_software/linux/instantclient/1919000/instantclient-sqlplus-linux.x64-19.19.0.0.0dbru.el9.zip -so /tmp/instantclient.zip \u0026\u0026 \\ unzip -o /tmp/instantclient.zip -d /opt/oracle \u0026\u0026 \\ rm /tmp/instantclient.zip \u0026\u0026 \\ curl https://download.oracle.com/otn_software/linux/instantclient/1919000/instantclient-tools-linux.x64-19.19.0.0.0dbru.el9.zip -so /tmp/instantclient.zip \u0026\u0026 \\ unzip -o /tmp/instantclient.zip -d /opt/oracle \u0026\u0026 \\ rm /tmp/instantclient.zip \u0026\u0026 \\ cd /opt/oracle \u0026\u0026 \\ mv instantclient_19_19 instantclient \u0026\u0026 \\ python3 -m pip install --no-cache-dir pip \u0026\u0026 \\ python3 -m pip install --no-cache-dir oracledb \u0026\u0026 \\ apt-get purge -y python3-pip \\ curl \\ unzip \u0026\u0026 \\ apt-get autoremove -y \u0026\u0026 \\ apt-get clean autoclean \u0026\u0026 \\ rm -rf /var/lib/apt/lists/* docker build -t e7hnr8ov/oracle-instantclient:alpine /opt/instantclient Dockerfile (arm) sudo vi /opt/instantclient/Dockerfile FROM python:alpine ENV TZ Asia/Seoul ENV LD_LIBRARY_PATH /opt/oracle/instantclient RUN apk update \u0026\u0026 \\ apk add --no-cache g++ \\ libaio \\ libc6-compat \\ curl \u0026\u0026 \\ curl https://download.oracle.com/otn_software/linux/instantclient/191000/instantclient-basiclite-linux.arm64-19.10.0.0.0dbru.zip -so /tmp/instantclient.zip \u0026\u0026 \\ unzip -o /tmp/instantclient.zip -d /opt/oracle \u0026\u0026 \\ cd /opt/oracle \u0026\u0026 \\ mv instantclient_19_10 instantclient \u0026\u0026 \\ ln -s /opt/oracle/instantclient/libclntsh.so.19.1 /usr/lib/libclntsh.so \u0026\u0026 \\ ln -s /opt/oracle/instantclient/libocci.so.19.1 /usr/lib/libocci.so \u0026\u0026 \\ ln -s /opt/oracle/instantclient/libociicus.so /usr/lib/libociicus.so \u0026\u0026 \\ ln -s /opt/oracle/instantclient/libnnz19.so /usr/lib/libnnz19.so \u0026\u0026 \\ ln -s /lib/libc.so.6 /usr/lib/libresolv.so.2 \u0026\u0026 \\ rm /tmp/instantclient.zip \u0026\u0026 \\ python -m pip install --no-cache-dir cx_Oracle \u0026\u0026 \\ apk del curl \u0026\u0026 \\ rm /var/cache/apk/* docker build -t e7hnr8ov/oracle-instantclient:alpine /opt/instantclient host 구성 crond 일정 기간 db 유휴 시 데이터 삭제를 공지하고 있으므로 매일 테스트 스키마를 갱신하도록 구성 1 2 sh cqa7wtjg_helper.sh dwc8khum_helper.sh #!/bin/bash # oci oralcedb 유휴 방지 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp user=HR pass=z***************************** url=\"'(description= (retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1521)(host=adb.ap-seoul-1.oraclecloud.com))(connect_data=(service_name=g**************_********_tpurgent.adb.oraclecloud.com))(security=(ssl_server_dn_match=yes)))'\" docker run \\ -i --rm --name=instantclient-cqa7wtjg --network=dev --user=0:0 \\ --env-file /opt/instantclient/.env \\ -e TZ=Asia/Seoul \\ -v /opt/instantclient/config/wallet_cqa7wtjg:/opt/oracle/instantclient/network/admin:ro \\ -v /opt/instantclient/data:/data:rw \\ e7hnr8ov/instantclient:ubuntu \\ /bin/bash -c \"exit | sqlplus $user/$pass@$url @/data/hr_schema/drop.sql\" \u003e \"$log_file\" tail -n4 \"$log_file\" | head -n1 \u003e \"$msg_file\" docker run \\ -i --rm --name=instantclient-cqa7wtjg --network=dev --user=0:0 \\ --env-file /opt/instantclient/.env \\ -e TZ=Asia/Seoul \\ -v /opt/instantclient/config/wallet_cqa7wtjg:/opt/oracle/instantclient/network/admin:ro \\ -v /opt/instantclient/data:/data:rw \\ e7hnr8ov/instantclient:ubuntu \\ /bin/bash -c \"exit | sqlplus $user/$pass@$url @/data/hr_schema/make.sql\" \u003e\u003e \"$log_file\" tail -n4 \"$log_file\" | head -n1 \u003e\u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" #!/bin/bash # oci oralcedb 유휴 방지 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp user=HR pass=B***************************** url=\"'(description= (retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1521)(host=adb.ap-seoul-1.oraclecloud.com))(connect_data=(service_name=g**************_********_high.adb.oraclecloud.com))(security=(ssl_server_dn_match=yes)))'\" docker run \\ -i --rm --name=instantclient-dwc8khum --network=dev --user=0:0 \\ --env-file /opt/instantclient/.env \\ -e TZ=Asia/Seoul \\ -v /opt/instantclient/config/wallet_dwc8khum:/opt/oracle/instantclient/network/admin:ro \\ -v /opt/instantclient/data:/data:rw \\ e7hnr8ov/instantclient:ubuntu \\ /bin/bash -c \"exit | sqlplus $user/$pass@$url @/data/hr_schema/drop.sql\" \u003e \"$log_file\" tail -n4 \"$log_file\" | head -n1 \u003e \"$msg_file\" docker run \\ -i --rm --name=instantclient-dwc8khum --network=dev --user=0:0 \\ --env-file /opt/instantclient/.env \\ -e TZ=Asia/Seoul \\ -v /opt/instantclient/config/wallet_dwc8khum:/opt/oracle/instantclient/network/admin:ro \\ -v /opt/instantclient/data:/data:rw \\ e7hnr8ov/instantclient:ubuntu \\ /bin/bash -c \"exit | sqlplus $user/$pass@$url @/data/hr_schema/make.sql\" \u003e\u003e \"$log_file\" tail -n4 \"$log_file\" | head -n1 \u003e\u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" Troubleshooting thick으로 연결 시 wallet 여부 관계 없이 /opt/oracle/instantclient/network/admin mount 필수\nsqlplus 실행 후 종료\n파이프 추가. 아래는 bash 예\n/bin/bash -c \"exit | sqlplus HR/z******************************'(description= (retry_count=20)(retry_delay=3)(address=(protocol=tcps)(port=1521)(host=adb.ap-seoul-1.oraclecloud.com))(connect_data=(service_name=g**************_cqa7wtjg_tpurgent.adb.oraclecloud.com))(security=(ssl_server_dn_match=yes)))' @/data/hr_schema/make.sql\" Package ’libaio1’ has no installation candidate libaio1 패키지는 버전 24.04부터 libaio1t64로 대체되었습니다.\nOracle은 종속성을 libaio1t64로 업데이트하여 SQLPLUS를 다시 컴파일해야 합니다.\n현재 작동하려면 @simon-dba 에서 제안한대로 libaio1t64 -\u003e libaio1 에서 심볼릭 링크를 만들어야합니다.\nubuntu v24는 symlink 생성 libaio1 -\u003e libaio1t64 3\napt-get update -y \u0026\u0026 apt-get intsall -y libaio1 \u0026\u0026 \\ apt-get update -y \u0026\u0026 apt-cache search libaio1 \u0026\u0026 \\ ln -s /usr/lib/x86_64-linux-gnu/libaio.so.1t64 /opt/oracle/instantclient_19_19/libaio.so.1 License 상업적 이용 제한 없음 4\nQ. Instant Client 비용은 얼마인가요?\nA. Instant Client는 OTN에서 무료로 제공되어 개발 또는 운영 환경에서 누구나 사용할 수 있습니다.\n하지만 고객은 이미 표준 지원 계약이 있는 경우에만 Oracle 지원에 연락할 수 있습니다. 5\nReferences https://www.oracle.com/database/technologies/instant-client/downloads.html https://medium.com/db-one/oracle-jdbc-drivers-a84e2b5f7eb9 https://github.com/dntco43u/s6h7k8rv/blob/main/cqa7wtjg_helper.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/dwc8khum_helper.sh ↩︎\nhttps://forums.oracle.com/ords/apexds/post/instant-client-on-ubuntu-24-04-noble-numbat-7244 ↩︎\nhttps://www.oracle.com/downloads/licenses/instant-client-lic.html ↩︎\nhttps://www.oracle.com/kr/database/technologies/faq-instant-client.html ↩︎\n","categories":["infra"],"description":"oracle 19 커넥터 구성","excerpt":"oracle 19 커넥터 구성","ref":"/infra/oracle-instantclient/","tags":["docker","oracle"],"title":"oracle/instantclient"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/oraclecloud/","tags":"","title":"oraclecloud"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/pxeboot/","tags":"","title":"pxeboot"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/reverse-proxy/","tags":"","title":"reverse-proxy"},{"body":"\ngraph LR subgraph gvp6nx1a A2[ssl-cert] --- A1 end A1[vsftpd] \u003c-- tcp/tls --\u003e B[client] A1[vsftpd] \u003c-- ftp-passive --\u003e B host 구성 포트 개방 sudo firewall-cmd --permanent --add-forward-port=port=6****:proto=tcp:toport=21 \u0026\u0026 \\ sudo firewall-cmd --permanent --add-port=6****-6****/tcp \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all selinux Note Permissive mode인 경우에도 필수적으로 구성\nsudo setsebool -P ftpd_use_passive_mode on \u0026\u0026 \\ sudo setsebool -P ftpd_full_access on 설치 sudo dnf update -y \u0026\u0026 sudo dnf install -y vsftpd \u0026\u0026 \\ sudo systemctl enable vsftpd \u0026\u0026 \\ sudo systemctl start vsftpd \u0026\u0026 \\ sudo systemctl status vsftpd sudo cp /etc/vsftpd/vsftpd.conf /etc/vsftpd/vsftpd.conf.bak \u0026\u0026 \\ sudo cp /etc/vsftpd/ftpusers /etc/vsftpd/ftpusers.bak root 접속 허용 (optional)\nsudo sed -i 's/root/#root/g' /etc/vsftpd/ftpusers vsftpd.conf sudo vi /etc/vsftpd/vsftpd.conf # rhel pam_service_name=vsftpd # security anonymous_enable=NO write_enable=YES local_enable=YES local_root=/ local_umask=022 userlist_enable=NO userlist_deny=NO chroot_list_enable=NO chroot_local_user=YES secure_chroot_dir=/var/empty allow_writeable_chroot=YES # passive listen=YES listen_ipv6=NO connect_from_port_20=NO pasv_enable=YES pasv_address=1**.***.***.*** pasv_min_port=6**** pasv_max_port=6**** # ssl rsa_cert_file=/opt/.acme/gvp6nx1a.duckdns.org_ecc/fullchain.cer rsa_private_key_file=/opt/.acme/gvp6nx1a.duckdns.org_ecc/gvp6nx1a.duckdns.org.key ssl_enable=YES allow_anon_ssl=NO require_ssl_reuse=YES ssl_ciphers=HIGH ssl_sslv2=NO ssl_sslv3=NO ssl_tlsv1=NO ssl_tlsv1_1=NO ssl_tlsv1_2=YES ssl_tlsv1_3=YES # log dirmessage_enable=YES xferlog_enable=YES xferlog_std_format=YES log_ftp_protocol=YES dual_log_enable=YES # etc seccomp_sandbox=NO force_dot_files=YES idle_session_timeout=0 logrotate sudo vi /etc/logrotate.d/vsftpd /var/log/vsftpd.log /var/log/xferlog { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate /usr/bin/systemctl restart vsftpd.service \u003e/dev/null 2\u003e\u00261 || true endscript } crond 1 2 vi ~/.local/bin/reload_services.sh #!/bin/bash # 변경된 구성을 반영하기 위한 서비스 재시작 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp { if [ -d /opt/nginx ]; then docker exec -i nginx nginx -s reload echo \"nginx: $(docker inspect --format '{{json .State.Status}}' nginx \\ | sed 's/\"//g')\" fi if [ -d /opt/jenkins/ ]; then cd /opt/jenkins || exit docker compose rm -f -s \u0026\u0026 docker compose pull \u0026\u0026 docker compose up -d echo \"jenkins: $(docker inspect --format '{{json .State.Status}}' jenkins \\ | sed 's/\"//g')\" fi #FIXME: promtail 15:00 종료 원인 파악될 때까지 if [ -d /opt/promtail ]; then cd /opt/promtail || exit docker compose rm -f -s \u0026\u0026 docker compose pull \u0026\u0026 docker compose up -d echo \"promtail: $(docker inspect --format '{{json .State.Status}}' promtail \\ | sed 's/\"//g')\" fi if [ -d /etc/vsftpd ]; then systemctl restart vsftpd.service echo \"vsftpd.service: $(systemctl is-active vsftpd.service)\" fi systemctl list-units --type service | grep failed | awk '{print $2 \": failed\"}' } \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" vi ~/.local/bin/vsftpd_ddns.sh #!/bin/bash # vsftpd 동적 ip 구성 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp ftp_ip=$(grep -E \"(^pasv_address=)(.*)\" /etc/vsftpd/vsftpd.conf \\ | sed -E \"s/(^pasv_address=)(.*)/\\2/g\") real_ip=$(dig +short txt ch whoami.cloudflare @1.1.1.1 | sed 's/\"//g') if [ \"$ftp_ip\" != \"$real_ip\" ]; then sed -Ei \"s/(^pasv_address=)(.*)/\\1$real_ip/g\" /etc/vsftpd/vsftpd.conf systemctl restart vsftpd.service echo \"vsftpd: pasv_address=$real_ip\" \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" fi 테스트 rclone 호환 테스트\necho \"testfile\" | tee ~/testfile \u0026\u0026 \\ REMOTE_FTP=gvp6nx1a-ftp: \u0026\u0026 \\ rclone copy \"$REMOTE_FTP\"/home/dev/testfile /tmp -vv -P \u0026\u0026 \\ rclone delete \"$REMOTE_FTP\"/home/dev/testfile -vv -P \u0026\u0026 \\ rclone move /tmp/testfile \"$REMOTE_FTP\"/home/dev -vv -P \u0026\u0026 \\ unset REMOTE_FTP \u0026\u0026 \\ rm ~/testfile License 상업적 이용 제한 없음\nGNU GPL 3 Troubleshooting 원인을 알 수 없는 오류들.\n구성 중에 selinux 로그는 항상 확인할 것.\nsudo journalctl -t audit -f rclone: local error: tls: protocol version not supported\nssl_tlsv1/v1_1=NO 구성 추가. vsftp TLS 1.3은 rclone 호환 불가. rclone 문서의 TLS 1.3 비활성화 참고 4\nrclone: Fatal error: 500 OOPS: priv_sock_get_cmd\nseccomp_sandbox=NO 구성 추가. 추가 보안 계층 비활성화.\nReferences https://rclone.org/ftp/ https://forum.rclone.org/t/is-encryption-ftp-explicit-over-tls-supported/30770/2 https://access.redhat.com/solutions/3436 https://wiki.gentoo.org/wiki/Vsftpd https://github.com/dntco43u/s6h7k8rv/blob/main/reload_services.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/vsftpd_ddns.sh ↩︎\nhttps://en.wikipedia.org/wiki/Vsftpd ↩︎\n–ftp-disable-tls13 Disable TLS 1.3 workaround for FTP servers with buggy TLS ↩︎\n","categories":["infra"],"description":"vsftpd rclone 호환 구성","excerpt":"vsftpd rclone 호환 구성","ref":"/infra/vsftpd/","tags":["rhel","vsftpd","rclone"],"title":"vsftpd"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/vsftpd/","tags":"","title":"vsftpd"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/web-server/","tags":"","title":"web-server"},{"body":"\ngraph LR subgraph iptables subgraph bridge-network A1[docker/wireguard] \u003c--\u003e B[docker] A2[apps] \u003c--\u003e B end subgraph host-network C[host] \u003c--\u003e C1[package/wireguard] end end A1 \u003c-- udp --\u003e D[client] C1 \u003c-- udp --\u003e D B \u003c-- wireguard 라우팅 방법을 찾지 못함 --\u003e C host 구성 포트 개방 sudo firewall-cmd --permanent --add-port=6****/udp \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all container 구성 docker-compose.yml vi /opt/wireguard/docker-compose.yml services: wireguard: image: linuxserver/wireguard:1.0.20210914 container_name: wireguard networks: - dev ports: - 6****:6****/udp user: 0:0 environment: - PUID=1000 - PGID=1000 - TZ=Asia/Seoul - PEERS=1 - PEERDNS=auto - LOG_CONFS=false volumes: - /usr/src:/usr/src:ro - /lib/modules:/lib/modules:ro - /opt/wireguard/config/wg_confs/wg0.conf:/config/wg_confs/wg0.conf:ro - /opt/wireguard/config/coredns/Corefile:/config/coredns/Corefile:ro cap_add: - NET_ADMIN - SYS_MODULE sysctls: - net.ipv4.conf.all.src_valid_mark=1 restart: unless-stopped networks: dev: external: true key 생성 docker exec -it wireguard /bin/sh \u0026\u0026 \\ umask 077 \u0026\u0026 \\ wg genkey | tee /etc/wireguard/server.key | wg pubkey \u003e /etc/wireguard/server.pub \u0026\u0026 \\ wg genkey | tee /etc/wireguard/client.key | wg pubkey \u003e /etc/wireguard/client.pub \u0026\u0026 \\ wg genpsk \u003e /etc/wireguard/client.psk \u0026\u0026 \\ cat /etc/wireguard/server.key \u0026\u0026 \\ cat /etc/wireguard/server.pub \u0026\u0026 \\ cat /etc/wireguard/client.key \u0026\u0026 \\ cat /etc/wireguard/client.pub \u0026\u0026 \\ cat /etc/wireguard/client.psk wg0.conf vi /opt/wireguard/config/wg_confs/wg0.conf [Interface] Address = 10.10.0.4/32 ListenPort = 6**** PrivateKey = +******************************************= PostUp = iptables -A FORWARD -i %i -j ACCEPT; iptables -A FORWARD -o %i -j ACCEPT; iptables -t nat -A POSTROUTING -o eth+ -j MASQUERADE PostDown = iptables -D FORWARD -i %i -j ACCEPT; iptables -D FORWARD -o %i -j ACCEPT; iptables -t nat -D POSTROUTING -o eth+ -j MASQUERADE [Peer] PublicKey = t******************************************= PresharedKey = h******************************************= AllowedIPs = 10.10.0.0/24 PersistentKeepalive = 25 Corefile coredns healthcheck 비활성화\ntee /opt/wireguard/config/coredns/Corefile \u003c\u003cEOF . { forward . /etc/resolv.conf } EOF 테스트 dns 누출 확인\nhttps://www.cloudflare.com/ssl/encrypted-sni/ https://dnsleaktest.com/ https://ipleak.net/ License 상업적 이용 제한 없음\nGNU GPL v2 1 Troubleshooting 기본 패키지의 wireguard가 docker bridge network에 접근할 수 있는 라우팅 방법을 찾지 못함\ndocker wireguard를 동일 bridge network에 설치. 이 구성은 host와 bridge 모두 접근 가눙\n작동하지 않았던 구성\nhttps://www.linux.org/threads/wireguard-iptables-rules.45473\nhttps://www.cyberciti.biz/faq/how-to-set-up-wireguard-firewall-rules-in-linux iptables v1.8.9 (legacy): can’t initialize iptables table ‘filter’: Table does not exist (do you need to insmod?)\nwireguard 호환 커널 모듈의 적재 필요\nsudo modprobe iptable_raw \u0026\u0026 \\ sudo reboot echo \"iptable_raw\" | sudo tee /etc/modules-load.d/iptable_raw.conf \u0026\u0026 \\ sudo lsmod | grep \"ip_table\" References https://github.com/BrodyBuster/docker-wireguard-vpn https://www.wireguard.com/#license ↩︎\n","categories":["infra"],"description":"RHEL9 wireguard docker 구성","excerpt":"RHEL9 wireguard docker 구성","ref":"/infra/wireguard/","tags":["wireguard","docker","vpn"],"title":"wireguard"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/wireguard/","tags":"","title":"wireguard"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/zerossl/","tags":"","title":"zerossl"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/benchmark/","tags":"","title":"benchmark"},{"body":"","categories":"","description":"","excerpt":"","ref":"/tags/debian/","tags":"","title":"debian"},{"body":"\n기타 구성 sshd_config cat \u003c\u003c EOF | sudo tee /etc/ssh/sshd_config.d/10-dev.conf PasswordAuthentication no PubkeyAuthentication yes SyslogFacility AUTHPRIV LogLevel INFO EOF sudo service sshd restart swap 생성\nsudo fallocate -l 4G /swapfile \u0026\u0026 \\ sudo chmod 600 /swapfile \u0026\u0026 \\ sudo mkswap /swapfile \u0026\u0026 \\ sudo swapon /swapfile \u0026\u0026 \\ sudo tee -a /etc/fstab \u003c\u003cEOF UUID=23ff5ad2-345b-45a4-992d-71d4a1a99f9b / ext4 rw, discard, errors=remount-ro, x-systemd.growfs, noatime, nodiratime 0 1 UUID=5D92-027D /boot/efi vfat defaults 0 0 /swapfile swap swap defaults 0 0 EOF sudo mount -a 변경\nsudo dd if=/dev/zero of=/swapfile bs=1MiB count=$((4*1024)) \u0026\u0026 \\ sudo chmod 600 /swapfile \u0026\u0026 \\ sudo mkswap /swapfile \u0026\u0026 \\ sudo swapon -v /swapfile \u0026\u0026 \\ sudo swapoff -v /previous_swapfile \u0026\u0026 \\ sudo rm /previous_swapfile zswap 속도 저하 체감으로 삭제\nsudo grubby --update-kernel=/boot/vmlinuz-$(uname -r) --args=\"zswap.enabled=0\" \u0026\u0026 sudo reboot sudo grep -r . /sys/kernel/debug/zswap zram 1 swap, zswap에서 옮겨온 구성\necho \"zram\" | sudo tee /etc/modules-load.d/zram.conf \u0026\u0026 \\ echo \"options zram num_devices=1\" | sudo tee /etc/modprobe.d/zram.conf \u0026\u0026 \\ echo KERNEL==\\\"zram0\\\", ATTR{disksize}=\\\"8G\\\",TAG+=\\\"systemd\\\" | sudo tee /etc/udev/rules.d/99-zram.rules sudo vi /etc/systemd/system/zram.service [Unit] Description=Swap with zram After=multi-user.target [Service] Type=oneshot RemainAfterExit=true ExecStartPre=/sbin/mkswap /dev/zram0 ExecStart=/sbin/swapon /dev/zram0 ExecStop=/sbin/swapoff /dev/zram0 [Install] WantedBy=multi-user.target sudo systemctl enable zram.service \u0026\u0026 \\ sudo systemctl restart zram.service \u0026\u0026 \\ sudo systemctl restart zram-swap.service \u0026\u0026 \\ sudo reboot; zramctl 포트 개방 sudo firewall-cmd --set-default-zone=public \u0026\u0026 \\ sudo firewall-cmd --get-active-zones \u0026\u0026 \\ sudo firewall-cmd --permanent --zone=public --add-masquerade \u0026\u0026 \\ sudo firewall-cmd --permanent --remove-service=cockpit \u0026\u0026 \\ sudo firewall-cmd --permanent --remove-service=dhcpv6-client sudo firewall-cmd --permanent --remove-service=ssh \u0026\u0026 \\ sudo firewall-cmd --permanent --add-forward-port=port=6****:proto=tcp:toport=22 \u0026\u0026 \\ sudo firewall-cmd --reload \u0026\u0026 \\ sudo firewall-cmd --list-all 저널 로그 정책 sudo journalctl --vacuum-time=7d \u0026\u0026 \\ sudo journalctl --vacuum-size=100M \u0026\u0026 \\ sudo systemctl restart systemd-journald; 이전 커널 삭제 sudo dnf -y update \u0026\u0026 sudo dnf -y remove --oldinstallonly --setopt installonly_limit=2 kernel 불필요 패키지 삭제 sudo dnf remove -y insights-client cockpit* \u0026\u0026 \\ subscription-manager remove --all \u0026\u0026 \\ subscription-manager unregister \u0026\u0026 \\ subscription-manager clean TCP BBR sudo tee -a /etc/sysctl.conf \u003c\u003cEOF vm.swappiness=1 net.core.default_qdisc=fq net.ipv4.tcp_congestion_control=bbr net.core.busy_read=50 net.core.busy_poll=50 EOF sudo sysctl -p selinux 비활성화 sudo vi /etc/sysconfig/selinux SELINUX=permissive sudo setenforce 0 \u0026\u0026 \\ sudo reboot; getenforce nic 이름 변경 관리 편의와 수집 데이터 통일을 위해 변경 (enp4s0 -\u003e eth0) 2\ncat /sys/class/net/enp4s0/type cat \u003c\u003c EOF | sudo tee /etc/udev/rules.d/70-persistent-net.rules SUBSYSTEM==\"net\",ACTION==\"add\",ATTR{address}==\"00:d8:61:1c:eb:65\",ATTR{type}==\"1\",NAME=\"eth0\" EOF sudo nmcli connection modify enp4s0 connection.interface-name \"\" \u0026\u0026 \\ sudo nmcli connection modify enp2s0 match.interface-name \"eth0\" \u0026\u0026 \\ sudo reboot ip link show \u0026\u0026 \\ nmcli -f device,name connection show \u0026\u0026 \\ sudo nmcli connection up \"enp2s0\" wakeonlan sudo ethtool -s eth0 wol g \u0026\u0026 \\ sudo ethtool eth0 | grep Wake-on 절전 구성 baremetal 서버만 (optional)\ngrep -i pstate /boot/config-$(uname -r) \u0026\u0026 \\ cat /sys/devices/system/cpu/cpu*/cpufreq/scaling_driver hwp 지원 intel cpu는 cmos에서 제어하거나 자체 sysfs file로 구성할 것\ncpupower frequency-info \u0026\u0026 \\ available cpufreq governors: conservative ondemand userspace powersave performance schedutil \u0026\u0026 \\ sudo cpupower frequency-set --governor powersave \u0026\u0026 \\ sudo systemctl enable cpupower ls /sys/devices/system/cpu/intel_pstate sudo dnf install -y powertop tuned-utils \u0026\u0026 \\ sudo powertop \u0026\u0026 \\ sudo systemctl enable powertop \u0026\u0026 \\ sudo powertop2tuned dev -ef \u0026\u0026 \\ sudo tuned-adm profile dev 커널 psi sudo grubby --update-kernel=ALL --args=\"psi=1\" \u0026\u0026 \\ sudo reboot; ls /proc/pressure Note PSI는 리소스가 개발됨에 따라 리소스 부족이 증가하는 것을 확인할 수 있는 표준 방법을 제공합니다.\n메모리, CPU 및 I/O(출력/출력)의 세 가지 주요 리소스에 대한 압력 지표가 있습니다.\nPSI는 RHEL 8 이상 버전에서 사용할 수 있으며 기본적으로 비활성화되어 있습니다.\nPSI가 활성화되면 리소스 최적화 서비스가 결과를 보강하고 더 자세한 내용과 더 나은 제안을 제공할 수 있습니다.\nPSI를 활성화하면 최대 값을 식별하는 것이 좋습니다.\nPSI를 사용하도록 설정하면 약간의 (\u003c1%) 성능이 저하됩니다.\nNode Exporter Full에서 psi 정보 수집 3\nepel 저장소 sudo dnf -y update \u0026\u0026 sudo dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm 자주 쓰는 유틸리티 sudo dnf -y update \u0026\u0026 sudo dnf install -y hdparm p7zip p7zip-plugins bind-utils rsync shellcheck sudo dnf -y update \u0026\u0026 sudo dnf install -y shellcheck 사용자 shell 전체 검사 4\nfind ~/.local/bin/ -type f -iname *.sh -exec shellcheck -x {} \\; aws 계정 변경 (ec2-user -\u003e dev)\nsudo tee -a ~/clone_user.sh \u003c\u003cEOF #!/bin/bash src=$1 dest=$2 src_groups=$(id -Gn \"$src\" | sed \"s/ /,/g\" | sed -r 's/\\\u003c'\"$src\"'\\\u003e\\b,?//g') src_shell=$(awk -F : -v name=\"$src\" '(name == $1) { print $7 }' /etc/passwd) sudo useradd --groups \"$src_groups\" --shell \"$src_shell\" --create-home \"$dest\" sudo passwd \"$dest\" EOF sudo chmod 700 ~/clone_user.sh \u0026\u0026 \\ sudo ~/clone_user.sh $(id -nu) dev \u0026\u0026 \\ sudo cp -R /home/$(id -nu)/.ssh /home/dev \u0026\u0026 \\ sudo chown dev:dev -R /home/dev \u0026\u0026 \\ sudo rm /home/ec2-user/clone_user.sh echo \"%wheel ALL=(ALL) NOPASSWD: ALL\" | sudo tee /etc/sudoers.d/wheel \u0026\u0026 \\ sudo usermod -aG wheel dev user process 실행 중이면 kill하고 진행\nsudo usermod -u 1003 ec2-user \u0026\u0026 sudo groupmod -g 1003 ec2-user \u0026\u0026 \\ sudo cat /etc/passwd | grep ec2-user \u0026\u0026 \\ sudo usermod -u 1000 dev \u0026\u0026 sudo groupmod -o -g 1000 dev \u0026\u0026 \\ sudo cat /etc/passwd | grep dev \u0026\u0026 \\ sudo chown -R dev:dev /home/dev \u0026\u0026 \\ sudo usermod -u 1001 ec2-user \u0026\u0026 sudo groupmod -g 1001 ec2-user \u0026\u0026 \\ sudo cat /etc/passwd | grep ec2-user \u0026\u0026 \\ sudo chown 1001:1001 -R /home/ec2-user hostname 구성\necho \"rqzviph1\" | sudo tee /etc/hostname logout bash profile 전역 변수 구성\nsudo tee /etc/profile.d/dev.sh \u003c\u003cEOF BASH_ENV=/etc/profile.d/dev.sh PS1=\"\\[\\033[36m\\]\\u\\[\\033[0m\\]@\\[\\033[32m\\]\\h\\[\\033[m\\]:\\[\\033[33;1m\\]\\w\\[\\033[m\\]\\$ \" TEL_BOT_KEY=\"6*********************************************\" TEL_CHAT_ID=\"1*********\" EOF motd sudo vi /etc/motd.d/dev \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m.\u001b[32m,\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m,\u001b[32m.\u001b[0m \u001b[32m.\u001b[32m,\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m'\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m.\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32m:\u001b[32m:\u001b[32m;\u001b[32m:\u001b[32m:\u001b[32m,\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m.\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m;\u001b[32m:\u001b[0mo\u001b[0mk\u001b[0mk\u001b[0mk\u001b[0mk\u001b[0mx\u001b[0mo\u001b[0mc\u001b[0m;\u001b[32m'\u001b[32m,\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m'\u001b[32m.\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m.\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[0ml\u001b[0mO\u001b[0mW\u001b[0mM\u001b[0mM\u001b[0m0\u001b[0m.\u001b[0m.\u001b[0m.\u001b[0m'\u001b[0ml\u001b[0mN\u001b[0mK\u001b[0mo\u001b[0m,\u001b[32m;\u001b[32mc\u001b[0mO\u001b[0mX\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mK\u001b[0mx\u001b[0mx\u001b[0m0\u001b[0mk\u001b[0m,\u001b[0m \u001b[0m \u001b[0m \u001b[32m.\u001b[32m.\u001b[32mc\u001b[32mc\u001b[32mc\u001b[0mc\u001b[0mx\u001b[0mK\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mc\u001b[0m \u001b[0m \u001b[0m \u001b[0m.\u001b[0m \u001b[0mc\u001b[0mM\u001b[0mM\u001b[0mW\u001b[0md\u001b[0mk\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0m:\u001b[0m \u001b[0m \u001b[0m.\u001b[0m.\u001b[0mk\u001b[0mM\u001b[0m0\u001b[0m.\u001b[0m \u001b[32mc\u001b[32mc\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[0mk\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mW\u001b[0mx\u001b[0mc\u001b[0m,\u001b[0m,\u001b[0ml\u001b[0mN\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mO\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mk\u001b[0m.\u001b[0m.\u001b[0m \u001b[0m \u001b[0mo\u001b[0mM\u001b[0mM\u001b[0md\u001b[0m \u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[0m:\u001b[0md\u001b[0mK\u001b[0mW\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mO\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mN\u001b[0mX\u001b[0mN\u001b[0mM\u001b[0mM\u001b[0mK\u001b[0m.\u001b[0m \u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m;\u001b[32m;\u001b[0m:\u001b[0mc\u001b[0md\u001b[0mk\u001b[0m0\u001b[0m0\u001b[0m0\u001b[0m0\u001b[0mk\u001b[0mO\u001b[0mx\u001b[0m:\u001b[0ml\u001b[0mN\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mM\u001b[0mN\u001b[0mk\u001b[0m,\u001b[0m \u001b[0m \u001b[0m \u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m:\u001b[32m:\u001b[32m:\u001b[32m:\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m'\u001b[31m;\u001b[31m:\u001b[31m:\u001b[32m,\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m.\u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[32m:\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m,\u001b[31m;\u001b[31m:\u001b[31m,\u001b[31m,\u001b[31m;\u001b[31m,\u001b[32m,\u001b[32m;\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m.\u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[32m,\u001b[32m,\u001b[32m:\u001b[32m,\u001b[32m'\u001b[32m:\u001b[32m;\u001b[32m'\u001b[32m,\u001b[31m;\u001b[31m:\u001b[31m,\u001b[31m,\u001b[31m,\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m,\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m,\u001b[32m.\u001b[32m\u001b[0m \u001b[32mc\u001b[32m;\u001b[32m;\u001b[32mc\u001b[32m'\u001b[32m,\u001b[32mc\u001b[32m,\u001b[32mc\u001b[32m;\u001b[32m,\u001b[31m,\u001b[31m,\u001b[31m:\u001b[31m:\u001b[31m;\u001b[31m,\u001b[31m,\u001b[31m,\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m:\u001b[32mc\u001b[32m,\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m;\u001b[31m:\u001b[31m,\u001b[32m:\u001b[32m;\u001b[32m.\u001b[32m\u001b[0m \u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m,\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m,\u001b[32m;\u001b[32m:\u001b[32m,\u001b[32m.\u001b[32m\u001b[0m \u001b[34m.\u001b[32m'\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m;\u001b[32m;\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m:\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m:\u001b[32m;\u001b[34m,\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m.\u001b[32m,\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32mc\u001b[32m,\u001b[32m,\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m;\u001b[32m,\u001b[32m'\u001b[34m.\u001b[34m,\u001b[34m,\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[32m\u001b[0m \u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m.\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m,\u001b[34m,\u001b[34m,\u001b[34m,\u001b[34m'\u001b[34m.\u001b[34m.\u001b[34m.\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m.\u001b[34m.\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m.\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m'\u001b[34m.\u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m \u001b[0m logrotate 사용자 log\nsudo vi /etc/logrotate.d/dev /home/dev/.local/log/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d nocompress create 0664 dev dev sharedscripts postrotate docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } 이하 기본 logrotate 재구성\nsudo vi /etc/logrotate.d/btmp /var/log/btmp { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0660 root utmp } sudo vi /etc/logrotate.d/chrony /var/log/chrony/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate /usr/bin/chronyc cyclelogs \u003e /dev/null 2\u003e\u00261 || true endscript nocreate } sudo vi /etc/logrotate.d/dnf /var/log/hawkey.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create } sudo vi /etc/logrotate.d/firewalld /var/log/firewalld { weekly missingok rotate 4 copytruncate minsize 1M } sudo vi /etc/logrotate.d/iscsiuiolog /var/log/iscsiuio.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate pkill -USR1 iscsiuio 2\u003e /dev/null || true endscript } sudo vi /etc/logrotate.d/kvm_stat /var/log/kvm_stat.csv { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d postrotate /usr/bin/systemctl try-restart kvm_stat.service endscript } sudo vi /etc/logrotate.d/rsyslog /var/log/cron /var/log/maillog /var/log/messages /var/log/secure /var/log/spooler { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 root root sharedscripts postrotate /usr/bin/systemctl -s HUP kill rsyslog.service \u003e/dev/null 2\u003e\u00261 || true docker restart promtail \u003e/dev/null 2\u003e\u00261 || true endscript } sudo vi /etc/logrotate.d/sssd /var/log/sssd/*.log { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d sharedscripts postrotate /bin/kill -HUP `cat /var/run/sssd.pid 2\u003e/dev/null` 2\u003e /dev/null || true /bin/pkill -HUP sssd_kcm 2\u003e /dev/null || true endscript } sudo vi /etc/logrotate.d/wtmp /var/log/wtmp { daily rotate 7 missingok notifempty dateext dateyesterday dateformat -%Y%m%d create 0664 root utmp } 전체 구성 테스트 sudo find /etc/logrotate.d/ -type f -exec w {} \\; selinux\nsudo vi /etc/audit/auditd.conf ... local_events = yes write_logs = yes log_file = /var/log/audit/audit.log log_group = root log_format = ENRICHED flush = INCREMENTAL_ASYNC freq = 50 max_log_file = 8 num_logs = 5 ... crond 5 6 7 vi ~/.local/bin/cleanup_disk.sh #!/bin/bash # 디스크 정리 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp disk=\"$1\" days=\"$2\" if [ -z \"$disk\" ] || [ -z \"$days\" ]; then err \"MANDATORY PARAMETER MISSING\" exit 1 fi { #$days 이상 지난 log 삭제 varlog_cnt=$(find /var/log/ -type f -mtime +\"$days\" | wc -l) usrlog_cnt=$(find /home/dev/.local/log/ -type f -mtime +\"$days\" | wc -l) docker_cnt=$(find /opt/ -type f \\ -regex \".*\\.\\(log\\|log\\.[0-9]*.*\\|log\\.bak.*\\)\" \\ -mtime +\"$days\" | wc -l) find /var/log/ -type f -mtime +\"$days\" -exec rm {} \\; find /home/dev/.local/log/ -type f -mtime +\"$days\" -exec rm {} \\; find /opt/ -type f \\ -regex \".*\\.\\(log\\|log\\.[0-9]*.*\\|log\\.bak.*\\)\" \\ -mtime +\"$days\" -exec rm {} \\; #docker code-server 폴더 로그 삭제 if [ -d /opt/code-server ]; then base_date=$(date +%Y%m%d -d \"$days day ago\") delete_over_date \"$base_date\" \"/opt/code-server/config/data/logs\" \\ \"cut -c 1-8\" fi #docker 미사용 이미지 삭제 read -ra args \u003c \u003c(docker images -q -f dangling=true) docker rmi \"${args[@]}\" #prrometheus wal 삭제 (임시) #rm -rf /opt/prometheus/data/wal/* #rm -rf /opt/prometheus/data/chuncks_head/* #nginx log 삭제 (임시) #truncate -s 0 /opt/nginx/log/*.log #xfs 조각 모음 /usr/sbin/xfs_fsr \"$disk\"; /usr/sbin/hdparm -Tt \"$disk\" } \u003e \"$log_file\" { echo \"$disk\" #xfs 조각화 수준 검사 /usr/sbin/xfs_db -c frag -r \"$disk\" | grep -o \"fragmentation factor.*\" \\ | sed -E 's/(fragmentation) (factor) (.*)/\\1: \\3/g' grep \"reads\" \"$log_file\" -a \\ | sed -E 's/^(.*)(cached|disk)( reads: )(.* = )(.*)/\\2\\3\\5/g' \\ | sed 's/ */ /g' echo \"mtime +$days logs: $((\"$docker_cnt\"+\"$varlog_cnt\"+\"$usrlog_cnt\"))\" } \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" vi ~/.local/bin/dpasswd.sh #!/bin/bash # .dpasswd 파일 생성 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp db_yn=\"$1\" #db 연계 생성 여부 if [ -z \"$db_yn\" ]; then err \"MANDATORY PARAMETER MISSING\" exit 1 fi #.dpasswd 하루 1회 생성 file_mtime=$(stat --printf=\"%y\" /home/dev/.local/etc/.dpasswd) file_date=$(cut -c 1-10 \u003c\u003c\u003c \"$file_mtime\" | sed 's/-//g') if [[ $(date +%Y%m%d) == \"$file_date\" ]]; then echo \"GENERATED ONLY ONCE PER DAY\" exit 0 fi mv /home/dev/.local/etc/.dpasswd \"/home/dev/.local/etc/.dpasswd-$file_date\" if [ \"$db_yn\" == Y ]; then docker run \\ -i --rm --name=instantclient-icnex2pa --network=dev --user=0:0 \\ --env-file /opt/instantclient/.env \\ -e TZ=Asia/Seoul \\ -v /opt/instantclient/data:/data:rw \\ e7hnr8ov/instantclient:ubuntu \\ python3 /data/icnex2pa.py \u003e .dpasswd.tmp sed 's/key=//g' .dpasswd.tmp | sed -z 's/\\n//g' \u003e /home/dev/.local/etc/.dpasswd rm .dpasswd.tmp else rand_string 64 \u003e /home/dev/.local/etc/.dpasswd fi echo \"Secret key updated\" \u003e \"$log_file\" show_secret \"$(\u003c /home/dev/.local/etc/.dpasswd)\" 8 \u003e\u003e \"$log_file\" #backup to sj9n7air-ftp if [ -f \"/home/dev/.local/etc/.dpasswd-$file_date\" ]; then rclone copy \\ --config /home/dev/.config/rclone/rclone.conf \\ --log-file /home/dev/.local/log/rclone_dpasswd.log --log-level DEBUG \\ \"/home/dev/.local/etc/.dpasswd-$file_date\" \\ sj9n7air-ftp:/mnt/d2/backups/fhy8vp3u/etc fi rm /home/dev/.local/etc/.dpasswd-* echo \"key=$(\u003c /home/dev/.local/etc/.dpasswd)\" \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" vi ~/.local/bin/notify_df.sh #!/bin/bash # disk free 알림 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp if [ -z \"$1\" ]; then err \"MANDATORY PARAMETER MISSING\" exit 1 fi { for i in $1; do show_disk_stat \"$i\"; done; } \u003e \"$log_file\" cp \"$log_file\" \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" License 상업적 이용 제한 없음\nrockylinux: Begin 3-Clause BSD License 8 Troubleshooting /usr/sbin/grub2-probe: error: failed to get canonical path of ‘/dev/mapper/rl_sj9n7air-root’\n업데이트 안 되는 경우 boot menu에서 args를 새 이름으로 변경하고 진입 후 grub2-mkconfig 실행\nsudo grubby --info DEFAULT \u0026\u0026 \\ sudo grubby args=\"ro crashkernel=1G-4G:192M,4G-64G:256M,64G-:512M noresume rd.lvm.lv=rl/root psi=1\" root=\"/dev/mapper/rl-root\" --update-kernel ALL sudo journalctl -b -u auditd /var/log/audit/audit.log is not a regular file\nThe audit daemon is exiting.\nsudo restorecon -Rv /var/log/audit/ \u0026\u0026 \\ sudo rm -rf /var/log/audit/audit.log \u0026\u0026 \\ sudo touch /var/log/audit/audit.log \u0026\u0026 \\ sudo chown root:root /var/log/audit \u0026\u0026 \\ sudo chmod 0700 /var/log/audit \u0026\u0026 \\ sudo chmod 0600 /var/log/audit/audit.log sudo service auditd restart \u0026\u0026 sudo systemctl status auditd audit service 중지되었을 때 systemctl로는 다시 시작 불가. service 사용할 것\nReferences https://askubuntu.com/questions/290937/what-is-the-best-directory-for-script-files https://superuser.com/questions/981981/how-can-i-excute-my-bash-shell-script-from-any-directory 최소: 8GB, 최대: 총 메모리/2 (zram-size=min(ram/2, 8192)) ↩︎\nhttps://access.redhat.com/solutions/1301563 ↩︎\nhttps://grafana.com/grafana/dashboards/1860-node-exporter-full ↩︎\nhttps://www.shellcheck.net/ ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/cleanup_disk.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/dpasswd.sh ↩︎\nhttps://github.com/dntco43u/s6h7k8rv/blob/main/notify_df.sh ↩︎\nhttps://rockylinux.org/legal/licensing ↩︎\n","categories":["infra"],"description":"RHLE9 기타 구성 메모","excerpt":"RHLE9 기타 구성 메모","ref":"/infra/rhel9-etc/","tags":["rhel"],"title":"RHEL9 기타 구성"},{"body":"\nAlmaLinux 8 -\u003e rockylinux 8 1 2 sudo curl https://raw.githubusercontent.com/rocky-linux/rocky-tools/main/migrate2rocky/migrate2rocky.sh -o migrate2rocky.sh \u0026\u0026 \\ sudo chmod u+x migrate2rocky.sh \u0026\u0026 \\ sudo ./migrate2rocky.sh -r sudo reboot; cat /etc/*release* Troubleshooting Problem 1: package linux-firmware-core-999:20220304-999.13.gitf011ccb4.el8.noarch conflicts with linux-firmware \u003c= 999:20211203-999.10.gitb0e898fb.el8 provided by linux-firmware-20220210-107.git6342082c.el8.noarch\nfirmware 패키지 충돌. 문제 없음\nProblem 2: package tuned-profiles-oci-2.18.0-2.0.1.el8.noarch requires tuned = 2.18.0-2.0.1.el8, but none of the providers can be installed\nxoraclecloud 패키지 누락. 문제 없음\nProblem 3: package tuned-profiles-oci-2.18.0-2.0.1.el8.noarch requires tuned = 2.18.0-2.0.1.el8, but none of the providers can be installed\noraclecloud 패키지 누락. 문제 없음\nhttps://docs.rockylinux.org/10/guides/migrate2rocky/ ↩︎\nhttps://github.com/rocky-linux/rocky-tools/tree/main/migrate2rocky ↩︎\n","categories":["etc"],"description":"AlmaLinux 8 -\u003e rockylinux 8 마이그레이션","excerpt":"AlmaLinux 8 -\u003e rockylinux 8 마이그레이션","ref":"/etc/rockylinux-migration/","tags":["rhel"],"title":"rockylinux 마이그레이션"},{"body":"\n벤치마크 geekbench4 1 yabs.sh #!/bin/bash # geekbench 벤치마크 source /home/dev/.bashrc source /home/dev/.local/bin/utils.sh log_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').log msg_file=/home/dev/.local/log/$(basename \"$0\" | sed 's/.sh//').tmp curl -sL https://raw.githubusercontent.com/masonr/yet-another-bench-script/master/yabs.sh \\ | bash -s -- -bi4 \u003e \"$log_file\" { grep -oE \"completed in.*\" \"$log_file\" \\ | sed -E 's/(completed in.)(.*)/Elapsed time: \\2/g' grep -E \"Host\\s*:\" \"$log_file\" \\ | sed -E 's/(Host)(\\s*)(:.*)/\\1\\3/g' grep -E \"Distro\\s*:\" \"$log_file\" \\ | sed -E 's/(Distro)(\\s*)(:.*)/OS\\3/g' cpu=\"$(grep -E \"Processor\\s*:\" \"$log_file\" \\ | sed -E 's/(Processor)(\\s*)(:.*)/CPU\\3/g')\" ram=\"$(grep -E \"RAM\\s:*\" \"$log_file\" \\ | sed -E 's/(RAM)(\\s*)(:.*)/\\1\\3/g')\" disk=\"$(grep -E \"Disk\\s*:\" \"$log_file\" \\ | sed -E 's/(Disk)(\\s*)(:.*)/\\1\\3/g')\" echo \"$cpu, $ram, $disk\" single=\"$(grep -E \"Single Core\" \"$log_file\" \\ | sed -E 's/(Single Core)(\\s*\\| )([0-9]*)(\\s*)/\\1: \\3/g')\" multi=\"$(grep -E \"Multi Core\" \"$log_file\" \\ | sed -E 's/(Multi Core)(\\s*\\| )([0-9]*)(\\s*)/\\1: \\3/g')\" echo \"$single, $multi\" grep \"Read\" \"$log_file\" \\ | tail -n 1 \\ | awk '{ print \"1M \"$1\": \"$7\" \"$8\", IOPS: \"$9 }' \\ | sed -E 's/\\(|\\)//g' grep \"Write\" \"$log_file\" \\ | tail -n 1 \\ | awk '{ print \"1M \"$1\": \"$7\" \"$8\", IOPS: \"$9 }' \\ | sed -E 's/\\(|\\)//g' grep \"Read\" \"$log_file\" \\ | head -n 1 \\ | awk '{ print \"4K \"$1\": \"$3\" \"$4\", IOPS: \"$5 }' \\ | sed -E 's/\\(|\\)//g' grep \"Write\" \"$log_file\" \\ | head -n 1 \\ | awk '{ print \"4K \"$1\": \"$3\" \"$4\", IOPS: \"$5 }' \\ | sed -E 's/\\(|\\)//g' grep \"Full Test\" \"$log_file\" \\ | sed -E 's/(Full Test)(\\s*\\| )(.*)/\\3/g' rm /home/dev/geekbench_claim.url } \u003e \"$msg_file\" send_tel_msg \"$TEL_BOT_KEY\" \"$TEL_CHAT_ID\" \"$msg_file\" rm \"$msg_file\" J1900 + 850EVO Single Core 240 Multi Core 705 1M Read 130.57 MB/s IOPS 127 1M Write 139.27 MB/s IOPS 136 4K Read 94.11 MB/s IOPS 23.5k 4K Write 94.36 MB/s IOPS 23.5k J5005 + PM871B Single Core 494 Multi Core 1588 1M Read 118.12 MB/s IOPS 115 1M Write 125.98 MB/s IOPS 123 4K Read 93.56 MB/s IOPS 23.3k 4K Write 93.81 MB/s IOPS 23.4k J5005 + PM9A1 Single Core 494 Multi Core 1578 1M Read 321.23 MB/s IOPS 313 1M Write 342.62 MB/s IOPS 334 4K Read 230.73 MB/s IOPS 57.6k 4K Write 231.34 MB/s IOPS 57.8k geekbench5 J5005 + PM9A1 https://github.com/dntco43u/s6h7k8rv/blob/main/yabs.sh ↩︎\n","categories":["etc"],"description":"蜗牛星际 snail interstellar 타오나스, lenovo v330-15igm 등 저성능 서버 yabs.sh 벤치마크","excerpt":"蜗牛星际 snail interstellar 타오나스, lenovo v330-15igm 등 저성능 서버 yabs.sh 벤치마크","ref":"/etc/low-performance-nas-benchmarks/","tags":["rhel","benchmark"],"title":"구형 nas 벤치마크"},{"body":"\n가용 메모리 비교 설치 후 초기 상태에서 비교\nfree -h ubuntu 22.04 lts total used free shared buff/cache available Mem: 833 239 216 3 377 449 Swap: 0 0 0 oracle linux total used free shared buff/cache available Mem: 682Mi 237Mi 144Mi 4.0Mi 300Mi 335Mi Swap: 1.3Gi 1.0Mi 1.3Gi rockylinux (migrated) total used free shared buff/cache available Mem: 959Mi 213Mi 477Mi 6.0Mi 267Mi 603Mi Swap: 0B 0B 0B debian 11 bullseye total used free shared buff/cache available Mem: 863 133 405 0 323 600 Swap: 0 0 0 ubuntu minimal total used free shared buff/cache available Mem: 966Mi 121Mi 456Mi 1.0Mi 388Mi 706Mi Swap: 0B 0B 0B Note rockylinux는 debian 수준으로 가볍다\n","categories":["etc"],"description":"linux 배포판 별 실제 가용 메모리를 확인","excerpt":"linux 배포판 별 실제 가용 메모리를 확인","ref":"/etc/memory-usage-by-linux-distribution/","tags":["rhel","debian","benchmark"],"title":"배포판 별 메모리 사용량"}]